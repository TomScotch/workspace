(function(window,Object,undefined){"use strict";function WheelEventProxy(a,b){this._scaleFactor=a,this._deltaMode=b,this.originalEvent=null}if(!window.qc||!window.qc.Node){var deepCopy=function(a){var b=[],c=function(a,b){for(var c in a)if(a[c]==b)return!0;return!1},d=function(a){if("object"!=typeof a||null===a)return a;if(c(b,a))return a;b.push(a);var e={};a.constructor===Array&&(e=[]);for(var f in a)a.hasOwnProperty(f)&&(e[f]=d(a[f]));return e};return d(a)},mixin=function(a,b,c){for(var d in b)c&&a[d]!==undefined||(a[d]=b[d]);return a};window.qc||(window.qc={});var qc=window.qc,Phaser=window.Phaser,PIXI=window.PIXI;mixin(qc,{PHASER_VERSION:Phaser.VERSION,GAMES:Phaser.GAMES,AUTO:Phaser.AUTO,CANVAS:Phaser.CANVAS,WEBGL:Phaser.WEBGL,HEADLESS:Phaser.HEADLESS,NONE:Phaser.NONE,LEFT:Phaser.LEFT,RIGHT:Phaser.RIGHT,UP:Phaser.UP,DOWN:Phaser.DOWN,scaleModes:Phaser.scaleModes}),this.qc=this.qc||{};var Log=qc.Log=function(a){var b=this;b.game=a,b.enableTrace=!1};Log.prototype.trace=function(){if(this.game.remoteLogUrl){var a=qc.Util.formatString.apply(null,arguments);console.log(a);var b=new Date,c=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+":"+b.getMilliseconds();qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",c+" "+a,function(){})}else if(this.enableTrace){var a=qc.Util.formatString.apply(null,arguments);console.log(a)}},Log.prototype.important=function(){var a=qc.Util.formatString.apply(null,arguments);if(console.log("%c"+a,"color:green"),this.game.remoteLogUrl){var b=new Date,c=b.getHours()+":"+b.getMinutes()+":"+b.getSeconds()+":"+b.getMilliseconds();qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",c+" "+a,function(){})}},Log.prototype.error=function(){var a=qc.Util.formatString.apply(null,arguments);console.log("%c"+a,"color:red");for(var b,c=1;c<arguments.length;c++)if(arguments[c]&&arguments[c].stack){b=arguments[c].stack,console.error(b);break}this.game.remoteLogUrl&&qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",Date.now()+" "+b?b:a,function(){}),b||console.trace()},Log.prototype.remoteReply=function(){var a=qc.Util.formatString.apply(null,arguments);console.log("%c"+a,"color:green"),qc.AssetUtil.post(this.game.remoteLogUrl+"/remoteLog",a,function(){})},qc.Circle=Phaser.Circle,Object.defineProperty(qc.Circle.prototype,"class",{get:function(){return"qc.Circle"}}),qc.Circle.prototype.toJson=function(){return[this.x,this.y,this.diameter]},qc.Circle.prototype.fromJson=function(a){this.x=a[0],this.y=a[1],this.diameter=a[2]},qc.Ellipse=Phaser.Ellipse,Object.defineProperty(qc.Ellipse.prototype,"class",{get:function(){return"qc.Ellipse"}}),qc.Ellipse.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},qc.Ellipse.prototype.fromJson=function(a){this.x=a[0],this.y=a[1],this.width=a[2],this.height=a[3]},qc.Line=Phaser.Line,Object.defineProperty(qc.Line.prototype,"class",{get:function(){return"qc.Line"}}),qc.Line.prototype.toJson=function(){return[this.start.x,this.start.y,this.end.x,this.end.y]},qc.Line.prototype.fromJson=function(a){this.start.setTo(a[0],a[1]),this.end.setTo(a[2],a[3])},qc.Matrix=Phaser.Matrix,Object.defineProperty(qc.Matrix.prototype,"class",{get:function(){return"qc.Matrix"}}),qc.Matrix.prototype.toJson=function(){return this.toArray()},qc.Matrix.prototype.fromJson=function(a){this.fromArray(a)},qc.Point=Phaser.Point,Object.defineProperty(qc.Point.prototype,"class",{get:function(){return"qc.Point"}}),qc.Point.prototype.toJson=function(){return[this.x,this.y]},qc.Point.prototype.fromJson=function(a){this.x=a[0],this.y=a[1]},qc.Polygon=Phaser.Polygon,Object.defineProperty(qc.Polygon.prototype,"class",{get:function(){return"qc.Polygon"}}),qc.Polygon.prototype.toJson=function(){return[this.toNumberArray(),this.closed]},qc.Polygon.prototype.fromJson=function(a){this.setTo(a[0]),this.closed=a[1]},qc.Rectangle=Phaser.Rectangle,Object.defineProperty(qc.Rectangle.prototype,"class",{get:function(){return"qc.Rectangle"}}),qc.Rectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height]},qc.Rectangle.prototype.fromJson=function(a){this.setTo(a[0],a[1],a[2],a[3])},qc.RoundedRectangle=Phaser.RoundedRectangle,Object.defineProperty(qc.RoundedRectangle.prototype,"class",{get:function(){return"qc.RoundedRectangle"}}),qc.RoundedRectangle.prototype.toJson=function(){return[this.x,this.y,this.width,this.height,this.radius]},qc.RoundedRectangle.prototype.fromJson=function(a){this.x=a[0],this.y=a[1],this.width=a[2],this.height=a[3],this.radius=a[4]};var Keyframe=qc.Keyframe=function(a,b,c,d){this.time=a,this.value=b,this.type=Keyframe.FREE_SMOOTH,this.inTangent=isNaN(c)?0:c,this.outTangent=isNaN(d)?0:d};Keyframe.prototype={},Keyframe.prototype.constructor=Keyframe,Keyframe.prototype.clone=function(){var a=new Keyframe(this.time,this.value,this.inTangent,this.outTangent);return a.type=this.type,a},Keyframe.AUTO=0,Keyframe.FREE_SMOOTH=1,Keyframe.FLAT=2,Keyframe.BROKEN=3,Keyframe.LINEAR=4,Keyframe.InfinityValue=Math.tan(Math.PI/2),Object.defineProperties(Keyframe.prototype,{inAngle:{get:function(){return Math.atan(this.inTangent)},set:function(a){this.inTangent=Math.tan(a*Math.PI/180)}},outAngle:{get:function(){return Math.atan(this.outTangent)},set:function(a){this.outTangent=Math.tan(a*Math.PI/180)}},inTangent:{get:function(){return this._inTangent||0},set:function(a){this._inTangent=Math.abs(a)===Keyframe.InfinityValue?(0>a?-1:1)*(1/0):a}},outTangent:{get:function(){return this._outTangent||0},set:function(a){this._outTangent=Math.abs(a)===Keyframe.InfinityValue?(0>a?-1:1)*(1/0):a}},isFlat:{get:function(){return this.inTangent===this.outTangent&&0===this.outTangent}},isBroken:{get:function(){return this.inTangent!==this.outTangent}}});var BezierCurve=qc.BezierCurve=function(a){if(this._keys=[],Array.isArray(a))for(var b in a)this.addKey(a[b]);else for(var b=0;b<arguments.length;++b)this.addKey(arguments[b])};BezierCurve.prototype={},BezierCurve.prototype.constructor=BezierCurve,Object.defineProperties(BezierCurve.prototype,{"class":{get:function(){return"qc.BezierCurve"}},keys:{get:function(){return this._keys},set:function(a){this._keys=[];for(var b in a)this.addKey(a[b])}},length:{get:function(){return this._keys.length}},startTime:{get:function(){return this.keys&&this.keys.length?this.keys[0].time:0}},endTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time:0}},totalTime:{get:function(){return this.keys&&this.keys.length?this.keys[this.keys.length-1].time-this.keys[0].time:0}},postWrapMode:{get:function(){return isNaN(this._postWrapMode)?BezierCurve.WRAP_CLAMP:this._postWrapMode},set:function(a){this._postWrapMode=a}},preWrapMode:{get:function(){return isNaN(this._preWrapMode)?BezierCurve.WRAP_CLAMP:this._preWrapMode},set:function(a){this._preWrapMode=a}}}),BezierCurve.prototype.toJson=function(){for(var a=[],b=0;b<this._keys.length;++b)a.push([this._keys[b].time,this._keys[b].value,this._keys[b].inTangent===1/0?"Infinity":this._keys[b].inTangent,this._keys[b].outTangent===1/0?"Infinity":this._keys[b].outTangent]);return a.push([this.preWrapMode,this.postWrapMode]),a},BezierCurve.prototype.fromJson=function(a){for(var b=0;b<a.length;++b)4===a[b].length&&this.addKey(a[b][0],a[b][1],"Infinity"===a[b][2]?1/0:a[b][2],"Infinity"===a[b][3]?1/0:a[b][3]);2===a[a.length-1].length&&(this.preWrapMode=a[a.length-1][0],this.postWrapMode=a[a.length-1][1])},BezierCurve.prototype.sort=function(){this._keys.sort(function(a,b){return a.time-b.time})},BezierCurve.prototype.addKey=function(a,b,c,d){var e=!(a instanceof Keyframe)&&(isNaN(c)||isNaN(d)),f=a instanceof Keyframe?a:new Keyframe(a,b,c,d),g=qc.Util.insertSortedList(this._keys,f,this._keyframeLess);return e&&this.makeKeyframeAuto(g),g},BezierCurve.prototype.removeKey=function(a){return this._keys?this._keys.splice(a,1):null},BezierCurve.prototype._keyframeLess=function(a,b){return a.time<b.time},BezierCurve.prototype._calc=function(a,b,c,d,e){var f=Math.pow(1-a,3)*b+3*Math.pow(1-a,2)*a*c+3*(1-a)*Math.pow(a,2)*e+d*Math.pow(a,3);return f===1/0||isNaN(f)||Math.abs(f)>=2147483647?1===a?d:b:f},BezierCurve.prototype._calcDerivative=function(a,b,c,d,e){var f=1-a,g=-3*b*f*f+3*c*f*(1-3*a)+3*e*a*(2-3*a)+3*d*Math.pow(a,2);return g===1/0||isNaN(g)?0:g},BezierCurve.prototype.evaluate=function(a,b){var c=0,d=this._keys?this._keys.length:0;if(0===d)return 0/0;if(1===d)return this._keys[0].value;var e=this._keys[0].time,f=this._keys[d-1].time,g=f-e;if(e>a){if(0===g||this.preWrapMode===BezierCurve.WRAP_CLAMP)return this._keys[0].value;if(this.preWrapMode===BezierCurve.WRAP_LOOP){var h=e-a;return h-=Math.floor(h/g)*g,this.evaluate(f-h,b)}if(this.preWrapMode===BezierCurve.WRAP_PINGPONG){var h=e-a;return h-=2*Math.floor(h/(2*g))*g,g>=h?this.evaluate(e+h,b):this.evaluate(f-h+g,b)}}if(a>f){if(0===g||this.postWrapMode===BezierCurve.WRAP_CLAMP)return this._keys[d-1].value;if(this.postWrapMode===BezierCurve.WRAP_LOOP){var h=a-f;return h-=Math.floor(h/g)*g,this.evaluate(e+h,b)}if(this.postWrapMode===BezierCurve.WRAP_PINGPONG){var h=a-f;return h-=2*Math.floor(h/(2*g))*g,g>=h?this.evaluate(f-h,b):this.evaluate(e+h-g,b)}}a===e&&b&&this.preWrapMode!==BezierCurve.WRAP_CLAMP&&(a=f);for(var i;++c<d;)if(i=this._keys[c].time,i!==e){if(i>=a){var j=i-e,k=(this._keys[c].value-this._keys[c-1].value,(a-e)/j),l=this._calc(k,this._keys[c-1].value,this._keys[c-1].value+j*this._keys[c-1].outTangent/3,this._keys[c].value,this._keys[c].value-j*this._keys[c].inTangent/3);return l}e=this._keys[c].time}return 0/0},BezierCurve.prototype.evaluateDerivative=function(a){var b=0,c=this._keys?this._keys.length:0;if(0===c)return 0/0;var d=this._keys[0].time;if(d>a||a>this._keys[c-1].time)return 0/0;for(var e;++b<c;)if(e=this._keys[b].time,e!==d){if(e>a){var f=e-d,g=(a-d)/f,h=this._calcDerivative(g,this._keys[b-1].value,this._keys[b-1].value+f*this._keys[b-1].outTangent/3,this._keys[b].value,this._keys[b].value-f*this._keys[b].inTangent/3);return h/f}d=this._keys[b].time}return 0/0},BezierCurve.prototype.makeKeyframeAuto=function(a){var b=a>=0&&a<this._keys.length?this.keys[a]:null,c=a>0&&a<this._keys.length?this._keys[a-1]:null,d=a<=this._keys.length-1&&a>=0?this._keys[a+1]:null,e=0,f=0;b&&(c&&(e++,f+=Math.atan2(b.value-c.value,b.time-c.time)),d&&(e++,f+=Math.atan2(d.value-b.value,d.time-b.time)),e>0&&(b.inTangent=b.outTangent=Math.tan(f/e)))},BezierCurve.prototype.makeKeyframeSmooth=function(a){var b=a>=0&&a<this._keys.length?this.keys[a]:null;if(b){var c=Math.atan(b.inTangent)+Math.atan(b.outTangent);b.inTangent=b.outTangent=Math.tan(c/2)}},BezierCurve.prototype.makeKeyframeFlat=function(a){var b=a>=0&&a<this._keys.length?this.keys[a]:null;b&&(b.inTangent=b.outTangent=0)},BezierCurve.prototype.makeKeyframeLinear=function(a){var b=a>=0&&a<this._keys.length?this.keys[a]:null,c=a>0&&a<this._keys.length?this._keys[a-1]:null,d=a<=this._keys.length-1&&a>=0?this._keys[a+1]:null;b&&(c&&(b.inTangent=(b.value-c.value)/(b.time-c.time)),d&&(b.outTangent=(d.value-b.value)/(d.time-b.time)))},BezierCurve.prototype.clone=function(){var a=new BezierCurve([]);for(var b in this._keys)a.addKey(this._keys[b].clone());return a},BezierCurve.WRAP_CLAMP=0,BezierCurve.WRAP_LOOP=1,BezierCurve.WRAP_PINGPONG=2;var GeometricTool=qc.GeometricTool={};GeometricTool.flattenPolygon=function(a){for(var b=new Array(2*a.length),c=a.length;c--;)b[2*c]=a[c].x,b[2*c+1]=a[c].y;return b},GeometricTool.polygonContains=function(a,b,c){if(isNaN(a[0])){for(var d=a.length,e=!1,f=-1,g=d-1;++f<d;g=f){var h=a[f].x,i=a[f].y,j=a[g].x,k=a[g].y;(c>=i&&k>c||c>=k&&i>c)&&(j-h)*(c-i)/(k-i)+h>b&&(e=!e)}return e}for(var d=a.length/2,e=!1,f=-1,g=d-1;++f<d;g=f){var h=a[2*f],i=a[2*f+1],j=a[2*g],k=a[2*g+1];(c>=i&&k>c||c>=k&&i>c)&&(j-h)*(c-i)/(k-i)+h>b&&(e=!e)}return e},GeometricTool.pointOnLine=function(a,b,c,d){return(c-a.x)*(b.y-a.y)===(b.x-a.x)*(d-a.y)},GeometricTool.pointOnSegment=function(a,b,c,d){var e=Math.min(a.x,b.x),f=Math.max(a.x,b.x),g=Math.min(a.y,b.y),h=Math.max(a.y,b.y);return qc.GeometricTool.pointOnLine(a,b,c,d)&&c>=e&&f>=c&&d>=g&&h>=d},GeometricTool.lineIntersectsPoints=function(a,b,c,d,e,f){"undefined"==typeof e&&(e=!0),f||(f=new qc.Point);var g=b.y-a.y,h=d.y-c.y,i=a.x-b.x,j=c.x-d.x,k=b.x*a.y-a.x*b.y,l=d.x*c.y-c.x*d.y,m=g*j-h*i;if(0===m)return null;if(a.equals(c)||a.equals(d))return f.x=a.x,f.y=a.y,f;if(b.equals(c)||b.equals(d))return f.x=b.x,f.y=b.y,f;if(f.x=(i*l-j*k)/m,f.y=(h*k-g*l)/m,e){var n=(d.y-c.y)*(b.x-a.x)-(d.x-c.x)*(b.y-a.y),o=((d.x-c.x)*(a.y-c.y)-(d.y-c.y)*(a.x-c.x))/n,p=((b.x-a.x)*(a.y-c.y)-(b.y-a.y)*(a.x-c.x))/n;return o>=0&&1>=o&&p>=0&&1>=p?f:null}return f};var inside=GeometricTool._sutherlandHodgmanInside=function(a,b,c,d){return(b.x-a.x)*(c.y-a.y)+d>=(b.y-a.y)*(c.x-a.x)},intersection=GeometricTool._sutherlandHodgmanIntersection=function(a,b,c,d){var e=[a.x-b.x,a.y-b.y],f=[c.x-d.x,c.y-d.y],g=a.x*b.y-a.y*b.x,h=c.x*d.y-c.y*d.x,i=1/(e[0]*f[1]-e[1]*f[0]);return{x:(g*f[0]-h*e[0])*i,y:(g*f[1]-h*e[1])*i}};GeometricTool.sutherlandHodgman=function(a,b){var c,d,e,f,g,h,i=1e-6,j=a;c=b[b.length-1];for(g in b){var d=b[g],k=j;j=[],e=k[k.length-1];for(h in k){var f=k[h];inside(c,d,f,i)?(inside(c,d,e,i)||j.push(intersection(c,d,e,f)),j.push(f)):inside(c,d,e,i)&&j.push(intersection(c,d,e,f)),e=f}c=d}return j},GeometricTool.Triangulate=function(a){var b=!0,c=a.length;if(3>c)return[];for(var d=[],e=[],f=0;c>f;f++)e.push(f);f=0;for(var g=c;g>3;){var h=e[(f+0)%g],i=e[(f+1)%g],j=e[(f+2)%g],k=a[h].x,l=a[h].y,m=a[i].x,n=a[i].y,o=a[j].x,p=a[j].y,q=!1;if(PIXI.PolyK._convex(k,l,m,n,o,p,b)){q=!0;for(var r=0;g>r;r++){var s=e[r];if(s!==h&&s!==i&&s!==j&&PIXI.PolyK._PointInTriangle(a[s].x,a[s].y,k,l,m,n,o,p)){q=!1;break}}}if(q)d.push(h,i,j),e.splice((f+1)%g,1),g--,f=0;else if(f++>3*g){if(!b)return null;for(d=[],e=[],f=0;c>f;f++)e.push(f);f=0,g=c,b=!1}}return d.push(e[0],e[1],e[2]),d},GeometricTool.area=function(a,b,c){return a&&b&&c?(b.x-a.x)*(c.y-a.y)-(c.x-a.x)*(b.y-a.y):0},GeometricTool.left=function(a,b,c){return GeometricTool.area(a,b,c)>0},GeometricTool.leftOn=function(a,b,c){return GeometricTool.area(a,b,c)>=0},GeometricTool.right=function(a,b,c){return GeometricTool.area(a,b,c)<0},GeometricTool.rightOn=function(a,b,c){return GeometricTool.area(a,b,c)<=0},GeometricTool.distance=function(a,b){var c=b.x-a.x,d=b.y-a.y;return c*c+d*d},GeometricTool.atPolygon=function(a,b){var c=a.length;return a[0>b?b%c+c:b%c]},GeometricTool.lineInt=function(a,b,c){c=c||0;var d,e,f,g,h,i,j,k=new qc.Point;return d=a[1].y-a[0].y,e=a[0].x-a[1].x,f=d*a[0].x+e*a[0].y,g=b[1].y-b[0].y,h=b[0].x-b[1].x,i=g*b[0].x+h*b[0].y,j=1/(d*h-g*e),GeometricTool._equals(j,0,c)||(k.x=(h*f-e*i)*j,k.y=(d*i-g*f)*j),k},GeometricTool.isPolygonReflex=function(a,b){return GeometricTool.right(GeometricTool.atPolygon(a,b-1),GeometricTool.atPolygon(a,b),GeometricTool.atPolygon(a,b+1))},GeometricTool.polygonCanSee=function(a,b,c){var d,e,f=[],g=[];if(GeometricTool.leftOn(GeometricTool.atPolygon(a,b+1),GeometricTool.atPolygon(a,b),GeometricTool.atPolygon(a,c))&&GeometricTool.rightOn(GeometricTool.atPolygon(a,b-1),GeometricTool.atPolygon(a,b),GeometricTool.atPolygon(a,c)))return!1;e=GeometricTool.distance(GeometricTool.atPolygon(a,b),GeometricTool.atPolygon(a,c));for(var h=0;h!=a.length;++h)if((h+1)%a.length!==b&&h!==b&&GeometricTool.leftOn(GeometricTool.atPolygon(a,b),GeometricTool.atPolygon(a,c),GeometricTool.atPolygon(a,h+1))&&GeometricTool.rightOn(GeometricTool.atPolygon(a,b),GeometricTool.atPolygon(a,c),GeometricTool.atPolygon(a,h))&&(f[0]=GeometricTool.atPolygon(a,b),f[1]=GeometricTool.atPolygon(a,c),g[0]=GeometricTool.atPolygon(a,h),g[1]=GeometricTool.atPolygon(a,h+1),d=GeometricTool.lineInt(f,g),GeometricTool.distance(GeometricTool.atPolygon(a,b),d)<e))return!1;return!0},GeometricTool._equals=function(a,b,c){return c=c||0,Math.abs(a-b)<c},GeometricTool.getIntersectionPoint=function(a,b,c,d,e){e=e||0;var f=b.y-a.y,g=a.x-b.x,h=f*a.x+g*a.y,i=d.y-c.y,j=c.x-d.x,k=i*c.x+j*c.y,l=f*j-i*g;return GeometricTool._equals(l,0,e)?{x:0,y:0}:{x:(j*h-g*k)/l,y:(f*k-i*h)/l}},GeometricTool.quickDecomp=function(a,b,c,d,e,f,g){f=f||100,g=g||0,e=e||25,b="undefined"!=typeof b?b:[],c=c||[],d=d||[];var h=[0,0],i=[0,0],j=[0,0],k=0,l=0,m=0,n=0,o=0,p=0,q=0,r=[],s=[],t=a;if(t.length<3)return b;if(g++,g>f)return b;for(var u=0;u<t.length;++u)if(GeometricTool.isPolygonReflex(t,u)){c.push(t[u]),k=l=Number.MAX_VALUE;for(var v=0;v<t.length;++v)GeometricTool.left(GeometricTool.atPolygon(t,u-1),GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v))&&GeometricTool.rightOn(GeometricTool.atPolygon(t,u-1),GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v-1))&&(j=GeometricTool.getIntersectionPoint(GeometricTool.atPolygon(t,u-1),GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v),GeometricTool.atPolygon(t,v-1)),GeometricTool.right(GeometricTool.atPolygon(t,u+1),GeometricTool.atPolygon(t,u),j)&&(m=GeometricTool.distance(t[u],j),l>m&&(l=m,i=j,p=v))),GeometricTool.left(GeometricTool.atPolygon(t,u+1),GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v+1))&&GeometricTool.rightOn(GeometricTool.atPolygon(t,u+1),GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v))&&(j=GeometricTool.getIntersectionPoint(GeometricTool.atPolygon(t,u+1),GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v),GeometricTool.atPolygon(t,v+1)),GeometricTool.left(GeometricTool.atPolygon(t,u-1),GeometricTool.atPolygon(t,u),j)&&(m=GeometricTool.distance(t[u],j),k>m&&(k=m,h=j,o=v)));if(p==(o+1)%t.length)j.x=(i.x+h.x)/2,j.y=(i.y+h.y)/2,d.push(j),o>u?(Array.prototype.push.apply(r,t.slice(u,o+1)),r.push(j),s.push(j),0!=p&&Array.prototype.push.apply(s,t.slice(p,t.length)),Array.prototype.push.apply(s,t.slice(0,u+1))):(0!=u&&Array.prototype.push.apply(r,t.slice(u,t.length)),Array.prototype.push.apply(r,t.slice(0,o+1)),r.push(j),s.push(j),Array.prototype.push.apply(s,t.slice(p,u+1)));else{if(p>o&&(o+=t.length),n=Number.MAX_VALUE,p>o)return b;for(var v=p;o>=v;++v)GeometricTool.leftOn(GeometricTool.atPolygon(t,u-1),GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v))&&GeometricTool.rightOn(GeometricTool.atPolygon(t,u+1),GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v))&&(m=GeometricTool.distance(GeometricTool.atPolygon(t,u),GeometricTool.atPolygon(t,v)),n>m&&(n=m,q=v%t.length));q>u?(Array.prototype.push.apply(r,t.slice(u,q+1)),0!=q&&Array.prototype.push.apply(s,t.slice(q,t.length)),Array.prototype.push.apply(s,t.slice(0,u+1))):(0!=u&&Array.prototype.push.apply(r,t.slice(u,t.length)),Array.prototype.push.apply(r,t.slice(0,q+1)),Array.prototype.push.apply(s,t.slice(q,u+1)))}return r.length<s.length?(GeometricTool.quickDecomp(r,b,c,d,e,f,g),GeometricTool.quickDecomp(s,b,c,d,e,f,g)):(GeometricTool.quickDecomp(s,b,c,d,e,f,g),GeometricTool.quickDecomp(r,b,c,d,e,f,g)),b}return b.push(t),b},GeometricTool.decomp=function(a){var b=GeometricTool.getCutEdges(a);return b.length>0?GeometricTool.polygonSlice(a,b):[a]},GeometricTool.polygonSlice=function(a,b){if(0===b.length)return[this];if(b instanceof Array&&b.length&&b[0]instanceof Array&&2==b[0].length&&b[0][0]instanceof Array){for(var c=[a],d=0;d<b.length;d++)for(var e=b[d],f=0;f<c.length;f++){var g=c[f],h=GeometricTool.polygonSlice(g,e);if(h){c.splice(f,1),c.push(h[0],h[1]);break}}return c}var e=b,d=a.indexOf(e[0]),f=a.indexOf(e[1]);return-1!=d&&-1!=f?[GeometricTool.copyPolygon(a,d,f),GeometricTool.copyPolygon(a,f,1)]:!1},GeometricTool.copyPolygon=function(a,b,c,d){var e=d||[];if(c>b)for(var f=b;c>=f;f++)e.push(a[f]);else{for(var f=0;c>=f;f++)e.push(a[f]);for(var f=b;f<a.length;f++)e.push(a[f])}return e},GeometricTool.getCutEdges=function(a){for(var b=[],c=[],d=[],e=Number.MAX_VALUE,f=0;f<a.length;++f)if(GeometricTool.isPolygonReflex(a,f))for(var g=0;g<a.length;++g)if(GeometricTool.polygonCanSee(a,f,g)){c=GeometricTool.getCutEdges(GeometricTool.copyPolygon(a,f,g)),d=GeometricTool.getCutEdges(GeometricTool.copyPolygon(a,g,f));for(var h=0;h<d.length;h++)c.push(d[h]);c.length<e&&(b=c,e=c.length,b.push([GeometricTool.atPolygon(a,f),GeometricTool.atPolygon(a,g)]))}return b};var AssetUtil=qc.AssetUtil={ASSET_SCENE:1,ASSET_PREFAB:2,ASSET_ATLAS:3,ASSET_TEXT:4,ASSET_FONT:5,ASSET_SOUND:6,ASSET_EXCEL:7,ASSET_WEBFONT:8,ASSET_ACTION:9,ASSET_ACTIONMANAGER:10,ASSET_TS:99,ASSET_JS:100,ASSET_UNKNOWN:101,parse:function(a,b,c){var d,e=b.key,f=b.url;if(!/\.bin$/.test(f)){if(b.isRaw)this._addAtlasToCache(a,e,f);else{var g=a.assets._cache.getSound(f);if(g){var h=new qc.SoundAsset(e,f,g.data,{uuid:e,type:AssetUtil.ASSET_SOUND});a.assets.cache(e,f,h)}}return void(c&&c())}if(b.isSound){var i=a.assets._cache.getBinary(f);delete a.assets._cache._binary[f];var j,k,l=new Uint8Array(i);if(81!==l[0]||67!==l[1])return a.log.error("Asset({0}) parse fail",f),void a.assets._parsing--;j=l,k=2;var m=function(){var a=j[k]<<24|j[k+1]<<16|j[k+2]<<8|j[k+3],b=k+4;return k+=a+4,[b,a]};d=[];var n;n=m(),d.push(a.serializer.unpackUTF8(j.subarray(n[0],n[0]+n[1]))),n=m(),d.push(i.slice(n[0],n[1]))}else{var i=a.assets._cache.getText(f);delete a.assets._cache._text[f];try{d=JSON.parse(i)}catch(o){return a.log.error("Asset{0}/{1} Parse fail",e,f),qc.Util.popupError(o.message),void(c&&c())}}var p=JSON.parse(d[0]);switch(p.type){case AssetUtil.ASSET_ATLAS:return AssetUtil._parseAtlas(a,p,JSON.parse(d[1]),d[2],d[3]?JSON.parse(d[3]):undefined,e,f,c);case AssetUtil.ASSET_PREFAB:return AssetUtil._parsePrefab(a,JSON.parse(d[1]),e,f,p,c);case AssetUtil.ASSET_SCENE:return AssetUtil._parseScene(a,JSON.parse(d[1]),e,f,p,c);case AssetUtil.ASSET_TEXT:return AssetUtil._parseText(a,d[1],e,f,p,c);case AssetUtil.ASSET_FONT:return AssetUtil._parseFont(a,p,d[1],d[2],e,f,c);case AssetUtil.ASSET_SOUND:return AssetUtil._parseSound(a,p,d[1],e,f,c);case AssetUtil.ASSET_EXCEL:return AssetUtil._parseExcel(a,p,JSON.parse(d[1]),e,f,c);case AssetUtil.ASSET_WEBFONT:return AssetUtil._parseWebFont(a,p,JSON.parse(d[1]),e,f,c);case AssetUtil.ASSET_ACTION:return AssetUtil._parseAction(a,JSON.parse(d[1]),e,f,p,c);case AssetUtil.ASSET_ACTIONMANAGER:return AssetUtil._parseActionManager(a,JSON.parse(d[1]),e,f,p,c);default:throw new Error("unsupported asset type："+p.type)}},isSound:function(a){if(qc.Util.isArray(a)){for(var b=0;b<a.length;b++)if(a[b]&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(a[b].toLowerCase()))return!0;return!1}return a&&/\.(mp3|ogg|mp3\.bin|ogg\.bin)$/.test(a.toLowerCase())},_parseAtlas:function(a,b,c,d,e,f,g,h){var i=new Image;i.src="data:image/png;base64,"+d,i.onerror=function(){i.onerror=undefined,h()},i.onload=function(){i.onload=undefined;var d=a.assets._cache;if(d._images[g]={url:g,data:i},PIXI.BaseTextureCache[g]=new PIXI.BaseTexture(i),PIXI.TextureCache[g]=new PIXI.Texture(PIXI.BaseTextureCache[g]),Object.keys(c).length>0)if(!e||b.animationType!==Sprite.DRAGON_BONES&&b.animationType!==Sprite.FRAME_SAMPLES)d._images[g].frameData=c&&qc.Util.isArray(c.frames)?Phaser.AnimationParser.JSONData(a.phaser,c,g):Phaser.AnimationParser.JSONDataHash(a.phaser,c,g);else{var j=qc.dragonBones.CoverAtlas(c);d._images[g].frameData=Phaser.AnimationParser.JSONDataHash(a.phaser,j,g)}else if(b.spriteSheet){var k=i.width/(b.spriteSheet.columns||1),l=i.height/(b.spriteSheet.rows||1),m=b.spriteSheet.margin||0,n=b.spriteSheet.spacing||0;d._images[g].frameData=Phaser.AnimationParser.spriteSheet(a.phaser,g,k,l,-1,m,n)}else d._images[g].frameData=new Phaser.FrameData,d._images[g].frame=new Phaser.Frame(0,0,0,i.width,i.height,"",""),d._images[g].frameData.addFrame(new Phaser.Frame(0,0,0,i.width,i.height,null,a.math.uuid()));d._resolveURL(g,d._images[g]);var o=new qc.Atlas(f,g,d._images[g],b,e);o.json=c,o.img=i,a.assets.cache(f,g,o),h()}},addAtlasFromImage:function(a,b,c,d){return a.assets._cache.addImage(c,c,d),this._addAtlasToCache(a,b,c)},_addAtlasToCache:function(a,b,c){var d=a.assets._cache._images[c],e=new qc.Atlas(b,c,d,{uuid:a.math.uuid(),type:AssetUtil.ASSET_ATLAS});return e.img=d.data,a.assets.cache(b,c,e),e},_parseFont:function(a,b,c,d,e,f,g){d=a.assets._loader.parseXml(d);var h=new Image;h.src="data:image/png;base64,"+c,h.onerror=function(){h.onerror=undefined,g()},h.onload=function(){h.onload=undefined;var c=new qc.Font(e,f,h,d,b);c._fontFamily=qc.UIText.BITMAPFONT,a.assets._cache.addBitmapFont(f,f,h,d,c.xSpacing,c.ySpacing),a.assets.cache(e,f,c),g()}},_parseText:function(a,b,c,d,e,f){a.assets._cache.addText(d,d,b),a.assets.cache(c,d,new qc.TextAsset(c,d,b,e)),f()},_parseScene:function(a,b,c,d,e,f){return AssetUtil._parsePrefab(a,b,c,d,e,f)},_parsePrefab:function(a,b,c,d,e,f){a.assets.cache(c,d,new Prefab(c,d,b,e)),f()},_parseAction:function(a,b,c,d,e,f){a.assets.cache(c,d,new ActionAsset(c,d,b,e)),f()},_parseActionManager:function(a,b,c,d,e,f){a.assets.cache(c,d,new ActionManagerAsset(c,d,b,e)),f()},_parseSound:function(a,b,c,d,e,f){if(a.assets._cache.addSound(e,e,c),a.assets._cache.isSoundDecoded(e)){var g=new qc.SoundAsset(d,e,a.phaser.cache.getSound(e),b);a.assets.cache(d,e,g),f()}else a.sound.phaser.decode(e,{url:e,key:d,meta:b,nextStep:f})},_parseExcel:function(a,b,c,d,e,f){a.assets.cache(d,e,new qc.ExcelAsset(d,e,c,b)),f()},_parseWebFont:function(a,b,c,d,e,f){AssetUtil._deleteWebFont(b.uuid),AssetUtil._loadWebFont(a,b.uuid,c.url);var g=new qc.Font(b.uuid,e,g,null,b);g._fontUrl="string"==typeof c.url?[c.url]:c.url,g._fontFamily=qc.UIText.WEBFONT,a.assets.cache(d,e.toString(),g),f(),window.WebFont&&WebFont.load({timeout:6e4,custom:{families:[b.uuid]},fontactive:function(c){a.world&&(Object.keys(PIXI.Text.fontPropertiesCache).forEach(function(a){a.indexOf(b.uuid)>=0&&delete PIXI.Text.fontPropertiesCache[a]}),AssetUtil._refreshWebFont(c,a.world)),a.assets.webFontLoaded.dispatch()},fontinactive:function(b){a.log.error("Load "+b+" fail")}})},_webFontType:{eot:"embedded-opentype",ttf:"truetype",ttc:"truetype",woff:"woff",svg:"svg"},_loadWebFont:function(a,b,c){var d=AssetUtil._webFontType,e=document.createElement("style");e.type="text/css",e.id="qc.webfont."+b,document.getElementsByTagName("head")[0].appendChild(e);var f="@font-face { font-family:"+b+"; src:";if(qc.Util.isArray(c))for(var g=0,h=c.length;h>g;g++){var i=(c[g],AssetUtil._getSuffix(c[g]));f+=c[g].indexOf("http")>=0?"url('"+c[g]+"') format('"+d[i]+"')":"url('"+(a.assets.baseURL+c[g])+"') format('"+d[i]+"')",f+=g===h-1?";":","}else{var i=AssetUtil._getSuffix(c);f+="url('"+c+"') format('"+d[i]+"');"}e.textContent+=f+"};"},_deleteWebFont:function(a){for(;;){var b=document.getElementById("qc.webfont."+a);if(!b)break;qc.Util.removeHTML(b)}},_refreshWebFont:function(a,b){b instanceof qc.UIText&&b._refreshWebFont(a);for(var c=b.children,d=c.length;d--;){var e=c[d];AssetUtil._refreshWebFont(a,e)}},_getSuffix:function(a){var b=a.substr((Math.max(0,a.lastIndexOf("."))||1/0)+1);return b.toLowerCase()},_createStandardXHR:function(){try{return new window.XMLHttpRequest}catch(a){}},_createActiveXHR:function(){try{return new window.ActiveXObject("Microsoft.XMLHTTP")}catch(a){}},getXHR:function(){var a;try{a=location.href}catch(b){a=document.createElement("a"),a.href="",a=a.href}var c=/^([\w\+\.\-]+:)(?:\/\/([^\/?#:]*)(?::(\d+))?)?/,d=/^(?:about|app|app\-storage|.+\-extension|file|res|widget):$/,e=c.exec(a.toLowerCase())||[],f=d.test(e[1]),g=window.ActiveXObject?function(){return!f&&AssetUtil._createStandardXHR()||AssetUtil._createActiveXHR()}:AssetUtil._createStandardXHR;return g()},get:function(a,b,c){var d=AssetUtil.getXHR();d.open("GET",a,!0),d.responseType="text",d.onreadystatechange=function(){4===d.readyState&&(200===d.status?b(d.responseText):c&&c(d))},d.send()},post:function(a,b,c,d){var e=AssetUtil.getXHR();e.open("POST",a,!0),e.responseType="text",e.onreadystatechange=function(){4===e.readyState&&(200===e.status?c(e.responseText):d&&d(e))},e.send(b)}},Assets=qc.Assets=function(a,b,c){this._loader=b,this._cache=c,this.game=a,b._qc=this,c._qc=this,this._uuid2UrlConf=window.urlMapConfig||{},this._uuid2UrlConf.__builtin_resource__="__builtin_resource__",this.assetCountMap=window.assetCountMap||{},this.batchTotalCount=0,this.batchCurCount=0,this.batchLoadFlag=!1,this.maxRetryTimes=1,this.webFontLoaded=new qc.Signal,this._parsing=0,this._loaderTimerMutex=-1024,this._assets={},this._keyUrl={},this._complete={};var d=this;b.onFileComplete.add(function(a,b,c){if(!c){var e=d._complete[b];if(!e||0===e.length)return;return e[0].retry>=d.maxRetryTimes?(d.game.log.important("Asset({0}) load fail",b),void d._callCb(b,null,e[0])):void d.game.timer.add(1e3,function(){d.game.log.trace("Retry download:{0}",b),e[0].retry++,d._internalLoad(e[0])})}d._parseAsset(b)}),a.sound.phaser.onSoundDecode.add(function(b,c){var e=d.game.phaser.cache.getSound(b);if(e&&e.decoded){var f=new qc.SoundAsset(c.key,c.url,e,c.meta);a.assets.cache(c.key,c.url,f)}c.nextStep()}),this._loadBuiltin()};Assets.prototype={},Assets.prototype.constructor=Assets,Assets.IMAGE=1,Assets.AUDIO=2,Assets.TEXT=3,Assets.BITMAPFONT=4,Assets.BINARY=5,Assets.ATLAS=6,Assets.JSON=7,Object.defineProperties(Assets.prototype,{isLoading:{get:function(){return this._loader.isLoading}},hasLoaded:{get:function(){return this._loader.hasLoaded}},baseURL:{get:function(){return this._loader.baseURL},set:function(a){this._loader.baseURL=a}},parsing:{get:function(){return this._parsing>0}},loaded:{get:function(){return this.batchCurCount?this.batchCurCount:this._loader._loadedFileCount}},total:{get:function(){return this.batchTotalCount?this.batchTotalCount:this._loader._totalFileCount}}}),Assets.prototype.loadBatch=function(){var a=function(a,b,c,d){b.loaded=!1,a.load(b.key,b.url,function(a){b.loaded=!0,b.asset=a,b.callback&&b.callback(b);for(var e=0;e<c.length;e++)if(!c[e].loaded)return;d(c)},b.override,b.isRaw)};return function(b,c){this.beginBatchLoad();for(var d=0;d<b.length;d++)a(this,b[d],b,c);this.endBatchLoad()}}(),Assets.prototype._internalLoad=function(a){var b=this;a.retry||(a.retry=0),a.isSound=AssetUtil.isSound(a.url),a.isSound&&(a.url=b.game.sound.tryGetUrl(a.url));var c=a.url;if(!a.override){var d=b.find(c);if(d&&(!d.hasUnloadedDependence||!d.hasUnloadedDependence(this.game)))return b._keyUrl[a.key]=c,"__builtin_resource__"!==a.key&&b.batchTotalCount&&b.batchCurCount<b.batchTotalCount&&(a.inPrefab||(b.batchCurCount+=1,b.game.log.trace("Asset {0} load from cache: {1} / {2}",c,b.batchCurCount,b.batchTotalCount))),void(a.callback&&a.callback(d))}if("__builtin_resource__"!==a.key){var e=b._loader;0===a.retry&&(b._complete[c]?b._complete[c].push(a):b._complete[c]=[a]),a.isSound?c.indexOf(".bin")<0?e.audio(c,c):AssetUtil.isSound(c)&&e.binary(c,c):a.isRaw?e.image(c,c):e.text(c,c),b.start()}},Assets.prototype.load=function(){var a,b,c,d=this,e=!1,f=!1,g=!1;if(1===arguments.length?b=arguments[0]:2===arguments.length?"string"==typeof arguments[1]?(a=arguments[0],b=arguments[1]):(b=arguments[0],c=arguments[1]):(a=arguments[0],b=arguments[1],c=arguments[2],e=arguments[3],f=arguments[4],g=arguments[5]),a=a||b,!b)throw new Error("url is empty.");var h={key:a,url:b,callback:c,override:e,isRaw:f,inPrefab:g};if(d.batchLoadFlag&&"__builtin_resource__"!==a){var i=d.assetCountMap[b]||1;d.batchTotalCount+=i}else d.batchLoadFlag||"__builtin_resource__"===a||d.batchTotalCount&&d.batchCurCount>=d.batchTotalCount&&(d.batchTotalCount=d.batchCurCount=0);d.game.phaser.state._created?d.game.timer.add(1,function(){d._internalLoad(h)}):d._internalLoad(h)},Assets.prototype.beginBatchLoad=function(){this.batchLoadFlag=!0,this.batchTotalCount=0,this.batchCurCount=0},Assets.prototype.endBatchLoad=function(){this.batchLoadFlag=!1},Assets.prototype.loadByUUID=function(a,b,c,d){var e=this,f=this._uuid2UrlConf[a];return f?void this.load(a,f,b,c,!1,d):(this.game.log.important("UUID({0}) not found.",a),e.batchTotalCount&&e.batchCurCount<e.batchTotalCount&&(d||(e.batchCurCount+=1,e.game.log.trace("Asset {0} load failed: {1} / {2}",a,e.batchCurCount,e.batchTotalCount))),void(b&&b()))},Assets.prototype.loadTexture=function(){var a,b,c,d,e=this;if(1===arguments.length?"string"==typeof arguments[0]?b=arguments[0]:c=arguments[0]:2===arguments.length?"string"==typeof arguments[0]&&"function"==typeof arguments[1]?(b=arguments[0],d=arguments[1]):"function"==typeof arguments[1]?(c=arguments[0],d=arguments[1]):(a=arguments[0],b=arguments[1]):"string"==typeof arguments[1]?(a=arguments[0],
b=arguments[1],d=arguments[2]):(a=arguments[0],c=arguments[1],d=arguments[2]),a=a||b,c){if(!a)throw new Error("key cannot be null.");e._keyUrl[a]=a;var f=AssetUtil.addAtlasFromImage(e.game,a,a,c);e.batchTotalCount&&e.batchCurCount<e.batchTotalCount&&(e.batchCurCount+=1,e.game.log.trace("Asset {0} loaded: {1} / {2}",a,e.batchCurCount,e.batchTotalCount)),d(f)}else e.load(a,b,d,!1,!0)},Assets.prototype.find=function(a){if(AssetUtil.isSound(a)&&(a=this.game.sound.tryGetUrl(a)),!qc.Util.isArray(a)){var b=this._keyUrl[a];return b?this._assets[b]:null}for(var c=0;c<a.length;c++){var d=this.find(a[c]);if(d)return d}},Assets.prototype.unload=function(a){if("string"==typeof a&&!this._keyUrl[a]){var b=AssetUtil.isSound(a);b&&(a=this.game.sound.tryGetUrl(a))}if(qc.Util.isArray(a))for(var c=0;c<a.length;c++)this.unload(a[c]);else if("string"==typeof a){var d=this._keyUrl[a];d&&(this._assets[d]&&this._assets[d].unload&&this._assets[d].unload(this.game),delete this._assets[d],delete this._keyUrl[a])}else this.unload(a.url)},Assets.prototype.findByUUID=function(a){for(var b in this._assets){var c=this._assets[b];if(c.uuid===a)return c}},Assets.prototype.cache=function(a,b,c){a=a||b,this._assets[b]=c,this._keyUrl[a]=b,this._keyUrl[b]=b},Assets.prototype.clear=function(){var a=this,b=Object.keys(PIXI.TextureCache);b.forEach(function(a){"__default"!==a&&"__missing"!==a&&"__builtin_resource__"!==a&&(PIXI.TextureCache[a].destroy(),delete PIXI.TextureCache[a])}),b=Object.keys(PIXI.BaseTextureCache),b.forEach(function(a){"__default"!==a&&"__missing"!==a&&"__builtin_resource__"!==a&&delete PIXI.BaseTextureCache[a]});var c=a._cache._images.__builtin_resource__;a._cache.destroy(),a._cache._images.__builtin_resource__=c,b=Object.keys(a._keyUrl),b.forEach(function(b){"__builtin_resource__"!==b&&delete a._keyUrl[b]}),b=Object.keys(a._assets),b.forEach(function(b){"__builtin_resource__"!==b&&delete a._assets[b]})},Assets.prototype.start=function(){var a=this;a.game.time.fixedTime-a._loaderTimerMutex<1||(a._loaderTimerMutex=a.game.time.fixedTime,a.game.timer.add(1,function(){a._loaderTimerMutex=-1024,a._loader.start()}))},Assets.prototype.addUrlConf=function(a,b){this._uuid2UrlConf[a]=b},Assets.prototype._parseAsset=function(a){var b=this,c=b._complete[a];if(c&&0!=c.length){var d=function(){b._parsing--;var d=b.find(a);if(d&&d.meta.type!==AssetUtil.ASSET_SCENE&&d.hasUnloadedDependence&&d.hasUnloadedDependence(b.game))for(var e in d.dependences){var f=d.dependences[e],g=function(e){var e=e;return function(f){if(!f){b.game.log.important("预制的依赖资源({0})加载失败.",e.uuid);var g=d.dependences[e.uuid];g&&(g.ok=!0)}d.hasUnloadedDependence(b.game)||b._callCb(a,d,c[0])}};b.loadByUUID(f.uuid,g(f),!1,!0)}else b._callCb(a,d,c[0])};b.nextStep=d,b._parsing++;try{AssetUtil.parse(this.game,c[0],d)}catch(e){b._parsing--,b.game.log.error("Asset({0}) Parse fail",a,e),qc.Util.popupError(e.message),b._callCb(a,null,c[0])}}},Assets.prototype._callCb=function(a,b){var c=this,d=c._complete[a];d&&(delete c._complete[a],d.forEach(function(d){b&&(c._keyUrl[d.key]=d.url),c.game.loadingProcessCallback&&(d.inPrefab||c.game.loadingProcessCallback(a,b,d)),c.batchTotalCount&&c.batchCurCount<c.batchTotalCount&&(d.inPrefab||(c.batchCurCount+=1,b?c.game.log.trace("Asset {0} loaded: {1} / {2}",a,c.batchCurCount,c.batchTotalCount):c.game.log.trace("Asset {0} load failed: {1} / {2}",a,c.batchCurCount,c.batchTotalCount))),d.callback&&d.callback(b)}))},Assets.prototype._loadBuiltin=function(){var a=this,b="__builtin_resource__",c="iVBORw0KGgoAAAANSUhEUgAAAIAAAABACAYAAADS1n9/AAAURElEQVR4Xu1cCVRUR9au1w2NrL8LAoIoEFBJ0w8QIioJRBRB1BE1qCCLBCUaEyMBo6AnYlSYqIjGOaNxieKekBicIKIoZnFQiUjTiKgoIAoBo8ggi2z95tyXLv62pbtfb7Q61DkegXer6ta9X92qunVvEUiFQpLkSDabPUFfX5+HELJqbGy0pijqoYmJyROhUHitra2ttKOjI6ekpKRdhW5eqEpRFIEQGokQMlSx3WaE0C2CICim7URERERdu3ZtfF1dnUlTUxPTajSdkZERMjc3bxw9enReWlraPqaVeTzeBQ6H83ZHR4cOi8VCHA6HaVWUn58PspJaZH6U10sfAF5+AIAOZYFAYQC4uLi4GBgYLGltbQ1yc3Mb4Ofnh7hcLiIIAo0aNYrGzM2bNxFFUejKlSvo7NmzHaWlpVcJgthlb29/JD09vUsesOR937x5c3Z2drZfeXk5evLkiTzyHr8PGDAA2dnZIX9//zMrVqzwl9dIXFycz9GjRzdyOBz9hIQEWzs7O30Oh0PAOJkUkE97eztVXl7empSUVNHe3t4aEhKyesuWLbnS6ru6unoJhcKzlpaWeqGhoSgkJIRJVy/QENC5lMIYACRJ2hobG39tb2/vu2TJEuTh4aEQM7m5uSg1NfXhgwcPPuLz+ekKVRYRx8bGzjpy5MjxpqYm3bCwMDR9+nRka2uLwCyCIuQpA+QA/4RCIaqoqEA//fQTOnToEJjmjpCQEK+tW7de7omvNWvWOKSkpBxZt26dmZ+f3xCEEAf6VKZA3wih9jNnzvyxdu3ah7GxsfM3bNhQJtnWmDFjRrS3t99cu3YtERgYqExX3XVUBsDEiRO36+rqfrR48WLWjBkzVGLmwIED6JtvvrldX1/vW1JSUsW0sYSEBDI1NZUfFRVFzJ07F5mZmdGKh3+SAJcEQk/fQRHw7+HDh+jbb79F+/bto2JiYqySkpL+kOTJxsbmzOzZs4eHh4fbcTgcXfxdHuAk2xHno729vePgwYPlP/zww73Kyko/SVoej/d4xowZAxMTE1FHRwc9TswzU5lhOkNDQ+UsAJfLNTI1NT3v7e09BhgRHwAMvqur6zmmROimmYWCFcRms1+oGxkZ2czn86cXFRVdYDIge3v7/4wbN85kw4YNNLmuri6CdiXbFm8L+O1JSZh34B+EC2XNmjXo0qVLjXfu3Pk/sTa+gp8DAgJ8N2/eDBtcQ2VnvuQYQVYEQTSvWLHiflZW1gHR9y/d3d3pGfbGG29k7N+/n/6zokCT7EspAHC5XIv+/ftfmzlz5pDY2NjuNkFonZ2dtPIVKaAoHR0dWmG4xMbGCnNzcz/g8/l7ZbSVBt8sLS3DL1++TLcBu2A9PT26LawQGcvcc01jYYICYAxtbW2wNtNjGjt2LKqpqfm7qEI8Qugq/Hzjxg03aWBSRAY9WQTg58033ywQfXN3dnb+N/ycl5f3iCCIaTCPeh0AXC6XM2TIkBsBAQFvxMTEdKMQhIVnubIDB4WB8rDC4uLiqPPnz8/i8/kZUtqkd1lbt25F8+fPR/369XtO+XhdV4QfvF8QB8GzZ8/QkSNH0KeffoqbArNJA6C0tNSFoqj/R64incmhJQiiy9HRkY8BwOPxauDny5cv1xEE4aIVC+Dn55c1fvz4KZ9//jnNF54hahx390yGNhcsWNBRWFjIEwgEt3rogwbA1atX0ciRI1+Y+aryJA6CW7duIXd39xcAcPPmTRehUKgRALBYrK5Ro0aJA+ChCAA1BEE4Y2ZUsQIKLQF+fn7LjY2NU7/77jt6lsKsV9TcM1UKmHCwBjC4CRMmlJuZmY3o4ZhIA+Dx48fI2Nj4ObPPtB95dBgET58+RYMGDdIqAEiSvCECwFqE0He9CgAulzvQ2tq6ZtmyZXpTpkxBYBZVNfnyhA9LAph12Ilv3rw5rqCgIEWiDg0AUI6+vn6Pu355fcj7DgCEcba2ttIgE5XuJaA3LYCbm9sqUf/JFy9e7N4A9ooFIElyu7e397KvvvpKI2ZfmiLwxm7mzJlPy8rKTCVcxzQAWlpaaGuhrl24JC8AALB2BgYGWgUA7pwkybbY2FjOnDlzVJ6EjJaAcePG6ffv379h3bp1nNGjR9PC6M0Cyv3tt99QTExMNJ/P3yPWNw0AsEZw9NMkAOBICNZImxYAd/7WW29FdnR0fLNr1y7k7OzMyNElTV+MAODt7R2MEDr6888/06ZQFZOjDHBgvwEm3sPDoyQ/P99JEgAASAAA0+OeojzAeAEAAMSXAQDAg4uLy0aKolZ5enqyVq1ahQYPHqyUXgwMDOQ7gsLCwi7Y29u/Gx8f3+0cUVSIqtCDYmEpWLp0KZWXl2cKbZWUlNSDHwR+hpMIAECTBQAgdtOmlT2A5Pi8vLysnzx5UkAQxGCQD3hAxUDKSBwnT56UD4DZs2c3RkZGGk+cOFHlNYcRVz0QgXnPzMxEGzduBAcI4vP5pzAAwFEj7kRStg9Z9eC0A0J+WSwA8KEqAGQpH9onYOcPP1haWj5OTU0FF6RWAXD37l0UHh6+CXi6du3aSgwAmJ1iytGE/mlvoJiV0YojSCMDk9Eo4ezsPAa+6+joXMnOzkaGhoZKrTPqYByWgebmZuTr63taZAECMABgdmpqA4h5h5OAmJXpBsDt27dHd3V1Mb76ZSoLGC+bzaZGjBhxTVSH9kJRKm7AZN3+SfJGODk5+Yr+eBZ87fhqlekg1EmH/e1jx469BO0WFxePfxkAkJGRYWdjY2PSr18/trr8IiDnZ8+edVVWVjYGBgaWYwCoqvzu9YvhbplwcXGZCpU6OzszXyIAFIoAMBoDAK6R582bp/AGiClA4ZRx/PhxcEt3y/CDDz7wgl+ysrL+8eOPP9oaGhoaqTg5u9kRWbummTNnVgQEBHwEH77++utfex0APB7PGzrncDg/v0RLwK+iJcDbx8fnB/j54sWLsxobGzUKABMTE/T222+fgP5yc3NnY21ZWVldWLhw4fDAwMBhYAVEZpoptp6jwxMTZn9GRkbV3r1771VXV0/ARL0OAFdX1zehc3Nz85JNmzYhBwcHrW4Cy8rKUFRU1HHg6ffffwffBF2GDRv2dNKkSUY7d+6k+RNz2CilCFwJHExgjiHK6dy5c01VVVXdvmBMs3LlyvG7du3aFh8fb+7r62uhq6vLYWhhX+BN5G9oz8nJqU1OTq5bvHjx8i+//DJPawCAq1/onCTJZ/PmzSMmT56sNQDABgys0Pr16+OAJ/F7AYjb271796ng4GAWxCfY29urpHhc+c6dOyglJQUdO3ZMGB0dPRXiDXtqGMcEGhgYGMbHx9vY2trqw6mE6Z4AQAanjIqKitbk5OTKlpaW5p5iAnvdAuDBfvjhh9WDBg2yXL16NT0oda11TLUEMwqEBB6vCxcu0AGHRUVF+eL1RTGBx5qbmzkQjArX1TweRKQrXoqLi9EXX3yBzpw5Ayef9vnz5wenpKTQ5l9aiY6O1m1ra4u8evWq559//mmgTFj44MGDW9zd3f+tp6e3f/fu3X+FI4kVrQHg/fff33v37t2onJwcGqnaAADMKG9v72dDhw41Apn0FEGcmJjIqa6uTrx3715kS0uLBVwSKVPg0sfAwKB2+PDh+62srBITExPl5i681gDg8Xhu9vb2V5cvX05H/GoqBkCassD85+fngwX4V15entTIU20CQBmgKVpHaxYAGOVyuVXvvvuuNYRfAQB6ywqIHCIoOjoavH/uxcXFOEZOUfm9MvQ8Hi+SIIi5XV1dfxO//tYqAHx8fIIHDRp0FBIQICCkt6wAzP7Tp0+jbdu2CX755ZfuMChp2oyIiFhTWFjoX1dXN1CZddjc3Lze1dU1Oy0t7a8QYy0UcQBA9xgEWgUAMBITE3OzpqZmJDheoDDd5SorQ+zenTt3LlVVVTWaz+fj+DipTb7qAODxeIcIgggVDXAp/C8QCP4J/2sdAOAX8PT0FJiamrLhaljZZAQmgMB5A+vXr4c0sn05OTkLZdWDU8Dhw4ePNjc368EpYOPGjXSgqCIFAj/hpCPa/beFhoaGyNv9K9K+PFqSJJchhLaL0dHZSAKBYNxLAQBgIiQkJBwhlObi4oI++eQTjYAAK3/79u1w9r9dV1fHk5VFLMoMKoyKimIBMC0tLeXJWub3mpoalJycDBlBwpiYGNekpCSBSg0yqMzj8bwIgoBEGPG8MvqoKxAI6KOv1i0AHseCBQtSqqurP4WZ9vHHH6sVBFj5O3bsQCdOnHjc2trqWFhY+KcsGdrY2PzxzjvvWBw8eJCBqJmThIeHQyhabWVlJeT8aaw4OTmZs1isSoRQd8wZQqitq6uLRrIo+OXlAQAwFRwcvImiqBWQ9bty5cruxEplTwfY2QP1k5KSIPulvLa21rOkpKRWhuTpiCCY8dXV1TQZDt9SZnnC4BMPL7OysoKMIMwC44RZRdBCkiTkHFqI1yEIYnZRUdFzzqeXxgJgRidPnjzfwcHhwKNHj3TgNi4gIOA5T6E8MGCfOVZ+VlYWOnz4MGpqajrd2Ng4+9KlS61yBEkDAOpAZhBO51JE+NJocXoZZARB+rWoqB0AJEleRAh5ivNBUdSPxcXFsyR5e+kAAAzCxtDLy+tIRUWFi7W1NX0tO2bMmBdi1jEYxJUO9eF3cPIcPXoU3b59u5kgiBXnzp3byVCJNADu378PF1Zqj1cES1BXV4dgXJoAAEmS2xBCn0iM9ZFAIBgsbfyqgkChgBCGSqDJxo4dO8nDw2P/vXv3htbX1yMfHx96Fw5LBJhWR0dHmq60tJS2EvBQBOy6z58/D27XdhaLldrQ0LCOwax/brLALzhDSZ7FUWQ8GJw4Q0kaAMBLShCEp0Ag+AecjJn24ezsHEpR1CEJeqFQKHS9fv26xjedTPhUytzB0zCenp5LdXV1ZzQ0NAyDtC1QOMTzwWyHlzfgd1NT02YdHZ3fqqqqdpqamp5S8nWQ7qhgTdxR4GhkiWhgWnb4ppTNZuMkCbgpfE8gEMDbQjKLk5MTyWKxINRLMqdwnUAgSJRVOSgiZAmiqOUIdfqmH0zv8Q2FoPDgZITQVETpzEg/dKhCHj/SvisFAMnGnJ2drYRCoQVFUQMJgoBQ7vZiuG5TT9EaAHg8HgSlAqhxyjj8ms9ms6fJOrXAuwpsNhs2tpKPWAkEAoFMTyetfCgKAADIlQVBHwBE+Qg9WQAej0c/ekQQBNxNdOeMIYRgxk0UCAQ9zjySJO8ihOwk8E8f+fBxT9rcCAoPpsPhIC8EIaIKoY53JK1AUETwBkSh1YhAN3TakQ8QHzt2rE6Z+aYWACjTsQJ1tGYBMI9OTk7WLBarBCEkHi1Uz2Kx/Pl8/u/iY+HxeJkEQdBxluKlpyNfTzIICgqir8KRvk4mQshbEgRBEcHrEIUgb78AsTunpO9Pl+k/kSfnHgFQW1trePDgwdgrV65MKykpcYSNl6IhULgOl8st9fDwyAwPD0+xsLCQu3b2wLDWAQA8iRw5pQihAWI8thIEMaeoqAiUBVFVsLZDWvdzRdqRT5ZygoKCOEhf5wjsOTAIEKETJVL+JdSvc0r67vT/yFOwvO99AJCxBEgKD5Jo2Gw2PGJBp66JShdFUR+yWKwGiqIgllFSpjKPfPIUFBQ+bwdCBEQNg7Lh/aJc1No5Iz09XbFHCqV09AIA0tLSQrds2bIjLCysv5OTE72jlzb75b2bA1YA3vK7fv06PMfWEBcX93FERMRheYOWnEDwO36rQBPHQPxGgahfmcuiaIMHIJC8jIBHkyR3/Go58gWFBcN6D+t+NnrWOSs9PV2e84yxiJ8b7KJFizKNjIyeBAYGhlpYWKiUkow5wG/41NbWooyMjMNNTU0D9uzZQ+f+MSz0EgD3/ppIWgH+4MgKz7gyAQDQwPFQZAls5IxB7pGPoQzQnPCQSVRrx6/p6elyQ9eYtgl03QDYtGnT5w8fPrRbtGhRBH5ESV2zDYMA/t+zZ0+amZlZ+WefffYFQ0ZpAED0Lvjs1R2fAKCCOwaxKGNGG2MRCCB24S/v14tF7pGP4fhpMo0BoKyszAQ6mDZtWvX3339vBK5RdQsZDxSEDUme7733XlNmZqYV/N3BwaFRjiBoAODMIHVGLOP7CcmMIEUUQ5JkEez/JOowOvIp0o+maAmY+aLG18EroOoUsCTTWOAnT56ET/RuWZ4liIqKmg50hw4d+hdkBuH3fNQhEPzKKGQEhYWF/Q3a3Ldv30+Ktk2SJOQyjsX1mB75FO1HE/TE1KlTaY9dTEyM09ChQzU2+8WtwIMHD+Dd4Ovwt1OnTjEK7Le0tHzi7+/fH2cG4WVKGaHgJQlnBGVnZzfU1NSIH+8UbpYkyRyE0CRljnwKd6bGCoSbmxvtQdq7d68ZpFupa92XxiMIH3b0CxcupN/DKygoMGcyHsnMILi9UwYEWPlwu8gkI4gJb5jG2dn570VFRfiVL0Wqao2WcHV1pT1JBw4cMAV3aG8AAJ57WbBgwSPot7CwUOq1qKRUcExgS0sLHRMImUH4iXqmEoQbSpwRZGBgoNaYwFcSAK/KEoAVDIkh5eXlCQUFBVMePXpkrExYuKmp6VM3N7fTdnZ2SUwygpiC61WkI5KSkjYC43p6egnTpk3TeC4A3L3DO0BtbW1J0G9CQsJqRQTXBwBFpCWflqioqOgPZP7+/vdPnDgB15ga2wjCpgtCumbNmtWUnZ1Nh+DY2to2yGezj0JTEuh2eoAlqK+vt+oNR9DAgQOrFZ35mhLA/3q7r4Ir+H9dRxodv8zLIJIk6csgVQpcBgkEAlUug1Tpvq+uHAnIvA7Oy8sLLC0tdVBFio6OjmXjx4/PUCEeQJXu++r2AaAPA7IkwOjmq0+Er68E+gDw+uqW0cj6AMBITK8vUR8AXl/dMhpZHwAYien1JeoDwOurW0Yj+y97o2/XSZsB1wAAAABJRU5ErkJggg==",d={ver:1,uuid:b,padding:{"button.png":[10,9,10,9],"button2.png":[10,9,10,9],"slider.png":[12,10,12,10],"sliderbg.png":[13,7,13,7],"sliderbg2.png":[14,0,0,0]}},e=JSON.parse('{"frames":{"circle.png":{"frame":{"x":1,"y":1,"w":37,"h":37},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":37,"h":37},"sourceSize":{"w":37,"h":37}},"sliderbg.png":{"frame":{"x":1,"y":41,"w":30,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":30,"h":16},"sourceSize":{"w":30,"h":16}},"slider.png":{"frame":{"x":41,"y":1,"w":28,"h":24},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":28,"h":24},"sourceSize":{"w":28,"h":24}},"button.png":{"frame":{"x":41,"y":28,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"button2.png":{"frame":{"x":72,"y":1,"w":26,"h":23},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":26,"h":23},"sourceSize":{"w":26,"h":23}},"ok.png":{"frame":{"x":72,"y":27,"w":25,"h":22},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":25,"h":22},"sourceSize":{"w":25,"h":22}},"sliderbg2.png":{"frame":{"x":101,"y":1,"w":19,"h":14},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":19,"h":14},"sourceSize":{"w":19,"h":14}},"empty.png":{"frame":{"x":101,"y":18,"w":16,"h":16},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":16,"h":16},"sourceSize":{"w":16,"h":16}},"arrow.png":{"frame":{"x":101,"y":37,"w":12,"h":7},"rotated":false,"trimmed":false,"spriteSourceSize":{"x":0,"y":0,"w":12,"h":7},"sourceSize":{"w":12,"h":7}}},"meta":{"app":"QCEngine","version":"1.0","image":"__builtin_resource__","format":"RGBA8888","size":{"w":128,"h":64},"scale":"1"}}');a._parsing++,AssetUtil._parseAtlas(this.game,d,e,c,undefined,d.uuid,b,function(){a._parsing--,a._callCb(b,a.find(b))})};var Atlas=qc.Atlas=function(a,b,c,d,e){this.key=b,this.url=b,this.meta=d,this.animation=undefined,this.json=undefined,this.img=undefined,this._data=c,e&&(this.animation={type:d.animationType,data:e})};Atlas.prototype.constructor=Atlas,Object.defineProperties(Atlas.prototype,{count:{get:function(){return this._data.frameData.total}},frames:{get:function(){return this._data.frameData._frames}},frameNames:{get:function(){var a=this.frames;if(!a||a.length<1)return[0];var b=[];for(var c in a)b.push(a[c].name);return b}},uuid:{get:function(){return this.meta.uuid}},"class":{get:function(){return"qc.Atlas"}}}),Atlas.prototype.getFrame=function(a){return"number"==typeof a?this._data.frameData.getFrame(a):this._data.frameData.getFrameByName(a)},Atlas.prototype.getTexture=function(a){return new qc.Texture(this,a)},Atlas.prototype.getPadding=function(a){if(!this.meta||!this.meta.padding)return[0,0,0,0];if(1==this.count){var b=Object.keys(this.meta.padding);a=b.length>0?b[0]:0}a===undefined&&(a=0);var c=this.meta.padding[a];return c&&(c[0]*=1,c[1]*=1,c[2]*=1,c[3]*=1),c||[0,0,0,0]},Atlas.prototype.unload=function(a){a.assets._cache.removeImage(this.key,!1),delete PIXI.TextureCache[this.key],delete PIXI.BaseTextureCache[this.key]};var Texture=qc.Texture=function(a,b){var c=this;c.atlas=a,c.frame=b||0};Texture.prototype.constructor=Texture,Object.defineProperties(Texture.prototype,{padding:{get:function(){return this.atlas.getPadding(this.frame)}},"class":{get:function(){return"qc.Texture"}}});var Prefab=qc.Prefab=function(a,b,c,d){this.key=a,this.url=b,this.meta=d,this.json=c};Prefab.prototype.constructor=Prefab,Object.defineProperties(Prefab.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),Prefab.prototype.hasUnloadedDependence=function(a){for(var b in this.dependences){var c=this.dependences[b];if(!c.ok&&c.uuid!==this.uuid){var d=a.assets.find(c.uuid);if(!d)return!0;if(d.hasUnloadedDependence&&d.hasUnloadedDependence(a))return!0;c.ok=!0}}return!1};var Font=qc.Font=function(a,b,c,d,e){this.key=a,this.url=b,this.meta=e,this.xml=d,this.image=c,this._fontUrl,this._fontFamily=qc.UIText.SYSTEMFONT};Font.prototype.constructor=Font,Object.defineProperties(Font.prototype,{uuid:{get:function(){return this.meta.uuid}},xSpacing:{get:function(){return this.meta.xSpacing}},ySpacing:{get:function(){return this.meta.ySpacing}}}),Font.prototype.unload=function(a){a.assets._cache.removeBitmapData(this.key),a.assets._cache.removeBitmapFont(this.key)};var SoundAsset=qc.SoundAsset=function(a,b,c,d){this.key=b,this.url=b,this.meta=d,this.sound=c};SoundAsset.prototype.constructor=SoundAsset,Object.defineProperties(SoundAsset.prototype,{uuid:{get:function(){return this.meta.uuid}}}),SoundAsset.prototype.unload=function(a){a.assets._cache.removeSound(this.key)};var TextAsset=qc.TextAsset=function(a,b,c,d){this.key=a,this.url=b,this.meta=d,this.text=c};TextAsset.prototype.constructor=TextAsset,Object.defineProperties(TextAsset.prototype,{uuid:{get:function(){return this.meta.uuid}}}),SoundAsset.prototype.unload=function(a){a.assets._cache.removeText(this.key)};var ExcelAsset=qc.ExcelAsset=function(a,b,c,d){this.key=a,this.url=b,this._meta=d,this._data="string"==typeof c?JSON.parse(c):c,this._sheets={},this._makeSheetData()};ExcelAsset.prototype.constructor=ExcelAsset,Object.defineProperties(ExcelAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},sheetsName:{get:function(){return this._sheets?Object.keys(this._sheets):[]}},sheets:{get:function(){return this._sheets}},meta:{get:function(){return this._meta}}}),ExcelAsset.prototype._makeSheetData=function(){for(var a=this._data?Object.keys(this._data):[],b=0;b<a.length;b++){var c=a[b],d=this._data[c].rows,e=this._data[c].cols,f=this._meta[c]?this._meta[c].primaryKey||[]:[],g=new qc.ExcelSheet(e,d,f);this._sheets[c]=g}},ExcelAsset.prototype.findSheet=function(a){return this.sheets[a]},ExcelAsset.prototype.unload=function(){},ExcelAsset._EXCEL_DATE_OFF=-22089888e5,ExcelAsset._TIMEZONE_OFF=60*(new Date).getTimezoneOffset()*1e3,ExcelAsset.parseToDate=function(a){return new Date(ExcelAsset._EXCEL_DATE_OFF+864e5*a+ExcelAsset._TIMEZONE_OFF)};var ExcelSheet=qc.ExcelSheet=function(a,b,c){this._cols=a||[],this._rows=b||[],this._indexes={},this._primaryKey=c,this._buildPrimaryIndex()};ExcelSheet.prototype.constructor=ExcelSheet,Object.defineProperties(ExcelSheet.prototype,{columns:{get:function(){return this._cols}},rows:{get:function(){return this._rows}}}),ExcelSheet.prototype._buildPrimaryIndex=function(){this.addSortIndex("primary",this._primaryKey)},ExcelSheet.prototype.addSortIndex=function(a){var b,c=Array.prototype.slice.call(arguments,1);return b=Array.isArray(c[0])?new qc.ExcelSortSheetIndex(this,c[0]):new qc.ExcelSortSheetIndex(this,c),this._indexes[a]=b,b},ExcelSheet.prototype.addHashIndex=function(a,b,c){var d=new qc.ExcelHashSheetIndex(this,b,c===undefined||c);return this._indexes[a]=d,d},ExcelSheet.prototype.getIndex=function(a){return this._indexes[a]},ExcelSheet.prototype.getPrimary=function(){return this.getIndex("primary")},ExcelSheet.prototype.find=function(a){for(var b=this._rows,c=b.length,d=-1;++d<c;)if(a(b[d]))return d;return-1},ExcelSheet.prototype.findLast=function(a){for(var b=this._rows,c=b.length;c-->0;)if(a(b[c]))return c;return-1},ExcelSheet.prototype.matches=function(a){for(var b=this._rows,c=b.length,d=-1,e=[];++d<c;)a(b[d])&&e.push(d);return e},ExcelSheet.prototype.parseColumnToData=function(a){for(var b=this._rows,c=b.length,d=-1,e=[];++d<c;)a in b[d]&&(b[d][a]=ExcelAsset.parseToDate(b[d][a]));return e};var ExcelSortSheetIndex=qc.ExcelSortSheetIndex=function(a,b){this.sheet=a,this._keys=b,this._buildIndex()};ExcelSortSheetIndex.prototype={},ExcelSortSheetIndex.prototype.constructor=ExcelSortSheetIndex,Object.defineProperties(ExcelSortSheetIndex.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}}}),ExcelSortSheetIndex.prototype._buildIndex=function(){var a=this,b=this.sheet.columns.slice(0);if(this._keys){for(var c=0;c<this._keys.length;c++){var d=b.indexOf(this._keys[c]);b.splice(d,1)}Array.prototype.unshift.apply(b,this._keys)}a._cols=b,a._rows=this.sheet.rows.slice(0),a._rows.sort(function(c,d){a._rowCompare(b,c,d)})},ExcelSortSheetIndex.prototype.first=function(){var a=arguments.length;if(0===a)return 0;var b=this;return this._dichotomySearchFirst(this._rows,arguments,function(a,c){return b._searchCompare(a,c)})},ExcelSortSheetIndex.prototype.last=function(){var a=arguments.length;if(0===a)return 0;var b=this;return this._dichotomySearchLast(this._rows,arguments,function(a,c){return b._searchCompare(a,c)})},ExcelSortSheetIndex.prototype.matches=function(){var a=arguments.length;if(0===a)return[0,this._rows.length];var b=this,c=this._dichotomySearchFirst(this._rows,arguments,function(a,c){return b._searchCompare(a,c)});if(0>c)return null;var d=this._dichotomySearchFirst(this._rows,arguments,function(a,c){return b._searchCompare(a,c)},c);return[c,d]},ExcelSortSheetIndex.prototype._cellCompare=function(a,b){return a?b?a===b?0:b>a?-1:1:-1:b?1:0},ExcelSortSheetIndex.prototype._searchCompare=function(a,b){if(!b)return 1;for(var c,d=this._cols,e=a.length,f=-1;++f<e;){if(c=this._cellCompare(a[f],b[d[f]]),c>0)return 1;if(0>c)return-1}return 0},ExcelSortSheetIndex.prototype._rowCompare=function(a,b,c,d,e){if(!a)return b?1:0;if(!b)return-1;d=d||0;for(var f,g,h=d+(e||c.length-d),i=d;h>i;i++)if(f=c[i],g=this._cellCompare(a[f],b[f]),0!==g)return g;return 0},ExcelSortSheetIndex.prototype._dichotomySearch=function(a,b,c){for(var d=0,e=a.length-1,f=0,g=0;e>=d;)if(f=Math.floor((d+e)/2),g=c(b,a[f]),0>g)e=f-1;else{if(!(g>0))return f;d=f+1}return-1},ExcelSortSheetIndex.prototype._dichotomySearchFirst=function(a,b,c,d,e){for(var d=d||0,e=e||a.length-1,f=0,g=0;e>d;)f=Math.floor((d+e)/2),g=c(b,a[f]),0>=g?e=f:d=f+1;return 0===c(b,a[d])?d:-1},ExcelSortSheetIndex.prototype._dichotomySearchLast=function(a,b,c,d,e){for(var d=d||0,e=e||a.length-1,f=0,g=0;e>d;)f=Math.ceil((d+e)/2),g=c(b,a[f]),0>g?e=f-1:d=f;return 0===c(b,a[e])?d:-1};var ExcelHashSheetIndex=qc.ExcelHashSheetIndex=function(a,b,c){this._buildIndex(a,b,c)};ExcelHashSheetIndex.prototype={},ExcelHashSheetIndex.prototype.constructor=ExcelHashSheetIndex,Object.defineProperties(ExcelHashSheetIndex.prototype,{columns:{get:function(){return this._cols.slice(0)}},rows:{get:function(){return this._rows}},keys:{get:function(){return this._keys}}}),ExcelHashSheetIndex.prototype._buildIndex=function(a,b,c){var d=a.rows;this._rows=d,this._cols=a.columns.slice(0),this._keys=[];for(var e=d.length,f=-1;++f<e;){var g=d[f],h=g[b];c?(this[h]=g,this._keys.push(h)):h in this?this[h].push(g):(this[h]=[g],this._keys.push(h))}};var phaserFileComplete=Phaser.Loader.prototype.fileComplete;Phaser.Loader.prototype.fileComplete=function(a,b){this.game.cache&&phaserFileComplete.call(this,a,b)};var ActionAsset=qc.ActionAsset=function(a,b,c,d){this.key=b,this.url=b,this.meta=d,this.json=c};ActionAsset.prototype.constructor=ActionAsset,Object.defineProperties(ActionAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),ActionAsset.prototype.hasUnloadedDependence=function(a){for(var b in this.dependences){var c=this.dependences[b];if(!c.ok&&c.uuid!==this.uuid){var d=a.assets.find(c.uuid);if(!d)return!0;if(d.hasUnloadedDependence&&d.hasUnloadedDependence(a))return!0;c.ok=!0}}return!1};var ActionManagerAsset=qc.ActionManagerAsset=function(a,b,c,d){this.key=b,this.url=b,this.meta=d,this.json=c};ActionManagerAsset.prototype.constructor=ActionManagerAsset,Object.defineProperties(ActionManagerAsset.prototype,{uuid:{get:function(){return this.meta.uuid}},dependences:{get:function(){return this.json.dependences}}}),ActionManagerAsset.prototype.hasUnloadedDependence=function(a){for(var b in this.dependences){var c=this.dependences[b];if(!c.ok&&c.uuid!==this.uuid){var d=a.assets.find(c.uuid);if(!d)return!0;if(d.hasUnloadedDependence&&d.hasUnloadedDependence(a))return!0;c.ok=!0}}return!1};var Math2=qc.Math=function(a){this.phaserMath=Phaser.Math,this.arrayUtils=Phaser.ArrayUtils,this.phaserRnd=a};Math2.prototype={},Math2.prototype.constructor=Math2,Math2.prototype.fuzzyEqual=function(a,b,c){return this.phaserMath.fuzzyEqual(a,b,c)},Math2.prototype.shuffle=function(a){return this.arrayUtils.shuffle(a)},Math2.prototype.fuzzyLessThan=function(a,b,c){return this.phaserMath.fuzzyLessThan(a,b,c)},Math2.prototype.fuzzyGreaterThan=function(a,b,c){return this.phaserMath.fuzzyGreaterThan(a,b,c)},Math2.prototype.fuzzyCeil=function(a,b){return this.phaserMath.fuzzyCeil(a,b)},Math2.prototype.fuzzyFloor=function(a,b){return this.phaserMath.fuzzyFloor(a,b)},Math2.prototype.average=function(){return this.phaserMath.average.apply(null,arguments)},Math2.prototype.shear=function(a){return this.phaserMath.shear(a)},Math2.prototype.snapTo=function(a,b,c){return this.phaserMath.snapTo(a,b,c)},Math2.prototype.snapToFloor=function(a,b,c){return this.phaserMath.snapToFloor(a,b,c)},Math2.prototype.snapToCeil=function(a,b,c){return this.phaserMath.snapToCeil(a,b,c)},Math2.prototype.roundTo=function(a,b,c){return this.phaserMath.roundTo(a,b,c)},Math2.prototype.floorTo=function(a,b,c){return this.phaserMath.floorTo(a,b,c)},Math2.prototype.ceilTo=function(a,b,c){return this.phaserMath.ceilTo(a,b,c)},Math2.prototype.angleBetween=function(a,b,c,d){return this.phaserMath.angleBetween(a,b,c,d)},Math2.prototype.angleBetweenY=function(a,b,c,d){return this.phaserMath.angleBetweenY(a,b,c,d)},Math2.prototype.reverseAngle=function(a){return this.phaserMath.reverseAngle(a)},Math2.prototype.normalizeAngle=function(a){return this.phaserMath.normalizeAngle(a)},Math2.prototype.maxAdd=function(a,b,c){return this.phaserMath.maxAdd(a,b,c)},Math2.prototype.minSub=function(a,b,c){return this.phaserMath.minSub(a,b,c)},Math2.prototype.wrap=function(a,b,c){return c>b?this.phaserMath.wrap(a,b,c):this.phaserMath.wrap(a,c,b)},Math2.prototype.wrapValue=function(a,b,c){return this.phaserMath.wrapValue(a,b,c)},Math2.prototype.isOdd=function(a){return!!this.phaserMath.isOdd(a)},Math2.prototype.isEven=function(a){return!!this.phaserMath.isEven(a)},Math2.prototype.min=function(){return this.phaserMath.min.apply(null,arguments)},Math2.prototype.max=function(){return this.phaserMath.max.apply(null,arguments)},Math2.prototype.wrapAngle=function(a,b){return this.phaserMath.wrapAngle(a,b)},Math2.prototype.linear=function(a,b,c){return this.phaserMath.linear(a,b,c)},Math2.prototype.factorial=function(a){return this.phaserMath.factorial(a)},Math2.prototype.getRandom=function(a,b,c){return Phaser.ArrayUtils.getRandomItem(a,b,c)},Math2.prototype.distance=function(a,b,c,d){return this.phaserMath.distance(a,b,c,d)},Math2.prototype.clamp=function(a,b,c){return this.phaserMath.clamp(a,b,c)},Math2.prototype.within=function(a,b,c){return this.phaserMath.within(a,b,c)},Math2.prototype.sign=function(a){return this.phaserMath.sign(a)},Math2.prototype.degToRad=function(a){return this.phaserMath.degToRad(a)},Math2.prototype.radToDeg=function(a){return this.phaserMath.radToDeg(a)},Math2.prototype.random=function(a,b){return"undefined"==typeof a||"undefined"==typeof b?this.phaserRnd.frac():a>b?this.phaserRnd.integerInRange(b,a):this.phaserRnd.integerInRange(a,b)},Math2.prototype.uuid=function(){return this.phaserRnd.uuid()},Math2.prototype.id=function(){var a=1;return function(){return++a}}(),Math2.prototype.invert=function(a,b){var c=b[0],d=b[1],e=b[2],f=b[3],g=b[4],h=b[5],i=b[6],j=b[7],k=b[8],l=k*g-h*j,m=-k*f+h*i,n=j*f-g*i,o=c*l+d*m+e*n;return o?(o=1/o,a[0]=l*o,a[1]=(-k*d+e*j)*o,a[2]=(h*d-e*g)*o,a[3]=m*o,a[4]=(k*c-e*i)*o,a[5]=(-h*c+e*f)*o,a[6]=n*o,a[7]=(-j*c+d*i)*o,a[8]=(g*c-d*f)*o,a):null},Math2.prototype.multiply=function(a,b,c){var d=b[0],e=b[1],f=b[2],g=b[3],h=b[4],i=b[5],j=b[6],k=b[7],l=b[8],m=c[0],n=c[1],o=c[2],p=c[3],q=c[4],r=c[5],s=c[6],t=c[7],u=c[8];return a[0]=m*d+n*g+o*j,a[1]=m*e+n*h+o*k,a[2]=m*f+n*i+o*l,a[3]=p*d+q*g+r*j,a[4]=p*e+q*h+r*k,a[5]=p*f+q*i+r*l,a[6]=s*d+t*g+u*j,a[7]=s*e+t*h+u*k,a[8]=s*f+t*i+u*l,a},Math2.prototype.smoothDamp=function(a,b,c,d,e,f){d=Math.max(1e-4,d);var g=2/d,h=g*f,i=1/(1+h+.48*h*h+.235*h*h*h),j=a-b,k=b,l=e*d;j=this.clamp(j,-l,l),b=a-j;var m=(c+g*j)*f;c=(c-g*m)*i;var n=b+(j+m)*i;return k-a>0&&n>k&&(n=k,c=(n-k)/f),[n,c]},qc.CleanPIXISpriteRetainer=function(a){this._frameCount=0,this.game=a},qc.CleanPIXISpriteRetainer.prototype={postRender:function(){if(this._frameCount++,!(this._frameCount<100)){this._frameCount=0;var a=this.game.phaser.renderer;if(a instanceof PIXI.WebGLRenderer)for(var b=a.spriteBatch.sprites,c=a.spriteBatch.currentBatchSize,d=b.length,e=c;d>e;e++)b[e]=null}}},qc.CleanPIXISpriteRetainer.prototype.constructor=qc.CleanPIXISpriteRetainer;var NodePool=qc.NodePool=function(a){this._game=a,this._nodes={},this._nameUuidMap={}};NodePool.prototype={},NodePool.prototype.constructor=NodePool,Object.defineProperties(NodePool.prototype,{game:{get:function(){return this._game}}}),NodePool.prototype.add=function(a,b){this._nodes[a]&&this.game.log.error("uuid {0} already exists",a),this._nodes[a]=b,b.uniqueName&&!this._nameUuidMap[b.uniqueName]&&(this._nameUuidMap[b.uniqueName]=a)},NodePool.prototype.remove=function(a){this._nodes[a]&&(this._nodes[a].uniqueName&&delete this._nameUuidMap[this._nodes[a].uniqueName],delete this._nodes[a])},NodePool.prototype.find=function(a){return this._nodes[a]?this._nodes[a]:void 0},NodePool.prototype.findByName=function(a){var b=this._nameUuidMap[a];return b?this._nodes[b]:void 0},NodePool.prototype.removeName=function(a){delete this._nameUuidMap[a]},NodePool.prototype.addName=function(a,b){this._nameUuidMap[a]=b};var Behaviour=qc.Behaviour=function(a){this._gameObject=a,this.cookie=0,this._events={},this.__hadUpdateOrRender=this.preUpdate||this.update||this.postUpdate?!0:!1};Behaviour.prototype.constructor=Behaviour,qc._userScripts={};var defineBehaviour=qc.defineBehaviour=function(a,b,c,d){for(var e=a.split("."),f=window,g=0;g<e.length-1;g++)f[e[g]]||(f[e[g]]={}),f=f[e[g]];var h=e[e.length-1];return b=b||qc.Behaviour,"function"==typeof d&&(d=d.call(this)),d=d||{},f[h]=function(d){b.call(this,d),this["class"]=a,this["super"]=b.prototype,"function"==typeof c&&c.call(this)},f[h].prototype=Object.create(b.prototype),f[h].prototype.constructor=f[h],f[h].prototype.getMeta=function(){var a=b.prototype.getMeta.call(this);return mixin(a,d)},f[h].prototype.clazz=a,qc._userScripts[a]=f[h],f[h]};qc.registerBehaviour=function(a,b){var c=b.prototype.getMeta;b.prototype.getMeta=function(){var a=c.call(this);return mixin(a,this.serializableFields||{})},b.prototype.clazz=a,qc._userScripts[a]=b},Object.defineProperties(Behaviour.prototype,{uuid:{get:function(){return this._uuid},set:function(a){this._uuid=a}},gameObject:{get:function(){return this._gameObject}},name:{get:function(){return this.gameObject.name},set:function(a){this.gameObject.name=a}},key:{get:function(){if(this._key)return this._key;if(this["class"]){var a=this["class"].match(/([^\..]*)$/);a&&(this._key=a[1])}return this._key},set:function(a){this._key&&this.gameObject&&this.gameObject[this._key]&&this.gameObject[this._key].uuid===this.uuid&&delete this.gameObject[this._key],this._key=a,this.gameObject&&!this.gameObject[a]&&(this.gameObject[a]=this)}},enable:{get:function(){return this._enable},set:function(a){this._enable!==a&&(this._enable=a,this._enable&&this.onEnable?this.onEnable():!this._enable&&this.onDisable&&this.onDisable())}},runInEditor:{get:function(){return this._runInEditor===!0},set:function(a){this._runInEditor=a}},game:{get:function(){return this.gameObject.game}}}),Behaviour.prototype.getScript=function(a){return this.gameObject.getScript(a)},Behaviour.prototype.getScripts=function(a){return this.gameObject.getScripts(a)},Behaviour.prototype.destroy=function(){this.gameObject.removeScript(this),this.onDestroy&&this.onDestroy();for(var a in this._events){var b=this._events[a];b&&b[0].remove(b[1],b[2])}this._events=[]},Behaviour.prototype.isEnable=function(){return this._enable},Behaviour.prototype.getMeta=function(){return{uuid:qc.Serializer.STRING,enable:{get:function(a){return a.enable},set:function(a,b){a._enable=b}}}},Behaviour.prototype._restoreInit=function(){this.gameObject._initGetSetField.call(this)},Behaviour.prototype.addListener=function(a,b,c,d){return a.add(b,c,d),this.cookie++,this._events[this.cookie]=[a,b,c],this.cookie},Behaviour.prototype.addListenerOnce=function(a,b,c,d){a.addOnce(b,c,d)},Behaviour.prototype.removeListener=function(a){var b=this._events[a];b&&(b[0].remove(b[1],b[2]),delete this._events[a])};var Storage=qc.Storage=function(a){this.game=a,this.restore()};Storage.prototype={},Storage.prototype.constructor=Storage,Object.defineProperties(Storage.prototype,{key:{get:function(){return this.game.localStorageID}}}),Storage.prototype.restore=function(){var a=window.localStorage.getItem(this.key);this._data=a?JSON.parse(a):{}},Storage.prototype.save=function(){var a=this.key;if(!a||"com.DefaultCompany.Default"===a)throw new Error("game.localStorageID should be set for local storage");var b=JSON.stringify(this._data);window.localStorage.setItem(this.key,b)},Storage.prototype.set=function(a,b){this._data[a]=b},Storage.prototype.del=function(a){this._data[a]&&delete this._data[a]},Storage.prototype.get=function(a){return this._data[a]?this._data[a]:void 0};var Node=qc.Node=function(a,b,c){var d=this;d.game=a.game._qc,d.phaser=a,a._qc=this,d.uuid=c||d.game.math.uuid(),d._uniqueName="",d._interactive=!1,d._draggable=!1,d._children=null,
d._prefab="",d.scripts=[],d.scriptMap={},d["static"]=!1,d.hitArea=undefined,this.cookie=0,d._events=[];var e=a.destroy;a.destroy=function(){if(!d._destroy)if(this.maybeOutWorld&&this.maybeOutWorld(),d===d.game.world)e.call(a,!0,!0),d._dispatchModelChangeEvent("destroy",d);else{d.onDestroy(),e.call(a);for(var b=d.scripts.length;b--;)d.scripts[b].destroy();d.scripts=[],d.scriptMap={},d._dispatchModelChangeEvent("destroy",d),d._destroy=!0}},b!==this&&(b||this.game.world).addChild(this),this._defaultTransform()};Node.prototype.constructor=Node,Object.defineProperties(Node.prototype,{uuid:{get:function(){return this._uuid},set:function(a){this._uuid&&this.game.nodePool.remove(this.uuid),this._uuid=a,this.game.nodePool.add(this.uuid,this)}},name:{get:function(){return this.phaser.name},set:function(a){a=a||"",a=a.replace(/\//g,""),this.phaser.name=a,this._dispatchModelChangeEvent("name",this)}},uniqueName:{get:function(){return this._uniqueName},set:function(a){this._uniqueName&&this.game.nodePool.removeName(this._uniqueName),this._uniqueName=a,this._uniqueName&&!this.game.nodePool.findByName(this._uniqueName)&&this.game.nodePool.addName(this._uniqueName,this.uuid)}},ignoreDestroy:{get:function(){return this.parent===this.game.world&&this.phaser.ignoreDestroy},set:function(a){this.parent===this.game.world?this.phaser.ignoreDestroy=a:(this.phaser.ignoreDestroy=!1,a&&this.game.log.error("Only Root Node can set: ignoreDestroy=true"))}},alpha:{get:function(){return this.phaser.alpha},set:function(a){this.phaser.alpha=a,this.phaser.displayChanged(qc.DisplayChangeStatus.ALPHA)}},visible:{get:function(){return this.phaser.visible},set:function(a){this.phaser.visible!==a&&(a&&this._toDestroy||(this.phaser.visible=a,this._isTransformDirty=!0,this._dispatchLayoutArgumentChanged("size"),this.phaser.displayChanged(a?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE),this._notifyVisibleChanged(a)))}},parent:{get:function(){var a=this.phaser.parent;return a?a._qc:null},set:function(a){a?a.addChild(this):this.parent instanceof Node&&this.parent.removeChild(this)}},worldVisible:{get:function(){return this.phaser&&this.phaser.worldVisible}},mask:{get:function(){return this.phaser.mask},set:function(a){this.phaser.mask=a}},children:{get:function(){if(!this._children){this._children=[];for(var a=this.phaser.children,b=0;b<a.length;b++){var c=a[b]._qc;c&&this._children.push(c)}}return this._children}},colorTint:{get:function(){return new Color(this.phaser.tint)},set:function(a){return a=a||new Color(16777215),a instanceof Color?(this.phaser.tint=a.toNumber(),void this.phaser.displayChanged(qc.DisplayChangeStatus.TINT)):(console.error(a),void this.game.log.error("Expected qc.Color"))}},onChildrenChanged:{get:function(){return this._onChildrenChanged||(this._onChildrenChanged=new Phaser.Signal)}}}),Node.prototype.isVisible=function(){return this.phaser.visible},Node.prototype.isWorldVisible=function(){var a=this;do{if(!a.phaser.visible)return!1;a=a.parent}while(a);return!0},Node.prototype.addScript=function(a,b){var c=qc.Util.findClass(a);if("function"!=typeof c)return void this.game.log.error("Class:{0} not exists",a);var d=new c(this);return d instanceof qc.Behaviour?(d.uuid=this.game.math.uuid(),d._clazz=a,d["class"]=a,this[d.key]=d,this.scripts.push(d),this.scriptMap[a]=d,(b||b===undefined)&&(!d.awake||this.game.device.editor===!0&&d.runInEditor!==!0||d.awake()),d._enable===undefined&&b!==!1&&(this.game.device.editor===!0&&d.runInEditor!==!0?d._enable=!0:d.enable=!0),d):void this.game.log.error("Must inherit from qc.Behaviour")},Node.prototype.removeScript=function(a){var b=this.scripts.indexOf(a);b>-1&&this.scripts.splice(b,1),delete this.scriptMap[a["class"]],this[a._key]&&this[a._key].uuid===a.uuid&&delete this[a._key],this.__json&&this.__json[a.uuid]&&delete this.__json[a.uuid]},Node.prototype.getScript=function(a,b){var c=a;if("string"!=typeof a&&(a=c.prototype.clazz),this.scriptMap[a])return this.scriptMap[a];if("string"==typeof a&&(c=qc.Util.findClass(a)),!c)return this.game.log.error("Class:{0} not exists",a),null;if(1===arguments.length||b){for(var d in this.scripts)if(this.scripts[d]instanceof c)return this.scripts[d]}else for(var d in this.scripts)if(this.scripts[d]["class"]===c.prototype.clazz)return this.scripts[d]},Node.prototype.getScripts=function(a,b){var c=a;"string"==typeof a&&(c=qc.Util.findClass(a));var d=[];if(!c)return this.game.log.error("Class:{0} not exists",a),d;if(1===arguments.length||b)for(var e in this.scripts)this.scripts[e]instanceof c&&d.push(this.scripts[e]);else for(var e in this.scripts)this.scripts[e]["class"]===c.prototype.clazz&&d.push(this.scripts[e]);return d},Node.prototype.isDescendantOf=function(a){for(var b=this.parent;b;){if(a===b)return!0;b=b.parent}return!1},Node.prototype.getChildren=function(){var a=this._children;return a||(a=this.children),a},Node.prototype.addChild=function(a){return this.addChildAt(a,this.children.length)},Node.prototype.addChildAt=function(a,b){if(a.parent!==this){if(!(a instanceof Node))throw new Error("Expected qc.Node");if(a===this)throw new Error("The child is myself");if(this.isDescendantOf(a))throw new Error("child is my parent");var c=a.parent;return c instanceof Node&&(c._children=null),this.phaser.addAt?this.phaser.addAt(a.phaser,b):this.phaser.addChildAt(a.phaser,b),this._dispatchModelChangeEvent("parent",a),a._callChildrenFunc("onAddToWorld"),a}},Node.prototype.swapChildren=function(a,b){this.phaser.swapChildren(a.phaser,b.phaser),this._dispatchModelChangeEvent("parent",a),this._dispatchModelChangeEvent("parent",b)},Node.prototype.getChildIndex=function(a){return this.children.indexOf(a)},Node.prototype.setChildIndex=function(a,b){if(a.parent===this){var c=this.phaser.children,d=c.indexOf(a.phaser);d!==b&&(c.splice(d,1),c.splice(b,0,a.phaser),a.phaser.displayChanged(qc.DisplayChangeStatus.ORDER),this._dispatchModelChangeEvent("parent",a),this._dispatchChildrenChanged("order",[a]))}},Node.prototype.getChildAt=function(a){return this.children[a]},Node.prototype.removeChild=function(a){return this.phaser.remove?this.phaser.remove(a.phaser):this.phaser.removeChild(a.phaser),this._children=null,this._dispatchModelChangeEvent("parent",a),a._callChildrenFunc("onRemoveFromWorld"),a},Node.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return this.removeChild(b)},Node.prototype.removeChildren=function(){var a=this.children;this.phaser.removeAll?this.phaser.removeAll():this.phaser.removeChildren(),this._dispatchModelChangeEvent("removeChildren",this),a.forEach(function(a){a&&a._callChildrenFunc("onRemoveFromWorld")})},Node.prototype.onDestroy=function(){this.parent=null,this.game.nodePool.remove(this.uuid)},Node.prototype.destroy=function(){this._toDestroy||(this._toDestroy=!0,this.visible=!1,this.game.world.addToDestroy(this))},Node.prototype.destroyImmediately=function(){if(!this._destroy&&!this._destroying){for(var a in this._events){var b=this._events[a];b&&b[0].remove(b[1],b[2])}this._events=[],this.visible=!1,this._destroying=!0,this.phaser&&this.phaser.destroy(),this._destroying=!1}},Node.prototype.find=function(a){if(""===a||"."===a||"./"===a)return this;for(var b=a.split("/"),c=this,d=0;d<b.length-1;d++){var e=b[d];if(""!==e)if(".."!==e){if(c=c._findByName(b[d]),!c)return c}else if(c=this.parent,c===this.game.stage)return null}var e=b[b.length-1];return""===e||"."===e?c:".."===e?c.parent===this.game.stage?null:c.parent:c._findByName(e)},Node.prototype._findByName=function(a){var b=this.children;for(var c in b)if(b[c].name===a)return b[c]},Node.prototype._dispatchModelChangeEvent=function(a,b){"name"!==a&&(this._children=null);var c=this.game.world;c.onModelChange.dispatch({type:a,target:b})},Node.prototype._sendMessage=function(a,b){if(this.scripts)for(var c=this.scripts.length,d=Array.prototype.slice.call(arguments,2),e=0;c>e;e++){var f=this.scripts[e];if(f&&f.enable){var g=f[a];if(!g)continue;var h=g.apply(f,d);if(b===!0&&h===!0)return!0}}},Node.prototype._broadcast=function(a){if(this.scripts){for(var b=this.scripts.length,c=Array.prototype.slice.call(arguments,1);b--;){var d=this.scripts[b];if(d&&d.enable&&(this.game.device.editor!==!0||d.runInEditor===!0)){if(this._toDestroy||this._destroy)return;var e=d[a];e&&e.apply(d,c)}}var f=this._children;f||(f=this.getChildren());var g=f.length;for(b=0;g>b;b++)f[b][a](c)}},Node.prototype._dispatchChildrenChanged=function(a,b){for(var c=this,d={source:this,type:a,children:b};c;)c._onChildrenChanged&&c._onChildrenChanged.dispatch(d),c=c.parent},Node.prototype._notifyVisibleChanged=function(a){this.onVisibleChange&&this.onVisibleChange();var b=this._children;b||(b=this.children);for(var c=b.length;c--;)b[c].visible&&b[c]._notifyVisibleChanged(a)},Node.prototype._callChildrenFunc=function(a){var b=this[a];b&&b.apply(this,arguments);var c=this._children;c||(c=this.children);for(var d=c.length;d--;){var e=c[d];e&&(b=e[a],b&&b.apply(e,arguments))}},Node.prototype.addListener=function(a,b,c,d){return a.add(b,c,d),this.cookie++,this._events[this.cookie]=[a,b,c],this.cookie},Node.prototype.addListenerOnce=function(a,b,c,d){a.addOnce(b,c,d)},Node.prototype.removeListener=function(a){var b=this._events[a];b&&(b[0].remove(b[1],b[2]),delete this._events[a])},Object.defineProperties(Node.prototype,{x:{get:function(){return this.phaser.x},set:function(a){this.x!==a&&(this.minAnchor.x<this.maxAnchor.x&&(this._left=this.left+(a-this.x),this._right=this.right-(a-this.x)),this.phaser.x=a,this._calcAnchoredX(),this.phaser.displayChanged(qc.DisplayChangeStatus.OFFSET),this._isTransformDirty=!0)}},y:{get:function(){return this.phaser.y},set:function(a){this.y!==a&&(this.minAnchor.y<this.maxAnchor.y&&(this._top=this.top+(a-this.y),this._bottom=this.bottom-(a-this.y)),this.phaser.y=a,this._calcAnchoredY(),this.phaser.displayChanged(qc.DisplayChangeStatus.OFFSET),this._isTransformDirty=!0)}},anchoredX:{get:function(){return this._anchoredX===undefined&&this._calcAnchoredX(),this._anchoredX},set:function(a){a!==this.anchoredX&&(this._anchoredX=a,this._calcX(),this._isTransformDirty=!0)}},anchoredY:{get:function(){return this._anchoredY===undefined&&this._calcAnchoredY(),this._anchoredY},set:function(a){a!==this.anchoredY&&(this._anchoredY=a,this._calcY(),this._isTransformDirty=!0)}},scaleX:{get:function(){return this.phaser.scale.x},set:function(a){a!==this.scaleX&&(this.phaser.scale.x=a,this.phaser.displayChanged(qc.DisplayChangeStatus.SCALE),this._isTransformDirty=!0)}},scaleY:{get:function(){return this.phaser.scale.y},set:function(a){a!==this.scaleY&&(this.phaser.scale.y=a,this.phaser.displayChanged(qc.DisplayChangeStatus.SCALE),this._isTransformDirty=!0)}},pivotX:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new qc.Point(0,0)),this.phaser.anchor.x},set:function(a){this.phaser.anchor||(this.phaser.anchor=new qc.Point(0,0)),this.phaser.anchor.x!==a&&(this.phaser.anchor.x=a,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this.relayout())}},pivotY:{get:function(){return this.phaser.anchor||(this.phaser.anchor=new qc.Point(0,0)),this.phaser.anchor.y},set:function(a){this.phaser.anchor||(this.phaser.anchor=new qc.Point(0,0)),this.phaser.anchor.y!==a&&(this.phaser.anchor.y=a,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this.relayout())}},rotation:{get:function(){return this.phaser.rotation},set:function(a){this.phaser.rotation!==a&&(this.phaser.rotation=a,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},skewX:{get:function(){return this._skewX},set:function(a){this._skewX!==a&&(this._skewX=a,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},skewY:{get:function(){return this._skewY},set:function(a){this._skewY!==a&&(this._skewY=a,this.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),this._isTransformDirty=!0)}},width:{get:function(){return this._width=this._width||0},set:function(a){if(!this.game.math.fuzzyEqual(this._width,a,.001)){if(this.minAnchor.x<this.maxAnchor.x){var b=a-this.width,c=b*this.pivotX,d=b-c;this._left-=c,this._right-=d}else this.setWidth(a);this.relayout()}}},height:{get:function(){return this._height=this._height?this._height:0},set:function(a){if(!this.game.math.fuzzyEqual(this._height,a,.001)){if(this.minAnchor.y<this.maxAnchor.y){var b=a-this.height,c=b*this.pivotY,d=b-c;this._top-=c,this._bottom-=d}else this.setHeight(a);this.relayout()}}},minAnchor:{get:function(){return this._minAnchor||(this._minAnchor=new qc.Point(0,0)),this._minAnchor},set:function(){throw new Error("user function:setAnchor")}},maxAnchor:{get:function(){return this._maxAnchor||(this._maxAnchor=new qc.Point(0,0)),this._maxAnchor},set:function(){throw new Error("use function:setAnchor")}},left:{get:function(){return this._left===undefined&&(this._left=0),this._left},set:function(a){this._left!==a&&(this._left=a,this.relayout())}},right:{get:function(){return this._right===undefined&&(this._right=0),this._right},set:function(a){this._right!==a&&(this._right=a,this.relayout())}},top:{get:function(){return this._top===undefined&&(this._top=0),this._top},set:function(a){this._top!==a&&(this._top=a,this.relayout())}},bottom:{get:function(){return this._bottom===undefined&&(this._bottom=0),this._bottom},set:function(a){this._bottom!==a&&(this._bottom=a,this.relayout())}},rect:{get:function(){var a=this.width,b=this.height;return new qc.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,a,b)}},worldTransform:{get:function(){return this.nodeUpdateTransform(),this.phaser.worldTransform}},localBounds:{get:function(){return this.phaser.getLocalBounds()}},_isTransformDirty:{get:function(){return!this.phaser._isNotNeedCalcTransform},set:function(a){this.phaser._isNotNeedCalcTransform!==!a&&(this.phaser._isNotNeedCalcTransform=!a)}},onLayoutArgumentChanged:{get:function(){return this._onLayoutArgumentChanged||(this._onLayoutArgumentChanged=new Phaser.Signal)}},onRelayout:{get:function(){return this._onRelayout||(this._onRelayout=new Phaser.Signal)}},onTransformChanged:{get:function(){return this.phaser._onTransformChanged||(this.phaser._onTransformChanged=new Phaser.Signal)}}}),Node.prototype.setStretch=function(a,b,c,d){var e=!1;this.minAnchor.x>=this.maxAnchor.x?this._anchoredX!==a&&(this._anchoredX=a,e=!0):(a!==undefined&&this._left!==a&&(this._left=a,e=!0),b!==undefined&&this._right!==b&&(this._right=b,e=!0)),this.minAnchor.y>=this.maxAnchor.y?this._anchoredY!==c&&(this._anchoredY=c,e=!0):(c!==undefined&&this._top!==c&&(this._top=c,e=!0),d!==undefined&&this._bottom!==d&&(this._bottom=d,e=!0)),e&&this.relayout()},Node.prototype.setAnchor=function(a,b,c){if(c=c===undefined?!0:c,a=a||this.minAnchor,b=b||this.maxAnchor,a.x<0&&(a.x=0),a.y<0&&(a.y=0),a.x>1&&(a.x=1),a.y>1&&(a.y=1),b.x<0&&(b.x=0),b.y<0&&(b.y=0),b.x>1&&(b.x=1),b.y>1&&(b.y=1),a.x>b.x||a.y>b.y)throw new Error("Expected:min < max");(a.x!==this.minAnchor.x||a.y!==this.minAnchor.y||b.x!==this.maxAnchor.x||b.y!==this.maxAnchor.y)&&(this._minAnchor=a,this._maxAnchor=b,c?(this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()):this.relayout())},Node.prototype.relayout=function(){var a=this.parent.rect;if(this.minAnchor.x<this.maxAnchor.x){var b=a.x+a.width*this.minAnchor.x+this.left,c=a.x+a.width*this.maxAnchor.x-this.right,d=c-b;this.setWidth(d),this.phaser.x=b+d*this.pivotX,this._calcAnchoredX()}else this.phaser.x=a.x+a.width*this.minAnchor.x+this.anchoredX;if(this.minAnchor.y<this.maxAnchor.y){var e=a.y+a.height*this.minAnchor.y+this.top,f=a.y+a.height*this.maxAnchor.y-this.bottom,g=f-e;this.setHeight(g),this.phaser.y=e+g*this.pivotY,this._calcAnchoredY()}else this.phaser.y=a.y+a.height*this.minAnchor.y+this.anchoredY;this._isTransformDirty=!0;for(var h=this.children,i=0;i<h.length;i++)h[i].relayout();this._calcWorldCorners(!0),this._dispatchLayoutArgumentChanged("size"),this._lastRectInfo=new qc.Rectangle(-this.width*this.pivotX,-this.height*this.pivotY,this.width,this.height),this._onRelayout&&this._onRelayout.dispatch()},Node.prototype.setWidth=function(a){this._width=a,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE)},Node.prototype.setHeight=function(a){this._height=a,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE)},Node.prototype._defaultTransform=function(){this.parent&&this.parent!==this.game.stage&&(this.x=0,this.y=0,this.width=100,this.height=100)},Node.prototype._calcMargin=function(){var a=this.parent.rect;if(this.minAnchor.x>=this.maxAnchor.x)this._left=this._right=0;else{var b=this.x-this.pivotX*this.width,c=a.x+a.width*this.minAnchor.x;this._left=b-c;var d=a.x+a.width*this.maxAnchor.x;this._right=d-(b+this.width)}if(this.minAnchor.y>=this.maxAnchor.y)this._top=this._bottom=0;else{var e=this.y-this.pivotY*this.height,f=a.y+a.height*this.minAnchor.y;this._top=e-f;var g=a.y+a.height*this.maxAnchor.y;this._bottom=g-(e+this.height)}},Node.prototype._calcAnchoredX=function(){var a=this.parent.rect;this._anchoredX=this.x-(a.width*this.minAnchor.x+a.x)},Node.prototype._calcAnchoredY=function(){var a=this.parent.rect;this._anchoredY=this.y-(a.height*this.minAnchor.y+a.y)},Node.prototype._calcX=function(){var a=this.parent.rect;this.x=this._anchoredX+(a.width*this.minAnchor.x+a.x)},Node.prototype._calcY=function(){var a=this.parent.rect;this.y=this._anchoredY+(a.height*this.minAnchor.y+a.y)},Node.prototype.toLocal=function(a){return this.worldTransform.applyInverse(a)},Node.prototype.toGlobal=function(a){return this.worldTransform.apply(a)},Node.prototype.nodeUpdateTransform=function(){var a=!1;return this.parent&&this.parent.nodeUpdateTransform&&(a=this.parent.nodeUpdateTransform()),this._isTransformDirty?(a||this.phaser.updateTransform(),!0):a},Node.prototype.getWorldPosition=function(){var a=this.worldTransform;return new qc.Point(a.tx,a.ty)},Node.prototype.getWorldScale=function(){var a=this.worldTransform,b=Math.atan2(a.b,a.a),c=Math.atan2(-a.c,a.d);a.b/a.a===-a.c/a.d&&c!==b&&(b=Math.atan(a.b/a.a),c=Math.atan(-a.c/a.d));var d=b===Math.PI||0===b||0===a.b&&0!==a.a?a.a/Math.cos(b):a.b/Math.sin(b),e=c===Math.PI||0===c||0===a.c&&0!==a.d?a.d/Math.cos(c):-a.c/Math.sin(c);return new qc.Point(d,e)},Node.prototype.getWorldSkew=function(){var a=this.worldTransform;return a.b/a.a===-a.c/a.d?new qc.Point(0,0):new qc.Point(Math.atan2(-a.c,a.d),Math.atan2(a.b,a.a))},Node.prototype.getWorldRotation=function(){var a=this.worldTransform;return a.b/a.a!==-a.c/a.d?0:Math.atan2(a.b,a.a)},Node.prototype.setTransformToWorld=function(a,b,c,d,e){this.setTransformTo(this.game.world,a,b,c,d,e)},Node.prototype.setTransformTo=function(a,b,c,d,e,f){b=b||0,c=c||0,d=d||1,e=e||1,f=f||0;var g=0,h=0;arguments.length>6&&"number"==typeof arguments[6]&&(g=arguments[6]),arguments.length>7&&"number"==typeof arguments[7]&&(h=arguments[7]);var i=Math.cos(g),j=Math.sin(g),k=Math.cos(h),l=Math.sin(h),m=Math.cos(f),n=Math.sin(f),o=(m*k-n*j)*d,p=(m*l+n*i)*d,q=(-n*k-m*j)*e,r=(-n*l+m*i)*e,s=b,t=c;this.setTransformToWithMatrix(a,o,p,q,r,s,t)},Node.prototype.setTransformToWithMatrix=function(a,b,c,d,e,f,g){var h=[b,c,0,d,e,0,f,g,1];if(a){var i=a?a.worldTransform||new qc.Matrix:new qc.Matrix,j=i.toArray(!0);this.game.math.multiply(h,j,h)}var k=this.parent?this.parent.worldTransform||new qc.Matrix:new qc.Matrix,l=k.toArray(!0),m=[];this.game.math.invert(m,l),this.game.math.multiply(m,m,h);var b=m[0],c=m[1],d=m[3],e=m[4];if(this.x=m[6],this.y=m[7],c/b!==-d/e){var n=Math.atan2(c,b),o=Math.atan2(-d,e);this.rotation=n,this.scaleX=0===n||0===c&&0!==b?b/Math.cos(n):c/Math.sin(n),this.scaleY=0===o||0===d&&0!==e?e/Math.cos(o):-d/Math.sin(o)}else{var p=Math.atan2(c,b);this.rotation=p,this.scaleX=0===p||0===c&&0!==b?b/Math.cos(p):c/Math.sin(p),this.scaleY=0===p||0===d&&0!==e?e/Math.cos(p):-d/Math.sin(p)}this._calcAnchoredX(),this._calcAnchoredY(),this._calcMargin()};var oldAddChildAt=Node.prototype.addChildAt;Node.prototype.addChildAt=function(a,b){oldAddChildAt.call(this,a,b),a._isSwitchParent||a.relayout(),a._isTransformDirty=!0},Node.prototype.switchParent=function(a,b){if(a!==this&&!a.isDescendantOf(this)){var c=this.worldTransform,d=c.a,e=c.b,f=c.c,g=c.d,h=c.tx,i=c.ty;this._isSwitchParent=!0,this.parent=a,delete this._isSwitchParent,b&&this.parent.setChildIndex(this,b),this.setTransformToWithMatrix(null,d,e,f,g,h,i)}},Node.prototype._calcWorldCorners=function(a){if(a||this.nodeUpdateTransform()){var b=this.rect,c=new qc.Point(b.x,b.y),d=new qc.Point(b.x+b.width,b.y),e=new qc.Point(b.x+b.width,b.y+b.height),f=new qc.Point(b.x,b.y+b.height),g=this.phaser.worldTransform;this._worldLeftTop=g.apply(c),this._worldRightTop=g.apply(d),this._worldRightBottom=g.apply(e),this._worldLeftBottom=g.apply(f);var h=Math.min(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),i=Math.max(this._worldLeftTop.x,this._worldRightTop.x,this._worldRightBottom.x,this._worldLeftBottom.x),j=Math.min(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y),k=Math.max(this._worldLeftTop.y,this._worldRightTop.y,this._worldRightBottom.y,this._worldLeftBottom.y);this._worldBox=new qc.Rectangle(h,j,i-h,k-j)}},Node.prototype.getWorldCorners=function(){return this._calcWorldCorners(),[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},Node.prototype.getCornersIn=function(a){var b=a&&a.phaser.worldTransform;return this._calcWorldCorners(),b?[b.applyInverse(this._worldLeftTop),b.applyInverse(this._worldRightTop),b.applyInverse(this._worldRightBottom),b.applyInverse(this._worldLeftBottom)]:[this._worldLeftTop,this._worldRightTop,this._worldRightBottom,this._worldLeftBottom]},Node.prototype.getWorldBox=function(){return this._calcWorldCorners(),this._worldBox},Node.prototype.getBoxIn=function(a){for(var b=this.getCornersIn(a),c=new qc.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),d=new qc.Point(Number.MAX_VALUE,Number.MAX_VALUE),e=0;4>e;e++){var f=b[e];c.x=Math.max(c.x,f.x),c.y=Math.max(c.y,f.y),d.x=Math.min(d.x,f.x),d.y=Math.min(d.y,f.y)}return new qc.Rectangle(d.x,d.y,c.x-d.x,c.y-d.y)},Node.prototype.rectContains=function(a){var b=this.toLocal(a);return this.rect.contains(b.x,b.y)},Node.prototype._dispatchLayoutArgumentChanged=function(a){this._onLayoutArgumentChanged&&this._onLayoutArgumentChanged.dispatch(a)},Object.defineProperties(Node.prototype,{hitArea:{get:function(){return this.phaser.hitArea===undefined?this.rect:this.phaser.hitArea},set:function(a){this.phaser.hitArea=a}},serializeHitArea:{get:function(){return this.phaser.hitArea},set:function(a){this.phaser.hitArea=a}},onDown:{get:function(){return this._onDown||(this._onDown=new Phaser.Signal),this._onDown}},onUp:{get:function(){return this._onUp||(this._onUp=new Phaser.Signal),this._onUp}},onClick:{get:function(){return this._onClick||(this._onClick=new Phaser.Signal),this._onClick}},onDragStart:{get:function(){return this._onDragStart||(this._onDragStart=new Phaser.Signal),this._onDragStart}},onDrag:{get:function(){return this._onDrag||(this._onDrag=new Phaser.Signal),this._onDrag}},onDragEnd:{get:function(){return this._onDragEnd||(this._onDragEnd=new Phaser.Signal),this._onDragEnd}},onDragDrop:{get:function(){return this._onDragDrop||(this._onDragDrop=new Phaser.Signal),this._onDragDrop}},onWheel:{get:function(){return this._onWheel||(this._onWheel=new Phaser.Signal),this._onWheel}},onEnter:{get:function(){return this._onEnter||(this._onEnter=new Phaser.Signal),this._onEnter}},onExit:{get:function(){return this._onExit||(this._onExit=new Phaser.Signal),this._onExit}},onInteractive:{get:function(){return this._onInteractive||(this._onInteractive=new Phaser.Signal),this._onInteractive}},interactive:{get:function(){return this._interactive},set:function(a){this._interactive=a,this._onInteractive&&this._onInteractive.dispatch()}}}),Node.prototype.checkAllowDrop=function(a){for(var b=!1,c=this.scripts.length,d=0;c>d;d++){var e=this.scripts[d];if(e){var f=e.isAllowDrop;if(!f)continue;if(f.call(e,a))return!0;b=!0}}return this.isAllowDrop?this.isAllowDrop(a):!b},Node.prototype.canHandleInputEvent=function(a){if(!this.interactive)return!1;var b=this["_"+a];if(b&&b.getNumListeners()>0)return!0;for(var c=this.scripts.length,d=0;c>d;d++){var e=this.scripts[d];if(e){var f=e[a];if(!f)continue;return!0}}return!1},Node.prototype.getInputEventHandle=function(a){for(var b,c=Array.isArray(a)?a:[a],d=this,e=this.game.stage;d&&d!==e;){for(b=c.length;b--;)if(d.canHandleInputEvent(c[b]))return d;d=d.parent}return null},Node.prototype.getInputEventHandleAndEventType=function(a){for(var b,c=Array.isArray(a)?a:[a],d=this,e=this.game.stage;d&&d!==e;){for(b=c.length;b--;)if(d.canHandleInputEvent(c[b]))return[d,c[b]];d=d.parent}return null},Node.prototype.fireInputEvent=function(a,b){if(!this.interactive||this.state===qc.UIState.DISABLED)return!1;var c=this._sendMessage(a,!0,b);if(c===!0)return!0;var d=this["_"+a];d&&d.getNumListeners()>0&&d.dispatch(this,b)},Node.prototype.checkHit=function(a,b){var c=this;if(c._interactive){var d=c.phaser.hitArea===undefined?this._lastRectInfo:this.phaser.hitArea;return d&&d.contains&&d.contains(a,b)}},Object.defineProperty(Node.prototype,"class",{get:function(){return"qc.Node"}}),Node.prototype.getMeta=function(){var a=qc.Serializer,b=this;return{uuid:{type:a.STRING,get:function(a){return a.uuid},set:function(a,c){b.game.serializer.restoreContext[c]=b.uuid}},_prefab:a.STRING,__lock:a.BOOLEAN,name:a.STRING,uniqueName:a.STRING,ignoreDestroy:a.BOOLEAN,alpha:a.NUMBER,visible:a.BOOLEAN,colorTint:a.COLOR,"static":a.BOOLEAN,scripts:{get:function(a,c){return b._packScripts.call(a,c)},set:function(a,c){b._unpackScripts.call(a,c)}},position:{get:function(a){return[a.pivotX,a.pivotY,a.anchoredX,a.anchoredY,a.x,a.y,a.width,a.height,a.left,a.right,a.top,a.bottom,a.minAnchor.x,a.minAnchor.y,a.maxAnchor.x,a.maxAnchor.y]},set:function(a,b){var c=a;c._minAnchor=new qc.Point(b[12],b[13]),c._maxAnchor=new qc.Point(b[14],b[15]),c.phaser.anchor=new qc.Point(b[0],b[1]),c._anchoredX=b[2],c._anchoredY=b[3],c._minAnchor.x<c._maxAnchor.x?(c._left=b[8],c._right=b[9]):c.setWidth(b[6]),c._minAnchor.y<c._maxAnchor.y?(c._top=b[10],c._bottom=b[11]):c.setHeight(b[7]),c.relayout()}},scaleX:a.NUMBER,scaleY:a.NUMBER,rotation:a.NUMBER,serializeHitArea:a.AUTO,interactive:a.BOOLEAN,isFiltersThrough:a.BOOLEAN,children:{get:function(a,c){return b._packChildren.call(a,c)},set:function(a,c){b._unpackChildren.call(a,c)}}}},Node.prototype._packChildren=function(a){var b=this.children;if(0===b.length)return[];if(this instanceof qc.UIText||this instanceof qc.Sprite)return[];var c=[];for(var d in b){var e=b[d],f=this.game.serializer.buildBundle(e,a);c.push(f)}return c},Node.prototype._unpackChildren=function(a){for(var b in a)var c=this.game.serializer.restoreBundle(a[b],this,!0)},Node.prototype._packScripts=function(a){var b=this.scripts;if(!b||0===b.length)return[];var c=[];for(var d in b){var e=b[d],f=null;"qc.NonexistScript"!==e._clazz?(this.__json&&this.__json[e.uuid]&&(f=this.__json[e.uuid].data),f=this.game.serializer.buildBundle(e,a,f),c.push({clazz:e._clazz,data:e.uuid}),this.__json||(this.__json={}),this.__json[e.uuid]=f):c.push({clazz:e.script,data:e.data.uuid[1]})}return c},Node.prototype._unpackScripts=function(a){for(var b in a){var c=a[b],d=c.data;d="string"==typeof d?this.__json[d].data:d.data;var e=qc.Util.findClass(c.clazz);if("function"==typeof e)try{var f=this.addScript(c.clazz,!1),g={};f.getMeta&&(g=f.getMeta());for(var h in g)try{this.game.serializer.fromJson(f,d,h,g[h])}catch(i){console.error("Deserialize fail!",i),qc.Util.popupError(i.message)}}catch(i){console.error("Deserialize error!",i),qc.Util.popupError(i.message)}else{if(d&&d.uuid){var f=this.addScript("qc.NonexistScript");f.script=c.clazz,f.data=d}console.error("Class: "+c.clazz+" is not exist!")}}this.game.device.editor||delete this.__json},Node.prototype._findPath=function(a,b){var c="";if(a===this)return c;b===undefined&&(b=!0);var d=this.children;for(var e in d){var f=d[e],g=f._findPath(a,!1);if(""===g)return c+=f.name;if(g)return c+=f.name+"/"+g}if(!b)return null;var h=this.parent;for(c+="/..";h!==this.game.stage;){var g=h._findPath(a,!1);if(""===g)return c;if(g)return c+="/"+g;h=h.parent,c+="/.."}return null},Node.prototype._restoreNodeRef=function(){var a={};this.getMeta&&(a=this.getMeta());for(var b in a){var c="__BUILTIN_NODE__"+b;this[c]&&"string"==typeof this[c]&&(this[b]=this.game.serializer.findNodeRef(this[c]),delete this[c]);var d="__BUILTIN_NODE_ARRAY__"+b;if(this[d]&&"object"==typeof this[d]){var e=[];for(var f in this[d])e.push(this[d][f]&&this[d][f][1]?this.game.serializer.findNodeRef(this[d][f][1]):null);this[b]=e,delete this[d]}}for(var f in this.scripts){var g=this.scripts[f],a={};g.getMeta&&(a=g.getMeta());for(var b in a){var c="__BUILTIN_NODE__"+b;g[c]&&"string"==typeof g[c]&&(g[b]=this.game.serializer.findNodeRef(g[c]),delete g[c]);var d="__BUILTIN_NODE_ARRAY__"+b;if(g[d]&&"object"==typeof g[d]){var e=[];for(var f in g[d])e.push(g[d][f]&&g[d][f][1]?this.game.serializer.findNodeRef(g[d][f][1]):null);g[b]=e,delete g[d]}}}var h=this.children;for(var b in h)h[b]._restoreNodeRef()},Node.prototype._restoreInit=function(){this._initGetSetField();for(var a in this.scripts){var b=this.scripts[a];b._restoreInit&&b._restoreInit()}var c=this.children;for(var d in c)c[d]._restoreInit()},Node.prototype._dispatchAwake=function(){var a=this.children;for(var b in a)a[b]._dispatchAwake();for(var c in this.scripts){var d=this.scripts[c];(this.game.device.editor!==!0||d.runInEditor)&&d.awake&&d.awake.call(d)}},Node.prototype._dispatchEnable=function(){var a=this.children;for(var b in a)a[b]._dispatchEnable();for(var c in this.scripts){var d=this.scripts[c];(this.game.device.editor!==!0||d.runInEditor)&&d.enable&&d.onEnable&&d.onEnable()}},Node.prototype._initGetSetField=function(){var a=this.__GET_SET__;if(a){for(var b in a){var c=a[b];this[c]=this["__BUILTIN_SET__"+c],delete this["__BUILTIN_SET__"+c]}delete this.__GET_SET__}};var _CUSTOM_FIELD=function(a,b){return{type:b,get:function(b){return b[a]},set:function(b,c){b["__BUILTIN_SET__"+a]=c,b.__GET_SET__?b.__GET_SET__.push(a):b.__GET_SET__=[a]}}};Node.prototype.generateTexture=function(a,b,c,d,e,f){if(!this.phaser)return new qc.RenderTexture(0,0,renderer,b,a);var g=this.localBounds;g.x+=c||0,g.y+=d||0,isNaN(e)||(g.width=e),isNaN(f)||(g.height=f);var h=new qc.RenderTexture(0|g.width,0|g.height,null,b,a);return PIXI.DisplayObject._tempMatrix.tx=-g.x,PIXI.DisplayObject._tempMatrix.ty=-g.y,h.render(this.phaser,PIXI.DisplayObject._tempMatrix),h},Node._snapTempMatrix=new PIXI.Matrix,Node.prototype._snapshotAsRenderTexture=function(a,b,c,d){if(!this.phaser)return new qc.RenderTexture(0,0);var e=a,f=this.getWorldScale();e||(e=qc.Bounds.getBounds(this)),b=b||e.width*f.x,c=c||e.height*f.y;var g=b/e.width,h=c/e.height;d=d||this.game.resolution,Node._snapTempMatrix.a=g,Node._snapTempMatrix.d=h,Node._snapTempMatrix.tx=-e.x*g,Node._snapTempMatrix.ty=-e.y*h;var i=this.game.phaser,j=new qc.RenderTexture(1,1,i.renderer,i.scale.scaleMode,d);return j.resize(b,c,!0),j.render(this.phaser,Node._snapTempMatrix),j},Node.prototype.snapshotAsImage=function(a,b,c,d,e){var f=this._snapshotAsRenderTexture(a,b,c,d),g=f.getBase64();f.destroy(!0);var h=new Image;return h.src=g,e&&(h.onload=function(){e(h)}),h},Node.prototype.snapshotAsAtlas=function(a,b,c,d,e){var f=this._snapshotAsRenderTexture(b,c,d,e),g=this.game.assets._cache;g.checkImageKey(a)&&g.removeImage(a,!1);var h=qc.AssetUtil.addAtlasFromImage(this.game,a,a,f.getCanvas());return h};var Serializer=qc.Serializer=function(a){this.game=a};Serializer.prototype={},Serializer.prototype.constructor=Serializer,Serializer.customDeserializers={},Serializer.AUTO=0,Serializer.INT=1,Serializer.INTS=2,Serializer.NUMBER=3,Serializer.NUMBERS=4,Serializer.BOOLEAN=5,Serializer.BOOLEANS=6,Serializer.STRING=7,Serializer.STRINGS=8,Serializer.MAPPING=9,Serializer.TEXTURE=10,Serializer.TEXTURES=11,Serializer.AUDIO=12,Serializer.AUDIOS=13,Serializer.COLOR=14,Serializer.COLORS=15,Serializer.PREFAB=16,
Serializer.PREFABS=17,Serializer.NODE=18,Serializer.NODES=19,Serializer.SCRIPT=20,Serializer.SCRIPTS=21,Serializer.GEOM=22,Serializer.GEOMS=23,Serializer.POINT=24,Serializer.POINTS=25,Serializer.RECTANGLE=26,Serializer.RECTANGLES=27,Serializer.CIRCLE=28,Serializer.CIRCLES=29,Serializer.ELLIPSE=30,Serializer.ELLIPSES=31,Serializer.FONT=32,Serializer.FONTS=33,Serializer.FILTER=34,Serializer.FILTERS=35,Serializer.TEXTASSET=36,Serializer.TEXTASSETS=37,Serializer.EXCELASSET=38,Serializer.EXCELASSETS=39,Serializer.ACTION=40,Serializer.ACTIONMANAGER=41,Serializer.ANIMATOR=42,Serializer.ANIMATORS=43,Serializer.prototype.buildBundle=function(a,b,c){b.dependences||(b.dependences=[]);var d={};a.getMeta&&(d=a.getMeta()),c=c||{};for(var e in d)this.toJson(a,c,b,e,a[e],d[e]);return{"class":a["class"],data:c,__json:a.__json}},Serializer.prototype.combineDependence=function(a){var b={};for(var c in a.dependences){var d=a.dependences[c];b[d.uuid]||(b[d.uuid]=d)}return b},Serializer.prototype.restoreBundle=function(a,b,c){c||(this.restoreContext={}),this.isRestoring=!0;var d=a.data.uuid;this.game.nodePool.find(d)&&(d=this.game.math.uuid());var e=this.newNode(a["class"],b,d);a.__json&&(e.__json=deepCopy(a.__json));var f={};e.getMeta&&(f=e.getMeta());var g=a.data;for(var h in f)"scripts"!==h&&this.fromJson(e,g,h,f[h]);return f.scripts&&this.fromJson(e,g,"scripts",f.scripts),e.onDeserialized&&e.onDeserialized(),c?e:(e._restoreNodeRef(),e._restoreInit(),e._dispatchAwake(),e._dispatchEnable(),this.restoreContext={},this.isRestoring=!1,e)},Serializer.prototype.restoreState=function(a){var b=[];this.restoreContext={},this.isRestoring=!0;for(var c in a.children){var d=this.restoreBundle(a.children[c],this.game.world,!0);b.push(d)}for(var c in b)b[c]._restoreNodeRef();for(var c in b)b[c]._restoreInit();for(var c in b)b[c]._dispatchAwake();for(var c in b)b[c]._dispatchEnable();this.restoreContext={},this.isRestoring=!1},Serializer.prototype.toJson=function(a,b,c,d,e,f){if(f=f||Serializer.AUTO,"object"==typeof f&&"function"==typeof f.get&&"function"==typeof f.set)return void(b[d]=f.get.call(a,a,c));switch(f){case Serializer.AUTO:f=this.getAutoType(e),f===undefined?b[d]=e:this.toJson(a,b,c,d,e,f);break;case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:this._saveCommonType(a,b,c,d,e,f);break;case Serializer.INTS:case Serializer.NUMBERS:case Serializer.STRINGS:case Serializer.BOOLEANS:this._saveCommonArray(a,b,c,d,e,f);break;case Serializer.MAPPING:this._saveMapping(a,b,c,d,e,f);break;case Serializer.COLOR:this.saveColor(a,b,c,d,e);break;case Serializer.COLORS:this._saveArray(a,b,c,d,e,f,this._saveColorItem);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:this.saveGeom(a,b,c,d,e);break;case Serializer.POINTS:case Serializer.RECTANGLES:case Serializer.CIRCLES:case Serializer.ELLIPSES:this._saveArray(a,b,c,d,e,f,this._saveGeomItem);break;case Serializer.PREFAB:this.savePrefab(a,b,c,d,e);break;case Serializer.PREFABS:this._saveArray(a,b,c,d,e,f,this._savePrefabItem);break;case Serializer.TEXTURE:this.saveTexture(a,b,c,d,e);break;case Serializer.TEXTURES:this._saveArray(a,b,c,d,e,f,this._saveTextureItem);break;case Serializer.AUDIO:this.saveAudio(a,b,c,d,e);break;case Serializer.AUDIOS:this._saveArray(a,b,c,d,e,f,this._saveAudioItem);break;case Serializer.TEXTASSET:this.saveTextAsset(a,b,c,d,e);break;case Serializer.TEXTASSETS:this._saveArray(a,b,c,d,e,f,this._saveTextAssetItem);break;case Serializer.EXCELASSET:this.saveExcelAsset(a,b,c,d,e);break;case Serializer.EXCELASSETS:this._saveArray(a,b,c,d,e,f,this._saveExcelAssetItem);break;case Serializer.FONT:this.saveFont(a,b,c,d,e);break;case Serializer.FONTS:this._saveArray(a,b,c,d,e,f,this._saveFontItem);break;case Serializer.NODE:this.saveNode(a,b,c,d,e);break;case Serializer.NODES:this._saveArray(a,b,c,d,e,f,this._saveNodeItem);break;case Serializer.FILTER:this._saveFilter(a,b,c,d,e);break;case Serializer.FILTERS:this._saveArray(a,b,c,d,e,f,this._saveFilterItem);break;case Serializer.ACTION:this.saveAction(a,b,c,d,e);break;case Serializer.ACTIONMANAGER:this.saveActionManager(a,b,c,d,e);break;case Serializer.ANIMATOR:e instanceof qc.ActionAsset?this.saveAction(a,b,c,d,e):e instanceof qc.ActionManagerAsset&&this.saveActionManager(a,b,c,d,e);break;case Serializer.ANIMATORS:if(e){b[d]=[f,[]];for(var g in e){var h=e[g];h instanceof qc.ActionAsset?b[d][1].push(this._saveActionItem(h,c)):h instanceof qc.ActionManagerAsset&&b[d][1].push(this._saveActionManagerItem(h,c))}}break;default:throw new Error("unsupported asset type:"+f)}},Serializer.prototype.fromJson=function(a,b,c,d){if(d=d||Serializer.AUTO,"object"==typeof d&&"function"==typeof d.get&&"function"==typeof d.set)return void d.set.call(a,a,b[c]);var e=b[c];if(e!==undefined){if(null===e||e===0/0)return void(a[c]=e);switch(e[0]){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:this._restoreCommonType(a,b,c,e[0]);break;case Serializer.INTS:case Serializer.NUMBERS:case Serializer.STRINGS:case Serializer.BOOLEANS:this._restoreCommonArray(a,b,c,e);break;case Serializer.MAPPING:this._restoreMapping(a,b,c,e);break;case Serializer.COLOR:this.restoreColor(a,b,c,e);break;case Serializer.COLORS:this._restoreArray(a,b,c,e,this._restoreColorItem);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:this.restoreGeom(a,b,c,e);break;case Serializer.POINTS:case Serializer.RECTANGLES:case Serializer.CIRCLES:case Serializer.ELLIPSES:this._restoreArray(a,b,c,e,this._restoreGeomItem);break;case Serializer.PREFAB:this.restorePrefab(a,b,c,e);break;case Serializer.PREFABS:this._restoreArray(a,b,c,e,this._restorePrefabItem);break;case Serializer.TEXTURE:this.restoreTexture(a,b,c,e);break;case Serializer.TEXTURES:this._restoreArray(a,b,c,e,this._restoreTextureItem);break;case Serializer.EXCELASSET:this.restoreExcelAsset(a,b,c,e);break;case Serializer.EXCELASSETS:this._restoreArray(a,b,c,e,this._restoreExcelAssetItem);break;case Serializer.AUDIO:this.restoreAudio(a,b,c,e);break;case Serializer.AUDIOS:this._restoreArray(a,b,c,e,this._restoreAudioItem);break;case Serializer.TEXTASSET:this.restoreTextAsset(a,b,c,e);break;case Serializer.TEXTASSETS:this._restoreArray(a,b,c,e,this._restoreTextAssetItem);break;case Serializer.FONT:this.restoreFont(a,b,c,e);break;case Serializer.FONTS:this._restoreArray(a,b,c,e,this._restoreFontItem);break;case Serializer.NODE:this.restoreNode(a,b,c,e);break;case Serializer.NODES:this.restoreNodes(a,b,c,e);break;case Serializer.FILTER:this._restoreFilter(a,b,c,e);break;case Serializer.FILTERS:this._restoreArray(a,b,c,e,this._restoreFilterItem);break;case Serializer.ACTION:this.restoreAction(a,b,c,e);break;case Serializer.ACTIONMANAGER:this.restoreActionManager(a,b,c,e);break;case Serializer.ANIMATORS:var f=[];if(e)for(var g in e[1])e[1][g][0]===Serializer.ACTION?f.push(this._restoreActionItem(e[1][g])):e[1][g][0]===Serializer.ACTIONMANAGER&&f.push(this._restoreActionManagerItem(e[1][g]));a[c]=f;break;default:throw new Error("unsupported asset type:"+d)}}},Serializer.prototype.atob=function(a){return decodeURIComponent(atob(a))},Serializer.prototype.btoa=function(a){return btoa(encodeURIComponent(a))},Serializer.prototype.unpackUTF8=function(a){var b,c,d,e,f,g,c=0,d=a.length;for(b="";d>c;)switch(e=a[c++],e>>4){case 0:case 1:case 2:case 3:case 4:case 5:case 6:case 7:b+=String.fromCharCode(e);break;case 12:case 13:f=a[c++],b+=String.fromCharCode((31&e)<<6|63&f);break;case 14:f=a[c++],g=a[c++],b+=String.fromCharCode((15&e)<<12|(63&f)<<6|(63&g)<<0)}return b},Serializer.prototype.findNodeRef=function(a){var b=this.restoreContext[a]?this.restoreContext[a]:a;return this.game.nodePool.find(b)},Serializer.prototype.saveAudio=function(a,b,c,d,e){b[d]=this._saveAudioItem(e,c)},Serializer.prototype.restoreAudio=function(a,b,c,d){a[c]=this._restoreAudioItem(d)},Serializer.prototype._saveAudioItem=function(a,b){return a instanceof qc.SoundAsset?(b.dependences.push({key:a.key,uuid:a.uuid}),[Serializer.AUDIO,a.key,a.uuid]):null},Serializer.prototype._restoreAudioItem=function(a){if(!a)return null;var b=this.game.assets.find(a[1]);return b||(b=this.game.assets.findByUUID(a[2])),b?b instanceof qc.SoundAsset?b:null:(console.error("音频资源尚未载入, 无法反序列化.",a[1]),null)},Serializer.prototype.saveAction=function(a,b,c,d,e){b[d]=this._saveActionItem(e,c)},Serializer.prototype.restoreAction=function(a,b,c,d){a[c]=this._restoreActionItem(d)},Serializer.prototype._saveActionItem=function(a,b){return a instanceof qc.ActionAsset?(b.dependences.push({key:a.key,uuid:a.uuid}),[Serializer.ACTION,a.uuid]):null},Serializer.prototype._restoreActionItem=function(a){if(!a)return null;var b=this.game.assets.findByUUID(a[1]);return b instanceof qc.ActionAsset?b:null},Serializer.prototype.saveActionManager=function(a,b,c,d,e){b[d]=this._saveActionManagerItem(e,c)},Serializer.prototype.restoreActionManager=function(a,b,c,d){a[c]=this._restoreActionManagerItem(d)},Serializer.prototype._saveActionManagerItem=function(a,b){return a instanceof qc.ActionManagerAsset?(b.dependences.push({key:a.key,uuid:a.uuid}),[Serializer.ACTIONMANAGER,a.uuid]):null},Serializer.prototype._restoreActionManagerItem=function(a){if(!a)return null;var b=this.game.assets.findByUUID(a[1]);return b instanceof qc.ActionManagerAsset?b:null},Serializer.prototype.saveColor=function(a,b,c,d,e){b[d]=this._saveColorItem(e)},Serializer.prototype.restoreColor=function(a,b,c,d){a[c]=this._restoreColorItem(d)},Serializer.prototype._saveColorItem=function(a){return a instanceof Color?[Serializer.COLOR,a.toNumber(!0)]:null},Serializer.prototype._restoreColorItem=function(a){return a?new Color(a[1]):null},Serializer.prototype.saveExcelAsset=function(a,b,c,d,e){b[d]=this._saveExcelAssetItem(e,c)},Serializer.prototype.restoreExcelAsset=function(a,b,c,d){a[c]=this._restoreExcelAssetItem(d)},Serializer.prototype._saveExcelAssetItem=function(a,b){return a instanceof qc.ExcelAsset?(b.dependences.push({key:a.key,uuid:a.uuid}),[Serializer.EXCELASSET,a.key,a.uuid]):null},Serializer.prototype._restoreExcelAssetItem=function(a){if(!a)return null;var b=this.game.assets.find(a[1]);return b||(b=this.game.assets.findByUUID(a[2])),b&&b instanceof qc.ExcelAsset?b:null},Serializer.prototype.saveFont=function(a,b,c,d,e){b[d]=this._saveFontItem(e,c)},Serializer.prototype.restoreFont=function(a,b,c,d){a[c]=this._restoreFontItem(d)},Serializer.prototype._saveFontItem=function(a,b){if(a instanceof qc.Font)var c=a;if(c&&c instanceof qc.Font){b.dependences.push({key:c.key,uuid:c.uuid});var d=c.uuid;a=c.key}return[Serializer.FONT,a,d]},Serializer.prototype._restoreFontItem=function(a,b){if(!a)return null;b=b||this;var c=b.game.assets.find(a[1]);return c||(c=b.game.assets.findByUUID(a[2])),c||(c=a[1]),c},Serializer.prototype.isGeom=function(a){return a instanceof qc.Circle||a instanceof qc.Ellipse||a instanceof qc.Line||a instanceof qc.Matrix||a instanceof qc.Polygon||a instanceof qc.Rectangle||a instanceof qc.RoundedRectangle||a instanceof qc.Point},Serializer.prototype.saveGeom=function(a,b,c,d,e){b[d]=this._saveGeomItem(e,c)},Serializer.prototype.restoreGeom=function(a,b,c,d){a[c]=this._restoreGeomItem(d)},Serializer.prototype._saveGeomItem=function(a){var b=Serializer.GEOM;return a instanceof qc.Point?b=Serializer.POINT:a instanceof qc.Rectangle?b=Serializer.RECTANGLE:a instanceof qc.Circle?b=Serializer.CIRCLE:a instanceof qc.Ellipse&&(b=Serializer.ELLIPSE),a?[b,a["class"],a.toJson()]:null},Serializer.prototype._restoreGeomItem=function(a){if(!a)return null;var b=qc.Util.findClass(a[1]),c=new b;return c.fromJson(a[2]),c},Serializer.prototype.saveNode=function(a,b,c,d,e){b[d]=this._saveNodeItem(e,c)},Serializer.prototype.restoreNode=function(a,b,c,d){a["__BUILTIN_NODE__"+c]=d[1]},Serializer.prototype.restoreNodes=function(a,b,c,d){a["__BUILTIN_NODE_ARRAY__"+c]=d[1]},Serializer.prototype._saveNodeItem=function(a){return a instanceof qc.Node?[Serializer.NODE,a.uuid]:null},Serializer.prototype.savePrefab=function(a,b,c,d,e){b[d]=this._savePrefabItem(e,c)},Serializer.prototype.restorePrefab=function(a,b,c,d){a[c]=this._restorePrefabItem(d)},Serializer.prototype._savePrefabItem=function(a,b){return a instanceof Prefab?(b.dependences.push({key:a.uuid,uuid:a.uuid}),[Serializer.PREFAB,a.uuid]):null},Serializer.prototype._restorePrefabItem=function(a){if(!a)return null;var b=this.game.assets.findByUUID(a[1]);return b instanceof Prefab?b:null},Serializer.prototype.saveTexture=function(a,b,c,d,e){b[d]=this._saveTextureItem(e,c)},Serializer.prototype.restoreTexture=function(a,b,c,d){a[c]=this._restoreTextureItem(d)},Serializer.prototype._saveTextureItem=function(a,b){if(!(a instanceof qc.Texture))return null;var c=a.atlas;return b.dependences.push({key:c.key,uuid:c.uuid}),[Serializer.TEXTURE,c.key,c.uuid,a.frame]},Serializer.prototype._restoreTextureItem=function(a){if(!a)return null;var b=this.game.assets.find(a[1]);return b||(b=this.game.assets.findByUUID(a[2])),b?b instanceof qc.Atlas?new qc.Texture(b,a[3]):null:(console.error("贴图资源尚未载入，无法反序列化。",a[1]),null)},Serializer.prototype.saveTextAsset=function(a,b,c,d,e){b[d]=this._saveTextAssetItem(e,c)},Serializer.prototype.restoreTextAsset=function(a,b,c,d){a[c]=this._restoreTextAssetItem(d)},Serializer.prototype._saveTextAssetItem=function(a,b){return a instanceof qc.TextAsset?(b.dependences.push({key:a.key,uuid:a.uuid}),[Serializer.TEXTASSET,a.key,a.uuid]):null},Serializer.prototype._restoreTextAssetItem=function(a){if(!a)return null;var b=this.game.assets.find(a[1]);return b||(b=this.game.assets.findByUUID(a[2])),b?b instanceof qc.TextAsset?b:null:(console.error("文本资源尚未载入, 无法反序列化.",a[1]),null)},Serializer.registerCustomDeserializer=function(a,b){var c=Serializer.customDeserializers;return c[a]?void console.error("Duplicate custom deserializer"):void(c[a]=b)},Serializer.prototype.getAutoType=function(a){if(a===undefined||null===a||a===0/0)return undefined;if("number"==typeof a)return Serializer.NUMBER;if("string"==typeof a)return Serializer.STRING;if("boolean"==typeof a)return Serializer.BOOLEAN;if(a instanceof qc.Node)return Serializer.NODE;if(a instanceof qc.Texture)return Serializer.TEXTURE;if(a instanceof qc.SoundAsset)return Serializer.AUDIO;if(a instanceof qc.TextAsset)return Serializer.TEXTASSET;if(a instanceof qc.ActionAsset)return Serializer.ACTION;if(a instanceof qc.ActionManagerAsset)return Serializer.ACTIONMANAGER;if(this.isGeom(a))return Serializer.GEOM;throw console.error(a),new Error("")},Serializer.prototype.newNode=function(a,b,c){switch(a){case"qc.UIImage":return this.game.add.image(b,c);case"qc.Sprite":return this.game.add.sprite(b,c);case"qc.UIRoot":return new qc.UIRoot(this.game,c);case"qc.Button":return this.game.add.button(b,c);case"qc.Toggle":return new qc.Toggle(this.game,b,c);case"qc.UIText":return this.game.add.text(b,c);case"qc.Sound":return this.game.add.sound(b,c);case"qc.Node":return this.game.add.node(b,c);case"qc.ScrollView":return this.game.add.scrollView(b,c);case"qc.ScrollBar":return this.game.add.scrollBar(b,!1,c);case"qc.InputField":return this.game.add.inputField(b,c);case"qc.ProgressBar":return this.game.add.progressBar(b,!1,c);case"qc.Slider":return this.game.add.slider(b,!1,c);case"qc.Tilemap":return this.game.add.tilemap(b,c);case"qc.TileLayer":return this.game.add.tileLayer(b,c);case"qc.ObjectLayer":return this.game.add.objectLayer(b,c);case"qc.Dom":return this.game.add.dom(b,c);case"qc.Graphics":return this.game.add.graphics(b,c);case"qc.Dropdown":return this.game.add.dropdown(b,c);default:var d=Serializer.customDeserializers[a];if(d)return d(this.game,b,c);throw new Error("unsupported class:"+a)}},Serializer.prototype._saveCommonType=function(a,b,c,d,e,f){b[d]=[f,e]},Serializer.prototype._restoreCommonType=function(a,b,c){a[c]=b[c][1]},Serializer.prototype._saveCommonArray=function(a,b,c,d,e,f){if(b[d]=[f,[]],e)for(var g in e)b[d][1].push(e[g])},Serializer.prototype._restoreCommonArray=function(a,b,c,d){var e=[];if(d)for(var f in d[1])e.push(d[1][f]);a[c]=e},Serializer.prototype._saveMapping=function(a,b,c,d,e,f){if(b[d]=[f,{}],e)for(var g in e)b[d][1][g]=e[g]},Serializer.prototype._restoreMapping=function(a,b,c,d){var e={};if(d)for(var f in d[1])e[f]=d[1][f];a[c]=e},Serializer.prototype._saveArray=function(a,b,c,d,e,f,g){if(b[d]=[f,[]],e)for(var h in e){var i=e[h],j=g.call(this,i,c);b[d][1].push(j)}},Serializer.prototype._restoreArray=function(a,b,c,d,e){var f=this,g=[];if(d)for(var h in d[1])g.push(e.call(this,d[1][h],f));a[c]=g};var Camera=qc.Camera=function(a){this.phaser=a,a._qc=this,a.roundPx=!1};Camera.prototype={},Camera.prototype.constructor=Camera,Object.defineProperties(Camera.prototype,{game:{get:function(){return this.phaser.game._qc}},world:{get:function(){return this.phaser.world._qc}},id:{get:function(){return this.phaser.id}},view:{get:function(){return this.phaser.view}},position:{get:function(){return this.phaser.position},set:function(a){this.phaser.position=a}},size:{get:function(){return new qc.Point(this.view.width,this.view.height)},set:function(a){this.setSize(a.x,a.y)}},x:{get:function(){return this.phaser.x},set:function(a){this.phaser.x=a}},y:{get:function(){return this.phaser.y},set:function(a){this.phaser.y=a}},width:{get:function(){return this.phaser.width},set:function(a){this.phaser.width=a}},height:{get:function(){return this.phaser.height},set:function(a){this.phaser.height=a}},bounds:{get:function(){return this.phaser.bounds},set:function(a){this.phaser.bounds=a}},visible:{get:function(){return this.phaser.visible},set:function(a){this.phaser.visible=a}},target:{get:function(){return this.phaser.target}}}),Camera.FOLLOW_LOCKON=Phaser.Camera.FOLLOW_LOCKON,Camera.FOLLOW_PLATFORMER=Phaser.Camera.FOLLOW_PLATFORMER,Camera.FOLLOW_TOPDOWN=Phaser.Camera.FOLLOW_TOPDOWN,Camera.FOLLOW_TOPDOWN_TIGHT=Phaser.Camera.FOLLOW_TOPDOWN_TIGHT,Camera.prototype.follow=function(a,b){null===a?this.phaser.unfollow():this.phaser.follow(a,b)},Camera.prototype.focusOn=function(a,b){this.phaser.focusOnXY(a,b)},Camera.prototype.reset=function(){this.phaser.reset()};var Game=qc.Game=function(a,b,c,d,e,f,g,h){var i=this;i.onStart=new qc.Signal,i.log=new qc.Log(i),i._debug=new qc.Debug(i),i._device=new qc.Device(i,Phaser.Device);var j;j="object"==typeof arguments[0]&&1===arguments.length?arguments[0]:{width:a,height:b,parent:c,state:d,transparent:e,physicsConfig:h},i.debug.on=j.debug,i.device.editor=j.editor,i.fixedGameSize=j.width>0&&j.height>0?{width:j.width,height:j.height}:null,i.remoteLogUrl=j.remoteLogUrl,d=j.state,d=d||{preload:function(){},create:function(){}};var k=d.init;if(d.init=function(){var a=i.phaser;i._nodePool=new qc.NodePool(i),new qc.SceneManager(a.state),new qc.PluginManager(a.plugins),a.math._qc=new qc.Math(a.rnd),i.timer=new qc.Timer(i),i.time=new qc.Time(i),i.sound=new qc.SoundManager(i),i._assets=new qc.Assets(i,a.load,a.cache),new qc.Stage(a.stage),new qc.Camera(a.camera),new qc.World(a.world),new qc.Input(a.input),i.dirtyRectangle=new qc.DirtyRectangle(a),a.renderer.dirtyRectangle=i.dirtyRectangle,i.dirtyRectangle.enable=j.dirtyRectangles,i.dirtyRectangle.showDirtyRegion=j.dirtyRectanglesShow,i.canvas.style.outline=0,i.container.style.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),i.plugins.add(qc.dragonBonesDriver),i.plugins.add(qc.CleanPIXISpriteRetainer),i._serializer=new qc.Serializer(i),i._storage=new qc.Storage(i),i.phaser.scale.pageAlignHorizontally=!0,i.phaser.scale.pageAlignVertically=!0,i.phaser.scale.scaleMode=Phaser.ScaleManager.SHOW_ALL,i.phaser.scale.onSizeChange.add(function(){i.device.resetOrientation()}),i.device.resetOrientation(),i._debug.remoteLogUrl=j.remoteLogUrl,k&&k.call(d),window.qc.initGame&&window.qc.initGame(i),i.onStart.dispatch()},j.state=d,j.renderer=null==j.renderer?Phaser.AUTO:j.renderer,!("antialias"in j)){var l;switch(j.renderer){case Phaser.HEADLESS:case Phaser.CANVAS:l=!1;break;case Phaser.AUTO:var m=function(){try{var a=document.createElement("canvas");return a.screencanvas=!1,!!window.WebGLRenderingContext&&(a.getContext("webgl")||a.getContext("experimental-webgl"))}catch(b){return!1}}();l=m?!0:!1;default:l=!0}j.antialias=l}if(j.disableVisibilityChange=j.runInBackground,j.disableVisibilityChange=null==j.disableVisibilityChange?!0:j.disableVisibilityChange,!j.resolution){var n=window.devicePixelRatio;j.resolution="number"==typeof j.resolutionRatio?1+Math.max(0,(n-1)*j.resolutionRatio):i.device.desktop?n:1+Math.max(0,(n-1)/4)}var o=j.backgroundColor;null==o&&(o=Color.background),o instanceof Color&&(o=o.toNumber()),j.backgroundColor=o,i.phaser=new Phaser.Game(j),i.phaser._qc=this,this.phaser._calcTransformCount=0,i.phaser.forceSingleUpdate=!0,i.add=new GameObjectFactory(i)};Object.defineProperties(Game.prototype,{id:{get:function(){return this.phaser.id}},config:{get:function(){return this.phaser.config},set:function(a){this.phaser.config=a}},physicsConfig:{get:function(){return this.phaser.physicsConfig},set:function(a){this.phaser.physicsConfig=a}},parent:{get:function(){return this.phaser.parent}},width:{get:function(){return this.phaser.width}},height:{get:function(){return this.phaser.height}},resolution:{get:function(){return this.phaser.resolution}},transparent:{get:function(){return this.phaser.renderer.transparent},set:function(a){this.phaser.renderer.transparent=a}},antialias:{get:function(){return this.phaser.antialias},set:function(a){var b=this.phaser;if(b.antialias!==a){b.antialias=a,b.stage.smoothed=a;for(var c in PIXI.BaseTextureCache)PIXI.BaseTextureCache[c].scaleMode=a?PIXI.scaleModes.LINEAR:PIXI.scaleModes.NEAREST,this.phaser.renderType===Phaser.WEBGL&&PIXI.BaseTextureCache[c].dirty();this.dirtyRectangle.forceDirty=!0}}},isBooted:{get:function(){return this.phaser.isBooted}},isRunning:{get:function(){return this.phaser.isRunning}},camera:{get:function(){return this.phaser.camera._qc}},canvas:{get:function(){return this.phaser.canvas}},onPause:{get:function(){return this.phaser.onPause}},onResume:{get:function(){return this.phaser.onResume}},onBlur:{get:function(){return this.phaser.onBlur}},onFocus:{get:function(){return this.phaser.onFocus}},state:{get:function(){return this.phaser.state._qc}},scene:{get:function(){return this.phaser.state._qc}},stage:{get:function(){return this.phaser.stage._qc}},container:{get:function(){return this.phaser.canvas.parentNode}},input:{get:function(){return this.phaser.input._qc}},plugins:{get:function(){return this.phaser.plugins._qc}},math:{get:function(){return this.phaser.math._qc}},assets:{get:function(){return this._assets}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null}},serializer:{get:function(){return this._serializer}},nodePool:{get:function(){return this._nodePool}},storage:{get:function(){return this._storage}},paused:{get:function(){return this.phaser.paused},set:function(a){this.phaser.paused=a}},stepCount:{get:function(){return this.phaser.stepCount}},stepping:{get:function(){return this.phaser.stepping}},device:{get:function(){return this._device}},debug:{get:function(){return this._debug}}}),Game.prototype.shutdown=function(){this.input.enable=!1,this.state.clearWorld(!0),this.assets.clear(),this.phaser.destroy()},Game.prototype.enableStep=function(){this.phaser.enableStep()},Game.prototype.disableStep=function(){this.phaser.disableStep()},Game.prototype.step=function(){this.phaser.step()},Game.prototype.updateScale=function(a){var b=this.phaser.scale;b&&(b._lastUpdate=0,a&&b.preUpdate())},Game.prototype.fullScreen=function(){var a=this;if(!a._adjustToFullScreen){var b,c;a._adjustToFullScreen=function(d){if(!a.isBooted||!a.input.inputting){var e=document.documentElement.clientWidth;window.innerWidth&&window.innerWidth<e&&(e=window.innerWidth);var f=document.documentElement.clientHeight;window.innerHeight&&window.innerHeight<f&&(f=window.innerHeight),(b!==e||c!==f||d)&&(b=e,c=f,a.device.iOS?(a.setGameSize(e-5,f+5),a.phaser.time.events.add(1,function(){a.setGameSize(e,f)})):a.setGameSize(e,f),a.container.style.width=e+"px",a.container.style.height=f+"px",a.updateScale(),a.device.phaser.UCBrowser&&(window.scrollTo(0,1),setTimeout(function(){var a=document.createElement("div");a.style.position="absolute",a.style.top=f+"px",a.style.width="100px",a.style.height="100px",document.body.appendChild(a),window.scrollTo(0,f),setTimeout(function(){window.scrollTo(0,1),document.body.removeChild(a)},10)},10)))}},window.addEventListener("orientationchange",a.updateGameLayout.bind(a,!1),!1),window.addEventListener("resize",a.updateGameLayout.bind(a,!1),!1),window.scrollTo(0,1),a._adjustToFullScreen()}},Game.prototype.setGameSize=function(a,b){this.fixedGameSize||this.phaser.scale.setGameSize(a,b),this.updateScale()},Game.prototype.updateGameLayout=function(a){this._adjustToFullScreen&&this._adjustToFullScreen(a),this.world.updateDomRoot()},Game.prototype.update=function(a){var b=this.phaser;if(this.time){var a=this.time.now;(!this._lastUpdateGameSizeTime||a-this._lastUpdateGameSizeTime>1e3)&&(this._lastUpdateGameSizeTime=a,this.updateGameLayout())}b._calcTransformCount=0,b.time.update(a);var c=1/b.time.desiredFps;if(b._kickstart)return this.updateLogic(c),b._calcTransformCount=0,b.stage.updateTransform(),this.updateRender(b.time.slowMotion*b.time.desiredFps),void(b._kickstart=!1);if(!(b._spiraling>1)||b.forceSingleUpdate){var d=1e3*b.time.slowMotion/b.time.desiredFps;b._deltaTime+=Math.max(Math.min(3*d,b.time.elapsed),0);var e=0;b.updatesThisFrame=Math.floor(b._deltaTime/d),b.forceSingleUpdate&&(b.updatesThisFrame=Math.min(1,b.updatesThisFrame));for(var f=!1;b._deltaTime>=d&&(b._deltaTime-=d,b.currentUpdateID=e,f||this._paused||this.pendingStep||(f=!0),f&&(b.updateFrameDelta(),this.updateLogic(c),b._calcTransformCount=0,b.stage.updateTransform()),e++,!b.forceSingleUpdate||1!==e););return e>b._lastCount?b._spiraling++:e<b._lastCount&&(b._spiraling=0),b._lastCount=e,f&&this.updateRender(b._deltaTime/d),f}b.time.time>b._nextFpsNotification&&(b._nextFpsNotification=b.time.time+1e4,b.fpsProblemNotifier.dispatch()),b._deltaTime=0,b._spiraling=0,b.updateRender(b.time.slowMotion*b.time.desiredFps)},Game.prototype.updateLogic=function(a){var b=Date.now(),c=this.phaser;if(c._paused||c.pendingStep)c.scale.pauseUpdate(),c.state.pauseUpdate(),c.debug.preUpdate();else{this.timer&&this.timer.update(this.time.now),c.stepping&&(c.pendingStep=!0);var d=Date.now();c.scale.preUpdate(),c.debug.preUpdate(),c.world.camera.preUpdate(),c.state.preUpdate(a),c.plugins.preUpdate(a),c.stage.preUpdate(),c.physics.preUpdate(),this.debug.preUpdate+=Date.now()-d,d=Date.now(),c.input.update(),c.state.update(),c.stage.update(),c.tweens.update(a),c.sound.update(),c.physics.update(),c.plugins.update(),this.debug.update+=this.time.now-d,d=Date.now(),c.stage.postUpdate(),c.plugins.postUpdate(),this.debug.postUpdate+=Date.now()-d,d=Date.now()}this.debug.logic+=Date.now()-b},Game.prototype.updateRender=function(a){var b=Date.now(),c=this.phaser;c.lockRender||(c.state.preRender(a),c.renderer.render(c.stage),c.plugins.render(a),c.state.render(a),c.plugins.postRender(a),qc.CanvasPool.postRender(),this.debug.render+=Date.now()-b)},Phaser.Game.prototype.gamePaused=function(a){this._paused||(this._paused=!0,this.time.gamePaused(),this.sound.setMute(),this.onPause.dispatch(a),this.device.cordova&&this.device.iOS&&(this.lockRender=!0))},Phaser.Game.prototype.gameResumed=function(a){this._paused&&!this._codePaused&&(this._paused=!1,this.time.gameResumed(),this.input.reset(),this.sound.unsetMute(),this.onResume.dispatch(a),this.device.cordova&&this.device.iOS&&(this.lockRender=!1))};var phaserGameParseConfig=Phaser.Game.prototype.parseConfig;Phaser.Game.prototype.parseConfig=function(a){phaserGameParseConfig.call(this,a),"antialias"in a&&(this.antialias=!!a.antialias)};var phaser_updateSetTimeout=Phaser.RequestAnimationFrame.prototype.updateSetTimeout;Phaser.RequestAnimationFrame.prototype.updateSetTimeout=function(){try{phaser_updateSetTimeout.call(this)}catch(a){this.game._qc.log.error("Error：{0}",a)}};var phaser_updateRAF=Phaser.RequestAnimationFrame.prototype.updateRAF;Phaser.RequestAnimationFrame.prototype.updateRAF=function(a){try{phaser_updateRAF.call(this,a)}catch(b){this.game._qc.log.error("Error：{0}",b)}},Phaser.Game.prototype.updateFrameDelta=function(a){var b=this,c=b.time,d=c.time,e=b.__lastFrameTime?d-b.__lastFrameTime:a;b.__lastFrameTime=d,c.frameDeltaTime=e/c.slowMotion,c._totalEscapeTime=c.frameDeltaTime+(c._totalEscapeTime||0)};var Plugin=qc.Plugin=Phaser.Plugin,PluginManager=qc.PluginManager=function(a){a._qc=this,this.phaser=a};PluginManager.prototype={},PluginManager.prototype.constructor=PluginManager,Object.defineProperties(PluginManager.prototype,{game:{get:function(){return this.phaser.game._qc}},plugins:{get:function(){return this.phaser.plugins}}}),PluginManager.prototype.add=function(a){var a=this.phaser.add.apply(this.phaser,arguments);return a.game=this.game,a},PluginManager.prototype.remove=function(a){this.phaser.remove(a)},PluginManager.prototype.removeAll=function(){this.phaser.removeAll()},PluginManager.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser},qc.Signal=Phaser.Signal,qc.SignalBinding=Phaser.SignalBinding;var Stage=qc.Stage=function(a){this.phaser=a,a._qc=this};Stage.prototype={},Stage.prototype.constructor=Stage,Object.defineProperties(Stage.prototype,{game:{get:function(){return this.phaser.game._qc}},name:{get:function(){return this.phaser.name},set:function(a){this.phaser.name=a}},runInBackground:{get:function(){return this.phaser.disableVisibilityChange},set:function(a){this.phaser.disableVisibilityChange=a}},backgroundColor:{get:function(){return new Color(this.phaser.backgroundColor)},set:function(a){if(a=a||Color.background,!(a instanceof Color))throw new Error("Expected qc.Color");this.phaser.backgroundColor=a.toNumber()}},x:{get:function(){return 0}},y:{get:function(){return 0}},rect:{get:function(){return new qc.Rectangle(0,0,this.game.width,this.game.height)}},pivotX:{get:function(){return 0},set:function(){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(){throw new Error("pivotY cannot be modified")}},worldTransform:{get:function(){return this.phaser.worldTransform}}}),Stage.prototype.updateTransform=function(){this.phaser.updateTransform()},Stage.prototype.destroy=function(){this.phaser.destroy(),delete this.phaser};var State=qc.State=function(){var a=new Phaser.State;this.phaser=a,a._qc=this};State.prototype={},State.prototype.constructor=State,Object.defineProperties(State.prototype,{game:{get:function(){return this.phaser.game}},key:{get:function(){return this.phaser.key},set:function(a){this.phaser.key=a}},add:{get:function(){return this.phaser.add._qc},set:function(a){this.phaser.add=a.phaser,a.phaser._qc=a}},make:{get:function(){return this.phaser.make._qc},set:function(a){this.phaser.make=a.phaser,a.phaser._qc=a}},camera:{get:function(){return this.phaser.camera._qc},set:function(a){this.phaser.camera=a.phaser,a.phaser._qc=a}},assets:{get:function(){return this._assets},set:function(a){this._assets=a}},input:{get:function(){return this.phaser.input._qc},set:function(a){this.phaser.input=a.phaser,a.phaser._qc=a}},math:{get:function(){return this.phaser.math._qc},set:function(a){this.phaser.math=a.phaser,a.phaser._qc=a}},time:{get:function(){return this.phaser.time._qc},set:function(a){this.phaser.time=a.phaser,a.phaser._qc=a}},tweens:{get:function(){return this.phaser.tweens._qc},set:function(a){this.phaser.tweens=a.phaser,a.phaser._qc=a}},world:{get:function(){return this.phaser.world?this.phaser.world._qc:null},set:function(a){this.phaser.world=a.phaser,a.phaser._qc=a}},physics:{get:function(){return this.phaser.physics._qc},set:function(a){this.phaser.physics=a.phaser,a.phaser._qc=a}}});var SceneManager=qc.SceneManager=function(a){a._qc=this,this.phaser=a,this._onPreload=new qc.Signal,
this._onCreate=new qc.Signal,this.onStartLoad=new qc.Signal,this.onEndLoad=new qc.Signal};SceneManager.prototype={},SceneManager.prototype.constructor=SceneManager,Object.defineProperties(SceneManager.prototype,{game:{get:function(){return this.phaser.game._qc}},entry:{get:function(){return this._entry},set:function(a){this._entry=a}},list:{get:function(){return this._list},set:function(a){this._list=a;var b=this;for(var c in a){var d=a[c],e={preload:function(){b._onPreload.dispatch();var a=b.game.assets.find(b.current+".bin");if(a)for(var c in a.dependences){var d=a.dependences[c];b.game.assets.loadByUUID(d.uuid,function(a){a||(b.game.log.important("场景的依赖资源({0})加载失败.",d.uuid),"function"==typeof b.game.loadingProcessCallback&&b.game.loadingProcessCallback(d.key))})}},create:function(){try{b._parse()}catch(a){b.game.log.error("Parse scene fail：{0}",a),qc.Util.popupError(a.message)}b.loading=!1,b._onCreate.dispatch(),b.onEndLoad.dispatch(e)}};this.phaser.add(d,e,!1)}}},loading:{get:function(){return this._loading||!1},set:function(a){this._loading=a}},current:{get:function(){return this.phaser.current}}}),SceneManager.prototype.download=function(a,b){a=a||this.entry;var c=a+".bin";this.game.log.trace("Start downloading scene:{0}",a),this.game.assets.beginBatchLoad(),this.game.assets.load(c,c,b),this.game.assets.endBatchLoad()},SceneManager.prototype.load=function(a,b,c,d){var e=this;return e.loading?void console.warn("Cannot call when switching scene."):(a=a||e.entry,/\//.test(a)||(a="Assets/scene/"+a),e.list.indexOf(a)<0?void e.game.log.error("Scene:{0} not exists",a):(e.loading=!0,e.onStartLoad.dispatch(a),e.clearWorld(),b!==!0&&(b=!1),b&&e.game.assets.clear(),void e.download(a,function(){"function"==typeof c&&e._onPreload.addOnce(c),"function"==typeof d&&e._onCreate.addOnce(d),e.phaser.start(a,!1,b)})))},SceneManager.prototype.clearWorld=function(a){var b=this.game.world.children.slice(0);b.forEach(function(b){(a||!b.ignoreDestroy)&&b.destroy()})},SceneManager.prototype.destroy=function(){this.entry=undefined,this.list=[],this.phaser.destroy()},SceneManager.prototype._parse=function(){var a=this.current+".bin",b=this.game.assets.find(a);if(b){var c=b.json.data;this.game.serializer.restoreState(c),this.game.world._prefab=a}else self.game.log.error("Can not find scene {0} from assets",state)};var World=qc.World=function(a){var b=this;b.onModelChange=new qc.Signal,qc.Node.call(b,a,b),b.name="world",b.onSizeChange.add(function(){b.relayout()}),b._toDestroyQ=[],b.game.container.style.overflow="hidden",b.backDomRoot=document.createElement("div"),b.backDomRoot.style.position="absolute",b.backDomRoot.style.left="0px",b.backDomRoot.style.top="0px",b.backDomRoot.style.overflow="hidden",b.game.container.insertBefore(b.backDomRoot,b.game.canvas),b.frontDomRoot=document.createElement("div"),b.frontDomRoot.style.position="absolute",b.frontDomRoot.style.left="0px",b.frontDomRoot.style.top="0px",b.frontDomRoot.style.overflow="hidden",b.game.container.appendChild(b.frontDomRoot)};World.prototype=Object.create(qc.Node.prototype),World.prototype.constructor=World,World.prototype.getMeta=function(){var a=(qc.Serializer,qc.Node.prototype.getMeta.call(this));return delete a.uuid,a},World.prototype.relayout=function(){for(var a=this.children,b=0;b<a.length;b++)a[b].relayout()},Object.defineProperties(World.prototype,{bounds:{get:function(){return this.phaser.bounds},set:function(a){this.phaser.setBounds(a.x,a.y,a.width,a.height)}},camera:{get:function(){return this.phaser.camera}},width:{get:function(){return this._editorWidth!==undefined?this._editorWidth:this.phaser.width},set:function(a){this.width!==a&&(this.phaser.width=a,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE),Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").set.call(this,a))}},height:{get:function(){return this._editorHeight!==undefined?this._editorHeight:this.phaser.height},set:function(a){this.height!==a&&(this.phaser.height=a,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE),Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").set.call(this,a))}},centerX:{get:function(){return this.phaser.centerX}},centerY:{get:function(){return this.phaser.centerY}},pivotX:{get:function(){return 0},set:function(){throw new Error("pivotX cannot be modified")}},pivotY:{get:function(){return 0},set:function(){throw new Error("pivotY cannot be modified")}},onSizeChange:{get:function(){return this.game.phaser.scale.onSizeChange}}}),World.prototype.preUpdate=function(){this._toDestroyQ.forEach(function(a){a.destroyImmediately()}),this._toDestroyQ.length=0},World.prototype.addToDestroy=function(a){this._toDestroyQ.push(a)},World.prototype.updateDomRoot=function(){if(!this.game.isBooted||!this.game.input.inputting){var a=this.frontDomRoot.style,b=this.backDomRoot.style,c=this.game.canvas.style;a.width=b.width=c.width,a.height=b.height=c.height,a.marginLeft=b.marginLeft=c.marginLeft,a.marginTop=b.marginTop=c.marginTop,a.marginRight=b.marginRight=c.marginRight,a.marginBottom=b.marginBottom=c.marginBottom}};var Input=qc.Input=function(a){var b=this;a._qc=b;var c=a.destroy;a.destroy=function(){b.destroy(),c.call(a)};var d=a.update;a.update=function(){b.update(),d.call(a)},b.phaser=a,b.game=a.game._qc,b._inputting=0,b.cursorPosition=new qc.Point(0/0,0/0),b.onKeyDown=new Phaser.Signal,b.onKeyUp=new Phaser.Signal,b.onKeyRepeat=new Phaser.Signal,b.onCursorMove=new Phaser.Signal,b.onWheel=new Phaser.Signal,b.onPointerUp=new Phaser.Signal,b.onPointerDown=new Phaser.Signal,b.onPointerMove=new Phaser.Signal,b.nativeMode=!1,b.keyboard=new qc.Keyboard(this),b.mouse=new qc.Mouse(this),b.touch=new qc.Touch(this),b.module=new qc.BaseInputModule(b.game,b),b._init()};Input.prototype={},Input.prototype.constructor=Input,Object.defineProperties(Input.prototype,{wheelDeltaX:{get:function(){return this._wheelDeltaX}},wheelDeltaY:{get:function(){return this._wheelDeltaY}},keyCount:{get:function(){return this.keyboard.keyCount}},keyCodes:{get:function(){return this.keyboard.keyCodes}},mouseCount:{get:function(){return this.mouse.mouseCount}},mouseIds:{get:function(){return this.mouse.mouseIds}},touchCount:{get:function(){return this.touch.touchCount}},touchIds:{get:function(){return this.touch.touchIds}},pointerCount:{get:function(){return this.mouseCount+this.touchCount}},pointers:{get:function(){return this.mouseIds.concat(this.touchIds)}},enable:{get:function(){return this._enable},set:function(a){this._setEnable(a)}},inputting:{get:function(){return this._inputting>0}}}),Input.prototype._init=function(){var a=this;a.phaser.game.onBlur.add(this._onBlur,this),a.keyboard.onKeyUp.add(this.processKeyUp,this),a.keyboard.onKeyDown.add(this.processKeyDown,this),a.keyboard.onKeyRepeat.add(this.processKeyRepeat,this),a.mouse.onMouseDown.add(this.processPointerDown,this),a.mouse.onMouseUp.add(this.processPointerUp,this),a.mouse.onMousePressMove.add(this.processPointerMove,this),a.mouse.onMouseMove.add(this.processMouseMove,this),a.mouse.onMouseWheel.add(this.processMouseWheel,this),a.touch.onTouchStart.add(this.processPointerDown,this),a.touch.onTouchEnd.add(this.processPointerUp,this),a.touch.onTouchMove.add(this.processPointerMove,this),a.enable=!0},Input.prototype.destroy=function(){this.phaser.game.onBlur.remove(this._onBlur,this),this.keyboard.onKeyUp.remove(this.processKeyUp,this),this.keyboard.onKeyDown.remove(this.processKeyDown,this),this.keyboard.onKeyRepeat.remove(this.processKeyRepeat,this),this.mouse.onMouseDown.remove(this.processPointerDown,this),this.mouse.onMouseUp.remove(this.processPointerUp,this),this.mouse.onMousePressMove.remove(this.processPointerDown,this),this.mouse.onMouseMove.remove(this.processMouseMove,this),this.mouse.onMouseWheel.remove(this.processMouseWheel,this),this.touch.onTouchStart.remove(this.processPointerDown,this),this.touch.onTouchEnd.remove(this.processPointerUp,this),this.touch.onTouchMove.remove(this.processPointerMove,this),this.module&&this.module.destroy(),this.keyboard&&this.keyboard.destroy(),this.mouse&&this.mouse.destroy(),this.touch&&this.touch.destroy(),this.onKeyDown.removeAll(),this.onKeyUp.removeAll(),this.onKeyRepeat.removeAll(),this.onCursorMove.removeAll(),this.onWheel.removeAll(),this.onPointerDown.removeAll(),this.onPointerMove.removeAll(),this.onPointerUp.removeAll(),this.phaser=null,this.module=null,this.keyboard=null,this.mouse=null,this.touch=null},Input.prototype._setEnable=function(a){this._enable!==a&&(this._enable=a,this.touch&&(this.touch.enable=a),this.mouse&&(this.mouse.enable=a),this.keyboard&&(this.keyboard.enable=a))},Input.prototype.update=function(){this._wheelDeltaX=0,this._wheelDeltaY=0,this.keyboard.update(),this.touch.update(),this.mouse.update(),this.module.update()},Input.prototype._onBlur=function(){this.module.lossFocus(),this.keyboard.lossFocus(),this.mouse.lossFocus(),this.touch.lossFocus()},Input.prototype.processKeyDown=function(a,b){this.onKeyDown.dispatch(a,b)},Input.prototype.processKeyUp=function(a,b){this.onKeyUp.dispatch(a,b)},Input.prototype.processKeyRepeat=function(a,b){this.onKeyRepeat.dispatch(a,b)},Input.prototype.isKeyDown=function(a){return this.keyboard.isKeyDown(a)},Input.prototype.isAnyKeyDown=function(){return this.keyboard.isAnyKeyDown()},Input.prototype.isAnyKey=function(){return this.keyboard.isAnyKey()},Input.prototype.isAltDown=function(){return this.isKeyDown(qc.Keyboard.ALT)},Input.prototype.isControlDown=function(){return this.isKeyDown(qc.Keyboard.CONTROL)},Input.prototype.isShiftDown=function(){return this.isKeyDown(qc.Keyboard.SHIFT)},Input.prototype.isMetaDown=function(){return this.isKeyDown(qc.Keyboard.META)||this.isKeyDown(qc.Keyboard.META_RWIN)||this.isKeyDown(qc.Keyboard.META_RMAC)},Input.prototype.hasCursor=function(){return!isNaN(this.cursorPosition.x)&&!isNaN(this.cursorPosition.y)},Input.prototype.isMouse=function(a){return 0>a&&a>=qc.Mouse.BUTTON_FORWORD},Input.prototype.isAnyMouse=function(){return this.mouse.isAnyMouse()},Input.prototype.isAnyMouseDown=function(){return this.mouse.isAnyMouseDown()},Input.prototype.isMouseDown=function(a){return this.mouse.isMouseDown(a)},Input.prototype.isAnyTouch=function(){return this.touch.isAnyTouch()},Input.prototype.isAnyTouchStart=function(){return this.touch.isAnyTouchStart()},Input.prototype.isTouchStart=function(a){return this.touch.isTouchStart(a)},Input.prototype.isAnyPointer=function(){return this.touch.isAnyTouch()||this.mouse.isAnyMouse()},Input.prototype.isAnyPointerStart=function(){return this.touch.isAnyTouchStart()||this.mouse.isAnyMouseDown()},Input.prototype.isPointerStart=function(a){return this.isMouse(a)?this.isMouseDown(a):this.isTouchStart(a)},Input.prototype.getPointer=function(a){return 0>a&&a>=qc.Mouse.BUTTON_FORWORD?this.mouse.getMouseById(a):this.touch.getTouchById(a)},Input.prototype.processMouseMove=function(a,b){this.cursorPosition.x=a,this.cursorPosition.y=b,this.onCursorMove.dispatch(a,b)},Input.prototype.processMouseWheel=function(a,b){this._wheelDeltaX=a,this._wheelDeltaY=b,this.onWheel.dispatch(a,b)},Input.prototype.processPointerDown=function(a,b,c){this.onPointerDown.dispatch(a,b,c)},Input.prototype.processPointerUp=function(a,b,c){this.onPointerUp.dispatch(a,b,c)},Input.prototype.processPointerMove=function(a,b,c){this.onPointerMove.dispatch(a,b,c)},Input.prototype.ignoreDomEvent=function(a){var b=this,c=b.findDomNodeWithEvent(a);return c&&c.interactive&&c.hitArea},Input.prototype.findDomNodeWithEvent=function(a){var b=this,c=a.target;if(!c||c===b.game.world.frontDomRoot||c===b.game.world.backDomRoot||c===b.game.canvas.parentNode)return null;for(;c&&!c._qc;)c=c.parentNode;return c?c._qc:null};var Debug=qc.Debug=function(a){var b=this;b._game=a,b.on=!1,b.animation=0,b.total=0,b.logic=0,b.render=0,b.preUpdate=0,b.update=0,b.postUpdate=0,b.clientId=0};Debug.prototype={},Debug.prototype.constructor=Debug,Object.defineProperties(Debug.prototype,{game:{get:function(){return this._game}},on:{get:function(){return this._on||!1},set:function(a){this._on=a,a&&(this.game.log.enableTrace=!0)}},remoteLogUrl:{set:function(v){if(this.pollTimer&&(this.game.timer.remove(this.pollTimer),this.pollTimer=null),"string"==typeof v){var self=this;this.pollTimer=this.game.timer.loop(1e3,function(game){if(!self.isPolling){var str=":queryCmd:"+self.clientId;try{self.isPolling=!0,qc.AssetUtil.post(game.remoteLogUrl+"/remoteLog",str,function(res){if(self.isPolling=!1,"200 OK"!==res){var match=res.match(/^id:(.*)/);if(match)return self.clientId=match[1],void(document.title="("+match[1]+")"+document.title);var cmdList;try{cmdList=JSON.parse(res)}catch(e){cmdList=[]}for(var i=0;i<cmdList.length;i++)try{var ret=eval(cmdList[i]);game.log.remoteReply(ret)}catch(e){game.log.remoteReply(e.stack)}}},function(){console.log("queryCmd post error."),self.isPolling=!1})}catch(e){self.isPolling=!1}}},null,this.game)}}}});var Device=qc.Device=function(a,b){var c=this;c.phaser=b,c._game=a,c._orientation=Device.PORTRAIT,c.onOrientationChange=new qc.Signal};Device.prototype={},Device.prototype.constructor=Debug,Object.defineProperties(Device.prototype,{game:{get:function(){return this._game}},desktop:{get:function(){return this.phaser.initialized?this.phaser.desktop:(this._isDesktop===undefined&&this.checkOS(),this._isDesktop)}},iOS:{get:function(){return this.phaser.iOS}},android:{get:function(){return this.phaser.android}},webGL:{get:function(){return this.phaser.webGL}},vibration:{get:function(){return this.phaser.vibration}},browser:{get:function(){return this.phaser.chrome?Device.CHROME:this.phaser.arora?Device.ARORA:this.phaser.epiphany?Device.EPIPHANY:this.phaser.firefox?Device.FIREFOX:this.phaser.trident?Device.TRIDENT:this.phaser.ie?Device.IE:this.phaser.mobileSafari?Device.MOBILE_SAFARI:this.phaser.midori?Device.MIDORI:this.phaser.opera?Device.OPERA:this.phaser.safari?Device.SAFARI:this.phaser.silk?Device.SILK:this.phaser.UCBrowser?Device.UCBROWSER:Device.UNKNOW}},resolution:{get:function(){return window.devicePixelRatio}},fullscreen:{get:function(){return this.phaser.fullscreen}},editor:{get:function(){return this._editor||!1},set:function(a){this._editor=a,a&&(this.game.debug.on=!0)}},orientation:{get:function(){return this._orientation},set:function(a){this.orientation!==a&&(this._orientation=a,this.onOrientationChange.dispatch(a))}}}),Device.UNKNOW=-1,Device.CHROME=0,Device.ARORA=1,Device.EPIPHANY=2,Device.FIREFOX=3,Device.IE=4,Device.TRIDENT=5,Device.MOBILE_SAFARI=6,Device.MIDORI=7,Device.OPERA=8,Device.SAFARI=9,Device.WEBAPP=10,Device.SILK=11,Device.UCBROWSER=12,Device.AUTO=0,Device.PORTRAIT=1,Device.LANDSCAPE=2,Device.prototype.resetOrientation=function(){this.orientation=this.game.world.width>this.game.world.height?Device.LANDSCAPE:Device.PORTRAIT},Device.prototype.isCanvasRenderer=function(){return this.game.phaser.renderType===Phaser.CANVAS},Device.prototype.isWebGLRenderer=function(){return this.game.phaser.renderType===Phaser.WEBGL},Device.prototype.checkOS=function(){var a=navigator.userAgent,b={};/Playstation Vita/.test(a)?b.vita=!0:/Kindle/.test(a)||/\bKF[A-Z][A-Z]+/.test(a)||/Silk.*Mobile Safari/.test(a)?b.kindle=!0:/Android/.test(a)?b.android=!0:/CrOS/.test(a)?b.chromeOS=!0:/iP[ao]d|iPhone/i.test(a)?b.iOS=!0:/Linux/.test(a)?b.linux=!0:/Mac OS/.test(a)?b.macOS=!0:/Windows/.test(a)&&(b.windows=!0,/Windows Phone/i.test(a)&&(b.windowsPhone=!0));var c=/Silk/.test(a);this._isDesktop=!1,(b.windows||b.macOS||b.linux&&!c||b.chromeOS)&&(this._isDesktop=!0),(b.windowsPhone||/Windows NT/i.test(a)&&/Touch/i.test(a))&&(this._isDesktop=!1)},qc.RenderTexture=PIXI.RenderTexture,qc.RenderTexture.prototype.resize=function(a,b,c){(a!==this.width||b!==this.height)&&(this.valid=a>0&&b>0,this.width=a,this.height=b,this.frame.width=this.crop.width=a*this.resolution,this.frame.height=this.crop.height=b*this.resolution,c&&(this.baseTexture.width=Math.round(this.width*this.resolution),this.baseTexture.height=Math.round(this.height*this.resolution)),this.renderer.type===PIXI.WEBGL_RENDERER&&(this.projection.x=this.width/2,this.projection.y=-this.height/2),this.valid&&this.textureBuffer.resize(Math.round(this.width*this.resolution),Math.round(this.height*this.resolution)))},qc.RenderTexture.prototype.directRenderWebGL=function(a,b,c){if(this.valid){var d={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=b?b.x:0,this.renderer.offset.y=b?b.y:0;var e=this.renderer.gl;if(e.isContextLost())return!1;if(!e.replace){var f=e.viewport;e.viewport=function(a,b,c,d){(0===c||0===d||0>c*d)&&console.log("viewPort:",a,b,c,d,c*d),f.call(e,a,b,c,d)},e.replace=!0}e.viewport(0,0,this.width*this.resolution,this.height*this.resolution),e.bindFramebuffer(e.FRAMEBUFFER,this.textureBuffer.frameBuffer),c&&this.textureBuffer.clear();var g=e.getError();g&&console.log("webgl gl.getError(",g,")"),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,this.renderer.offset.x=d.x,this.renderer.offset.y=d.y}},PIXI.RenderTexture.prototype.directRenderCanvas=function(a,b,c){if(this.valid){var d={x:this.renderer.offset.x,y:this.renderer.offset.y};this.renderer.offset.x=b?b.x:0,this.renderer.offset.y=b?b.y:0,c&&this.textureBuffer.clear();var e=this.textureBuffer.context,f=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(a,e),this.renderer.resolution=f,this.renderer.offset.x=d.x,this.renderer.offset.y=d.y}},qc.RenderTexture.prototype.renderWebGL=function(a,b,c){if(this.valid){var d=a.getWorldTransform();d.identity(),d.translate(0,2*this.projection.y),b&&d.append(b),d.scale(1,-1),a.worldAlpha=1,a._isSubNeedCalcTransform=!0;for(var e=a.children,f=0,g=e.length;g>f;f++)e[f].updateTransform();var h=this.renderer.gl;h.viewport(0,0,this.width*this.resolution,this.height*this.resolution),h.bindFramebuffer(h.FRAMEBUFFER,this.textureBuffer.frameBuffer),c&&this.textureBuffer.clear(),this.renderer.spriteBatch.dirty=!0,this.renderer.renderDisplayObject(a,this.projection,this.textureBuffer.frameBuffer),this.renderer.spriteBatch.dirty=!0,a._isNotNeedCalcTransform=!1}},PIXI.RenderTexture.prototype.renderCanvas=function(a,b,c){if(this.valid){var d=a.worldTransform;d.identity(),b&&d.append(b),a.worldAlpha=1,a._isSubNeedCalcTransform=!0;for(var e=a.children,f=0,g=e.length;g>f;f++)e[f].updateTransform();c&&this.textureBuffer.clear();var h=this.textureBuffer.context,i=this.renderer.resolution;this.renderer.resolution=this.resolution,this.renderer.renderDisplayObject(a,h),this.renderer.resolution=i,a._isNotNeedCalcTransform=!1}};var SoftClipManager=qc.SoftClipManager=function(a){this.renderSession=a,this._polygons=[]};SoftClipManager.prototype={},SoftClipManager.prototype.constructor=SoftClipManager,Object.defineProperties(SoftClipManager.prototype,{needClip:{get:function(){return!!this._polygons.length}}}),SoftClipManager.getManager=function(a){var b=a.softClipManager;return b||(b=a.softClipManager=new SoftClipManager(a)),b},SoftClipManager.prototype.pushPolygon=function(a){var b=this,c=[];if(b.renderSession.spriteBatch.batchType=qc.BATCH_TRIANGLES,!b._polygons.length){for(var d=arguments.length;d--;){var e=arguments[d],f=qc.GeometricTool.quickDecomp(e);if(f.length)Array.prototype.push.apply(c,f);else for(var g=GeometricTool.Triangulate(e),h=0;h<g.length;h+=3){var i=g[h],j=g[h+1],k=g[h+2];c.push([e[i],e[j],e[k]])}}return void b._polygons.push(c)}for(var l=b._polygons[b._polygons.length-1],m=l.length;m--;)for(var n=l[m],d=arguments.length;d--;){a=arguments[d];var f=qc.GeometricTool.sutherlandHodgman(a,n);c.push(f)}b._polygons.push(c)},SoftClipManager.prototype.popPolygon=function(){var a=this;a._polygons.length&&a._polygons.splice(a._polygons.length-1,1),a._polygons.length||(a.renderSession.spriteBatch.batchType=qc.BATCH_QUAD)},SoftClipManager.prototype.getClipPolygon=function(a,b,c,d,e,f){var g=this,h=[],i=g._polygons[g._polygons.length-1],j=i.length,k=1/(a*d+c*-b);a*=k,b*=k,c*=k,d*=k;for(var l=f*c-e*d,m=-f*a+e*b,n=-1;++n<j;){for(var o=i[n],p=[],q=o.length,r=-1;++r<q;){var s=o[r];p.push(new qc.Point(d*s.x-c*s.y+l,a*s.y-b*s.x+m))}h.push(p)}return h},SoftClipManager.prototype.renderSprite=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=this.getClipPolygon(k,l,m,n,o,p);if(0!==r.length){var s=[new qc.Point(c,d),new qc.Point(e,d),new qc.Point(e,f),new qc.Point(c,f)],t={x:c,y:d,width:e-c,height:f-d};if(t.width&&t.height)for(var u=function(a,b,c,d,e,f){return{x:b+(a.x-f.x)/f.width*(c-b),y:d+(a.y-f.y)/f.height*(e-d)}},v=r.length;v--;){var w=r[v],x=qc.GeometricTool.sutherlandHodgman(w,s),y=x.length;if(!(3>y)){for(var z=[],A=[],B=-1;++B<y;)z[B]=u(x[B],g,i,h,j,t),A.push({x:k*x[B].x+m*x[B].y+o,y:n*x[B].y+l*x[B].x+p});var C=qc.GeometricTool.Triangulate(A);if(C)for(var B=0;B<C.length;B+=3){var D=C[B],E=C[B+1],F=C[B+2];this._addWebGLTriangle(a.spriteBatch,b,q,A[D],A[E],A[F],z[D],z[E],z[F])}}}}},SoftClipManager.prototype._addWebGLTriangle=function(a,b,c,d,e,f,g,h,i){a.currentBatchSize>=a.triangleSize&&(a.flush(),a.currentBaseTexture=b.texture.baseTexture);var j=a.colors,k=a.positions,l=3*a.currentBatchSize*a.vertSize;a.renderSession.roundPixels?(k[l]=0|d.x,k[l+1]=0|d.y,k[l+5]=0|e.x,k[l+6]=0|e.y,k[l+10]=0|f.x,k[l+11]=0|f.y):(k[l]=d.x,k[l+1]=d.y,k[l+5]=e.x,k[l+6]=e.y,k[l+10]=f.x,k[l+11]=f.y),k[l+2]=g.x,k[l+3]=g.y,k[l+7]=h.x,k[l+8]=h.y,k[l+12]=i.x,k[l+13]=i.y,j[l+4]=j[l+9]=j[l+14]=c,a.sprites[a.currentBatchSize++]=b};var SoundManager=qc.SoundManager=function(a){this.game=a,this.phaser=a.phaser.sound,this.phaser._qc=this;var b=this;a.onStart.add(function(){b._boot()}),this._soundDurationMap=window.soundDurationMap||{}};SoundManager.prototype.constructor=SoundManager,SoundManager.prototype._boot=function(){var a=this.phaser,b=this.game.input;!a.game.device.cocoonJS&&a.game.device.iOS||window.PhaserGlobal&&window.PhaserGlobal.fakeiOSTouchLock?(b.touch.callbackContext=a,a.game.device.iOSVersion>8?b.touch.touchEndCallback=a.unlock:b.touch.touchStartCallback=a.unlock,b.mouse.callbackContext=a,b.mouse.mouseDownCallback=a.unlock,a.touchLocked=!0):a.touchLocked=!1},Object.defineProperties(SoundManager.prototype,{mute:{get:function(){return this.phaser.mute},set:function(a){this.phaser.mute=a}},volume:{get:function(){return this.phaser.volume},set:function(a){this.phaser.volume=a}},usingWebAudio:{get:function(){return this.phaser.usingWebAudio}},usingAudioTag:{get:function(){return this.phaser.usingAudioTag}},mp3Support:{get:function(){return this.game.phaser.device.mp3}},oggSupport:{get:function(){return this.game.phaser.device.ogg||this.game.phaser.device.opus}},webAudioSupport:{get:function(){return this.game.phaser.sound.usingWebAudio}}}),SoundManager.prototype._getAudioTagDurationInConfig=function(a){var b=a.key;return/\.bin$/i.test(b)||(b+=".bin"),this._soundDurationMap[b]||a._sound.duration},SoundManager.prototype.tryGetUrl=function(a){var b=a;return b.indexOf(".mp3.bin")>0?this.mp3Support||(b=b.replace(".mp3.bin",".ogg.bin")):b.indexOf(".ogg.bin")>0&&(this.oggSupport||(b=b.replace(".ogg.bin",".mp3.bin"))),this.webAudioSupport||(b=b.replace(".bin","")),b};var Key=qc.Key=function(a,b){this.game=a,this._keycode=b,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.repeats=0,this._lastRepeatTime=0,this._eventList=[]};Key.prototype={},Key.prototype.constructor=Key,Object.defineProperties(Key.prototype,{keyCode:{get:function(){return this._keycode}},currCharCode:{get:function(){return this._charCode},set:function(a){this._charCode=a}},isJustDown:{get:function(){var a=this._justDown;return a&&(this._justDown=!1,this._isDown=!0),a}},isJustUp:{get:function(){var a=this._justUp;return a&&(this._justUp=!1,this._isDown=!1),a}},isDown:{get:function(){return this._isDown}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),Key.prototype.destroy=function(){this.game=null},Key.prototype.hasEvent=function(){return!!this._eventList.length},Key.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var a=this._eventList.shift();do{if(!a)break;switch(a.type){case Key.DOWN:this._onDown(a.time);break;case Pointer.UP:this._onUp()}return!0}while(!1);return!1},Key.prototype.onDown=function(){return this._eventList.push({type:Key.DOWN,time:this.game.time.fixedTime}),!0},Key.prototype.onUp=function(){return this._eventList.push({type:Key.UP}),!0},Key.prototype._onDown=function(a){return this.isDown||this._justDown?!1:(this._justDown=!0,this.downTime=a,this._lastRepeatTime=this.downTime,!0)},Key.prototype._onUp=function(){return!this._isDown&&!this._justDown||this._justUp?!1:(this._justUp=!0,!0)},Key.prototype.setState=function(a){var b=(this._isDown||this._justDown)&&!this._justUp;return this._isDown=a,this._justDown=!1,this._justUp=!1,b^a},Key.prototype.checkRepeat=function(a){if(!this.isDown)return!1;var b=this.game.time.fixedTime;return b-this._lastRepeatTime-a>0?(this.repeats++,this._lastRepeatTime=b,!0):!1},Key.UP=-1,Key.DOWN=0;var Pointer=qc.Pointer=function(a,b){this.game=a,this._id=b,this._isDown=!1,this._justDown=!1,this._justUp=!1,this.downTime=0,this.withinGame=!1,this.previousStatus=[],this._eventList=[]};Pointer.prototype={},Pointer.prototype.constructor=Pointer,Object.defineProperties(Pointer.prototype,{id:{get:function(){return this._id}},x:{get:function(){return this._x}},y:{get:function(){return this._y}},startX:{get:function(){return this._startX}},startY:{get:function(){return this._startY}},isMouse:{get:function(){return this._id<qc.Mouse.NONE&&this._id>=qc.Mouse.BUTTON_FORWORD}},isJustDown:{get:function(){var a=this._justDown;return a&&(this._justDown=!1,this._isDown=!0),a}},isJustUp:{get:function(){var a=this._justUp;return a&&(this._justUp=!1,this._isDown=!1),a}},isDown:{get:function(){return this._isDown}},isDowning:{get:function(){return this._justDown}},isUpping:{get:function(){return this._justUp}},deltaX:{get:function(){return this._deltaX}},deltaY:{get:function(){return this._deltaY}},distanceX:{get:function(){return this.x-this.startX}},distanceY:{get:function(){return this.y-this.startY}},deviceId:{get:function(){return this._deviceId||this.id},set:function(a){this._deviceId=a}},eventId:{get:function(){return this._eventId||this.id},set:function(a){this._eventId=a}},duringTime:{get:function(){return this.isDown?this.game.time.fixedTime-this.downTime:-1}}}),Pointer.prototype.destroy=function(){this.game=null},Pointer.prototype.update=function(){this._deltaX=this._tempX-this._x,this._deltaY=this._tempY-this._y,this._x=this._tempX,this._y=this._tempY},Pointer.prototype.hasEvent=function(){return!!this._eventList.length},Pointer.prototype.nextEvent=function(){if(!this._eventList.length)return!1;var a=this._eventList.shift();do{if(!a)break;switch(a.type){case Pointer.DOWN:this.withinGame=!0,this._onDown(a.x,a.y,a.time);break;case Pointer.UP:this._onUp(a.time);break;case Pointer.LEAVE:this.withinGame=!1,this._onMove(a.x,a.y);break;case Pointer.ENTER:this.withinGame=!0,this._onMove(a.x,a.y);break;case Pointer.MOVE:this._onMove(a.x,a.y);break;case Pointer.CANCEL:this._onCancel(a.time)}return!0}while(!1);return!1},Pointer.prototype.onDown=function(a,b){return this._eventList.push({type:Pointer.DOWN,x:a,y:b,time:this.game.time.fixedTime}),!0},Pointer.prototype.onMove=function(a,b){var c=this._eventList.length;return c>0&&this._eventList[c-1].type===Pointer.MOVE?(this._eventList[c-1].x=a,this._eventList[c-1].y=b):this._eventList.push({type:Pointer.MOVE,x:a,y:b}),!0},Pointer.prototype.onLeave=function(a,b){return this._eventList.push({type:Pointer.LEAVE,x:a,y:b}),!0},Pointer.prototype.onEnter=function(a,b){return this._eventList.push({type:Pointer.ENTER,x:a,y:b}),!0},Pointer.prototype.onUp=function(){return this._eventList.push({type:Pointer.UP,time:this.game.time.fixedTime}),!0},Pointer.prototype.onCancel=function(){return this._eventList.push({type:Pointer.CANCEL,time:this.game.time.fixedTime}),!0},Pointer.prototype._onDown=function(a,b,c){return this.isDown||this._justDown?!1:(this._justDown=!0,this.downTime=c,this._x=a,this._y=b,this._startX=a,this._startY=b,this._tempX=a,this._tempY=b,this._deltaX=0,this._deltaY=0,!0)},Pointer.prototype._onUp=function(a){if(!this._isDown&&!this._justDown||this._justUp)return!1;for(this._justUp=!0,this.previousStatus.unshift({startX:this._startX,startY:this._startY,endX:this.x,endY:this.y,downTime:this.downTime,upTime:a});this.previousStatus.length>10;)this.previousStatus.pop();return!0},Pointer.prototype._onCancel=function(a){return this._justUp?!1:(this._onUp(a),!0)},Pointer.prototype._onMove=function(a,b){this._tempX=a,this._tempY=b},Pointer.prototype.isDouble=function(){},Pointer.UP=-1,Pointer.DOWN=0,Pointer.MOVE=1,Pointer.ENTER=2,Pointer.LEAVE=3,Pointer.CANCEL=4;var Keyboard=qc.Keyboard=function(a,b){this.input=a,this.game=a.game,this.repeatInterval=100,this.onKeyDown=new Phaser.Signal,this.onKeyUp=new Phaser.Signal,this.onKeyRepeat=new Phaser.Signal,this._keys=[],this._keyCodes={},this._capture={},this._keyDownNum=0,this._anyKeyDown=!1,this._init(b)};Keyboard.prototype={},Keyboard.prototype.constructor=Keyboard,Object.defineProperties(Keyboard.prototype,{enable:{get:function(){return this._enable},set:function(a){this._setEnable(a)}},generator:{get:function(){return this._generator||window},set:function(a){if(a!==this._generator){var b=this.enable;this.enable=!1,this._generator=a,b&&(this.enable=!0)}}},gainFocusType:{get:function(){return this._gainFocusType},set:function(a){this._gainFocusType=a}},keyCount:{get:function(){return this._keyDownNum}},keyCodes:{get:function(){return Object.keys(this._keyCodes)}}}),Keyboard.prototype._init=function(a){this._onKeyDown=this._processKeyDown.bind(this),this._onKeyUp=this._processKeyUp.bind(this),this._onBlur=this.lossFocus.bind(this),this._onMouseOver=this._onOver.bind(this),this._onMouseClick=this._onClick.bind(this),this.generator=a,this.gainFocusType=Keyboard.GAINFOCUS_CLICK,this.enable=!0,this.game.device.phaser.windows&&this.game.device.phaser.desktop&&this.addKeyCapture(Keyboard.ALT)},Keyboard.prototype.destroy=function(){this.enable=!1,this.input=null,this.generator=null,this._onKeyDown=null,this._onKeyUp=null,this._onBlur=null,this._onMouseOver=null,this._onMouseClick=null},Keyboard.prototype.update=function(){if(this.enable){this._anyKeyDown=!1;for(var a,b=this._keys.length;b--;)if(a=this._keys[b])for(;a.nextEvent();)a.isJustDown&&(this._anyKeyDown=!0,this._recordKey(a.keyCode,!0),this.onKeyDown.dispatch(a.keyCode)),a.isJustUp&&(this._recordKey(a.keyCode,!1),this.onKeyUp.dispatch(a.keyCode)),a.checkRepeat(this.repeatInterval)&&this.onKeyRepeat.dispatch(a._keycode)}},Keyboard.prototype.isKeyDown=function(a){return this._keys[a]&&this._keys[a].isDown},Keyboard.prototype.isAnyKey=function(){return this._keyDownNum>0},Keyboard.prototype.isAnyKeyDown=function(){return this._anyKeyDown},Keyboard.prototype._recordKey=function(a,b){b?(this._keyDownNum++,this._keyCodes[a]=!0):(this._keyDownNum--,delete this._keyCodes[a])},Keyboard.prototype._setEnable=function(a){if(this._enable!==a){this._enable=a;var b=this.generator;a?(b.addEventListener("keydown",this._onKeyDown,!1),b.addEventListener("keyup",this._onKeyUp,!1),b.addEventListener("blur",this._onBlur,!1),this._addFocusAbility(b,!0)):(b.removeEventListener("keydown",this._onKeyDown),b.removeEventListener("keyup",this._onKeyUp),b.removeEventListener("blur",this._onBlur),this._removeFocusAbility(b),this._clearKeys())}},Keyboard.prototype._addFocusAbility=function(a,b){if(a!==window||window.parent&&window.parent!==window){a.tabIndex=a.tabIndex||-1;var c=this;a.addEventListener("mouseover",c._onMouseOver,!1),a.addEventListener("click",c._onMouseClick,!1),this.input.onPointerDown.add(c._onMouseClick,c),b&&setTimeout(function(){c.gainFocus()},1)}},Keyboard.prototype._removeFocusAbility=function(a){(a!==window||window.parent&&window.parent!==window)&&(a.removeEventListener("mouseover",this._onMouseOver),a.removeEventListener("click",this._onMouseClick),this.input.onPointerDown.remove(this._onMouseClick,this))},Keyboard.prototype._prepareKey=function(a){
this._keys[a]||(this._keys[a]=new qc.Key(this.game,a))},Keyboard.prototype.setModifierKeysState=function(a,b){a.altKey!==undefined&&(this._setKeyCodeState(Keyboard.ALT,a.altKey,b),this._setKeyCodeState(Keyboard.SHIFT,a.shiftKey,b),this._setKeyCodeState(Keyboard.CONTROL,a.ctrlKey,b),b!=Keyboard.META&&b!=Keyboard.META_RWIN&&b!=Keyboard.META_RMAC&&this._setKeyCodeState(Keyboard.META,a.metaKey,b))},Keyboard.prototype._setKeyCodeState=function(a,b,c){a!==c&&(this._prepareKey(a),this._keys[a].setState(b)&&this._recordKey(a,b))},Keyboard.prototype._processKeyDown=function(a){this._prepareKey(a.keyCode),this._capture[a.keyCode]&&a.preventDefault(),this._keys[a.keyCode].onDown(),this._keys[a.keyCode].currCharCode=a.charCode,this.setModifierKeysState(a,a.keyCode),this.input.nativeMode&&this.update()},Keyboard.prototype._processKeyUp=function(a){this._prepareKey(a.keyCode),this._capture[a.keyCode]&&a.preventDefault(),this._keys[a.keyCode].onUp(),this.setModifierKeysState(a,a.keyCode),this.input.nativeMode&&this.update()},Keyboard.prototype._onOver=function(){this.gainFocusType===Keyboard.GAINFOCUS_OVER&&this.gainFocus()},Keyboard.prototype._onClick=function(){this.gainFocusType===Keyboard.GAINFOCUS_CLICK&&this.gainFocus()},Keyboard.prototype.gainFocus=function(){(this.generator!==window||window.parent&&window.parent!==window)&&this.generator.focus()},Keyboard.prototype._clearKeys=function(){for(;this._keys.length>0;){var a=this._keys.pop();a&&a.destroy()}this._keyDownNum=0,this._keyCodes={}},Keyboard.prototype.lossFocus=function(){this._clearKeys()},Keyboard.prototype.addKeyCapture=function(a){if("object"==typeof a)for(var b in a)this._capture[a[b]]=!0;else this._capture[a]=!0},Keyboard.prototype.removeKeyCapture=function(a){delete this._capture[a]},Keyboard.prototype.clearCapture=function(){this._capture={}},Keyboard.GAINFOCUS_OVER=0,Keyboard.GAINFOCUS_CLICK=1,Keyboard.A="A".charCodeAt(0),Keyboard.B="B".charCodeAt(0),Keyboard.C="C".charCodeAt(0),Keyboard.D="D".charCodeAt(0),Keyboard.E="E".charCodeAt(0),Keyboard.F="F".charCodeAt(0),Keyboard.G="G".charCodeAt(0),Keyboard.H="H".charCodeAt(0),Keyboard.I="I".charCodeAt(0),Keyboard.J="J".charCodeAt(0),Keyboard.K="K".charCodeAt(0),Keyboard.L="L".charCodeAt(0),Keyboard.M="M".charCodeAt(0),Keyboard.N="N".charCodeAt(0),Keyboard.O="O".charCodeAt(0),Keyboard.P="P".charCodeAt(0),Keyboard.Q="Q".charCodeAt(0),Keyboard.R="R".charCodeAt(0),Keyboard.S="S".charCodeAt(0),Keyboard.T="T".charCodeAt(0),Keyboard.U="U".charCodeAt(0),Keyboard.V="V".charCodeAt(0),Keyboard.W="W".charCodeAt(0),Keyboard.X="X".charCodeAt(0),Keyboard.Y="Y".charCodeAt(0),Keyboard.Z="Z".charCodeAt(0),Keyboard.ZERO="0".charCodeAt(0),Keyboard.ONE="1".charCodeAt(0),Keyboard.TWO="2".charCodeAt(0),Keyboard.THREE="3".charCodeAt(0),Keyboard.FOUR="4".charCodeAt(0),Keyboard.FIVE="5".charCodeAt(0),Keyboard.SIX="6".charCodeAt(0),Keyboard.SEVEN="7".charCodeAt(0),Keyboard.EIGHT="8".charCodeAt(0),Keyboard.NINE="9".charCodeAt(0),Keyboard.NUMPAD_0=96,Keyboard.NUMPAD_1=97,Keyboard.NUMPAD_2=98,Keyboard.NUMPAD_3=99,Keyboard.NUMPAD_4=100,Keyboard.NUMPAD_5=101,Keyboard.NUMPAD_6=102,Keyboard.NUMPAD_7=103,Keyboard.NUMPAD_8=104,Keyboard.NUMPAD_9=105,Keyboard.NUMPAD_MULTIPLY=106,Keyboard.NUMPAD_ADD=107,Keyboard.NUMPAD_ENTER=108,Keyboard.NUMPAD_SUBTRACT=109,Keyboard.NUMPAD_DECIMAL=110,Keyboard.NUMPAD_DIVIDE=111,Keyboard.F1=112,Keyboard.F2=113,Keyboard.F3=114,Keyboard.F4=115,Keyboard.F5=116,Keyboard.F6=117,Keyboard.F7=118,Keyboard.F8=119,Keyboard.F9=120,Keyboard.F10=121,Keyboard.F11=122,Keyboard.F12=123,Keyboard.F13=124,Keyboard.F14=125,Keyboard.F15=126,Keyboard.COLON=186,Keyboard.EQUALS=187,Keyboard.UNDERSCORE=189,Keyboard.QUESTION_MARK=191,Keyboard.TILDE=192,Keyboard.OPEN_BRACKET=219,Keyboard.BACKWARD_SLASH=220,Keyboard.CLOSED_BRACKET=221,Keyboard.QUOTES=222,Keyboard.BACKSPACE=8,Keyboard.TAB=9,Keyboard.CLEAR=12,Keyboard.ENTER=13,Keyboard.SHIFT=16,Keyboard.CONTROL=17,Keyboard.ALT=18,Keyboard.META=91,Keyboard.META_RWIN=92,Keyboard.META_RMAC=93,Keyboard.CAPS_LOCK=20,Keyboard.ESC=27,Keyboard.SPACEBAR=32,Keyboard.PAGE_UP=33,Keyboard.PAGE_DOWN=34,Keyboard.END=35,Keyboard.HOME=36,Keyboard.LEFT=37,Keyboard.UP=38,Keyboard.RIGHT=39,Keyboard.DOWN=40,Keyboard.INSERT=45,Keyboard.DELETE=46,Keyboard.HELP=47,Keyboard.NUM_LOCK=144,Keyboard.PLUS=43,Keyboard.MINUS=45;var Mouse=qc.Mouse=function(a,b){this.input=a,this.game=a.game,this._wheelEvent=null,this.capture=!0,this.callbackContext=this.game,this.mouseDownCallback=null,this.onMouseDown=new Phaser.Signal,this.onMouseUp=new Phaser.Signal,this.onMouseMove=new Phaser.Signal,this.onMousePressMove=new Phaser.Signal,this.onMouseWheel=new Phaser.Signal,this._mouses=[],this._mouseIds={},this._mouseDownNum=0,this._anyMouseDown=!1,this._checkEventHandledByTouch=this.game.phaser.device.android&&this.game.phaser.device.chrome===!1,this._wheelInfo={deltaX:0,deltaY:0},this._init(b)};Mouse.prototype={},Mouse.prototype.constructor=Mouse,Object.defineProperties(Mouse.prototype,{enable:{get:function(){return this._enable},set:function(a){this._setEnable(a)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(a){if(a!==this._generator){var b=this.enable;this.enable=!1,this._generator=a,b&&(this.enable=!0)}}},mouseWheel:{get:function(){return this._wheelInfo}},mouseCount:{get:function(){return this._mouseDownNum}},mouseIds:{get:function(){return Object.keys(this._mouseIds)}}}),Mouse.prototype._init=function(a){this._mouseKeyMap={0:Mouse.BUTTON_LEFT,1:Mouse.BUTTON_MIDDLE,2:Mouse.BUTTON_RIGHT,3:Mouse.BUTTON_BACK,4:Mouse.BUTTON_FORWORD},this._mouseKeyMap[-1]=Mouse.NONE,this._onMouseDown=this.processMouseDown.bind(this),this._onMouseUp=this.processMouseUp.bind(this),this._onMouseOver=this.processMouseOver.bind(this),this._onMouseOut=this.processMouseOut.bind(this),this._onMouseUpGlobal=this.processMouseUpGlobal.bind(this),this._onMouseMove=this.processMouseMove.bind(this),this._onMouseWheel=this.processMouseWheel.bind(this),this.generator=a,this.enable=!0},Mouse.prototype.update=function(){if(this.enable){this._anyMouseDown=!1;for(var a,b=this._mouses.length;b-->1;)if(a=this._mouses[b])for(;a.nextEvent();)a.isJustDown&&(this._anyMouseDown=!0,this._recordMouse(a.id,!0),this.onMouseDown.dispatch(a.id,a.x,a.y)),a.update(),a.isDown&&(a.deltaX||a.deltaY)&&this.onMousePressMove.dispatch(a.id,a.x,a.y),a.isJustUp&&(this._recordMouse(a.id,!1),this.onMouseUp.dispatch(a.id,a.x,a.y));if(a=this.getMouseById(Mouse.NONE))for(;a.nextEvent();)a.update(),(a.deltaX||a.deltaY)&&this.onMouseMove.dispatch(a.x,a.y);var c=this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0});c&&(c.deltaX||c.deltaY)?(this._wheelInfo.deltaX=c.deltaX||0,this._wheelInfo.deltaY=c.deltaY||0,this.onMouseWheel.dispatch(this._wheelInfo.deltaX,this._wheelInfo.deltaY)):(this._wheelInfo.deltaX=0,this._wheelInfo.deltaY=0),c.deltaX=0,c.deltaY=0}},Mouse.prototype.destroy=function(){this.enable=!1,this._onMouseDown=null,this._onMouseUp=null,this._onMouseOver=null,this._onMouseOut=null,this._onMouseUpGlobal=null,this._onMouseMove=null,this._onMouseWheel=null,this.input=null,this.game=null,this.generator=null},Mouse.prototype._setEnable=function(a){if(!(this._enable===a||this.game.phaser.device.android&&this.game.phaser.device.chrome===!1&&this.game.phaser.device.touch)){this._enable=a;var b=this.generator,c=this.game.phaser.device;if(a){b.addEventListener("mousedown",this._onMouseDown,!1),b.addEventListener("mouseup",this._onMouseUp,!1),b.addEventListener("mousemove",this._onMouseMove,!1),c.cocoonJS||(b===window||window.addEventListener("mouseup",this._onMouseUpGlobal,!1),b.addEventListener("mouseout",this._onMouseOut,!1),b.addEventListener("mouseover",this._onMouseOver,!1));var d=c.wheelEvent;d&&(b.addEventListener(d,this._onMouseWheel,!1),"mousewheel"===d?this._wheelEvent=new WheelEventProxy(-1/40,1):"DOMMouseScroll"===d&&(this._wheelEvent=new WheelEventProxy(1,1))),this.getMouseById(Mouse.NONE)}else{b.removeEventListener("mousedown",this._onMouseDown),b.removeEventListener("mousemove",this._onMouseMove),b.removeEventListener("mouseup",this._onMouseUp),b.removeEventListener("mouseout",this._onMouseOut),b.removeEventListener("mouseover",this._onMouseOver);var d=c.wheelEvent;d&&b.removeEventListener(d,this._onMouseWheel),b===window||window.removeEventListener("mouseup",this._onMouseUpGlobal),this._clearMouses()}}},Mouse.prototype._clearMouses=function(){for(;this._mouses.length>0;){var a=this._mouses.pop();a&&a.destroy()}this._mouseDownNum=0,this._mouseIds={}},Mouse.prototype.lossFocus=function(){this._clearMouses(),this.getMouseById(Mouse.NONE)},Mouse.prototype.isAnyMouse=function(){return this._mouseDownNum>0},Mouse.prototype.isAnyMouseDown=function(){return this._anyMouseDown},Mouse.prototype.isMouseDown=function(a){return!!this._mouseIds[a]},Mouse.prototype._recordMouse=function(a,b){b?(this._mouseDownNum++,this._mouseIds[a]=!0):(this._mouseDownNum--,delete this._mouseIds[a])},Mouse.prototype.getMouseById=function(a){var b=Math.abs(a);return this._mouses[b]||(this._mouses[b]=new qc.Pointer(this.game,a)),this._mouses[b]},Mouse.prototype._updateMousesPosition=function(a,b,c){for(var d,e=this._mouses.length;e--;)d=this._mouses[e],d&&(c===qc.Pointer.ENTER?d.onEnter(a,b):c===qc.Pointer.LEAVE?d.onLeave(a,b):d.onMove(a,b))},Mouse.prototype._toWorld=function(a,b,c){var d=this.game.canvas,e=this.game.phaser.scale.scaleFactor,f=d.ownerDocument===(this.generator.ownerDocument||this.generator.document)?d.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(b-f.left)*e.x,y:(c-f.top)*e.y}},Mouse.prototype.processMouseDown=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault(),this.mouseDownCallback&&this.mouseDownCallback.call(this.callbackContext,a);var b=this._mouseKeyMap[a.button];if(b!=undefined){var c=this._toWorld(this.generator,a.clientX,a.clientY);if(!this._checkEventHandledByTouch||!this.input.touch.checkEventHandled(!0,c.x,c.y)){var d=this.getMouseById(b);d.deviceId=a.button,d.onDown(c.x,c.y),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}}},Mouse.prototype.processMouseUp=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=this._mouseKeyMap[a.button];if(b!=undefined){var c=this.getMouseById(b);c.deviceId=a.button,c.onUp(),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseUpGlobal=function(a){var b=this._mouseKeyMap[a.button];if(b!=undefined){var c=this.getMouseById(b);c.onUp(),this.input&&this.input.keyboard&&this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseOut=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=this._mouseKeyMap[a.button];if(b!=undefined){var c=this._toWorld(this.generator,a.clientX,a.clientY);this._updateMousesPosition(c.x,c.y,qc.Pointer.LEAVE),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseOver=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=this._mouseKeyMap[a.button];if(b!=undefined){var c=this._toWorld(this.generator,a.clientX,a.clientY);this._updateMousesPosition(c.x,c.y,qc.Pointer.ENTER),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseMove=function(a){!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=this._mouseKeyMap[a.button];if(b!=undefined){var c=this._toWorld(this.generator,a.clientX,a.clientY);this._updateMousesPosition(c.x,c.y,qc.Pointer.MOVE),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()}},Mouse.prototype.processMouseWheel=function(a){this._wheelEvent&&(a=this._wheelEvent.bindEvent(a)),!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();var b=(Phaser.Math.clamp(-a.deltaY,-1,1),this._tempWheelInfo||(this._tempWheelInfo={deltaX:0,deltaY:0}));b.deltaX+=a.deltaX,b.deltaY+=a.deltaY,this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()},Mouse.NONE=0,Mouse.BUTTON_LEFT=-1,Mouse.BUTTON_MIDDLE=-2,Mouse.BUTTON_RIGHT=-3,Mouse.BUTTON_BACK=-4,Mouse.BUTTON_FORWORD=-5,WheelEventProxy.prototype={},WheelEventProxy.prototype.constructor=WheelEventProxy,WheelEventProxy.prototype.bindEvent=function(a){if(!WheelEventProxy._stubsGenerated&&a){var b=function(a){return function(){var b=this.originalEvent[a];return"function"!=typeof b?b:b.bind(this.originalEvent)}};for(var c in a)c in WheelEventProxy.prototype||Object.defineProperty(WheelEventProxy.prototype,c,{get:b(c)});WheelEventProxy._stubsGenerated=!0}return this.originalEvent=a,this},Object.defineProperties(WheelEventProxy.prototype,{type:{value:"wheel"},deltaMode:{get:function(){return this._deltaMode}},deltaY:{get:function(){return this._scaleFactor*(this.originalEvent.wheelDelta||this.originalEvent.detail)||0}},deltaX:{get:function(){return this._scaleFactor*this.originalEvent.wheelDeltaX||0}},deltaZ:{value:0}});var Touch=qc.Touch=function(a,b){this.input=a,this.game=a.game,this.capture=!0,this.onTouchStart=new Phaser.Signal,this.onTouchEnd=new Phaser.Signal,this.onTouchMove=new Phaser.Signal,this._touches=[],this._touchIds={},this._deviceIdMap={},this._touchesStartPosition=[],this._touchStartNum=0,this._anyTouchStart=!1,this._init(b),this.callbackContext=this.game,this.touchStartCallback=null,this.touchMoveCallback=null,this.touchEndCallback=null,this.touchEnterCallback=null,this.touchLeaveCallback=null,this.touchCancelCallback=null};Touch.prototype={},Touch.prototype.constructor=Touch,Object.defineProperties(Touch.prototype,{enable:{get:function(){return this._enable},set:function(a){this._setEnable(a)}},generator:{get:function(){return this._generator||this.game.canvas.parentNode||this.game.canvas},set:function(a){if(a!==this._generator){var b=this.enable;this.enable=!1,this._generator=a,b&&(this.enable=!0)}}},touchCount:{get:function(){return this._touchStartNum}},touchIds:{get:function(){return Object.keys(this._touchIds)}}}),Touch.prototype._init=function(a){this._onTouchStart=this.processTouchStart.bind(this),this._onTouchCancel=this.processTouchCancel.bind(this),this._onTouchEnd=this.processTouchEnd.bind(this),this._onTouchEnter=this.processTouchEnter.bind(this),this._onTouchLeave=this.processTouchLeave.bind(this),this._onTouchMove=this.processTouchMove.bind(this),this.generator=a,this.enable=!0},Touch.prototype.update=function(){if(this.enable){this._touchesStartPosition.splice(0,this._touchesStartPosition.length),this._anyTouchStart=!1;for(var a,b=this._touches.length;b--;)if(a=this._touches[b])for(;a.nextEvent();)a.isJustDown&&(this._anyTouchStart=!0,this._recordTouch(a.id,!0),this.onTouchStart.dispatch(a.id,a.x,a.y)),a.update(),a.isDown&&(a.deltaX||a.deltaY)&&this.onTouchMove.dispatch(a.id,a.x,a.y),a.isJustUp&&(this._recordTouch(a.id,!1),this.onTouchEnd.dispatch(a.id,a.x,a.y)),a.isDown||this._removeTouch(a.id)}},Touch.prototype.destroy=function(){this.enable=!1,this._onTouchStart=null,this._onTouchCancel=null,this._onTouchEnd=null,this._onTouchEnter=null,this._onTouchLeave=null,this._onTouchMove=null,this.input=null,this.game=null,this.generator=null},Touch.prototype.checkEventHandled=function(a,b,c){for(var d=this._touchesStartPosition.length;d--;){var e=this._touchesStartPosition[d];if(e.isDown===a&&e.x===b&&e.y===c)return!0}return!1},Touch.prototype._setEnable=function(a){if(this._enable!==a){var b=this.generator,c=this.game.phaser.device;if(!c.touch)return void(this._enable=!1);this._enable=a,a?(b.addEventListener("touchstart",this._onTouchStart,!1),b.addEventListener("touchmove",this._onTouchMove,!1),b.addEventListener("touchend",this._onTouchEnd,!1),b.addEventListener("touchcancel",this._onTouchCancel,!1),c.cocoonJS||(b.addEventListener("touchenter",this._onTouchEnter,!1),b.addEventListener("touchleave",this._onTouchLeave,!1))):(b.removeEventListener("touchstart",this._onTouchStart),b.removeEventListener("touchmove",this._onTouchMove),b.removeEventListener("touchend",this._onTouchEnd),b.removeEventListener("touchcancel",this._onTouchCancel),b.removeEventListener("touchenter",this._onTouchEnter),b.removeEventListener("touchleave",this._onTouchLeave),this._clearTouches())}},Touch.prototype._clearTouches=function(){for(var a;this._touches.length>0;)a=this._touches.pop(),a&&a.destroy();this._deviceIdMap={},this._touchStartNum=0,this._touchIds={}},Touch.prototype.lossFocus=function(){this._clearTouches()},Touch.prototype.isAnyTouch=function(){return this._touchStartNum>0},Touch.prototype.isAnyTouchStart=function(){return this._anyTouchStart},Touch.prototype.isTouchStart=function(a){return!!this._touchIds[a]},Touch.prototype._recordTouch=function(a,b){b?(this._touchStartNum++,this._touchIds[a]=!0):(this._touchStartNum--,delete this._touchIds[a])},Touch.prototype.getTouchById=function(a){return this._touches[a]},Touch.prototype._getFirstInvalidTouch=function(){for(var a=-1,b=this._touches.length+1;++a<b;){var c=this._touches[a];if(!c)break;if(!c.isDown&&!c.hasEvent())return c}var d=new qc.Pointer(this.game,a);return this._touches[a]=d,d},Touch.prototype._removeTouch=function(a){var b=this._touches[a];b&&delete this._deviceIdMap[b.deviceId]},Touch.prototype.getTouchByDeviceId=function(a,b){if(this._deviceIdMap[a]===undefined){if(b){var c=this._getFirstInvalidTouch();return c.deviceId=a,this._deviceIdMap[a]=c.id,c}return null}return this.getTouchById(this._deviceIdMap[a])},Touch.prototype._toWorld=function(a,b,c){var d=this.game.canvas,e=this.game.phaser.scale.scaleFactor,f=d.ownerDocument===(this.generator.ownerDocument||this.generator.document)?d.getBoundingClientRect():this.generator.getBoundingClientRect&&this.generator.getBoundingClientRect()||{left:0,top:0};return{x:(b-f.left)*e.x,y:(c-f.top)*e.y}},Touch.prototype._updateTouchWithTouches=function(a){for(var b=a.length,c={};b--;){var d=a[b];c[d.identifier]=!0;var e=this._toWorld(this.generator,d.clientX,d.clientY),f=this.getTouchByDeviceId(d.identifier);f&&(f.deviceId=d.identifier,f.onMove(e.x,e.y))}for(var b=this._touches.length;b--;){var d=this._touches[b];d&&!c[d.deviceId]&&d.onCancel(!1)}},Touch.prototype.processTouchStart=function(a){this.touchStartCallback&&this.touchStartCallback.call(this.callbackContext,a),!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();for(var b=a.changedTouches.length;b--;){var c=a.changedTouches[b];if(c){var d=this.getTouchByDeviceId(c.identifier,!0),e=this._toWorld(this.generator,c.clientX,c.clientY);this._touchesStartPosition.push({isDown:!0,x:e.x,y:e.y}),d.onDown(e.x,e.y)}}this._updateTouchWithTouches(a.touches),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()},Touch.prototype.processTouchEnd=function(a){this.touchEndCallback&&this.touchEndCallback.call(this.callbackContext,a),!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();for(var b=a.changedTouches.length;b--;){var c=a.changedTouches[b];if(c){var d=this.getTouchByDeviceId(c.identifier);if(d){var e=this._toWorld(this.generator,c.clientX,c.clientY);this._touchesStartPosition.push({isDown:!1,x:e.x,y:e.y}),d.onUp(e.x,e.y)}}}this._updateTouchWithTouches(a.touches),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()},Touch.prototype.processTouchCancel=function(a){this.touchCancelCallback&&this.touchCancelCallback.call(this.callbackContext,a),this.processTouchEnd(a,!0)},Touch.prototype.processTouchLeave=function(a){this.touchLeaveCallback&&this.touchLeaveCallback.call(this.callbackContext,a),this.processTouchMove(a,!0)},Touch.prototype.processTouchEnter=function(a){this.touchEnterCallback&&this.touchEnterCallback.call(this.callbackContext,a),this.processTouchMove(a,!0)},Touch.prototype.processTouchMove=function(a,b){!b&&this.touchMoveCallback&&this.touchMoveCallback.call(this.callbackContext,a),!this.input.ignoreDomEvent(a)&&this.capture&&a.preventDefault();for(var c=a.changedTouches.length;c--;){var d=a.changedTouches[c];if(d){var e=this.getTouchByDeviceId(d.identifier);if(e){var f=this._toWorld(this.generator,d.clientX,d.clientY);e.onMove(f.x,f.y)}}}this._updateTouchWithTouches(a.touches),this.input.keyboard.setModifierKeysState(a),this.input.nativeMode&&this.update()},Touch.MAIN=0;var BaseInputEvent=qc.BaseInputEvent=function(a){this.source=a,this.effect=!0};BaseInputEvent.prototype={},BaseInputEvent.prototype.constructor=BaseInputEvent;var WheelEvent=qc.WheelEvent=function(a,b){BaseInputEvent.call(this,{deltaX:a,deltaY:b})};WheelEvent.prototype=Object.create(BaseInputEvent.prototype),WheelEvent.prototype.constructor=WheelEvent,Object.defineProperties(WheelEvent.prototype,{deltaX:{get:function(){return this.source.deltaX}},deltaY:{get:function(){return this.source.deltaY}}});var CursorMoveEvent=qc.CursorMoveEvent=function(a,b){BaseInputEvent.call(this,{x:a,y:b})};CursorMoveEvent.prototype=Object.create(BaseInputEvent.prototype),CursorMoveEvent.prototype.constructor=CursorMoveEvent,Object.defineProperties(CursorMoveEvent.prototype,{x:{get:function(){return this.source.x}},y:{get:function(){return this.source.y}}});var PointerEvent=qc.PointerEvent=function(a){BaseInputEvent.call(this,a)};PointerEvent.prototype=Object.create(BaseInputEvent.prototype),PointerEvent.prototype.constructor=PointerEvent;var ClickEvent=qc.ClickEvent=function(a){PointerEvent.call(this,a),this.isTap=!1,this.isDoubleTap=!1,this.isDoubleClick=!1};ClickEvent.prototype=Object.create(PointerEvent.prototype),ClickEvent.prototype.constructor=ClickEvent;var DragStartEvent=qc.DragStartEvent=function(a){PointerEvent.call(this,a),this.started=!0};DragStartEvent.prototype=Object.create(PointerEvent.prototype),DragStartEvent.prototype.constructor=DragStartEvent;var DragEvent=qc.DragEvent=function(a){PointerEvent.call(this,a)};DragEvent.prototype=Object.create(PointerEvent.prototype),DragEvent.prototype.constructor=DragEvent;var DragEndEvent=qc.DragEndEvent=function(a,b){PointerEvent.call(this,a),this.result=b};DragEndEvent.prototype=Object.create(PointerEvent.prototype),DragEndEvent.prototype.constructor=DragEndEvent;var DropEvent=qc.DropEvent=function(a,b){PointerEvent.call(this,a),this.dragging=b,this.result=null};DropEvent.prototype=Object.create(PointerEvent.prototype),DropEvent.prototype.constructor=DropEvent;var BaseInputModule=qc.BaseInputModule=function(a,b){this.game=a,this.input=b,this.handleTouchAsMouse=!0,this._currMainPointerId=0/0,this._needHandleEventTypes=["onDown","onUp","onClick"],this._needHandleDragTypes=["onDragStart","onDrag","onDragEnd"],this._needHandleClickAndDragType=["onClick","onDragStart","onDrag","onDragEnd"],this._startDragMoveDistance=10,this.tapDuringTime=200,this.doubleClickDuringTime=600,this._pointersEvent={},this._init()};BaseInputModule.prototype={},BaseInputModule.prototype.constructor=BaseInputModule,BaseInputModule.prototype._init=function(){this.input.onPointerDown.add(this.onPointerDown,this),this.input.onPointerUp.add(this.onPointerUp,this),this.input.onPointerMove.add(this.onPointerMove,this),this.input.onWheel.add(this.onWheel,this),this.input.onCursorMove.add(this.onCursorMove,this)},BaseInputModule.prototype._buildPointerRecord=function(a,b){return{eventId:a,deviceId:a,isMouse:b,downNode:null,draggingNode:null,overNode:null}},BaseInputModule.prototype.destroy=function(){this.input.onPointerDown.remove(this.onPointerDown,this),this.input.onPointerUp.remove(this.onPointerUp,this),this.input.onPointerMove.remove(this.onPointerMove,this),this.input.onWheel.remove(this.onWheel,this),this.input.onCursorMove.remove(this.onCursorMove,this),this.reset()},BaseInputModule.prototype.lossFocus=function(){this.reset()},BaseInputModule.prototype.update=function(){},BaseInputModule.prototype.reset=function(){for(var a in this._pointersEvent){var b,c=this._pointersEvent[a];if(isNaN(c.deviceId)||(b=this.input.getPointer(c.deviceId),c.deviceId=0/0),null!==c.downNode){var d=new qc.PointerEvent(b);c.downNode.fireInputEvent("onUp",d),c.downNode=null}if(c.draggingNode){var e=new qc.DragEndEvent(b,null);c.draggingNode.fireInputEvent("onDragEnd",e),c.draggingNode=null}if(c.overNode){var f=new qc.CursorMoveEvent(0/0,0/0);this.doPointerExitAndEnter(c,f,null),c.overNode=null}}this._pointersEvent={},this._currMainPointerId=0/0},BaseInputModule.prototype.checkEventRecordNode=function(a){a.draggingNode&&a.draggingNode._destroy&&(a.draggingNode=null),a.downNode&&a.downNode._destroy&&(a.downNode=null),a.overNode&&a.overNode._destroy&&(a.overNode=null)},BaseInputModule.prototype.onPointerDown=function(a,b,c){var d=this.input.getPointer(a),e=this._pointersEvent[a]||(this._pointersEvent[a]=this._buildPointerRecord(a,this.input.isMouse(a)));if(this.handleTouchAsMouse&&(a===qc.Mouse.BUTTON_LEFT||a===qc.Touch.MAIN)){if(!isNaN(this._currMainPointerId)&&this._currMainPointerId!==a)return;this._currMainPointerId=a,d.eventId=qc.Mouse.BUTTON_LEFT,e.eventId=qc.Mouse.BUTTON_LEFT}this.checkEventRecordNode(e);var f=this._fetchNodeInParent(this.game.world,b,c);if(!e.isMouse){var g=new qc.CursorMoveEvent(b,c);this.doPointerExitAndEnter(e,g,f)}var h=f?f.getInputEventHandle(this._needHandleEventTypes):null;if(h){e.downNode=h;var i=new qc.PointerEvent(d);h&&h.fireInputEvent("onDown",i)}},BaseInputModule.prototype.onPointerUp=function(a,b,c){var d=this.input.getPointer(a),e=this._pointersEvent[a]||(this._pointersEvent[a]=this._buildPointerRecord(a,this.input.isMouse(a)));if(this.handleTouchAsMouse&&(a===qc.Mouse.BUTTON_LEFT||a===qc.Touch.MAIN)){if(this._currMainPointerId!==a)return;this._currMainPointerId=0/0,d.eventId=qc.Mouse.BUTTON_LEFT,e.eventId=d.eventId}this.checkEventRecordNode(e);var f=this._fetchNodeInParent(this.game.world,b,c,e.draggingNode),g=f?f.getInputEventHandle(this._needHandleEventTypes):null,h=new qc.PointerEvent(d);if(null!==e.draggingNode){var i=f?f.getInputEventHandle("onDragDrop"):null,j=new qc.DropEvent(d,e.draggingNode);i&&i.checkAllowDrop(e.draggingNode)&&i.fireInputEvent("onDragDrop",j);var k=new qc.DragEndEvent(d,j.result);e.draggingNode.fireInputEvent("onDragEnd",k),e.draggingNode=null}else if(g&&g===e.downNode){var l=new qc.ClickEvent(d);if(d.previousStatus.length){var m=d.previousStatus[0],n=d.previousStatus[1];l.isTap=m.upTime-m.downTime<this.tapDuringTime,l.isDoubleTap=n&&m.upTime-n.downTime<2*this.tapDuringTime,l.isDoubleClick=n&&m.upTime-n.downTime<this.doubleClickDuringTime}g.fireInputEvent("onClick",l)}if(e.downNode&&(h.downInside=!0,h.upInside=e.downNode===g,e.downNode.fireInputEvent("onUp",h)),g&&g!==e.downNode&&(h.downInside=!1,h.upInside=!0,g.fireInputEvent("onUp",h)),e.downNode=null,!e.isMouse){var o=new qc.CursorMoveEvent(b,c);this.doPointerExitAndEnter(e,o,null)}delete this._buildPointerRecord[e.deviceId]},BaseInputModule.prototype.onPointerMove=function(a,b,c){var d=this.input.getPointer(a),e=this._pointersEvent[a]||(this._pointersEvent[a]=this._buildPointerRecord(a,this.input.isMouse(a)));this.checkEventRecordNode(e);var f=this._fetchNodeInParent(this.game.world,b,c);if(!e.isMouse){var g=new qc.CursorMoveEvent(b,c);this.doPointerExitAndEnter(e,g,f)}if(!e.draggingNode){var h=this._fetchNodeInParent(this.game.world,d.startX,d.startY),i={x:d.x,y:d.y},j=null;do{if(!h)break;var k=h.getInputEventHandleAndEventType(this._needHandleClickAndDragType);if(!k)break;if("onClick"===k[1]&&(Math.abs(d.distanceX)<this._startDragMoveDistance||Math.abs(d.distanceY)<this._startDragMoveDistance))break;j=k[0]}while(!1);var l=new qc.DragStartEvent(d);d._x=d.startX,d._y=d.startY,j&&j.fireInputEvent("onDragStart",l),d._x=i.x,d._y=i.y,e.draggingNode=j}if(!e.draggingNode&&(Math.abs(d.distanceX)>=this._startDragMoveDistance||Math.abs(d.distanceY)>=this._startDragMoveDistance)){var h=this._fetchNodeInParent(this.game.world,d.startX,d.startY),i={x:d.x,y:d.y},j=h?h.getInputEventHandle(this._needHandleDragTypes):null,l=new qc.DragStartEvent(d);d._x=d.startX,d._y=d.startY,j&&j.fireInputEvent("onDragStart",l),d._x=i.x,d._y=i.y,e.draggingNode=j}if(e.draggingNode){var j=f?f.getInputEventHandle("onDragDrop"):null,m=new qc.DropEvent(d,e.draggingNode);!j||j.isAllowDrop&&!j.isAllowDrop(e.draggingNode)||j.fireInputEvent("onDragOver",m);var n=new qc.DragEvent(d);e.draggingNode.fireInputEvent("onDrag",n)}},BaseInputModule.prototype.onWheel=function(a,b){if(this.input.hasCursor){var c=this.input.cursorPosition,d=this._fetchNodeInParent(this.game.world,c.x,c.y),e=d?d.getInputEventHandle("onWheel"):null;if(e){var f=new qc.WheelEvent(-a,-b);e.fireInputEvent("onWheel",f),this.onCursorMove(c.x,c.y)}}},BaseInputModule.prototype.onCursorMove=function(a,b){var c=this._fetchNodeInParent(this.game.world,a,b),d=new qc.CursorMoveEvent(a,b);this.checkEventRecordNode(this),this.doPointerExitAndEnter(this,d,c)},BaseInputModule.prototype.doPointerExitAndEnter=function(a,b,c){if(a.overNode!==c){var d=this.findCommonRoot(a.overNode,c);if(a.overNode)for(var e=a.overNode;e&&e!==this.game.world&&(!d||d!==e);)e.fireInputEvent("onExit",b),e=e.parent;if(c)for(var e=c;e&&e!==d&&e!==this.game.world;)e.fireInputEvent("onEnter",b),e=e.parent;a.overNode=c}},BaseInputModule.prototype._flattenPolygonContains=function(a,b,c){for(var d=a.length/2,e=!1,f=-1,g=d-1;++f<d;g=f){var h=a[2*f],i=a[2*f+1],j=a[2*g],k=a[2*g+1];(c>=i&&k>c||c>=k&&i>c)&&(j-h)*(c-i)/(k-i)+h>b&&(e=!e)}return e},BaseInputModule.prototype.findCommonRoot=function(a,b){if(!a||!b)return null;for(var c=a,d=b;c;){for(d=b;d;){if(c===d)return c;d=d.parent}c=c.parent}return null},BaseInputModule.prototype._fetchNodeInParent=function(a,b,c,d){if(!a||!a.phaser.visible)return null;var e=a.phaser.worldTransform.applyInverse({x:b,y:c});if(a===this.game.world&&!a.rect.contains(e.x,e.y))return null;if(a===d)return null;if(a.phaser.mask){for(var f=a.phaser.mask.graphicsData.length,g=!1,h=0;h<a.phaser.mask.graphicsData.length;h++){var i=a.phaser.mask.graphicsData[h];if(i.fill&&i.shape){i.shape.points&&i.shape.points.length>0&&!(i.shape.points[0]instanceof qc.Point)&&this._flattenPolygonContains(i.shape.points,b,c)?g=!0:i.shape.contains(b,c)&&(g=!0);break}}if(0!=f&&!g)return null}if(a.phaser.softClip&&a.phaser.softClip.length&&!qc.GeometricTool.polygonContains(a.phaser.softClip,b,c))return null;for(var j=null,k=a.children,h=k.length;h--;)if(j=this._fetchNodeInParent(k[h],b,c,d))return j;return a.checkHit(e.x,e.y)?a:null};var DirtyRectangle=qc.DirtyRectangle=function(a){var b=this;b._destroyRegion=[],b.game=a,b.game.world.getSelfWidth=function(){return this.width},b.game.world.getSelfHeight=function(){return this.height},b.game.scale.onSizeChange.add(b.onSizeChange,b),b.enable=!1,b.showDirtyRegion=!1,b.forceDirty=!1};DirtyRectangle.prototype={},DirtyRectangle.prototype.constructor=DirtyRectangle,Object.defineProperties(DirtyRectangle.prototype,{enable:{get:function(){return this._enable},set:function(a){a!==this._enable&&(this._enable=a,this._recalcAll=a,a||this.releaseDirtyCanvas())}},showDirtyRegion:{get:function(){return this._showDirtyRegion},set:function(a){a!==this._showDirtyRegion&&(this._showDirtyRegion=a,a||this.releaseDirtyCanvas())}}}),DirtyRectangle.prototype.redirectDirty=function(a){var b=this;b._enable&&a&&b._destroyRegion.push(a)},DirtyRectangle.prototype.onSizeChange=function(){var a=this;a.game.world.displayChanged(qc.DisplayChangeStatus.SIZE)},DirtyRectangle.prototype._unionRect=function(a,b){var c=a.x+a.width,d=a.y+a.height,e=b.x+b.width,f=b.y+b.height,g=a.x<b.x?a.x:b.x,h=a.y<b.y?a.y:b.y,i=e>c?e:c,j=f>d?f:d,k=i-g,l=j-h;return{x:g,y:h,width:k,height:l,area:k*l}},DirtyRectangle.prototype._insersectionRect=function(a,b){var c=a.x+a.width,d=a.y+a.height,e=b.x+b.width,f=b.y+b.height,g=a.x>b.x?a.x:b.x,h=a.y>b.y?a.y:b.y,i=c>e?e:c,j=d>f?f:d,k=i-g,l=j-h;if(0>k||0>l)return null;var m={x:g,y:h,width:k,height:l,area:k*l};return m},DirtyRectangle.prototype._mergeRect=function(a){var b=this,c=a.length;if(2>c)return!0;for(var d=-1,e=!1,f=null,g=0;!e&&++d<c;){var h=a[d];for(h.clip&&(h=h.clip),g=d;!e&&++g<c;){var i=a[g];i.clip&&(i=i.clip),f=b._unionRect(h,i),e=.8*f.area-h.area-i.area<0}}return e&&f?(a[d]=f,
a.splice(g,1),!1):!0},DirtyRectangle.prototype.collectDirtyRegion=function(a,b,c){var d=this;if(c=c||[],!b)return c;var e=a;b instanceof Phaser.Text&&b.dirty&&(b.updateText(),b.getWorldTransform(),b.dirty=!1);var f=b.isSkipChildrenRender&&b.isSkipChildrenRender(),g=b.getDisplayProxy&&b.getDisplayProxy()||b;if(g!==b&&g.displayChanged(b._displayChangeStatus),g._updateBounds&&(f|=g._updateBounds(d._recalcAll)),g._mask){var h=g._currWorldBounds;h&&(e=e?d._insersectionRect(e,h):h)}if(g._dirtyBounds){var i=g._currWorldBounds;if(i&&e){var j=d._insersectionRect(i,e);j?g._currWorldBounds.clip=j:i=null}if(g._lastWorldBounds)for(var k=g._lastWorldBounds.length;k--;){var l=g._lastWorldBounds[k];l&&c.push(l)}g._lastWorldBounds=[],i&&c.push(i),g._dirtyBounds=!1}if(0===g._displayChangeStatus&&(f|=!b._subDisplayChanged),b._subDisplayChanged=!1,d._recalcAll||!f)for(var m=b.children.length;m--;)d.collectDirtyRegion(e,b.children[m],c);return b._resetDisplayChangeStatus&&b._resetDisplayChangeStatus(),g!==b&&g._resetDisplayChangeStatus&&g._resetDisplayChangeStatus(),c},DirtyRectangle.prototype.updateDirtyRegion=function(a,b,c){{var d=this;Date.now()}null==c._displayChangeStatus&&(c._displayChangeStatus=-1);var e=d._currDirtyRegion=d.collectDirtyRegion(null,c);if(d._destroyRegion&&(Array.prototype.push.apply(e,d._destroyRegion),d._destroyRegion=[]),d._recalcAll||d.forceDirty||e.length>500)d._recalcAll=!1,d._currDirtyRegion=e=[{x:0,y:0,width:d.game.width,height:d.game.height}],d.forceDirty=!1;else for(;!d._mergeRect(e););var f=e.length;if(!f)return!1;for(a.save(),d._saveContext=!0,a.beginPath();f--;){var g=e[f];g&&0!==g.clip&&(g.clip&&(g=g.clip),a.rect(g.x*b-1|0,g.y*b-1|0,g.width*b+3|0,g.height*b+3|0))}return a.clip(),c._displayChangeStatus=0,!0},DirtyRectangle.prototype.restore=function(a){var b=this;b._saveContext&&(a.restore(),b._saveContext=!1)},DirtyRectangle.prototype.checkShowDirtyCanvas=function(){var a=this,b=a.game.canvas,c=a._dirtyCanvas;return b?(c||(c=a._dirtyCanvas=document.createElement("canvas"),a._dirtyContext=a._dirtyCanvas.getContext("2d"),b.parentNode.insertBefore(a._dirtyCanvas,b),c.style.left=c.style.top="0px",c.style.position="absolute"),(c.style.width!==b.style.width||c.style.height!==b.style.height||c.width!==b.width||c.height!==b.height)&&(c.width=b.width,c.height=b.height,c.style.width=b.style.width,c.style.height=b.style.height),!0):!1},DirtyRectangle.prototype.releaseDirtyCanvas=function(){var a=this,b=a._dirtyCanvas;b&&(this.dirtyContext=null,this._dirtyCanvas=null,b.parentElement&&b.parentElement.removeChild(b))},DirtyRectangle.prototype.showDirtyRectangle=function(a,b){if(this._showDirtyRegion){var c=this;if(c.checkShowDirtyCanvas()){var d=c._dirtyCanvas,e=c._dirtyContext;e.clearRect(0,0,d.width,d.height),e.beginPath();var f=this._currDirtyRegion,g=f.length,h=.9;for(0===g&&this._lastShowAlpha>0?(f=this._lastShowRegion,h=this._lastShowAlpha-.05,g=f.length):this._lastShowRegion=f,this._lastShowAlpha=h;g--;){var i=f[g];i&&(i.clip?e.rect(i.clip.x*b,i.clip.y*b,i.clip.width*b,i.clip.height*b):e.rect(i.x*b,i.y*b,i.width*b,i.height*b))}e.lineWidth=3,e.strokeStyle="rgba(255,255,0, "+this._lastShowAlpha+")",e.stroke()}}};var __extends=function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);c.prototype=b.prototype,a.prototype=new c},dragonBones;!function(a){!function(a){var b=function(){function a(a,b){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),this.x=a,this.y=b}return a.prototype.toString=function(){return"[Point (x="+this.x+" y="+this.y+")]"},a}();a.Point=b;var c=function(){function a(a,b,c,d){"undefined"==typeof a&&(a=0),"undefined"==typeof b&&(b=0),"undefined"==typeof c&&(c=0),"undefined"==typeof d&&(d=0),this.x=a,this.y=b,this.width=c,this.height=d}return a}();a.Rectangle=c;var d=function(){function a(){this.a=1,this.b=0,this.c=0,this.d=1,this.tx=0,this.ty=0}return a.prototype.invert=function(){var a=this.a,b=this.b,c=this.c,d=this.d,e=this.tx,f=a*d-b*c;this.a=d/f,this.b=-b/f,this.c=-c/f,this.d=a/f,this.tx=(c*this.ty-d*e)/f,this.ty=-(a*this.ty-b*e)/f},a}();a.Matrix=d;var e=function(){function a(){this.alphaMultiplier=0,this.alphaOffset=0,this.blueMultiplier=0,this.blueOffset=0,this.greenMultiplier=0,this.greenOffset=0,this.redMultiplier=0,this.redOffset=0}return a}();a.ColorTransform=e}(a.geom||(a.geom={}));var b=a.geom;!function(a){var b=function(){function a(a){this.type=a}return a}();a.Event=b;var c=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.FADE_IN="fadeIn",b.FADE_OUT="fadeOut",b.START="start",b.COMPLETE="complete",b.LOOP_COMPLETE="loopComplete",b.FADE_IN_COMPLETE="fadeInComplete",b.FADE_OUT_COMPLETE="fadeOutComplete",b}(b);a.AnimationEvent=c;var d=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.Z_ORDER_UPDATED="zOrderUpdated",b}(b);a.ArmatureEvent=d;var e=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.ANIMATION_FRAME_EVENT="animationFrameEvent",b.BONE_FRAME_EVENT="boneFrameEvent",b}(b);a.FrameEvent=e;var f=function(a){function b(b){a.call(this,b)}return __extends(b,a),b.SOUND="sound",b.BONE_FRAME_EVENT="boneFrameEvent",b}(b);a.SoundEvent=f;var g=function(){function a(){}return a.prototype.hasEventListener=function(a){return this._listenersMap&&this._listenersMap[a]?!0:!1},a.prototype.addEventListener=function(a,b){if(a&&b){this._listenersMap||(this._listenersMap={});var c=this._listenersMap[a];c&&this.removeEventListener(a,b),c?c.push(b):this._listenersMap[a]=[b]}},a.prototype.removeEventListener=function(a,b){if(this._listenersMap&&a&&b){var c=this._listenersMap[a];if(c)for(var d=c.length,e=0;d>e;e++)c[e]==b&&(1==d?(c.length=0,delete this._listenersMap[a]):c.splice(e,1))}},a.prototype.removeAllEventListeners=function(a){a?delete this._listenersMap[a]:this._listenersMap=null},a.prototype.dispatchEvent=function(a){if(a){var b=this._listenersMap[a.type];if(b){a.target=this;for(var c=b.concat(),d=b.length,e=0;d>e;e++)c[e](a)}}},a}();a.EventDispatcher=g;var h=function(a){function b(){if(a.call(this),b._instance)throw new Error("Singleton already constructed!")}return __extends(b,a),b.getInstance=function(){return b._instance||(b._instance=new b),b._instance},b}(g);a.SoundEventManager=h}(a.events||(a.events={}));var c=a.events;!function(a){var d=function(){function a(){this.transform=new e.DBTransform,this.pivot=new b.Point,this._durationTransform=new e.DBTransform,this._durationPivot=new b.Point,this._durationColor=new b.ColorTransform}return a._borrowObject=function(){return 0==a._pool.length?new a:a._pool.pop()},a._returnObject=function(b){a._pool.indexOf(b)<0&&(a._pool[a._pool.length]=b),b.clear()},a._clear=function(){for(var b=a._pool.length;b--;)a._pool[b].clear();a._pool.length=0},a.getEaseValue=function(b,c){if(c>1){var d=.5*(1-Math.cos(b*Math.PI))-b;c-=1}else c>0?d=Math.sin(b*a.HALF_PI)-b:0>c&&(d=1-Math.cos(b*a.HALF_PI)-b,c*=-1);return d*c+b},a.prototype.fadeIn=function(a,b,c){switch(this._bone=a,this._animationState=b,this._timeline=c,this._originTransform=this._timeline.originTransform,this._originPivot=this._timeline.originPivot,this._tweenTransform=!1,this._tweenColor=!1,this._totalTime=this._animationState.totalTime,this.transform.x=0,this.transform.y=0,this.transform.scaleX=0,this.transform.scaleY=0,this.transform.skewX=0,this.transform.skewY=0,this.pivot.x=0,this.pivot.y=0,this._durationTransform.x=0,this._durationTransform.y=0,this._durationTransform.scaleX=0,this._durationTransform.scaleY=0,this._durationTransform.skewX=0,this._durationTransform.skewY=0,this._durationPivot.x=0,this._durationPivot.y=0,this._currentFrame=null,this._timeline.getFrameList().length){case 0:this._bone._arriveAtFrame(null,this,this._animationState,!1),this._updateState=0;break;case 1:this._updateState=-1;break;default:this._updateState=1}},a.prototype.fadeOut=function(){this.transform.skewX=f.TransformUtil.formatRadian(this.transform.skewX),this.transform.skewY=f.TransformUtil.formatRadian(this.transform.skewY)},a.prototype.update=function(b){if(this._updateState)if(this._updateState>0){0==this._timeline.scale?b=1:b/=this._timeline.scale,1==b&&(b=.99999999),b+=this._timeline.offset;var c=Math.floor(b);b-=c;for(var d,e=this._totalTime*b,g=!1;!this._currentFrame||e>this._currentFramePosition+this._currentFrameDuration||e<this._currentFramePosition;)g&&this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!0),g=!0,this._currentFrame?(d=this._timeline.getFrameList().indexOf(this._currentFrame)+1,d>=this._timeline.getFrameList().length&&(d=0),this._currentFrame=this._timeline.getFrameList()[d]):(d=0,this._currentFrame=this._timeline.getFrameList()[0]),this._currentFrameDuration=this._currentFrame.duration,this._currentFramePosition=this._currentFrame.position;if(g){this.tweenActive=this._currentFrame.displayIndex>=0,d++,d>=this._timeline.getFrameList().length&&(d=0);var h=this._timeline.getFrameList()[d];0==d&&this._animationState.loop&&this._animationState.loopCount>=Math.abs(this._animationState.loop)-1&&((this._currentFramePosition+this._currentFrameDuration)/this._totalTime+c-this._timeline.offset)*this._timeline.scale>.99999999?(this._updateState=0,this._tweenEasing=0/0):this._tweenEasing=this._currentFrame.displayIndex<0||h.displayIndex<0||!this._animationState.tweenEnabled?0/0:isNaN(this._animationState.clip.tweenEasing)?this._currentFrame.tweenEasing:this._animationState.clip.tweenEasing,isNaN(this._tweenEasing)?(this._tweenTransform=!1,this._tweenColor=!1):(this._durationTransform.x=h.transform.x-this._currentFrame.transform.x,this._durationTransform.y=h.transform.y-this._currentFrame.transform.y,this._durationTransform.skewX=h.transform.skewX-this._currentFrame.transform.skewX,this._durationTransform.skewY=h.transform.skewY-this._currentFrame.transform.skewY,this._durationTransform.scaleX=h.transform.scaleX-this._currentFrame.transform.scaleX,this._durationTransform.scaleY=h.transform.scaleY-this._currentFrame.transform.scaleY,0==d&&(this._durationTransform.skewX=f.TransformUtil.formatRadian(this._durationTransform.skewX),this._durationTransform.skewY=f.TransformUtil.formatRadian(this._durationTransform.skewY)),this._durationPivot.x=h.pivot.x-this._currentFrame.pivot.x,this._durationPivot.y=h.pivot.y-this._currentFrame.pivot.y,this._tweenTransform=0!=this._durationTransform.x||0!=this._durationTransform.y||0!=this._durationTransform.skewX||0!=this._durationTransform.skewY||0!=this._durationTransform.scaleX||0!=this._durationTransform.scaleY||0!=this._durationPivot.x||0!=this._durationPivot.y?!0:!1,this._currentFrame.color&&h.color?(this._durationColor.alphaOffset=h.color.alphaOffset-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=h.color.redOffset-this._currentFrame.color.redOffset,this._durationColor.greenOffset=h.color.greenOffset-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=h.color.blueOffset-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=h.color.alphaMultiplier-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=h.color.redMultiplier-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=h.color.greenMultiplier-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=h.color.blueMultiplier-this._currentFrame.color.blueMultiplier,this._tweenColor=0!=this._durationColor.alphaOffset||0!=this._durationColor.redOffset||0!=this._durationColor.greenOffset||0!=this._durationColor.blueOffset||0!=this._durationColor.alphaMultiplier||0!=this._durationColor.redMultiplier||0!=this._durationColor.greenMultiplier||0!=this._durationColor.blueMultiplier?!0:!1):this._currentFrame.color?(this._tweenColor=!0,this._durationColor.alphaOffset=-this._currentFrame.color.alphaOffset,this._durationColor.redOffset=-this._currentFrame.color.redOffset,this._durationColor.greenOffset=-this._currentFrame.color.greenOffset,this._durationColor.blueOffset=-this._currentFrame.color.blueOffset,this._durationColor.alphaMultiplier=1-this._currentFrame.color.alphaMultiplier,this._durationColor.redMultiplier=1-this._currentFrame.color.redMultiplier,this._durationColor.greenMultiplier=1-this._currentFrame.color.greenMultiplier,this._durationColor.blueMultiplier=1-this._currentFrame.color.blueMultiplier):h.color?(this._tweenColor=!0,this._durationColor.alphaOffset=h.color.alphaOffset,this._durationColor.redOffset=h.color.redOffset,this._durationColor.greenOffset=h.color.greenOffset,this._durationColor.blueOffset=h.color.blueOffset,this._durationColor.alphaMultiplier=h.color.alphaMultiplier-1,this._durationColor.redMultiplier=h.color.redMultiplier-1,this._durationColor.greenMultiplier=h.color.greenMultiplier-1,this._durationColor.blueMultiplier=h.color.blueMultiplier-1):this._tweenColor=!1),this._tweenTransform||(this._animationState.blend?(this.transform.x=this._originTransform.x+this._currentFrame.transform.x,this.transform.y=this._originTransform.y+this._currentFrame.transform.y,this.transform.skewX=this._originTransform.skewX+this._currentFrame.transform.skewX,this.transform.skewY=this._originTransform.skewY+this._currentFrame.transform.skewY,this.transform.scaleX=this._originTransform.scaleX+this._currentFrame.transform.scaleX,this.transform.scaleY=this._originTransform.scaleY+this._currentFrame.transform.scaleY,this.pivot.x=this._originPivot.x+this._currentFrame.pivot.x,this.pivot.y=this._originPivot.y+this._currentFrame.pivot.y):(this.transform.x=this._currentFrame.transform.x,this.transform.y=this._currentFrame.transform.y,this.transform.skewX=this._currentFrame.transform.skewX,this.transform.skewY=this._currentFrame.transform.skewY,this.transform.scaleX=this._currentFrame.transform.scaleX,this.transform.scaleY=this._currentFrame.transform.scaleY,this.pivot.x=this._currentFrame.pivot.x,this.pivot.y=this._currentFrame.pivot.y)),this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1),this._tweenColor||(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._isColorChanged&&this._bone._updateColor(0,0,0,0,1,1,1,1,!1))}if((this._tweenTransform||this._tweenColor)&&(b=(e-this._currentFramePosition)/this._currentFrameDuration,this._tweenEasing&&(b=a.getEaseValue(b,this._tweenEasing))),this._tweenTransform){var i=this._currentFrame.transform,j=this._currentFrame.pivot;this._animationState.blend?(this.transform.x=this._originTransform.x+i.x+this._durationTransform.x*b,this.transform.y=this._originTransform.y+i.y+this._durationTransform.y*b,this.transform.skewX=this._originTransform.skewX+i.skewX+this._durationTransform.skewX*b,this.transform.skewY=this._originTransform.skewY+i.skewY+this._durationTransform.skewY*b,this.transform.scaleX=this._originTransform.scaleX+i.scaleX+this._durationTransform.scaleX*b,this.transform.scaleY=this._originTransform.scaleY+i.scaleY+this._durationTransform.scaleY*b,this.pivot.x=this._originPivot.x+j.x+this._durationPivot.x*b,this.pivot.y=this._originPivot.y+j.y+this._durationPivot.y*b):(this.transform.x=i.x+this._durationTransform.x*b,this.transform.y=i.y+this._durationTransform.y*b,this.transform.skewX=i.skewX+this._durationTransform.skewX*b,this.transform.skewY=i.skewY+this._durationTransform.skewY*b,this.transform.scaleX=i.scaleX+this._durationTransform.scaleX*b,this.transform.scaleY=i.scaleY+this._durationTransform.scaleY*b,this.pivot.x=j.x+this._durationPivot.x*b,this.pivot.y=j.y+this._durationPivot.y*b)}this._tweenColor&&(this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset+this._durationColor.alphaOffset*b,this._currentFrame.color.redOffset+this._durationColor.redOffset*b,this._currentFrame.color.greenOffset+this._durationColor.greenOffset*b,this._currentFrame.color.blueOffset+this._durationColor.blueOffset*b,this._currentFrame.color.alphaMultiplier+this._durationColor.alphaMultiplier*b,this._currentFrame.color.redMultiplier+this._durationColor.redMultiplier*b,this._currentFrame.color.greenMultiplier+this._durationColor.greenMultiplier*b,this._currentFrame.color.blueMultiplier+this._durationColor.blueMultiplier*b,!0):this._bone._updateColor(this._durationColor.alphaOffset*b,this._durationColor.redOffset*b,this._durationColor.greenOffset*b,this._durationColor.blueOffset*b,1+this._durationColor.alphaMultiplier*b,1+this._durationColor.redMultiplier*b,1+this._durationColor.greenMultiplier*b,1+this._durationColor.blueMultiplier*b,!0))}else this._updateState=0,this._animationState.blend?(this.transform.copy(this._originTransform),this.pivot.x=this._originPivot.x,this.pivot.y=this._originPivot.y):(this.transform.x=this.transform.y=this.transform.skewX=this.transform.skewY=this.transform.scaleX=this.transform.scaleY=0,this.pivot.x=0,this.pivot.y=0),this._currentFrame=this._timeline.getFrameList()[0],this.tweenActive=this._currentFrame.displayIndex>=0,this._bone._arriveAtFrame(this._currentFrame,this,this._animationState,!1),this._currentFrame.color?this._bone._updateColor(this._currentFrame.color.alphaOffset,this._currentFrame.color.redOffset,this._currentFrame.color.greenOffset,this._currentFrame.color.blueOffset,this._currentFrame.color.alphaMultiplier,this._currentFrame.color.redMultiplier,this._currentFrame.color.greenMultiplier,this._currentFrame.color.blueMultiplier,!0):this._bone._isColorChanged&&this._bone._updateColor(0,0,0,0,1,1,1,1,!1)},a.prototype.clear=function(){this._updateState=0,this._bone=null,this._animationState=null,this._timeline=null,this._currentFrame=null,this._originTransform=null,this._originPivot=null},a.HALF_PI=.5*Math.PI,a._pool=[],a}();a.TimelineState=d;var g=function(){function a(){this.loop=0,this.layer=0,this._timelineStates={}}return a._borrowObject=function(){return 0==a._pool.length?new a:a._pool.pop()},a._returnObject=function(b){a._pool.indexOf(b)<0&&(a._pool[a._pool.length]=b),b.clear()},a._clear=function(){for(var b=a._pool.length;b--;)a._pool[b].clear();a._pool.length=0},a.prototype.fadeIn=function(a,b,c,d,e,f,g,h){this.layer=f,this.clip=b,this.name=this.clip.name,this.totalTime=this.clip.duration,this._armature=a,Math.round(this.clip.duration*this.clip.frameRate)<2||d==1/0?(this.timeScale=1,this.currentTime=this.totalTime,this.loop=this.loop>=0?1:-1):(this.timeScale=d,this.currentTime=0,this.loop=e),this._pauseBeforeFadeInComplete=h,this._fadeInTime=c*this.timeScale,this._fadeState=1,this._fadeOutBeginTime=0,this._fadeOutWeight=-1,this._fadeWeight=0,this._fadeIn=!0,this._fadeOut=!1,this.loopCount=-1,this.displayControl=g,this.isPlaying=!0,this.isComplete=!1,this.weight=1,this.blend=!0,this.enabled=!0,this.tweenEnabled=!0,this.updateTimelineStates()},a.prototype.fadeOut=function(a,b){if("undefined"==typeof b&&(b=!1),this._armature&&!(this._fadeOutWeight>=0)){this._fadeState=-1,this._fadeOutWeight=this._fadeWeight,this._fadeOutTime=a*this.timeScale,this._fadeOutBeginTime=this.currentTime,this._fadeOut=!0,this.isPlaying=!b,this.displayControl=!1;for(var c in this._timelineStates)this._timelineStates[c].fadeOut();this.enabled=!0}},a.prototype.play=function(){this.isPlaying=!0},a.prototype.stop=function(){this.isPlaying=!1},a.prototype.getMixingTransform=function(a){return this._mixingTransforms?Number(this._mixingTransforms[a]):-1},a.prototype.addMixingTransform=function(a,b,c){if("undefined"==typeof b&&(b=2),"undefined"==typeof c&&(c=!0),!this.clip||!this.clip.getTimeline(a))throw new Error;if(this._mixingTransforms||(this._mixingTransforms={}),c)for(var d,e,f=this._armature._boneList.length;f--;)d=this._armature._boneList[f],d.name==a&&(e=d),e&&(e==d||e.contains(d))&&(this._mixingTransforms[d.name]=b);else this._mixingTransforms[a]=b;this.updateTimelineStates()},a.prototype.removeMixingTransform=function(a,b){if("undefined"==typeof a&&(a=null),"undefined"==typeof b&&(b=!0),a){if(b)for(var c,d,e=this._armature._boneList.length;e--;)c=this._armature._boneList[e],c.name==a&&(d=c),d&&(d==c||d.contains(c))&&delete this._mixingTransforms[c.name];else delete this._mixingTransforms[a];for(var f in this._mixingTransforms){var g=!0;break}g||(this._mixingTransforms=null)}else this._mixingTransforms=null;this.updateTimelineStates()},a.prototype.advanceTime=function(a){if(!this.enabled)return!1;var b,d;if(this._fadeIn&&(this._fadeIn=!1,this._armature.hasEventListener(c.AnimationEvent.FADE_IN)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_IN),b.animationState=this,this._armature._eventList.push(b))),this._fadeOut&&(this._fadeOut=!1,this._armature.hasEventListener(c.AnimationEvent.FADE_OUT)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_OUT),b.animationState=this,this._armature._eventList.push(b))),this.currentTime+=a*this.timeScale,this.isPlaying&&!this.isComplete){var e,f;this._pauseBeforeFadeInComplete?(this._pauseBeforeFadeInComplete=!1,this.isPlaying=!1,e=0,f=Math.floor(e)):(e=this.currentTime/this.totalTime,f=Math.floor(e),f!=this.loopCount&&(-1==this.loopCount&&this._armature.hasEventListener(c.AnimationEvent.START)&&(b=new c.AnimationEvent(c.AnimationEvent.START),b.animationState=this,this._armature._eventList.push(b)),this.loopCount=f,this.loopCount&&(this.loop&&this.loopCount*this.loopCount>=this.loop*this.loop-1?(d=!0,e=1,f=0,this._armature.hasEventListener(c.AnimationEvent.COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.COMPLETE),b.animationState=this,this._armature._eventList.push(b))):this._armature.hasEventListener(c.AnimationEvent.LOOP_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.LOOP_COMPLETE),b.animationState=this,this._armature._eventList.push(b)))));for(var g in this._timelineStates)this._timelineStates[g].update(e);var h=this.clip.getFrameList();if(h.length>0){for(var i,j=this.totalTime*(e-f),k=!1;!this._currentFrame||j>this._currentFrame.position+this._currentFrame.duration||j<this._currentFrame.position;)k&&this._armature._arriveAtFrame(this._currentFrame,null,this,!0),k=!0,this._currentFrame?(i=h.indexOf(this._currentFrame),i++,i>=h.length&&(i=0),this._currentFrame=h[i]):this._currentFrame=h[0];k&&this._armature._arriveAtFrame(this._currentFrame,null,this,!1)}}if(this._fadeState>0)0==this._fadeInTime?(this._fadeWeight=1,this._fadeState=0,this.isPlaying=!0,this._armature.hasEventListener(c.AnimationEvent.FADE_IN_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_IN_COMPLETE),b.animationState=this,this._armature._eventList.push(b))):(this._fadeWeight=this.currentTime/this._fadeInTime,this._fadeWeight>=1&&(this._fadeWeight=1,this._fadeState=0,this.isPlaying||(this.currentTime-=this._fadeInTime),this.isPlaying=!0,this._armature.hasEventListener(c.AnimationEvent.FADE_IN_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_IN_COMPLETE),b.animationState=this,this._armature._eventList.push(b))));else if(this._fadeState<0){if(0==this._fadeOutTime)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(c.AnimationEvent.FADE_OUT_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_OUT_COMPLETE),b.animationState=this,this._armature._eventList.push(b)),!0;if(this._fadeWeight=(1-(this.currentTime-this._fadeOutBeginTime)/this._fadeOutTime)*this._fadeOutWeight,this._fadeWeight<=0)return this._fadeWeight=0,this._fadeState=0,this._armature.hasEventListener(c.AnimationEvent.FADE_OUT_COMPLETE)&&(b=new c.AnimationEvent(c.AnimationEvent.FADE_OUT_COMPLETE),b.animationState=this,this._armature._eventList.push(b)),!0}return d&&(this.isComplete=!0,this.loop<0&&this.fadeOut((this._fadeOutWeight||this._fadeInTime)/this.timeScale,!0)),!1},a.prototype.updateTimelineStates=function(){if(this._mixingTransforms){for(var a in this._timelineStates)null==this._mixingTransforms[a]&&this.removeTimelineState(a);for(a in this._mixingTransforms)this._timelineStates[a]||this.addTimelineState(a)}else for(a in this.clip.getTimelines())this._timelineStates[a]||this.addTimelineState(a)},a.prototype.addTimelineState=function(a){var b=this._armature.getBone(a);if(b){var c=d._borrowObject(),e=this.clip.getTimeline(a);c.fadeIn(b,this,e),this._timelineStates[a]=c}},a.prototype.removeTimelineState=function(a){d._returnObject(this._timelineStates[a]),delete this._timelineStates[a]},a.prototype.clear=function(){this.clip=null,this.enabled=!1,this._armature=null,this._currentFrame=null,this._mixingTransforms=null;for(var a in this._timelineStates)this.removeTimelineState(a)},a._pool=[],a}();a.AnimationState=g;var h=function(){function a(a){this._armature=a,this._animationLayer=[],this._isPlaying=!1,this.animationNameList=[],this.tweenEnabled=!0,this.timeScale=1}return a.prototype.getLastAnimationName=function(){return this._lastAnimationState?this._lastAnimationState.name:null},a.prototype.getLastAnimationState=function(){return this._lastAnimationState},a.prototype.getAnimationDataList=function(){return this._animationDataList},a.prototype.setAnimationDataList=function(a){this._animationDataList=a,this.animationNameList.length=0;for(var b in this._animationDataList)this.animationNameList[this.animationNameList.length]=this._animationDataList[b].name},a.prototype.getIsPlaying=function(){return this._isPlaying&&!this.getIsComplete()},a.prototype.getIsComplete=function(){if(this._lastAnimationState){if(!this._lastAnimationState.isComplete)return!1;for(var a=this._animationLayer.length;a--;)for(var b=this._animationLayer[a],c=b.length;c--;)if(!b[c].isComplete)return!1;return!0}return!1},a.prototype.dispose=function(){if(this._armature){this.stop();for(var a=this._animationLayer.length;a--;){for(var b=this._animationLayer[a],c=b.length;c--;)g._returnObject(b[c]);b.length=0}this._animationLayer.length=0,this.animationNameList.length=0,this._armature=null,this._animationLayer=null,this._animationDataList=null,this.animationNameList=null}},a.prototype.gotoAndPlay=function(b,c,d,e,f,h,i,j,k,l){if("undefined"==typeof c&&(c=-1),"undefined"==typeof d&&(d=-1),"undefined"==typeof e&&(e=0/0),"undefined"==typeof f&&(f=0),"undefined"==typeof h&&(h=null),"undefined"==typeof i&&(i=a.SAME_LAYER_AND_GROUP),"undefined"==typeof j&&(j=!0),"undefined"==typeof k&&(k=!0),"undefined"==typeof l&&(l=!0),!this._animationDataList)return null;for(var m,n=this._animationDataList.length;n--;)if(this._animationDataList[n].name==b){m=this._animationDataList[n];break}if(!m)return null;this._isPlaying=!0,c=0>c?m.fadeInTime<0?.3:m.fadeInTime:c;var o;o=0>d?m.scale<0?1:m.scale:d/m.duration,e=isNaN(e)?m.loop:e,f=this.addLayer(f);var p,q;switch(i){case a.NONE:break;case a.SAME_LAYER:for(q=this._animationLayer[f],n=q.length;n--;)p=q[n],p.fadeOut(c,k);break;case a.SAME_GROUP:for(r=this._animationLayer.length;r--;)for(q=this._animationLayer[r],n=q.length;n--;)p=q[n],p.group==h&&p.fadeOut(c,k);break;case a.ALL:for(var r=this._animationLayer.length;r--;)for(q=this._animationLayer[r],n=q.length;n--;)p=q[n],p.fadeOut(c,k);break;case a.SAME_LAYER_AND_GROUP:default:for(q=this._animationLayer[f],n=q.length;n--;)p=q[n],p.group==h&&p.fadeOut(c,k)}this._lastAnimationState=g._borrowObject(),this._lastAnimationState.group=h,this._lastAnimationState.tweenEnabled=this.tweenEnabled,this._lastAnimationState.fadeIn(this._armature,m,c,1/o,e,f,j,l),this.addState(this._lastAnimationState);var s,t,u=this._armature._slotList;for(n=u.length;n--;)s=u[n],t=s.getChildArmature(),t&&t.animation.gotoAndPlay(b,c);return this._lastAnimationState},a.prototype.play=function(){this._animationDataList&&0!=this._animationDataList.length&&(this._lastAnimationState?this._isPlaying?this.gotoAndPlay(this._lastAnimationState.name):this._isPlaying=!0:this.gotoAndPlay(this._animationDataList[0].name))},a.prototype.stop=function(){this._isPlaying=!1},a.prototype.getState=function(a,b){"undefined"==typeof b&&(b=0);var c=this._animationLayer.length;if(0==c)return null;b>=c&&(b=c-1);var d=this._animationLayer[b];if(!d)return null;for(var e=d.length;e--;)if(d[e].name==a)return d[e];return null},a.prototype.hasAnimation=function(a){for(var b=this._animationDataList.length;b--;)if(this._animationDataList[b].name==a)return!0;return!1},a.prototype.advanceTime=function(a){if(this._isPlaying){a*=this.timeScale;var b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w=this._armature._boneList.length,x=w;for(w--;x--;){for(e=this._armature._boneList[x],f=e.name,g=1,h=0,i=0,j=0,k=0,l=0,m=0,n=0,o=0,b=this._animationLayer.length;b--;){for(p=0,q=this._animationLayer[b],d=q.length,c=0;d>c;c++)r=q[c],x==w&&r.advanceTime(a)?(this.removeState(r),c--,d--):(s=r._timelineStates[f],s&&s.tweenActive&&(t=r._fadeWeight*r.weight*g,u=s.transform,v=s.pivot,h+=u.x*t,i+=u.y*t,j+=u.skewX*t,k+=u.skewY*t,l+=u.scaleX*t,m+=u.scaleY*t,n+=v.x*t,o+=v.y*t,p+=t));if(p>=g)break;g-=p}u=e.tween,v=e._tweenPivot,u.x=h,u.y=i,u.skewX=j,u.skewY=k,u.scaleX=l,u.scaleY=m,v.x=n,v.y=o}}},a.prototype.addLayer=function(a){return a>=this._animationLayer.length&&(a=this._animationLayer.length,this._animationLayer[a]=[]),a},a.prototype.addState=function(a){var b=this._animationLayer[a.layer];b.push(a)},a.prototype.removeState=function(a){var b=a.layer,c=this._animationLayer[b];c.splice(c.indexOf(a),1),g._returnObject(a),0==c.length&&b==this._animationLayer.length-1&&this._animationLayer.length--},a.NONE="none",a.SAME_LAYER="sameLayer",a.SAME_GROUP="sameGroup",a.SAME_LAYER_AND_GROUP="sameLayerAndGroup",a.ALL="all",a}();a.Animation=h}(a.animation||(a.animation={}));var d=a.animation;!function(a){var c=function(){function a(){this.x=0,this.y=0,this.skewX=0,this.skewY=0,this.scaleX=1,this.scaleY=1}return a.prototype.getRotation=function(){return this.skewX},a.prototype.setRotation=function(a){this.skewX=this.skewY=a},a.prototype.copy=function(a){this.x=a.x,this.y=a.y,this.skewX=a.skewX,this.skewY=a.skewY,this.scaleX=a.scaleX,this.scaleY=a.scaleY},a.prototype.toString=function(){return"[DBTransform (x="+this.x+" y="+this.y+" skewX="+this.skewX+" skewY="+this.skewY+" scaleX="+this.scaleX+" scaleY="+this.scaleY+")]"},a}();a.DBTransform=c;var d=function(){function a(){this.position=0,this.duration=0}return a.prototype.dispose=function(){},a}();a.Frame=d;var e=function(a){function d(){a.call(this),this.tweenEasing=0,this.tweenRotate=0,this.displayIndex=0,this.zOrder=0/0,this.visible=!0,this.global=new c,this.transform=new c,this.pivot=new b.Point}return __extends(d,a),d.prototype.dispose=function(){a.prototype.dispose.call(this),this.global=null,this.transform=null,this.pivot=null,this.color=null},d}(d);a.TransformFrame=e;var g=function(){function a(){this._frameList=[],this.duration=0,this.scale=1}return a.prototype.getFrameList=function(){return this._frameList},a.prototype.dispose=function(){for(var a=this._frameList.length;a--;)this._frameList[a].dispose();this._frameList.length=0,this._frameList=null},a.prototype.addFrame=function(a){if(!a)throw new Error;if(!(this._frameList.indexOf(a)<0))throw new Error;this._frameList[this._frameList.length]=a},a}();a.Timeline=g;var h=function(a){function d(){a.call(this),this.originTransform=new c,this.originPivot=new b.Point,this.offset=0,this.transformed=!1}return __extends(d,a),d.prototype.dispose=function(){this!=d.HIDE_TIMELINE&&(a.prototype.dispose.call(this),this.originTransform=null,this.originPivot=null)},d.HIDE_TIMELINE=new d,d}(g);a.TransformTimeline=h;var i=function(a){function b(){a.call(this),this.frameRate=0,this.loop=0,this.tweenEasing=0/0,this.fadeInTime=0,this._timelines={}}return __extends(b,a),b.prototype.getTimelines=function(){return this._timelines},b.prototype.dispose=function(){a.prototype.dispose.call(this);for(var b in this._timelines)this._timelines[b].dispose();this._timelines=null},b.prototype.getTimeline=function(a){return this._timelines[a]},b.prototype.addTimeline=function(a,b){if(!a)throw new Error;this._timelines[b]=a},b}(g);a.AnimationData=i;var j=function(){function a(){this.transform=new c}return a.prototype.dispose=function(){this.transform=null,this.pivot=null},a.ARMATURE="armature",a.IMAGE="image",a}();a.DisplayData=j;var k=function(){
function a(){this._displayDataList=[],this.zOrder=0}return a.prototype.getDisplayDataList=function(){return this._displayDataList},a.prototype.dispose=function(){for(var a=this._displayDataList.length;a--;)this._displayDataList[a].dispose();this._displayDataList.length=0,this._displayDataList=null},a.prototype.addDisplayData=function(a){if(!a)throw new Error;if(!(this._displayDataList.indexOf(a)<0))throw new Error;this._displayDataList[this._displayDataList.length]=a},a.prototype.getDisplayData=function(a){for(var b=this._displayDataList.length;b--;)if(this._displayDataList[b].name==a)return this._displayDataList[b];return null},a}();a.SlotData=k;var l=function(){function a(){this.length=0,this.global=new c,this.transform=new c}return a.prototype.dispose=function(){this.global=null,this.transform=null},a}();a.BoneData=l;var m=function(){function a(){this._slotDataList=[]}return a.prototype.getSlotDataList=function(){return this._slotDataList},a.prototype.dispose=function(){for(var a=this._slotDataList.length;a--;)this._slotDataList[a].dispose();this._slotDataList.length=0,this._slotDataList=null},a.prototype.getSlotData=function(a){for(var b=this._slotDataList.length;b--;)if(this._slotDataList[b].name==a)return this._slotDataList[b];return null},a.prototype.addSlotData=function(a){if(!a)throw new Error;if(!(this._slotDataList.indexOf(a)<0))throw new Error;this._slotDataList[this._slotDataList.length]=a},a}();a.SkinData=m;var n=function(){function a(){this._boneDataList=[],this._skinDataList=[],this._animationDataList=[]}return a.prototype.getBoneDataList=function(){return this._boneDataList},a.prototype.getSkinDataList=function(){return this._skinDataList},a.prototype.getAnimationDataList=function(){return this._animationDataList},a.prototype.dispose=function(){for(var a=this._boneDataList.length;a--;)this._boneDataList[a].dispose();for(a=this._skinDataList.length;a--;)this._skinDataList[a].dispose();for(a=this._animationDataList.length;a--;)this._animationDataList[a].dispose();this._boneDataList.length=0,this._skinDataList.length=0,this._animationDataList.length=0,this._boneDataList=null,this._skinDataList=null,this._animationDataList=null},a.prototype.getBoneData=function(a){for(var b=this._boneDataList.length;b--;)if(this._boneDataList[b].name==a)return this._boneDataList[b];return null},a.prototype.getSkinData=function(a){if(!a)return this._skinDataList[0];for(var b=this._skinDataList.length;b--;)if(this._skinDataList[b].name==a)return this._skinDataList[b];return null},a.prototype.getAnimationData=function(a){for(var b=this._animationDataList.length;b--;)if(this._animationDataList[b].name==a)return this._animationDataList[b];return null},a.prototype.addBoneData=function(a){if(!a)throw new Error;if(!(this._boneDataList.indexOf(a)<0))throw new Error;this._boneDataList[this._boneDataList.length]=a},a.prototype.addSkinData=function(a){if(!a)throw new Error;if(!(this._skinDataList.indexOf(a)<0))throw new Error;this._skinDataList[this._skinDataList.length]=a},a.prototype.addAnimationData=function(a){if(!a)throw new Error;this._animationDataList.indexOf(a)<0&&(this._animationDataList[this._animationDataList.length]=a)},a.prototype.sortBoneDataList=function(){var a=this._boneDataList.length;if(0!=a){for(var b=[];a--;){for(var c=this._boneDataList[a],d=0,e=c;e&&e.parent;)d++,e=this.getBoneData(e.parent);b[a]={level:d,boneData:c}}for(b.sort(this.sortBoneData),a=b.length;a--;)this._boneDataList[a]=b[a].boneData}},a.prototype.sortBoneData=function(a,b){return a.level>b.level?1:-1},a}();a.ArmatureData=n;var o=function(){function a(){this._armatureDataList=[],this._subTexturePivots={}}return a.prototype.getArmatureNames=function(){var a=[];for(var b in this._armatureDataList)a[a.length]=this._armatureDataList[b].name;return a},a.prototype.getArmatureDataList=function(){return this._armatureDataList},a.prototype.dispose=function(){for(var a in this._armatureDataList)this._armatureDataList[a].dispose();this._armatureDataList.length=0,this._armatureDataList=null,this._subTexturePivots=null},a.prototype.getArmatureData=function(a){for(var b=this._armatureDataList.length;b--;)if(this._armatureDataList[b].name==a)return this._armatureDataList[b];return null},a.prototype.addArmatureData=function(a){if(!a)throw new Error;if(!(this._armatureDataList.indexOf(a)<0))throw new Error;this._armatureDataList[this._armatureDataList.length]=a},a.prototype.removeArmatureData=function(a){var b=this._armatureDataList.indexOf(a);b>=0&&this._armatureDataList.splice(b,1)},a.prototype.removeArmatureDataByName=function(a){for(var b=this._armatureDataList.length;b--;)this._armatureDataList[b].name==a&&this._armatureDataList.splice(b,1)},a.prototype.getSubTexturePivot=function(a){return this._subTexturePivots[a]},a.prototype.addSubTexturePivot=function(a,c,d){var e=this._subTexturePivots[d];return e?(e.x=a,e.y=c):this._subTexturePivots[d]=e=new b.Point(a,c),e},a.prototype.removeSubTexturePivot=function(a){if(a)delete this._subTexturePivots[a];else for(a in this._subTexturePivots)delete this._subTexturePivots[a]},a}();a.SkeletonData=o;var p=function(){function a(){}return a.parseTextureAtlasData=function(a,c){if("undefined"==typeof c&&(c=1),!a)throw new Error;var d={};d.__name=a[f.ConstValues.A_NAME];var e=a[f.ConstValues.SUB_TEXTURE];for(var g in e){var h=e[g],i=h[f.ConstValues.A_NAME],j=new b.Rectangle(Number(h[f.ConstValues.A_X])/c,Number(h[f.ConstValues.A_Y])/c,Number(h[f.ConstValues.A_WIDTH])/c,Number(h[f.ConstValues.A_HEIGHT])/c);d[i]=j}return d},a.parseSkeletonData=function(b){if(!b)throw new Error;var c=Number(b[f.ConstValues.A_FRAME_RATE]),d=new o;d.name=b[f.ConstValues.A_NAME];var e=b[f.ConstValues.ARMATURE];for(var g in e){var h=e[g];d.addArmatureData(a.parseArmatureData(h,d,c))}return d},a.parseArmatureData=function(b,c,d){var e=new n;e.name=b[f.ConstValues.A_NAME];var g=b[f.ConstValues.BONE];for(var h in g){var i=g[h];e.addBoneData(a.parseBoneData(i))}var j=b[f.ConstValues.SKIN];for(var h in j){var k=j[h];e.addSkinData(a.parseSkinData(k,c))}f.DBDataUtil.transformArmatureData(e),e.sortBoneDataList();var l=b[f.ConstValues.ANIMATION];for(var h in l){var m=l[h];e.addAnimationData(a.parseAnimationData(m,e,d))}return e},a.parseBoneData=function(b){var c=new l;return c.name=b[f.ConstValues.A_NAME],c.parent=b[f.ConstValues.A_PARENT],c.length=Number(b[f.ConstValues.A_LENGTH])||0,a.parseTransform(b[f.ConstValues.TRANSFORM],c.global),c.transform.copy(c.global),c},a.parseSkinData=function(b,c){var d=new m;d.name=b[f.ConstValues.A_NAME];var e=b[f.ConstValues.SLOT];for(var g in e){var h=e[g];d.addSlotData(a.parseSlotData(h,c))}return d},a.parseSlotData=function(b,c){var d=new k;d.name=b[f.ConstValues.A_NAME],d.parent=b[f.ConstValues.A_PARENT],d.zOrder=Number(b[f.ConstValues.A_Z_ORDER]);var e=b[f.ConstValues.DISPLAY];for(var g in e){var h=e[g];d.addDisplayData(a.parseDisplayData(h,c))}return d},a.parseDisplayData=function(b,c){var d=new j;return d.name=b[f.ConstValues.A_NAME],d.type=b[f.ConstValues.A_TYPE],d.pivot=c.addSubTexturePivot(0,0,d.name),a.parseTransform(b[f.ConstValues.TRANSFORM],d.transform,d.pivot),d},a.parseAnimationData=function(b,c,d){var e=new i;if(e.name=b[f.ConstValues.A_NAME],e.frameRate=d,e.loop=Number(b[f.ConstValues.A_LOOP])||0,e.fadeInTime=Number(b[f.ConstValues.A_FADE_IN_TIME]),e.duration=Number(b[f.ConstValues.A_DURATION])/d,e.scale=Number(b[f.ConstValues.A_SCALE]),b.hasOwnProperty(f.ConstValues.A_TWEEN_EASING)){var g=b[f.ConstValues.A_TWEEN_EASING];e.tweenEasing=g==undefined||null==g?0/0:Number(g)}else e.tweenEasing=0/0;a.parseTimeline(b,e,a.parseMainFrame,d);var h,j,k=b[f.ConstValues.TIMELINE];for(var l in k){var m=k[l];h=a.parseTransformTimeline(m,e.duration,d),j=m[f.ConstValues.A_NAME],e.addTimeline(h,j)}return f.DBDataUtil.addHideTimeline(e,c),f.DBDataUtil.transformAnimationData(e,c),e},a.parseTimeline=function(a,b,c,d){var e,g=0,h=a[f.ConstValues.FRAME];for(var i in h){var j=h[i];e=c(j,d),e.position=g,b.addFrame(e),g+=e.duration}e&&(e.duration=b.duration-e.position)},a.parseTransformTimeline=function(b,c,d){var e=new h;return e.duration=c,a.parseTimeline(b,e,a.parseTransformFrame,d),e.scale=Number(b[f.ConstValues.A_SCALE]),e.offset=Number(b[f.ConstValues.A_OFFSET]),e},a.parseFrame=function(a,b,c){b.duration=Number(a[f.ConstValues.A_DURATION])/c,b.action=a[f.ConstValues.A_ACTION],b.event=a[f.ConstValues.A_EVENT],b.sound=a[f.ConstValues.A_SOUND]},a.parseMainFrame=function(b,c){var e=new d;return a.parseFrame(b,e,c),e},a.parseTransformFrame=function(c,d){var g=new e;if(a.parseFrame(c,g,d),g.visible=1!=Number(c[f.ConstValues.A_HIDE]),c.hasOwnProperty(f.ConstValues.A_TWEEN_EASING)){var h=c[f.ConstValues.A_TWEEN_EASING];g.tweenEasing=h==undefined||null==h?0/0:Number(h)}else g.tweenEasing=0;g.tweenRotate=Number(c[f.ConstValues.A_TWEEN_ROTATE])||0,g.displayIndex=Number(c[f.ConstValues.A_DISPLAY_INDEX])||0,g.zOrder=Number(c[f.ConstValues.A_Z_ORDER])||0,a.parseTransform(c[f.ConstValues.TRANSFORM],g.global,g.pivot),g.transform.copy(g.global);var i=c[f.ConstValues.COLOR_TRANSFORM];return i&&(g.color=new b.ColorTransform,g.color.alphaOffset=Number(i[f.ConstValues.A_ALPHA_OFFSET]),g.color.redOffset=Number(i[f.ConstValues.A_RED_OFFSET]),g.color.greenOffset=Number(i[f.ConstValues.A_GREEN_OFFSET]),g.color.blueOffset=Number(i[f.ConstValues.A_BLUE_OFFSET]),g.color.alphaMultiplier=.01*Number(i[f.ConstValues.A_ALPHA_MULTIPLIER]),g.color.redMultiplier=.01*Number(i[f.ConstValues.A_RED_MULTIPLIER]),g.color.greenMultiplier=.01*Number(i[f.ConstValues.A_GREEN_MULTIPLIER]),g.color.blueMultiplier=.01*Number(i[f.ConstValues.A_BLUE_MULTIPLIER])),g},a.parseTransform=function(a,b,c){"undefined"==typeof c&&(c=null),a&&(b&&(b.x=Number(a[f.ConstValues.A_X]),b.y=Number(a[f.ConstValues.A_Y]),b.skewX=Number(a[f.ConstValues.A_SKEW_X])*f.ConstValues.ANGLE_TO_RADIAN,b.skewY=Number(a[f.ConstValues.A_SKEW_Y])*f.ConstValues.ANGLE_TO_RADIAN,b.scaleX=Number(a[f.ConstValues.A_SCALE_X]),b.scaleY=Number(a[f.ConstValues.A_SCALE_Y])),c&&(c.x=Number(a[f.ConstValues.A_PIVOT_X]),c.y=Number(a[f.ConstValues.A_PIVOT_Y])))},a}();a.DataParser=p}(a.objects||(a.objects={}));var e=a.objects;!function(b){var d=function(b){function c(){b.call(this),this._dataDic={},this._textureAtlasDic={},this._textureAtlasLoadingDic={}}return __extends(c,b),c.prototype.getSkeletonData=function(a){return this._dataDic[a]},c.prototype.addSkeletonData=function(a,b){if(!a)throw new Error;if(b=b||a.name,!b)throw new Error("Unnamed data!");this._dataDic[b],this._dataDic[b]=a},c.prototype.removeSkeletonData=function(a){delete this._dataDic[a]},c.prototype.getTextureAtlas=function(a){return this._textureAtlasDic[a]},c.prototype.addTextureAtlas=function(a,b){if(!a)throw new Error;if(b=b||a.name,!b)throw new Error("Unnamed data!");this._textureAtlasDic[b],this._textureAtlasDic[b]=a},c.prototype.removeTextureAtlas=function(a){delete this._textureAtlasDic[a]},c.prototype.dispose=function(a){if("undefined"==typeof a&&(a=!0),a){for(var b in this._dataDic)this._dataDic[b].dispose();for(var b in this._textureAtlasDic)this._textureAtlasDic[b].dispose()}this._dataDic=null,this._textureAtlasDic=null,this._textureAtlasLoadingDic=null,this._currentDataName=null,this._currentTextureAtlasName=null},c.prototype.buildArmature=function(b,c,d,f,g){if(d){var h=this._dataDic[d];if(h)var i=h.getArmatureData(b)}else for(d in this._dataDic)if(h=this._dataDic[d],i=h.getArmatureData(b))break;if(!i)return null;this._currentDataName=d,this._currentTextureAtlasName=f||d;var j=this._generateArmature(b);j.name=b;var k,l,m=i.getBoneDataList();for(var n in m)l=m[n],k=new a.Bone,k.name=l.name,k.origin.copy(l.transform),i.getBoneData(l.parent)?j.addChild(k,l.parent):j.addChild(k,null);if(c&&c!=b){var o=h.getArmatureData(c);if(!o)for(d in this._dataDic)if(h=this._dataDic[d],o=h.getArmatureData(c))break}j.animation.setAnimationDataList(o?o.getAnimationDataList():i.getAnimationDataList());var p=i.getSkinData(g);if(!p)throw new Error;var q,r,s,t,u,v,w=[],x=p.getSlotDataList();for(var n in x)if(u=x[n],k=j.getBone(u.parent)){for(v=u.getDisplayDataList(),q=this._generateSlot(),q.name=u.name,q._originZOrder=u.zOrder,q._dislayDataList=v,w.length=0,t=v.length;t--;)switch(r=v[t],r.name=""+r.name,r.type){case e.DisplayData.ARMATURE:s=this.buildArmature(r.name,null,this._currentDataName,this._currentTextureAtlasName,null),s&&(w[t]=s);break;case e.DisplayData.IMAGE:default:w[t]=this._generateDisplay(this._textureAtlasDic[this._currentTextureAtlasName],r.name,r.pivot.x,r.pivot.y)}q.setDisplayList(w),q._changeDisplay(0),k.addChild(q)}return j._slotsZOrderChanged=!0,j.advanceTime(0),j},c.prototype.getTextureDisplay=function(a,b,c,d){if(b)var e=this._textureAtlasDic[b];if(!e&&!b)for(b in this._textureAtlasDic){if(e=this._textureAtlasDic[b],e.getRegion(a))break;e=null}if(e){if(isNaN(c)||isNaN(d)){var f=this._dataDic[b];if(f){var g=f.getSubTexturePivot(a);g&&(c=g.x,d=g.y)}}return this._generateDisplay(e,a,c,d)}return null},c.prototype._generateArmature=function(){return null},c.prototype._generateSlot=function(){return null},c.prototype._generateDisplay=function(){return null},c}(c.EventDispatcher);b.BaseFactory=d}(a.factorys||(a.factorys={}));a.factorys;!function(a){var c=function(){function a(){}return a.ANGLE_TO_RADIAN=Math.PI/180,a.DRAGON_BONES="dragonBones",a.ARMATURE="armature",a.SKIN="skin",a.BONE="bone",a.SLOT="slot",a.DISPLAY="display",a.ANIMATION="animation",a.TIMELINE="timeline",a.FRAME="frame",a.TRANSFORM="transform",a.COLOR_TRANSFORM="colorTransform",a.TEXTURE_ATLAS="TextureAtlas",a.SUB_TEXTURE="SubTexture",a.A_VERSION="version",a.A_IMAGE_PATH="imagePath",a.A_FRAME_RATE="frameRate",a.A_NAME="name",a.A_PARENT="parent",a.A_LENGTH="length",a.A_TYPE="type",a.A_FADE_IN_TIME="fadeInTime",a.A_DURATION="duration",a.A_SCALE="scale",a.A_OFFSET="offset",a.A_LOOP="loop",a.A_EVENT="event",a.A_SOUND="sound",a.A_ACTION="action",a.A_HIDE="hide",a.A_TWEEN_EASING="tweenEasing",a.A_TWEEN_ROTATE="tweenRotate",a.A_DISPLAY_INDEX="displayIndex",a.A_Z_ORDER="z",a.A_WIDTH="width",a.A_HEIGHT="height",a.A_X="x",a.A_Y="y",a.A_SKEW_X="skX",a.A_SKEW_Y="skY",a.A_SCALE_X="scX",a.A_SCALE_Y="scY",a.A_PIVOT_X="pX",a.A_PIVOT_Y="pY",a.A_ALPHA_OFFSET="aO",a.A_RED_OFFSET="rO",a.A_GREEN_OFFSET="gO",a.A_BLUE_OFFSET="bO",a.A_ALPHA_MULTIPLIER="aM",a.A_RED_MULTIPLIER="rM",a.A_GREEN_MULTIPLIER="gM",a.A_BLUE_MULTIPLIER="bM",a}();a.ConstValues=c;var f=function(){function a(){}return a.transformPointWithParent=function(b,c){var d=a._helpMatrix;a.transformToMatrix(c,d),d.invert();var e=b.x,f=b.y;b.x=d.a*e+d.c*f+d.tx,b.y=d.d*f+d.b*e+d.ty,b.skewX=a.formatRadian(b.skewX-c.skewX),b.skewY=a.formatRadian(b.skewY-c.skewY)},a.transformToMatrix=function(a,b){b.a=a.scaleX*Math.cos(a.skewY),b.b=a.scaleX*Math.sin(a.skewY),b.c=-a.scaleY*Math.sin(a.skewX),b.d=a.scaleY*Math.cos(a.skewX),b.tx=a.x,b.ty=a.y},a.formatRadian=function(b){return b%=a.DOUBLE_PI,b>Math.PI&&(b-=a.DOUBLE_PI),b<-Math.PI&&(b+=a.DOUBLE_PI),b},a.DOUBLE_PI=2*Math.PI,a._helpMatrix=new b.Matrix,a}();a.TransformUtil=f;var g=function(){function a(){}return a.transformArmatureData=function(a){for(var b,c,d=a.getBoneDataList(),e=d.length;e--;)b=d[e],b.parent&&(c=a.getBoneData(b.parent),c&&(b.transform.copy(b.global),f.transformPointWithParent(b.transform,c.global)))},a.transformArmatureDataAnimations=function(b){for(var c=b.getAnimationDataList(),d=c.length;d--;)a.transformAnimationData(c[d],b)},a.transformAnimationData=function(b,c){for(var d,e,g,h,i,j,k,l,m,n,o=c.getSkinData(null),p=c.getBoneDataList(),q=o.getSlotDataList(),r=p.length;r--;)if(d=p[r],e=b.getTimeline(d.name)){g=null;for(var s in q)if(g=q[s],g.parent==d.name)break;h=d.parent?b.getTimeline(d.parent):null,i=e.getFrameList(),j=null,k=null,l=null,n=i.length;for(var t=0;n>t;t++){if(m=i[t],h?(a._helpTransform1.copy(m.global),a.getTimelineTransform(h,m.position,a._helpTransform2),f.transformPointWithParent(a._helpTransform1,a._helpTransform2),m.transform.copy(a._helpTransform1)):m.transform.copy(m.global),m.transform.x-=d.transform.x,m.transform.y-=d.transform.y,m.transform.skewX-=d.transform.skewX,m.transform.skewY-=d.transform.skewY,m.transform.scaleX-=d.transform.scaleX,m.transform.scaleY-=d.transform.scaleY,e.transformed||g&&(m.zOrder-=g.zOrder),j||(j=e.originTransform,j.copy(m.transform),j.skewX=f.formatRadian(j.skewX),j.skewY=f.formatRadian(j.skewY),k=e.originPivot,k.x=m.pivot.x,k.y=m.pivot.y),m.transform.x-=j.x,m.transform.y-=j.y,m.transform.skewX=f.formatRadian(m.transform.skewX-j.skewX),m.transform.skewY=f.formatRadian(m.transform.skewY-j.skewY),m.transform.scaleX-=j.scaleX,m.transform.scaleY-=j.scaleY,e.transformed||(m.pivot.x-=k.x,m.pivot.y-=k.y),l){var u=m.transform.skewX-l.transform.skewX;l.tweenRotate?l.tweenRotate>0?(0>u&&(m.transform.skewX+=2*Math.PI,m.transform.skewY+=2*Math.PI),l.tweenRotate>1&&(m.transform.skewX+=2*Math.PI*(l.tweenRotate-1),m.transform.skewY+=2*Math.PI*(l.tweenRotate-1))):(u>0&&(m.transform.skewX-=2*Math.PI,m.transform.skewY-=2*Math.PI),l.tweenRotate<1&&(m.transform.skewX+=2*Math.PI*(l.tweenRotate+1),m.transform.skewY+=2*Math.PI*(l.tweenRotate+1))):(m.transform.skewX=l.transform.skewX+f.formatRadian(m.transform.skewX-l.transform.skewX),m.transform.skewY=l.transform.skewY+f.formatRadian(m.transform.skewY-l.transform.skewY))}l=m}e.transformed=!0}},a.getTimelineTransform=function(a,b,c){for(var e,g,h,i,j=a.getFrameList(),k=j.length;k--;)if(e=j[k],e.position<=b&&e.position+e.duration>b){g=e.tweenEasing,k==j.length-1||isNaN(g)||b==e.position?c.copy(e.global):(h=(b-e.position)/e.duration,g&&(h=d.TimelineState.getEaseValue(h,g)),i=j[k+1],c.x=e.global.x+(i.global.x-e.global.x)*h,c.y=e.global.y+(i.global.y-e.global.y)*h,c.skewX=f.formatRadian(e.global.skewX+(i.global.skewX-e.global.skewX)*h),c.skewY=f.formatRadian(e.global.skewY+(i.global.skewY-e.global.skewY)*h),c.scaleX=e.global.scaleX+(i.global.scaleX-e.global.scaleX)*h,c.scaleY=e.global.scaleY+(i.global.scaleY-e.global.scaleY)*h);break}},a.addHideTimeline=function(a,b){for(var c,d,f=b.getBoneDataList(),g=f.length;g--;)c=f[g],d=c.name,a.getTimeline(d)||a.addTimeline(e.TransformTimeline.HIDE_TIMELINE,d)},a._helpTransform1=new e.DBTransform,a._helpTransform2=new e.DBTransform,a}();a.DBDataUtil=g}(a.utils||(a.utils={}));var f=a.utils,g=function(){function a(){this.global=new e.DBTransform,this.origin=new e.DBTransform,this.offset=new e.DBTransform,this.tween=new e.DBTransform,this.tween.scaleX=this.tween.scaleY=0,this._globalTransformMatrix=new b.Matrix,this._visible=!0,this._isColorChanged=!1,this._isDisplayOnStage=!1,this._scaleType=0,this.fixedRotation=!1}return a.prototype.getVisible=function(){return this._visible},a.prototype.setVisible=function(a){this._visible=a},a.prototype._setParent=function(a){this.parent=a},a.prototype._setArmature=function(a){this.armature&&this.armature._removeDBObject(this),this.armature=a,this.armature&&this.armature._addDBObject(this)},a.prototype.dispose=function(){this.parent=null,this.armature=null,this.global=null,this.origin=null,this.offset=null,this.tween=null,this._globalTransformMatrix=null},a.prototype._update=function(){if(this.global.scaleX=(this.origin.scaleX+this.tween.scaleX)*this.offset.scaleX,this.global.scaleY=(this.origin.scaleY+this.tween.scaleY)*this.offset.scaleY,this.parent){var a=this.origin.x+this.offset.x+this.tween.x,b=this.origin.y+this.offset.y+this.tween.y,c=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx=this.global.x=c.a*a+c.c*b+c.tx,this._globalTransformMatrix.ty=this.global.y=c.d*b+c.b*a+c.ty,this.fixedRotation?(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY):(this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX+this.parent.global.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY+this.parent.global.skewY),this.parent.scaleMode>=this._scaleType&&(this.global.scaleX*=this.parent.global.scaleX,this.global.scaleY*=this.parent.global.scaleY)}else this._globalTransformMatrix.tx=this.global.x=this.origin.x+this.offset.x+this.tween.x,this._globalTransformMatrix.ty=this.global.y=this.origin.y+this.offset.y+this.tween.y,this.global.skewX=this.origin.skewX+this.offset.skewX+this.tween.skewX,this.global.skewY=this.origin.skewY+this.offset.skewY+this.tween.skewY;this._globalTransformMatrix.a=this.global.scaleX*Math.cos(this.global.skewY),this._globalTransformMatrix.b=this.global.scaleX*Math.sin(this.global.skewY),this._globalTransformMatrix.c=-this.global.scaleY*Math.sin(this.global.skewX),this._globalTransformMatrix.d=this.global.scaleY*Math.cos(this.global.skewX)},a}();a.DBObject=g;var h=function(a){function b(b){a.call(this),this._displayBridge=b,this._displayList=[],this._displayIndex=-1,this._scaleType=1,this._originZOrder=0,this._tweenZorder=0,this._offsetZOrder=0,this._isDisplayOnStage=!1,this._isHideDisplay=!1}return __extends(b,a),b.prototype.getZOrder=function(){return this._originZOrder+this._tweenZorder+this._offsetZOrder},b.prototype.setZOrder=function(a){this.getZOrder()!=a&&(this._offsetZOrder=a-this._originZOrder-this._tweenZorder,this.armature&&(this.armature._slotsZOrderChanged=!0))},b.prototype.getDisplay=function(){var a=this._displayList[this._displayIndex];return a instanceof j?a.getDisplay():a},b.prototype.setDisplay=function(a){this._displayList[this._displayIndex]=a,this._setDisplay(a)},b.prototype.getChildArmature=function(){var a=this._displayList[this._displayIndex];return a instanceof j?a:null},b.prototype.setChildArmature=function(a){this._displayList[this._displayIndex]=a,a&&this._setDisplay(a.getDisplay())},b.prototype.getDisplayList=function(){return this._displayList},b.prototype.setDisplayList=function(a){if(!a)throw new Error;for(var b=this._displayList.length=a.length;b--;)this._displayList[b]=a[b];if(this._displayIndex>=0){var c=this._displayIndex;this._displayIndex=-1,this._changeDisplay(c)}},b.prototype._setDisplay=function(a){this._displayBridge.getDisplay()?this._displayBridge.setDisplay(a):(this._displayBridge.setDisplay(a),this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)),this.updateChildArmatureAnimation(),this._isDisplayOnStage=!this._isHideDisplay&&this._displayBridge.getDisplay()?!0:!1},b.prototype._changeDisplay=function(a){if(0>a)this._isHideDisplay||(this._isHideDisplay=!0,this._displayBridge.removeDisplay(),this.updateChildArmatureAnimation());else{if(this._isHideDisplay){this._isHideDisplay=!1;var b=!0;this.armature&&(this._displayBridge.addDisplay(this.armature.getDisplay(),-1),this.armature._slotsZOrderChanged=!0)}var c=this._displayList.length;if(a>=c&&c>0&&(a=c-1),this._displayIndex!=a){this._displayIndex=a;var d=this._displayList[this._displayIndex];this._setDisplay(d instanceof j?d.getDisplay():d),this._dislayDataList&&this._displayIndex<this._dislayDataList.length&&this.origin.copy(this._dislayDataList[this._displayIndex].transform)}else b&&this.updateChildArmatureAnimation()}this._isDisplayOnStage=!this._isHideDisplay&&this._displayBridge.getDisplay()?!0:!1},b.prototype.setVisible=function(a){a!=this._visible&&(this._visible=a,this._updateVisible(this._visible))},b.prototype._setArmature=function(b){a.prototype._setArmature.call(this,b),this.armature?(this.armature._slotsZOrderChanged=!0,this._displayBridge.addDisplay(this.armature.getDisplay(),-1)):this._displayBridge.removeDisplay()},b.prototype.dispose=function(){this._displayBridge&&(a.prototype.dispose.call(this),this._displayBridge.dispose(),this._displayList.length=0,this._displayBridge=null,this._displayList=null,this._dislayDataList=null)},b.prototype._update=function(){if(a.prototype._update.call(this),this._isDisplayOnStage){var b=this.parent._tweenPivot.x,c=this.parent._tweenPivot.y;if(b||c){var d=this.parent._globalTransformMatrix;this._globalTransformMatrix.tx+=d.a*b+d.c*c,this._globalTransformMatrix.ty+=d.b*b+d.d*c}this._displayBridge.updateTransform(this._globalTransformMatrix,this.global)}},b.prototype._updateVisible=function(a){this._displayBridge.setVisible(this.parent.getVisible()&&this._visible&&a)},b.prototype.updateChildArmatureAnimation=function(){var a=this.getChildArmature();if(a)if(this._isHideDisplay)a.animation.stop(),a.animation._lastAnimationState=null;else{var b=this.armature?this.armature.animation.getLastAnimationName():null;b&&a.animation.hasAnimation(b)?a.animation.gotoAndPlay(b):a.animation.play()}},b}(g);a.Slot=h;var i=function(a){function d(){a.call(this),this._children=[],this._scaleType=2,this._tweenPivot=new b.Point,this.scaleMode=1}return __extends(d,a),d.prototype.setVisible=function(a){if(this._visible!=a){this._visible=a;for(var b=this._children.length;b--;){var c=this._children[b];c instanceof h&&c._updateVisible(this._visible)}}},d.prototype._setArmature=function(b){a.prototype._setArmature.call(this,b);for(var c=this._children.length;c--;)this._children[c]._setArmature(this.armature)},d.prototype.dispose=function(){if(this._children){a.prototype.dispose.call(this);for(var b=this._children.length;b--;)this._children[b].dispose();this._children.length=0,this._children=null,this._tweenPivot=null,this.slot=null}},d.prototype.contains=function(a){if(!a)throw new Error;if(a==this)return!1;for(var b=a;b!=this&&null!=b;)b=b.parent;return b==this},d.prototype.addChild=function(a){if(!a)throw new Error;if(a==this||a instanceof d&&a.contains(this))throw new Error("An Bone cannot be added as a child to itself or one of its children (or children's children, etc.)");a.parent&&a.parent.removeChild(a),this._children[this._children.length]=a,a._setParent(this),a._setArmature(this.armature),!this.slot&&a instanceof h&&(this.slot=a)},d.prototype.removeChild=function(a){if(!a)throw new Error;var b=this._children.indexOf(a);if(!(b>=0))throw new Error;this._children.splice(b,1),a._setParent(null),a._setArmature(null),a==this.slot&&(this.slot=null)},d.prototype.getSlots=function(){for(var a=[],b=this._children.length;b--;)this._children[b]instanceof h&&a.unshift(this._children[b]);return a},d.prototype._arriveAtFrame=function(a,b,e){if(a){var f=e.getMixingTransform(name);if(!(!e.displayControl||2!=f&&-1!=f||this.displayController&&this.displayController!=e.name)){var g=a;if(this.slot){var i=g.displayIndex;i>=0&&(isNaN(g.zOrder)||g.zOrder==this.slot._tweenZorder||(this.slot._tweenZorder=g.zOrder,this.armature._slotsZOrderChanged=!0)),this.slot._changeDisplay(i),this.slot._updateVisible(g.visible)}}if(a.event&&this.armature.hasEventListener(c.FrameEvent.BONE_FRAME_EVENT)){var j=new c.FrameEvent(c.FrameEvent.BONE_FRAME_EVENT);j.bone=this,j.animationState=e,j.frameLabel=a.event,this.armature._eventList.push(j)}if(a.sound&&d._soundManager.hasEventListener(c.SoundEvent.SOUND)){var k=new c.SoundEvent(c.SoundEvent.SOUND);k.armature=this.armature,k.animationState=e,k.sound=a.sound,d._soundManager.dispatchEvent(k)}if(a.action)for(var l in this._children)if(this._children[l]instanceof h){var m=this._children[l].getChildArmature();m&&m.animation.gotoAndPlay(a.action)}}else this.slot&&this.slot._changeDisplay(-1)},d.prototype._updateColor=function(a,b,c,d,e,f,g,i,j){for(var k=this._children.length;k--;){var l=this._children[k];l instanceof h&&l._displayBridge.updateColor(a,b,c,d,e,f,g,i)}this._isColorChanged=j},d._soundManager=c.SoundEventManager.getInstance(),d}(g);a.Bone=i;var j=function(a){function b(b){a.call(this),this.animation=new d.Animation(this),this._display=b,this._slotsZOrderChanged=!1,this._slotList=[],this._boneList=[],this._eventList=[]}return __extends(b,a),b.prototype.getDisplay=function(){return this._display},b.prototype.dispose=function(){if(this.animation){this.animation.dispose();for(var a=this._slotList.length;a--;)this._slotList[a].dispose();for(a=this._boneList.length;a--;)this._boneList[a].dispose();this._slotList.length=0,this._boneList.length=0,this._eventList.length=0,this._slotList=null,this._boneList=null,this._eventList=null,this._display=null,this.animation=null}},b.prototype.advanceTime=function(a){this.animation.advanceTime(a),a*=this.animation.timeScale;for(var b=this._boneList.length;b--;)this._boneList[b]._update();b=this._slotList.length;for(var d;b--;)if(d=this._slotList[b],d._update(),d._isDisplayOnStage){var e=d.getChildArmature();e&&e.advanceTime(a)}if(this._slotsZOrderChanged&&(this.updateSlotsZOrder(),this.hasEventListener(c.ArmatureEvent.Z_ORDER_UPDATED)&&this.dispatchEvent(new c.ArmatureEvent(c.ArmatureEvent.Z_ORDER_UPDATED))),this._eventList.length){var f=this._eventList.length;for(b=0;f>b;b++)this.dispatchEvent(this._eventList[b]);this._eventList.length=0}},b.prototype.getSlots=function(a){return"undefined"==typeof a&&(a=!0),a?this._slotList.concat():this._slotList},b.prototype.getBones=function(a){return"undefined"==typeof a&&(a=!0),a?this._boneList.concat():this._boneList},b.prototype.getSlot=function(a){for(var b=this._slotList.length;b--;)if(this._slotList[b].name==a)return this._slotList[b];return null},b.prototype.getSlotByDisplay=function(a){if(a)for(var b=this._slotList.length;b--;)if(this._slotList[b].getDisplay()==a)return this._slotList[b];return null},b.prototype.removeSlot=function(a){if(!a)throw new Error;if(!(this._slotList.indexOf(a)>=0))throw new Error;a.parent.removeChild(a)},b.prototype.removeSlotByName=function(a){if(a){var b=this.getSlot(a);b&&this.removeSlot(b)}},b.prototype.getBone=function(a){for(var b=this._boneList.length;b--;)if(this._boneList[b].name==a)return this._boneList[b];return null},b.prototype.getBoneByDisplay=function(a){var b=this.getSlotByDisplay(a);return b?b.parent:null},b.prototype.removeBone=function(a){if(!a)throw new Error;if(!(this._boneList.indexOf(a)>=0))throw new Error;a.parent?a.parent.removeChild(a):a._setArmature(null)},b.prototype.removeBoneByName=function(a){if(a){var b=this.getBone(a);b&&this.removeBone(b)}},b.prototype.addChild=function(a,b){if(!a)throw new Error;if(b){var c=this.getBone(b);if(!c)throw new Error;c.addChild(a)}else a.parent&&a.parent.removeChild(a),a._setArmature(this)},b.prototype.updateSlotsZOrder=function(){this._slotList.sort(this.sortSlot);for(var a,b=this._slotList.length;b--;)a=this._slotList[b],a._isDisplayOnStage&&a._displayBridge.addDisplay(this._display,-1);this._slotsZOrderChanged=!1},b.prototype._addDBObject=function(a){if(a instanceof h){var b=a;this._slotList.indexOf(b)<0&&(this._slotList[this._slotList.length]=b)}else if(a instanceof i){var c=a;this._boneList.indexOf(c)<0&&(this._boneList[this._boneList.length]=c,this._sortBoneList())}},b.prototype._removeDBObject=function(a){if(a instanceof h){var b=a,c=this._slotList.indexOf(b);c>=0&&this._slotList.splice(c,1)}else if(a instanceof i){var d=a;c=this._boneList.indexOf(d),c>=0&&this._boneList.splice(c,1)}},b.prototype._sortBoneList=function(){var a=this._boneList.length;if(0!=a){for(var b,c,d,e=[];a--;){for(b=0,c=this._boneList[a],d=c;d;)b++,d=d.parent;e[a]={level:b,bone:c}}for(e.sort(this.sortBone),a=e.length;a--;)this._boneList[a]=e[a].bone}},b.prototype._arriveAtFrame=function(a,d,e){if(a.event&&this.hasEventListener(c.FrameEvent.ANIMATION_FRAME_EVENT)){var f=new c.FrameEvent(c.FrameEvent.ANIMATION_FRAME_EVENT);f.animationState=e,f.frameLabel=a.event,this._eventList.push(f)}if(a.sound&&b._soundManager.hasEventListener(c.SoundEvent.SOUND)){var g=new c.SoundEvent(c.SoundEvent.SOUND);g.armature=this,g.animationState=e,g.sound=a.sound,b._soundManager.dispatchEvent(g)}a.action&&e.isPlaying&&this.animation.gotoAndPlay(a.action)},b.prototype.sortSlot=function(a,b){return a.getZOrder()<b.getZOrder()?1:-1},b.prototype.sortBone=function(a,b){return a.level<b.level?1:-1},b._soundManager=c.SoundEventManager.getInstance(),b}(c.EventDispatcher);a.Armature=j}(dragonBones||(dragonBones={}));var dragonBones;!function(a){!function(a){var b=function(){function a(){}return a.prototype.getVisible=function(){return this._display?this._display.visible:!1},a.prototype.setVisible=function(a){this._display&&(this._display.visible=a)},a.prototype.getDisplay=function(){return this._display},a.prototype.setDisplay=function(a){
if(this._display!=a){var b=-1;if(this._display){var c=this._display.parent;c&&(b=this._display.parent.children.indexOf(this._display)),this.removeDisplay()}this._display=a,this.addDisplay(c,b)}},a.prototype.dispose=function(){this._display=null},a.prototype.updateTransform=function(a,b){this._display.x=a.tx,this._display.y=a.ty,this._display.skewX=b.skewX,this._display.skewY=b.skewY,this._display.scaleX=b.scaleX,this._display.scaleY=b.scaleY},a.prototype.updateColor=function(a,b,c,d,e){this._display&&(this._display.alpha=e)},a.prototype.addDisplay=function(a,b){var c=a;c&&this._display&&(0>b||"undefined"==typeof b?(this._display.parent===c&&c.removeChild(this._display),c.addChild(this._display)):c.addChildAt(this._display,Math.min(b,c.children.length)))},a.prototype.removeDisplay=function(){this._display&&this._display.parent&&this._display.parent.removeChild(this._display)},a.RADIAN_TO_ANGLE=180/Math.PI,a}();a.QcDisplayBridge=b}(a.display||(a.display={}));var b=a.display;!function(b){var c=function(){function b(a,b,c){"undefined"==typeof c&&(c=1),this._regions={},this.image=a,this.scale=c,this.atlasId=b.atlasId,this.parseData(b)}return b.prototype.dispose=function(){this.image=null,this._regions=null},b.prototype.getRegion=function(a){return this._regions[a]},b.prototype.parseData=function(b){var c=a.objects.DataParser.parseTextureAtlasData(b,this.scale);this.name=c.__name,delete c.__name;for(var d in c)this._regions[d]=c[d]},b}();b.QcBonesAtlas=c}(a.textures||(a.textures={}));a.textures;!function(c){var d=function(c){function d(){c.call(this)}return __extends(d,c),d.prototype._generateArmature=function(b){var c=new qc.Node(new Phaser.Group(a.game,null)),d=new a.Armature(c);return c.name=b,c._bone=!0,d},d.prototype._generateSlot=function(){var c=new a.Slot(new b.QcDisplayBridge);return c},d.prototype._generateDisplay=function(b,c,d,e){var f=new qc.UIImage(a.game._qc),g=b.atlasId;return f.texture=f.game.assets.find(g),f.frame=c,f.name=c,f._bone=!0,f.resetNativeSize(),f.pivotX=d/f.width,f.pivotY=e/f.height,f.parent&&f.parent.removeChild(f),f},d}(c.BaseFactory);c.QcBonesFactory=d}(a.factorys||(a.factorys={}));a.factorys}(dragonBones||(dragonBones={})),dragonBones.CoverAtlas=function(a){for(var b,c,d={meta:{image:a.imagePath},frames:b={}},e=a.SubTexture,f=e.length,g=0;f>g;g++)c=e[g],b[c.name]={filename:c.name,frame:{x:c.x,y:c.y,w:c.width,h:c.height},rotated:!1,trimmed:!1,spriteSourceSize:{x:0,y:0,w:c.width,h:c.height},sourceSize:{w:c.width,h:c.height}};return d},dragonBones.findArmature=function(a){return a.armature[0].name},dragonBones.makeQcArmature=function(a,b,c,d){b.name=d,a.name=d;var e=b;e.atlasId=e.name;var f=new dragonBones.factorys.QcBonesFactory;f.addSkeletonData(dragonBones.objects.DataParser.parseSkeletonData(a));var g=new dragonBones.textures.QcBonesAtlas(c,e);f.addTextureAtlas(g);var h=f.buildArmature(dragonBones.findArmature(a));return h},qc.dragonBones=dragonBones,qc.dragonBonesDriver=function(a){qc.dragonBones.game=a},qc.dragonBonesDriver.prototype={update:function(){}},qc.dragonBonesDriver.prototype.constructor=qc.dragonBonesDriver,qc.Transition={NONE:0,COLOR_TINT:1,TEXTURE_SWAP:2,ANIMATION:3},qc.UIState={NORMAL:0,PRESSED:1,DISABLED:2},qc.Util={findClass:function(a){for(var b=a.split("."),c=window,d=0;d<b.length-1;d++){if(!c[b[d]])return;c=c[b[d]]}return c[b[b.length-1]]},clone:function(a){if(null===a||"object"!=typeof a)return a;var b=new a.constructor;for(var c in a)a.hasOwnProperty(c)&&(b[c]=a[c]);return b},isArray:Array.isArray||function(a){return"[object Array]"===toString.call(a)},removeHTML:function(){var a;return function(b){if(b&&b.parentNode){if(a===b)return;a=b,b.parentNode.removeChild(b),a=null}}}(),updateTransform:function(a,b){var c=a.game,d=c.phaser.scale.scaleFactorInversed,e=b.style,f=a.rect,g=a.worldTransform,h=(-f.x).toFixed(5)+"px "+(-f.y).toFixed(5)+"px",i="matrix("+(g.a*d.x).toFixed(5)+","+(g.b*d.x).toFixed(5)+","+(g.c*d.y).toFixed(5)+","+(g.d*d.y).toFixed(5)+","+(g.tx*d.x).toFixed(0)+","+(g.ty*d.y).toFixed(0)+")";e.left=f.x.toFixed(5)+"px",e.top=f.y.toFixed(5)+"px",e.width=f.width.toFixed(5)+"px",e.height=f.height.toFixed(5)+"px",e.webkitTransform=i,e.mozTransform=i,e.msTransform=i,e.oTransform=i,e.transform=i,e.webkitTransformOrigin=h,e.mozTransformOrigin=h,e.msTransformOrigin=h,e.oTransformOrigin=h,e.transformOrigin=h},formatString:function(a){var b=arguments;return b.length<=1?qc.Util.formatValue(a).replace(/^\'|\'$/g,""):a.replace(/\{(\d+)\}/g,function(a,c){return qc.Util.formatValue(b[parseInt(c)+1]).replace(/^\'|\'$/g,"")})},popupError:function(a){if(window.parent&&window.parent.G&&window.parent.G.notification){var b=window.parent.G,c=qc.Util.formatString(b._("Exception notification"),a);b.notification.error(c)}else{var c="Error: "+a;if("undefined"!=typeof qici&&qici.config){var d=qici.config.gameInstance,e=window[d];e&&(e.log.error(c),e.debug.on&&alert(c))}else console.trace(c)}},formatValue:function(a,b,c){"number"!=typeof b&&(b=0),c=c||[];var d=function(a){if(a===undefined)return"undefined";if(null===a)return"null";var b=typeof a,c=Object.prototype.toString.call(a);if("string"===b){var d="'"+JSON.stringify(a).replace(/^"|"$/g,"").replace(/'/g,"\\'").replace(/\\"/g,'"')+"'";return d}if("number"===b)return 0===a&&0>1/a?"-0":""+a;if("boolean"===b)return""+a;if("symbol"===b)return a.toString();if("function"===b){var e=a.name?":"+a.name:"";return"[Function"+e+"]"}return"[object RegExp]"===c?"[RegExp: "+RegExp.prototype.toString.call(a)+"]":"[object Error]"===c?"[Error: "+a.stack+"]":"[object Date]"===c?"[Date: "+Date.prototype.toString.call(a)+"]":void 0},e=d(a);if(e)return e;var f=Object.keys(a);if(0===f.length){var g=a;try{g=a.valueOf()}catch(h){}if(e=d(g))return e}var i,j,k=function(a,b,c,d){for(var e=[],f=0,g=a.length;g>f;++f)e.push(Object.prototype.hasOwnProperty.call(a,String(f))?m(d,a,b,String(f),!0):"");return c.forEach(function(c){"symbol"!=typeof c&&c.match(/^\d+$/)||e.push(m(d,a,b,c,!0))}),e},l=function(a,b,c,d){return c.map(function(c){return m(d,a,b,c,!1)})};if(Array.isArray(a)?(i=["[","]"],j=k):(i=["{","}"],j=l),0===f.length)return i[0]+""+i[1];var m=function(a,b,c,d,e){var f,g,h;return h=Object.getOwnPropertyDescriptor(b,d)||{value:b[d]},h.get?g=h.set?"[Getter/Setter]":"[Getter]":h.set&&(g="[Setter]"),g||(a.indexOf(h.value)<0?(g=null===c?qc.Util.formatValue(h.value,null,a):qc.Util.formatValue(h.value,c-1,a),g.indexOf("\n")>-1&&(g=e?g.split("\n").map(function(a){return"  "+a}).join("\n").substr(2):"\n"+g.split("\n").map(function(a){return"   "+a}).join("\n"))):g="[Circular]"),e&&d.match(/^\d+$/)?g:(f=JSON.stringify(""+d),f=f.match(/^"([a-zA-Z_][a-zA-Z_0-9]*)"$/)?f.substr(1,f.length-2):f.replace(/'/g,"\\'").replace(/\\"/g,'"').replace(/(^"|"$)/g,"'").replace(/\\\\/g,"\\"),f+": "+g)};if(0>b){var n="Object";return Array.isArray(a)?n="Array":(a["class"]&&"string"==typeof a["class"]&&(n=a["class"]),a.name&&"string"==typeof a["class"]&&(n=n+"("+a.name+")")),"["+n+"]"}c.push(a);var o=j(a,b,f,c);c.pop();var p=function(a,b){var c=a.reduce(function(a,b){return a+b.replace(/\u001b\[\d\d?m/g,"").length+1},0);return c>60?b[0]+(1===b[0].length?"":"\n ")+" "+a.join(",\n  ")+" "+b[1]:b[0]+" "+a.join(", ")+" "+b[1]};return p(o,i)},insertSortedList:function(a,b,c,d){var e,f=function(a,b,c){var d=0,e=a.length-1;if(0>e)return-1;for(var f=0;e>d;)f=Math.floor((d+e)/2),c(a[f],b)?d=f+1:e=f;return c(a[d],b)?-1:d},g=f(a,b,c);return e=d?0>g?a.push(b)-1:a.splice(g,0,b)&&g:0>g?a.push(b)-1:a.splice(g,c(b,a[g])?0:1,b)&&g}},window.onerror=function(a){qc.Util.popupError(a)};var Color=qc.Color=function(a){if(this.alpha=1,this._rgb=[255,255,255],null!=a)if("number"==typeof a)this._rgb[0]=a>>16&255,this._rgb[1]=a>>8&255,this._rgb[2]=255&a,this.alpha=(a>>>24)/255;else if(qc.Util.isArray(a))this.rgb=a;else{if("string"!=typeof a)throw new Error("Invalid color");if(a=a.toLowerCase(),0===a.indexOf("rgb"))var b=Phaser.Color.webToColor(a);else{var b=this._hexToColor(a);b.a=b.a/255}this._rgb[0]=b.r,this._rgb[1]=b.g,this._rgb[2]=b.b,this.alpha=b.a}};Color.prototype={},Color.prototype.constructor=Color,Object.defineProperties(Color.prototype,{alpha:{get:function(){return this._alpha},set:function(a){(0>a||a>1)&&(a=1),this._alpha=a}},rgb:{get:function(){return this._rgb},set:function(a){if(!qc.Util.isArray(a))throw new Error("Expected:Array");if(a.length<3)throw new Error("Invalid rgb");this._rgb[0]=a[0],this._rgb[1]=a[1],this._rgb[2]=a[2],this.alpha=4===a.length?a[3]:1}},r:{get:function(){return this._rgb[0]},set:function(a){this._rgb[0]=a}},g:{get:function(){return this._rgb[1]},set:function(a){this._rgb[1]=a}},b:{get:function(){return this._rgb[2]},set:function(a){this._rgb[2]=a}},"class":{get:function(){return"qc.Color"}}}),Color.prototype.toString=function(a){switch(a){case"#rgb":return"#"+Phaser.Color.componentToHex(this._rgb[0])+Phaser.Color.componentToHex(this._rgb[1])+Phaser.Color.componentToHex(this._rgb[2]);case"#argb":return"#"+Phaser.Color.componentToHex(Math.round(255*this.alpha))+Phaser.Color.componentToHex(this._rgb[0])+Phaser.Color.componentToHex(this._rgb[1])+Phaser.Color.componentToHex(this._rgb[2]);case"rgb":return"rgb("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+")";default:return"rgba("+this._rgb[0].toString()+","+this._rgb[1].toString()+","+this._rgb[2].toString()+","+this.alpha+")"}},Color.prototype.toNumber=function(a){return a?(255*this.alpha<<24|this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0:(this._rgb[0]<<16|this._rgb[1]<<8|this._rgb[2])>>>0},Color.prototype._hexToColor=function(a){if(a.length<=0||"#"!==a[0])return{r:255,g:255,b:255,a:255};a=a.substr(1,a.length-1);var b=!1;if(a.length>6&&a.length<=8)for(b=!0;a.length<8;)a="0"+a;for(;a.length<6;)a="0"+a;var c=255,d=0;b&&(c=parseInt(a.substr(d,2),16),d+=2);var e=parseInt(a.substr(d,2),16);d+=2;var f=parseInt(a.substr(d,2),16);d+=2;var g=parseInt(a.substr(d,2),16);return{r:e,g:f,b:g,a:c}},Color.black=new Color(4278190080),Color.white=new Color(4294967295),Color.red=new Color(4294901760),Color.yellow=new Color(4294967040),Color.blue=new Color(4278255615),Color.green=new Color(4278255360),Color.grey=new Color(4291611852),Color.shadow=new Color(2147483648),Color.background=new Color(4282861383),qc.CanvasPool={pool:{},unused:[],cookie:19870101,get:function(a){var b=qc.CanvasPool.pool,c=b[a],d=!1;if(!c){d=!0;var e=qc.CanvasPool.unused;b[a]=c=e.length?e.pop():Phaser.Canvas.create(1,1)}return c._cookie=qc.CanvasPool.cookie,{canvas:c,dirty:d}},stat:function(){var a=0,b=0,c=qc.CanvasPool.pool;for(var d in c){var e=c[d];e&&(a++,b+=e.width*e.height)}console.info("当前Canvas使用中："+a+"，总像素为："+b+"，未使用的Canvas数量："+qc.CanvasPool.unused.length)},postRender:function(){var a=qc.CanvasPool,b=a.cookie;a.cookie=b+1;for(var c=a.pool,d=a.unused,e=Object.keys(c),f=0,g=e.length;g>f;f++){var h=e[f],i=c[h];i._cookie!==b&&(delete c[h],i.width=1,i.height=1,d.push(i))}}};var appCache=window.applicationCache;if(appCache){var logEvent=function(){},logError=function(){};appCache.addEventListener("cached",logEvent,!1),appCache.addEventListener("checking",logEvent,!1),appCache.addEventListener("downloading",logEvent,!1),appCache.addEventListener("error",logError,!1),appCache.addEventListener("noupdate",logEvent,!1),appCache.addEventListener("obsolete",logEvent,!1),appCache.addEventListener("progress",logEvent,!1),appCache.addEventListener("updateready",logEvent,!1)}var pc2bytes0=new Array(0,4,536870912,536870916,65536,65540,536936448,536936452,512,516,536871424,536871428,66048,66052,536936960,536936964),pc2bytes1=new Array(0,1,1048576,1048577,67108864,67108865,68157440,68157441,256,257,1048832,1048833,67109120,67109121,68157696,68157697),pc2bytes2=new Array(0,8,2048,2056,16777216,16777224,16779264,16779272,0,8,2048,2056,16777216,16777224,16779264,16779272),pc2bytes3=new Array(0,2097152,134217728,136314880,8192,2105344,134225920,136323072,131072,2228224,134348800,136445952,139264,2236416,134356992,136454144),pc2bytes4=new Array(0,262144,16,262160,0,262144,16,262160,4096,266240,4112,266256,4096,266240,4112,266256),pc2bytes5=new Array(0,1024,32,1056,0,1024,32,1056,33554432,33555456,33554464,33555488,33554432,33555456,33554464,33555488),pc2bytes6=new Array(0,268435456,524288,268959744,2,268435458,524290,268959746,0,268435456,524288,268959744,2,268435458,524290,268959746),pc2bytes7=new Array(0,65536,2048,67584,536870912,536936448,536872960,536938496,131072,196608,133120,198656,537001984,537067520,537004032,537069568),pc2bytes8=new Array(0,262144,0,262144,2,262146,2,262146,33554432,33816576,33554432,33816576,33554434,33816578,33554434,33816578),pc2bytes9=new Array(0,268435456,8,268435464,0,268435456,8,268435464,1024,268436480,1032,268436488,1024,268436480,1032,268436488),pc2bytes10=new Array(0,32,0,32,1048576,1048608,1048576,1048608,8192,8224,8192,8224,1056768,1056800,1056768,1056800),pc2bytes11=new Array(0,16777216,512,16777728,2097152,18874368,2097664,18874880,67108864,83886080,67109376,83886592,69206016,85983232,69206528,85983744),pc2bytes12=new Array(0,4096,134217728,134221824,524288,528384,134742016,134746112,16,4112,134217744,134221840,524304,528400,134742032,134746128),pc2bytes13=new Array(0,4,256,260,0,4,256,260,1,5,257,261,1,5,257,261),spfunction1=new Array(16843776,0,65536,16843780,16842756,66564,4,65536,1024,16843776,16843780,1024,16778244,16842756,16777216,4,1028,16778240,16778240,66560,66560,16842752,16842752,16778244,65540,16777220,16777220,65540,0,1028,66564,16777216,65536,16843780,4,16842752,16843776,16777216,16777216,1024,16842756,65536,66560,16777220,1024,4,16778244,66564,16843780,65540,16842752,16778244,16777220,1028,66564,16843776,1028,16778240,16778240,0,65540,66560,0,16842756),spfunction2=new Array(-2146402272,-2147450880,32768,1081376,1048576,32,-2146435040,-2147450848,-2147483616,-2146402272,-2146402304,-2147483648,-2147450880,1048576,32,-2146435040,1081344,1048608,-2147450848,0,-2147483648,32768,1081376,-2146435072,1048608,-2147483616,0,1081344,32800,-2146402304,-2146435072,32800,0,1081376,-2146435040,1048576,-2147450848,-2146435072,-2146402304,32768,-2146435072,-2147450880,32,-2146402272,1081376,32,32768,-2147483648,32800,-2146402304,1048576,-2147483616,1048608,-2147450848,-2147483616,1048608,1081344,0,-2147450880,32800,-2147483648,-2146435040,-2146402272,1081344),spfunction3=new Array(520,134349312,0,134348808,134218240,0,131592,134218240,131080,134217736,134217736,131072,134349320,131080,134348800,520,134217728,8,134349312,512,131584,134348800,134348808,131592,134218248,131584,131072,134218248,8,134349320,512,134217728,134349312,134217728,131080,520,131072,134349312,134218240,0,512,131080,134349320,134218240,134217736,512,0,134348808,134218248,131072,134217728,134349320,8,131592,131584,134217736,134348800,134218248,520,134348800,131592,8,134348808,131584),spfunction4=new Array(8396801,8321,8321,128,8396928,8388737,8388609,8193,0,8396800,8396800,8396929,129,0,8388736,8388609,1,8192,8388608,8396801,128,8388608,8193,8320,8388737,1,8320,8388736,8192,8396928,8396929,129,8388736,8388609,8396800,8396929,129,0,0,8396800,8320,8388736,8388737,1,8396801,8321,8321,128,8396929,129,1,8192,8388609,8193,8396928,8388737,8193,8320,8388608,8396801,128,8388608,8192,8396928),spfunction5=new Array(256,34078976,34078720,1107296512,524288,256,1073741824,34078720,1074266368,524288,33554688,1074266368,1107296512,1107820544,524544,1073741824,33554432,1074266112,1074266112,0,1073742080,1107820800,1107820800,33554688,1107820544,1073742080,0,1107296256,34078976,33554432,1107296256,524544,524288,1107296512,256,33554432,1073741824,34078720,1107296512,1074266368,33554688,1073741824,1107820544,34078976,1074266368,256,33554432,1107820544,1107820800,524544,1107296256,1107820800,34078720,0,1074266112,1107296256,524544,33554688,1073742080,524288,0,1074266112,34078976,1073742080),spfunction6=new Array(536870928,541065216,16384,541081616,541065216,16,541081616,4194304,536887296,4210704,4194304,536870928,4194320,536887296,536870912,16400,0,4194320,536887312,16384,4210688,536887312,16,541065232,541065232,0,4210704,541081600,16400,4210688,541081600,536870912,536887296,16,541065232,4210688,541081616,4194304,16400,536870928,4194304,536887296,536870912,16400,536870928,541081616,4210688,541065216,4210704,541081600,0,541065232,16,16384,541065216,4210704,16384,4194320,536887312,0,541081600,536870912,4194320,536887312),spfunction7=new Array(2097152,69206018,67110914,0,2048,67110914,2099202,69208064,69208066,2097152,0,67108866,2,67108864,69206018,2050,67110912,2099202,2097154,67110912,67108866,69206016,69208064,2097154,69206016,2048,2050,69208066,2099200,2,67108864,2099200,67108864,2099200,2097152,67110914,67110914,69206018,69206018,2,2097154,67108864,67110912,2097152,69208064,2050,2099202,69208064,2050,67108866,69208066,69206016,2099200,0,2,69208066,0,2099202,69206016,2048,67108866,67110912,2048,2097154),spfunction8=new Array(268439616,4096,262144,268701760,268435456,268439616,64,268435456,262208,268697600,268701760,266240,268701696,266304,4096,64,268697600,268435520,268439552,4160,266240,262208,268697664,268701696,4160,0,0,268697664,268435520,268439552,266304,262144,266304,262144,268701696,4096,64,268697664,4096,266304,268439552,64,268435520,268697600,268697664,268435456,262144,268439616,0,268701760,262208,268435520,268697600,268439552,268439616,0,268701760,266240,266240,4160,4160,262208,268435456,268701696);qc.Des={encrypt:function(a,b,c,d,e){return qc.Des._des(a,b,!0,c,d,e)},decrypt:function(a,b,c,d,e){return qc.Des._des(a,b,!1,c,d,e)},_des:function(a,b,c,d,e,f){var g,h,i,j,k,l,m,n,o,p,q,r,s,t,u=qc.Des.des_createKeys(a),v=0,w=b.length,x=0,y=32==u.length?3:9;n=3==y?c?new Array(0,32,2):new Array(30,-2,-2):c?new Array(0,32,2,62,30,-2,64,96,2):new Array(94,62,-2,32,64,2,30,-2,-2),2==f?b+="        ":1==f?(i=8-w%8,b+=String.fromCharCode(i,i,i,i,i,i,i,i),8==i&&(w+=8)):f||(b+="\x00\x00\x00\x00\x00\x00\x00\x00");var z="",A="";for(1==d&&(o=e.charCodeAt(v++)<<24|e.charCodeAt(v++)<<16|e.charCodeAt(v++)<<8|e.charCodeAt(v++),q=e.charCodeAt(v++)<<24|e.charCodeAt(v++)<<16|e.charCodeAt(v++)<<8|e.charCodeAt(v++),v=0);w>v;){for(l=b.charCodeAt(v++)<<24|b.charCodeAt(v++)<<16|b.charCodeAt(v++)<<8|b.charCodeAt(v++),m=b.charCodeAt(v++)<<24|b.charCodeAt(v++)<<16|b.charCodeAt(v++)<<8|b.charCodeAt(v++),1==d&&(c?(l^=o,m^=q):(p=o,r=q,o=l,q=m)),i=252645135&(l>>>4^m),m^=i,l^=i<<4,i=65535&(l>>>16^m),m^=i,l^=i<<16,i=858993459&(m>>>2^l),l^=i,m^=i<<2,i=16711935&(m>>>8^l),l^=i,m^=i<<8,i=1431655765&(l>>>1^m),m^=i,l^=i<<1,l=l<<1|l>>>31,m=m<<1|m>>>31,h=0;y>h;h+=3){for(s=n[h+1],t=n[h+2],g=n[h];g!=s;g+=t)j=m^u[g],k=(m>>>4|m<<28)^u[g+1],i=l,l=m,m=i^(spfunction2[j>>>24&63]|spfunction4[j>>>16&63]|spfunction6[j>>>8&63]|spfunction8[63&j]|spfunction1[k>>>24&63]|spfunction3[k>>>16&63]|spfunction5[k>>>8&63]|spfunction7[63&k]);i=l,l=m,m=i}l=l>>>1|l<<31,m=m>>>1|m<<31,i=1431655765&(l>>>1^m),m^=i,l^=i<<1,i=16711935&(m>>>8^l),l^=i,m^=i<<8,i=858993459&(m>>>2^l),l^=i,m^=i<<2,i=65535&(l>>>16^m),m^=i,l^=i<<16,i=252645135&(l>>>4^m),m^=i,l^=i<<4,1==d&&(c?(o=l,q=m):(l^=p,m^=r)),A+=String.fromCharCode(l>>>24,l>>>16&255,l>>>8&255,255&l,m>>>24,m>>>16&255,m>>>8&255,255&m),x+=8,512==x&&(z+=A,A="",x=0)}return z+A},des_createKeys:function(a){for(var b,c,d,e=a.length>8?3:1,f=new Array(32*e),g=new Array(0,0,1,1,1,1,1,1,0,1,1,1,1,1,1,0),h=0,i=0,j=0;e>j;j++){var k=a.charCodeAt(h++)<<24|a.charCodeAt(h++)<<16|a.charCodeAt(h++)<<8|a.charCodeAt(h++),l=a.charCodeAt(h++)<<24|a.charCodeAt(h++)<<16|a.charCodeAt(h++)<<8|a.charCodeAt(h++);d=252645135&(k>>>4^l),l^=d,k^=d<<4,d=65535&(l>>>-16^k),k^=d,l^=d<<-16,d=858993459&(k>>>2^l),l^=d,k^=d<<2,d=65535&(l>>>-16^k),k^=d,l^=d<<-16,d=1431655765&(k>>>1^l),l^=d,k^=d<<1,d=16711935&(l>>>8^k),k^=d,l^=d<<8,d=1431655765&(k>>>1^l),l^=d,k^=d<<1,d=k<<8|l>>>20&240,k=l<<24|l<<8&16711680|l>>>8&65280|l>>>24&240,l=d;for(var m=0;m<g.length;m++)g[m]?(k=k<<2|k>>>26,l=l<<2|l>>>26):(k=k<<1|k>>>27,l=l<<1|l>>>27),k&=-15,l&=-15,b=pc2bytes0[k>>>28]|pc2bytes1[k>>>24&15]|pc2bytes2[k>>>20&15]|pc2bytes3[k>>>16&15]|pc2bytes4[k>>>12&15]|pc2bytes5[k>>>8&15]|pc2bytes6[k>>>4&15],c=pc2bytes7[l>>>28]|pc2bytes8[l>>>24&15]|pc2bytes9[l>>>20&15]|pc2bytes10[l>>>16&15]|pc2bytes11[l>>>12&15]|pc2bytes12[l>>>8&15]|pc2bytes13[l>>>4&15],d=65535&(c>>>16^b),f[i++]=b^d,f[i++]=c^d<<16}return f}},Phaser.Game.prototype.update=function(a){var b=Date.now();this._qc.update(a),this._qc.debug.total+=Date.now()-b};var phaser_setUpRenderer=Phaser.Game.prototype.setUpRenderer;Phaser.Game.prototype.setUpRenderer=function(){!this.device.webGL||this.device.desktop||this.device.iOS||qc.isSupportWebGL&&!qc.isSupportWebGL(this._qc)&&(this.device.webGL=!1),phaser_setUpRenderer.call(this)},Phaser.Group.prototype.preUpdate=function(){var a=this._qc;if(a&&a["static"])return!0;if(a){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.preUpdate(),!this.visible))return}}for(var e=this.children,c=e.length;c--;)e[c]&&(e[c].visible?e[c].preUpdate():e[c].renderOrderID=-1);return!0},Phaser.Group.prototype.update=function(){var a=this._qc;if(a&&a["static"])return!0;if(a){a.update&&a.update();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.update&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.update(),!this.visible))return}}for(var e=this.children,c=e.length;c--;)e[c]&&e[c].visible&&e[c].update()},Phaser.Group.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var a=this._qc;if(!a||!a["static"]){if(a){a.postUpdate&&a.postUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.postUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.postUpdate(),!this.visible))return}}for(var e=this.children,c=e.length;c--;)e[c]&&e[c].visible&&e[c].postUpdate()}},Phaser.StateManager.prototype.loadComplete=function(){var a=this;if(a._created!==!0){var b=a.game._qc;return b.assets.parsing||b.state.pendLoadComplete?void b.timer.add(15,function(){a.loadComplete()}):void(a._created===!1&&a.onCreateCallback?(a._created=!0,a.onCreateCallback.call(a.callbackContext,a.game)):a._created=!0)}};var oldClearCurrentState=Phaser.StateManager.prototype.clearCurrentState;Phaser.StateManager.prototype.clearCurrentState=function(){oldClearCurrentState.call(this),this.game.world.displayChanged(qc.DisplayChangeStatus.SIZE)};var oldDeviceInitialize=Phaser.Device._initialize;Phaser.Device._initialize=function(){oldDeviceInitialize.call(this);var a=window.navigator.userAgent;this.UCBrowser=/UCBrowser/.test(a),this.iOS&&(navigator.appVersion.match(/OS (\d+)/),this.iOSVersion=parseInt(RegExp.$1,10));var b=/AppleWebKit\/([0-9\.]+)/,c=b.exec(navigator.userAgent);c&&c.length>0?(this.AppleWebKit=!0,this.AppleWebKitVersion=c[1].split(".")):this.AppleWebKit=!1,this.supportStencil=!this.AppleWebKit||this.AppleWebKitVersion[0]>534,this.android&&this.UCBrowser&&(qc.__IS_ANDROID_UC=!0)},Phaser.Animation=function(a,b,c,d,e,f,g){"undefined"==typeof g&&(g=!1),this.game=a,this._parent=b,this._frameData=d,this.name=c,this._frames=[],this._frames=this._frames.concat(e),this.delay=1e3/f,this.loop=g,this.loopCount=0,this.killOnComplete=!1,this.isFinished=!1,this.isPlaying=!1,this.isPaused=!1,this._pauseStartTime=0,this._frameIndex=0,this._frameDiff=0,this._frameSkip=1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.onStart=new Phaser.Signal,this.onUpdate=null,this.onComplete=new Phaser.Signal,this.onLoop=new Phaser.Signal,this.game.onPause.add(this.onPause,this),this.game.onResume.add(this.onResume,this)},Phaser.Animation.prototype={play:function(a,b,c){return"number"==typeof a&&(this.delay=1e3/a),"boolean"==typeof b&&(this.loop=b),"undefined"!=typeof c&&(this.killOnComplete=c),this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.updateCurrentFrame(!1),this._parent.events.onAnimationStart$dispatch(this._parent,this),this.onStart.dispatch(this._parent,this),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this},restart:function(){this.isPlaying=!0,this.isFinished=!1,this.paused=!1,this.loopCount=0,this._timeLastFrame=this.game.time.time,this._timeNextFrame=this.game.time.time+this.delay,this._frameIndex=0,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this._parent.setFrame(this.currentFrame),this._parent.animations.currentAnim=this,this._parent.animations.currentFrame=this.currentFrame,this.onStart.dispatch(this._parent,this)},setFrame:function(a,b){var c;if("undefined"==typeof b&&(b=!1),"string"==typeof a)for(var d=0;d<this._frames.length;d++)this._frameData&&this._frameData.getFrame(this._frames[d]).name===a&&(c=d);else if("number"==typeof a)if(b)c=a;else for(var d=0;d<this._frames.length;d++)this._frames[d]===c&&(c=d);c&&(this._frameIndex=c-1,this._timeNextFrame=this.game.time.time,this.update())},stop:function(a,b){"undefined"==typeof a&&(a=!1),"undefined"==typeof b&&(b=!1),this.isPlaying=!1,this.isFinished=!0,this.paused=!1,a&&(this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[0]):0,this._parent.setFrame(this.currentFrame)),b&&(this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this))},onPause:function(){this.isPlaying&&(this._frameDiff=this._timeNextFrame-this.game.time.time)},onResume:function(){this.isPlaying&&(this._timeNextFrame=this.game.time.time+this._frameDiff)},update:function(){return this.isPaused?!1:this.isPlaying&&this.game.time.time>=this._timeNextFrame?(this._frameSkip=1,this._frameDiff=this.game.time.time-this._timeNextFrame,this._timeLastFrame=this.game.time.time,this._frameDiff>this.delay&&(this._frameSkip=Math.floor(this._frameDiff/this.delay),this._frameDiff-=this._frameSkip*this.delay,this._frameSkip+=1),this._timeNextFrame=this.game.time.time+(this.delay-this._frameDiff),this._frameIndex+=this._frameSkip,this._frameIndex>=this._frames.length?this.loop?(this._frameIndex%=this._frames.length,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.loopCount++,this._parent.events.onAnimationLoop$dispatch(this._parent,this),this.onLoop.dispatch(this._parent,this),this.updateCurrentFrame(!0)):(this.complete(),!1):this.updateCurrentFrame(!0)):!1},updateCurrentFrame:function(a){return this._frameData?(this.currentFrame=this._frameData.getFrame(this._frames[this._frameIndex]),this.currentFrame&&(this._parent.setFrame(this.currentFrame),this._parent.__tilePattern&&(this._parent.__tilePattern=!1,this._parent.tilingTexture=!1)),this.onUpdate&&a?(this.onUpdate.dispatch(this,this.currentFrame),!!this._frameData):!0):!1},next:function(a){"undefined"==typeof a&&(a=1);var b=this._frameIndex+a;b>=this._frames.length&&(this.loop?b%=this._frames.length:b=this._frames.length-1),b!==this._frameIndex&&(this._frameIndex=b,this.updateCurrentFrame(!0))},previous:function(a){"undefined"==typeof a&&(a=1);var b=this._frameIndex-a;0>b&&(this.loop?b=this._frames.length+b:b++),b!==this._frameIndex&&(this._frameIndex=b,this.updateCurrentFrame(!0))},updateFrameData:function(a){this._frameData=a,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex%this._frames.length]):this._frameIndex%this._frames.length},destroy:function(){this.game&&(this.game.onPause.remove(this.onPause,this),this.game.onResume.remove(this.onResume,this),this.game=null,this._parent=null,this._frames=null,this._frameData=null,this.currentFrame=null,this.isPlaying=!1,this.onStart.dispose(),this.onLoop.dispose(),this.onComplete.dispose(),this.onUpdate&&this.onUpdate.dispose())},complete:function(){this._frameIndex=this._frames.length-1,this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[this._frameIndex]):this._frameIndex,this.isPlaying=!1,this.isFinished=!0,this.paused=!1,this._parent.events.onAnimationComplete$dispatch(this._parent,this),this.onComplete.dispatch(this._parent,this),this.killOnComplete&&this._parent.kill()}},Phaser.Animation.prototype.constructor=Phaser.Animation,Object.defineProperty(Phaser.Animation.prototype,"paused",{get:function(){return this.isPaused},set:function(a){this.isPaused=a,a?this._pauseStartTime=this.game.time.time:this.isPlaying&&(this._timeNextFrame=this.game.time.time+this.delay)}}),Object.defineProperty(Phaser.Animation.prototype,"frameTotal",{get:function(){return this._frames.length}}),Object.defineProperty(Phaser.Animation.prototype,"frame",{get:function(){return null!==this.currentFrame?this.currentFrame.index:this._frameIndex},set:function(a){this.currentFrame=this._frameData?this._frameData.getFrame(this._frames[a]):a,null!==this.currentFrame&&(this._frameIndex=a,this._parent.setFrame(this.currentFrame),this.onUpdate&&this.onUpdate.dispatch(this,this.currentFrame))}}),Object.defineProperty(Phaser.Animation.prototype,"speed",{get:function(){return Math.round(1e3/this.delay)},set:function(a){a>=1&&(this.delay=1e3/a)}}),Object.defineProperty(Phaser.Animation.prototype,"enableUpdate",{get:function(){return null!==this.onUpdate},set:function(a){a&&null===this.onUpdate?this.onUpdate=new Phaser.Signal:a||null===this.onUpdate||(this.onUpdate.dispose(),this.onUpdate=null)}}),Phaser.Animation.generateFrameNames=function(a,b,c,d,e){"undefined"==typeof d&&(d="");var f=[],g="";if(c>b)for(var h=b;c>=h;h++)g="number"==typeof e?Phaser.Utils.pad(h.toString(),e,"0",1):h.toString(),g=a+g+d,f.push(g);else for(var h=b;h>=c;h--)g="number"==typeof e?Phaser.Utils.pad(h.toString(),e,"0",1):h.toString(),g=a+g+d,f.push(g);return f},Phaser.AnimationManager=function(a){this.sprite=a,this.game=a.game,this.currentFrame=null,this.currentAnim=null,this.updateIfVisible=!0,this.isLoaded=!1,this._frameData=null,this._anims={},this._outputFrames=[]},Phaser.AnimationManager.prototype={loadFrameData:function(a,b){if("undefined"==typeof a)return!1;if(this.isLoaded)for(var c in this._anims)this._anims[c].updateFrameData(a);return this._frameData=a,"undefined"==typeof b||null===b?this.frame=0:"string"==typeof b?this.frameName=b:this.frame=b,this.isLoaded=!0,!0},copyFrameData:function(a,b){if(this._frameData=a.clone(),this.isLoaded)for(var c in this._anims)this._anims[c].updateFrameData(this._frameData);return"undefined"==typeof b||null===b?this.frame=0:"string"==typeof b?this.frameName=b:this.frame=b,this.isLoaded=!0,!0},add:function(a,b,c,d,e){if(b=b||[],c=c||60,"undefined"==typeof d&&(d=!1),"undefined"==typeof e&&(e=b&&"number"==typeof b[0]?!0:!1),this._outputFrames.length=0,this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION)this._frameData.getFrameIndexes(b,e,this._outputFrames),this._anims[a]=new Phaser.Animation(this.game,this.sprite,a,this._frameData,this._outputFrames,c,d);else{for(var f=this.sprite._qc._animation[a].last,g=new Array(f),h=0,i=f;i>h;h++)g[h]=h;this._anims[a]=new Phaser.Animation(this.game,this.sprite,a,null,g,c,d)}return this.currentAnim=this._anims[a],this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),this.sprite.__tilePattern&&(this.sprite.__tilePattern=!1,this.tilingTexture=!1),this._anims[a]},validateFrames:function(a,b){"undefined"==typeof b&&(b=!0);for(var c=0;c<a.length;c++)if(b===!0){if(a[c]>this._frameData.total)return!1}else if(this._frameData.checkFrameName(a[c])===!1)return!1;return!0},play:function(a,b,c,d){if(this._anims[a]){var e=this.currentAnim;return e===this._anims[a]?e.isPlaying===!1?(e.paused=!1,e.play(b,c,d)):("number"==typeof b&&e.delay!==1e3/b&&(e.delay=1e3/b,e._timeNextFrame=e._timeLastFrame+e.delay),"boolean"==typeof c&&(e.loop=c),"undefined"!=typeof d&&(e.killOnComplete=d),e):(e&&e.isPlaying&&e.stop(),e=this._anims[a],e.paused=!1,this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=e.currentFrame),
e.play(b,c,d))}},stop:function(a,b){"undefined"==typeof b&&(b=!1),"string"==typeof a?this._anims[a]&&(this.currentAnim=this._anims[a],this.currentAnim.stop(b)):this.currentAnim&&this.currentAnim.stop(b)},update:function(){return this.updateIfVisible&&!this.sprite.visible?!1:this.currentAnim&&this.currentAnim.update()?(this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame),!0):!1},next:function(a){this.currentAnim&&(this.currentAnim.next(a),this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},previous:function(a){this.currentAnim&&(this.currentAnim.previous(a),this.sprite._qc&&this.sprite._qc.animationType===qc.Sprite.FRAME_ANIMATION&&(this.currentFrame=this.currentAnim.currentFrame))},getAnimation:function(a){return"string"==typeof a&&this._anims[a]?this._anims[a]:null},refreshFrame:function(){this.sprite.setTexture(PIXI.TextureCache[this.currentFrame.uuid]),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)},destroy:function(){var a=null;for(var a in this._anims)this._anims.hasOwnProperty(a)&&this._anims[a].destroy();this._anims={},this._outputFrames=[],this._frameData=null,this.currentAnim=null,this.currentFrame=null,this.sprite=null,this.game=null}},Phaser.AnimationManager.prototype.constructor=Phaser.AnimationManager,Object.defineProperty(Phaser.AnimationManager.prototype,"frameData",{get:function(){return this._frameData}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frameTotal",{get:function(){return this._frameData.total}}),Object.defineProperty(Phaser.AnimationManager.prototype,"paused",{get:function(){return this.currentAnim.isPaused},set:function(a){this.currentAnim.paused=a}}),Object.defineProperty(Phaser.AnimationManager.prototype,"name",{get:function(){return this.currentAnim?this.currentAnim.name:void 0}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frame",{get:function(){return this.currentFrame?this.currentFrame.index:void 0},set:function(a){"number"==typeof a&&this._frameData&&null!==this._frameData.getFrame(a)&&(this.currentFrame=this._frameData.getFrame(a),this.currentFrame&&(this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1)))}}),Object.defineProperty(Phaser.AnimationManager.prototype,"frameName",{get:function(){return this.currentFrame?this.currentFrame.name:void 0},set:function(a){"string"==typeof a&&null!==this._frameData.getFrameByName(a)?(this.currentFrame=this._frameData.getFrameByName(a),this.currentFrame&&(this._frameIndex=this.currentFrame.index,this.sprite.setFrame(this.currentFrame),this.sprite.__tilePattern&&(this.__tilePattern=!1,this.tilingTexture=!1))):console.warn("Cannot set frameName: "+a)}}),qc.BATCH_QUAD=0,qc.BATCH_TRIANGLES=1;var oldWebGLSpriteBatchSetContext=PIXI.WebGLSpriteBatch.prototype.setContext;PIXI.WebGLSpriteBatch.prototype.setContext=function(a){oldWebGLSpriteBatchSetContext.call(this,a),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var b=3*this.triangleSize;this.triangleIndices=new PIXI.Uint16Array(b);for(var c=0;b>c;++c)this.triangleIndices[c]=c;this._batchType=qc.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.triangleIndices,a.STATIC_DRAW)};var oldWebGLSpriteBatchDestroy=PIXI.WebGLSpriteBatch.prototype.destroy;PIXI.WebGLSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),oldWebGLSpriteBatchDestroy.call(this)},Object.defineProperties(PIXI.WebGLSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(a){a!==this._batchType&&(this.stop(),a===qc.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=a,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=a,this.batchIndexNumber=6),this.start())}}}),PIXI.WebGLSpriteBatch.prototype.renderBatch=function(a,b,c){if(0!==b){var d=this.gl;a._dirty[d.id]?this.renderSession.renderer.updateTexture(a):d.bindTexture(d.TEXTURE_2D,a._glTextures[d.id]),d.drawElements(d.TRIANGLES,b*this.batchIndexNumber,d.UNSIGNED_SHORT,c*this.batchIndexNumber*2),this.renderSession.drawCount++}},PIXI.CanvasMaskManager.prototype.popMask=function(a){if(a.context.restore(),qc.__IS_ANDROID_UC){var b=qc._tempCanvas;b||(b=qc._tempCanvas=document.createElement("canvas"),b.width=128,b.height=128),a.context.drawImage(b,0,0,2,2,-5,-5,1,1)}},PIXI.CanvasTinter.getTintedTexture=function(a,b){var c=a.tintedTexture||document.createElement("canvas");return PIXI.CanvasTinter.tintMethod(a.texture,b,c),c};var DisplayChangeStatus=qc.DisplayChangeStatus={OFFSET:1,SCALE:2,ROTATION:4,SIZE:8,TINT:16,ALPHA:32,SHOW:64,HIDE:128,TEXTURE:256,ORDER:512};DisplayChangeStatus.VISIBLE_MASK=DisplayChangeStatus.SHOW|DisplayChangeStatus.HIDE,DisplayChangeStatus.INHERIT_MASK=DisplayChangeStatus.SIZE|DisplayChangeStatus.ORDER|DisplayChangeStatus.OFFSET|DisplayChangeStatus.SCALE|DisplayChangeStatus.ROTATION|DisplayChangeStatus.VISIBLE_MASK,DisplayChangeStatus.RECALC_MASK=DisplayChangeStatus.ROTATION|DisplayChangeStatus.VISIBLE_MASK|DisplayChangeStatus.SIZE|DisplayChangeStatus.SCALE,DisplayChangeStatus.REOFFSET_MASK=DisplayChangeStatus.OFFSET;var oldDestroy=PIXI.DisplayObject.prototype.destroy;PIXI.DisplayObject.prototype.destroy=function(){this.maybeOutWorld(),oldDestroy.call(this)},PIXI.DisplayObject.prototype.setDisplayProxy=function(a,b){this._displayProxy=a,this._skipChildren=b},PIXI.DisplayObject.prototype.getDisplayProxy=function(){return this._displayProxy},PIXI.DisplayObject.prototype.isSkipChildrenRender=function(){return this._skipChildren},PIXI.DisplayObject.prototype.maybeOutWorld=function(){this.game?this.game._qc&&this.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds):this.stage&&this.stage.game._qc&&this.stage.game._qc.dirtyRectangle.redirectDirty(this._currWorldBounds)},PIXI.DisplayObject.prototype.displayChanged=function(a){if(0!==a&&null!=a){var b=this;if(null==b._displayChangeStatus&&(b._displayChangeStatus=DisplayChangeStatus.SHOW),b._displayChangeStatus|=a,a&DisplayChangeStatus.HIDE){this.displayObjectUpdateTransform();for(var c=0,d=this.children.length;d>c;++c)this.children[c].updateTransform()}else a&DisplayChangeStatus.SHOW&&(b._displayChangeStatus&=~DisplayChangeStatus.HIDE);for(var e=b;(e=e.parent)&&!e._subDisplayChanged;)e._subDisplayChanged=!0}},PIXI.DisplayObject.prototype._fastCalcBounds=function(a,b){var c=this,d=c.getSelfWidth&&c.getSelfWidth(),e=c.getSelfHeight&&c.getSelfHeight();if(b&DisplayChangeStatus.HIDE||!c.worldAlpha||!c.worldVisible||!d||!e)return null;var f=c.worldTransform,g=f.a,h=f.b,i=f.c,j=f.d,k=f.tx,l=f.ty;if(!a||b&DisplayChangeStatus.RECALC_MASK){var m,n=c.anchor?c.anchor.x:0,o=c.anchor?c.anchor.y:0,p=d*-n,q=e*-o,r=p+d,s=q+e;0>d&&(m=p,p=r,r=m),0>e&&(m=q,q=s,s=m);var t,u,v,w;if(0===h&&0===i)0>g?(t=g*r+k,u=g*p+k):(t=g*p+k,u=g*r+k),0>j?(v=j*s+l,w=j*q+l):(v=j*q+l,w=j*s+l);else{var x,y,z,A,B,C,D,E;g>=0?(x=g*p,y=g*r):(x=g*r,y=g*p),h>=0?(z=h*p,A=h*r):(z=h*r,A=h*p),i>=0?(B=i*q,C=i*s):(B=i*s,C=i*q),j>=0?(D=j*q,E=j*s):(D=j*s,E=j*q),t=x+B+k,u=y+C+k,v=z+D+l,w=A+E+l}return{x:t,y:v,width:u-t,height:w-v,tx:k,ty:l,area:(u-t)*(w-v)}}if(b&DisplayChangeStatus.REOFFSET_MASK){{k-a.tx,l-a.ty}return{x:a.x+k-a.tx,y:a.y+l-a.ty,width:a.width,height:a.height,tx:k,ty:l,area:a.area}}return{x:a.x,y:a.y,tx:a.tx,ty:a.ty,width:a.width,height:a.height,area:a.area}},PIXI.DisplayObject.prototype._updateBounds=function(a){var b=this,c=(b.worldTransform,b.parent),d=c?c._displayChangeStatus:0;(null==b._displayChangeStatus||a)&&(b._displayChangeStatus=DisplayChangeStatus.SHOW);var e=b._displayChangeStatus;if(e|=d&DisplayChangeStatus.INHERIT_MASK,!(b.worldVisible||e&DisplayChangeStatus.HIDE))return!0;if(0===e)return!1;b._lastWorldBounds||(b._lastWorldBounds=[]);var f=b._qc&&b._qc.animationType===qc.Sprite.FRAME_SAMPLES,g=b._currWorldBounds;if(b._currWorldBounds&&b._lastWorldBounds.push(b._currWorldBounds),b._displayChangeStatus=e,f){var h=b._qc.getSampledAnimationBounds(),i=b.worldTransform.apply(new qc.Point(h.x,h.y)),j=b.worldTransform.apply(new qc.Point(h.x+h.width,h.y)),k=b.worldTransform.apply(new qc.Point(h.x+h.width,h.y+h.height)),l=b.worldTransform.apply(new qc.Point(h.x,h.y+h.height)),m=Math.min(i.x,j.x,k.x,l.x),n=Math.max(i.x,j.x,k.x,l.x),o=Math.min(i.y,j.y,k.y,l.y),p=Math.max(i.y,j.y,k.y,l.y);b._currWorldBounds={x:m,y:o,width:n-m,height:p-o,area:(n-m)*(p-o)}}else b._currWorldBounds=b._fastCalcBounds(b._lastWorldBounds[b._lastWorldBounds.length-1],e);return b._dirtyBounds=g!==b._currWorldBounds,!1},PIXI.DisplayObject.prototype._resetDisplayChangeStatus=function(){var a=this;a._displayChangeStatus=0},PIXI.DisplayObject.prototype.updateTransform=function(){var a=this.parent;if(a)if(this.worldAlpha=this.alpha*this.parent.worldAlpha,this._lastWorldAlpha!==this.worldAlpha&&(this._lastWorldAlpha=this.worldAlpha,this.displayChanged(DisplayChangeStatus.ALPHA)),!this._isNotNeedCalcTransform||a._isSubNeedCalcTransform){this.game&&this.game._calcTransformCount++;var b,c,d,e,f,g,h=this.parent.worldTransform,i=this.worldTransform;i.inUpdate=!0,this.rotation%PIXI.PI_2?(this.rotation!==this.rotationCache&&(this.rotationCache=this.rotation,this._sr=Math.sin(this.rotation),this._cr=Math.cos(this.rotation)),b=this._cr*this.scale.x,c=this._sr*this.scale.x,d=-this._sr*this.scale.y,e=this._cr*this.scale.y,f=this.position.x,g=this.position.y,(this.pivot.x||this.pivot.y)&&(f-=this.pivot.x*b+this.pivot.y*d,g-=this.pivot.x*c+this.pivot.y*e),i.a=b*h.a+c*h.c,i.b=b*h.b+c*h.d,i.c=d*h.a+e*h.c,i.d=d*h.b+e*h.d,i.tx=f*h.a+g*h.c+h.tx,i.ty=f*h.b+g*h.d+h.ty):(b=this.scale.x,e=this.scale.y,f=this.position.x-this.pivot.x*b,g=this.position.y-this.pivot.y*e,i.a=b*h.a,i.b=b*h.b,i.c=e*h.c,i.d=e*h.d,i.tx=f*h.a+g*h.c+h.tx,i.ty=f*h.b+g*h.d+h.ty),this._isNotNeedCalcTransform=!0,this._isSubNeedCalcTransform=!0,this.worldTransformChangedCallback&&this.worldTransformChangedCallback.call(this.worldTransformChangedContext),this.transformCallback&&(i.inUpdate=!1,this.transformCallback.call(this.transformCallbackContext,i,h)),this._onTransformChanged&&this._onTransformChanged.dispatch(i,h)}else{this._isSubNeedCalcTransform=!1;var i=this.worldTransform,h=a.worldTransform;this.transformCallback&&(i.inUpdate=!1,this.transformCallback.call(this.transformCallbackContext,i,h))}},PIXI.DisplayObject.prototype.displayObjectUpdateTransform=PIXI.DisplayObject.prototype.updateTransform,PIXI.DisplayObject.prototype.getWorldTransform=function(){for(var a=!1,b=this,c=null;b;)b._isNotNeedCalcTransform||(a=!0,c=b),b=b.parent;return a&&c.updateTransform(),this.worldTransform},PIXI.DisplayObjectContainer.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b;this.softClip&&SoftClipManager.getManager(a).pushPolygon(this.softClip);var c=!1;if(this._graphicsFilter||this._mask||this._filters){if(this._graphicsFilter&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(a.spriteBatch.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(a.spriteBatch.stop(),a.maskManager.pushMask(this.mask,a),a.spriteBatch.start()),this._renderSelfWebGL&&(c=this._renderSelfWebGL(a)),!c)for(b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);a.spriteBatch.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&!this.filterSelf&&a.filterManager.popFilter(),this._graphicsFilter&&a.filterManager.popFilter(),a.spriteBatch.start()}else if(this._renderSelfWebGL&&(c=this._renderSelfWebGL(a)),!c)for(b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);this.softClip&&SoftClipManager.getManager(a).popPolygon()}},PIXI.DisplayObjectContainer.prototype._renderCanvas=function(a){if(this.visible!==!1&&0!==this.alpha){if(this._cacheAsBitmap)return void this._renderCachedSprite(a);var b=!1;if(this._mask&&a.maskManager.pushMask(this._mask,a),this._renderSelfCanvas&&(b=this._renderSelfCanvas(a)),!b)for(var c=0;c<this.children.length;c++)this.children[c]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}},PIXI.DisplayObjectContainer.prototype.addChildAt=function(a,b){if(b>=0&&b<=this.children.length)return a.parent&&a.parent.removeChild(a),a.parent=this,this.children.splice(b,0,a),this._qc&&this._qc._dispatchChildrenChanged("add",[a._qc]),this.stage&&a.setStageReference(this.stage),a;throw new Error(a+"addChildAt: The index "+b+" supplied is out of bounds "+this.children.length)},PIXI.DisplayObjectContainer.prototype.swapChildren=function(a,b){if(a!==b){var c=this.getChildIndex(a),d=this.getChildIndex(b);if(0>c||0>d)throw new Error("swapChildren: Both the supplied DisplayObjects must be a child of the caller.");this.children[c]=b,this.children[d]=a,this._qc&&this._qc._dispatchChildrenChanged("order",[a._qc,b._qc]),a.displayChanged(qc.DisplayChangeStatus.ORDER),b.displayChanged(qc.DisplayChangeStatus.ORDER)}},PIXI.DisplayObjectContainer.prototype.setChildIndex=function(a,b){if(0>b||b>=this.children.length)throw new Error("The supplied index is out of bounds");var c=this.getChildIndex(a);this.children.splice(c,1),this.children.splice(b,0,a),this._qc&&this._qc._dispatchChildrenChanged("order",[a._qc]),a.displayChanged(qc.DisplayChangeStatus.ORDER)},PIXI.DisplayObjectContainer.prototype.removeChildAt=function(a){var b=this.getChildAt(a);return b.maybeOutWorld(),this.stage&&b.removeStageReference(),b.parent=undefined,this.children.splice(a,1),this._qc&&this._qc._dispatchChildrenChanged("remove",[b._qc]),b},PIXI.DisplayObjectContainer.prototype.remove=function(a){return this.removeChild(a)},PIXI.DisplayObjectContainer.prototype.removeChildren=function(a,b){var c=a||0,d="number"==typeof b?b:this.children.length,e=d-c;if(e>0&&d>=e){for(var f=this.children.splice(c,e),g=[],h=0;h<f.length;h++){var i=f[h];i.maybeOutWorld(),this.stage&&i.removeStageReference(),i.parent=undefined,i._qc&&g.push(i._qc)}return this._qc&&this._qc._dispatchChildrenChanged("remove",g),f}if(0===e&&0===this.children.length)return this._qc&&this._qc._dispatchChildrenChanged("remove",[]),[];throw new Error("removeChildren: Range Error, numeric values are outside the acceptable range")},PIXI.DisplayObjectContainer.prototype.getLocalBounds=function(){var a=this.worldTransform;this._isSubNeedCalcTransform=!0,this.worldTransform=PIXI.identityMatrix;for(var b=0,c=this.children.length;c>b;b++)this.children[b].updateTransform();var d=this.getBounds();return this.worldTransform=a,this._isSubNeedCalcTransform=!0,this._isNotNeedCalcTransform=!1,d},PIXI.DisplayObjectContainer.prototype.displayMaybeOutWorld=PIXI.DisplayObject.prototype.maybeOutWorld,PIXI.DisplayObjectContainer.prototype.maybeOutWorld=function(){this.displayMaybeOutWorld();for(var a=this.children,b=0,c=a.length;c>b;b++)a[b].maybeOutWorld()},PIXI.PixiShader.prototype.init=function(){var a=this.gl,b=PIXI.compileProgram(a,this.vertexSrc||PIXI.PixiShader.defaultVertexSrc,this.fragmentSrc);if(a.useProgram(b),this.uSampler=a.getUniformLocation(b,"uSampler"),this.uSourceSampler=a.getUniformLocation(b,"uSourceSampler"),this.projectionVector=a.getUniformLocation(b,"projectionVector"),this.offsetVector=a.getUniformLocation(b,"offsetVector"),this.dimensions=a.getUniformLocation(b,"dimensions"),this.pixelSize=a.getUniformLocation(b,"pixelSize"),this.aVertexPosition=a.getAttribLocation(b,"aVertexPosition"),this.aTextureCoord=a.getAttribLocation(b,"aTextureCoord"),this.colorAttribute=a.getAttribLocation(b,"aColor"),-1===this.colorAttribute&&(this.colorAttribute=2),this.attributes=[this.aVertexPosition,this.aTextureCoord,this.colorAttribute],this.extraAttribute)for(var c in this.extraAttribute){var d=this.extraAttribute[c].name;this[d]=a.getAttribLocation(b,d),this.attributes.push(this[d])}for(var d in this.uniforms)this.uniforms[d].uniformLocation=a.getUniformLocation(b,d);this.initUniforms(),this.program=b};var oldSpriteSetTexture=PIXI.Sprite.prototype.setTexture;PIXI.Sprite.prototype.setTexture=function(a){oldSpriteSetTexture.call(this,a),this.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE)},PIXI.Sprite.prototype.getSelfWidth=function(){return this._qc?this._qc.width:this.texture&&this.texture.frame&&this.texture.frame.width},PIXI.Sprite.prototype.getSelfHeight=function(){return this._qc?this._qc.height:this.texture&&this.texture.frame&&this.texture.frame.height},PIXI.Sprite.prototype._renderWebGL=function(a){if(this.visible&&!(this.alpha<=0)&&this.renderable){var b;if(this.softClip&&SoftClipManager.getManager(a).pushPolygon(this.softClip),this.maskPixel){var c=a.spriteBatch;for(c.flush(),a.filterManager.pushFilter(this.maskPixel),b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);c.stop(),a.filterManager.popFilter(),c.start()}else if(this._graphicsFilter||this._mask||this._filters){var c=a.spriteBatch;if(this._graphicsFilter&&(c.flush(),a.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(c.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(c.stop(),a.maskManager.pushMask(this.mask,a),c.start()),this._filters&&this.filterSelf){c.stop();var d=this.texture.baseTexture._glTextures[a.gl.id],e=a.filterManager.buildFilterTexture(a,this._filterBlock,this);c.start();var f=this.texture._uvs;e&&(this.texture.baseTexture._glTextures[a.gl.id]=e.texture),this._renderWebGLImpl(a),c.flush(),e&&(this.texture.baseTexture._glTextures[a.gl.id]=d,a.filterManager.texturePool.push(e),this.texture._uvs=f)}else this._renderWebGLImpl(a);for(b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);c.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&!this.filterSelf&&a.filterManager.popFilter(),this._graphicsFilter&&a.filterManager.popFilter(),c.start()}else for(this._renderWebGLImpl(a),b=0;b<this.children.length;b++)this.children[b]._renderWebGL(a);this.softClip&&SoftClipManager.getManager(a).popPolygon()}},PIXI.WebGLStencilManager.prototype.pushSpriteStencil=function(a,b){var c=this.gl;0===this.stencilStack.length&&(c.enable(c.STENCIL_TEST),c.clear(c.STENCIL_BUFFER_BIT),this.reverse=!0,this.count=0),this.stencilStack.push(a);var d=this.count;c.colorMask(!1,!1,!1,!1),c.stencilFunc(c.ALWAYS,0,255),c.stencilOp(c.KEEP,c.KEEP,c.INVERT),this.reverse?(c.stencilFunc(c.EQUAL,d,255),c.stencilOp(c.KEEP,c.KEEP,c.INCR)):(c.stencilFunc(c.EQUAL,255-d,255),c.stencilOp(c.KEEP,c.KEEP,c.DECR)),a._renderWebGLImpl(b),b.spriteBatch.flush(),this.reverse?c.stencilFunc(c.EQUAL,d+1,255):c.stencilFunc(c.EQUAL,255-(d+1),255),c.colorMask(!0,!0,!0,!0),c.stencilOp(c.KEEP,c.KEEP,c.KEEP),this.count++},PIXI.WebGLStencilManager.prototype.popSpriteStencil=function(a,b){var c=this.gl;if(this.stencilStack.pop(),this.count--,0===this.stencilStack.length)c.disable(c.STENCIL_TEST);else{var d=this.count;c.colorMask(!1,!1,!1,!1),this.reverse?(c.stencilFunc(c.EQUAL,d+1,255),c.stencilOp(c.KEEP,c.KEEP,c.DECR)):(c.stencilFunc(c.EQUAL,255-(d+1),255),c.stencilOp(c.KEEP,c.KEEP,c.INCR)),a._renderWebGLImpl(b),b.spriteBatch.flush(),this.reverse?c.stencilFunc(c.EQUAL,d,255):c.stencilFunc(c.EQUAL,255-d,255),c.colorMask(!0,!0,!0,!0),c.stencilOp(c.KEEP,c.KEEP,c.KEEP)}},PIXI.Sprite.prototype._renderWebGLImpl=function(a){var b=a.softClipManager,c=a.spriteBatch;if(b&&b.needClip){var d=this.texture,e=d.baseTexture.resolution,f=this.worldTransform,g=d._uvs;if(!g)return;var h,i,j,k,l=f.a/e,m=f.b/e,n=f.c/e,o=f.d/e,p=f.tx,q=f.ty,r=this.anchor.x,s=this.anchor.y;if(d.trim){var t=d.trim;i=t.x-r*t.width,h=i+d.crop.width,k=t.y-s*t.height,j=k+d.crop.height}else h=d.frame.width*(1-r),i=d.frame.width*-r,j=d.frame.height*(1-s),k=d.frame.height*-s;var u=this.tint;u=(u>>16)+(65280&u)+((255&u)<<16)+(255*this.worldAlpha<<24),b.renderSprite(a,this,i,k,h,j,g.x0,g.y0,g.x2,g.y2,l,m,n,o,p,q,u)}else c.render(this)},PIXI.Sprite.prototype._renderCanvas=function(a){if(!(this.visible===!1||0===this.alpha||this.renderable===!1||this.texture.crop.width<=0||this.texture.crop.height<=0)){if(this.maskPixel){var b=a.bufferPool||(a.bufferPool=[]),c=a.context,d=c.globalOffX||0,e=c.globalOffY||0,f=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),g=Math.max(d,f.x),h=Math.max(e,f.y),i=Math.min(f.x+f.width,c.canvas.width+d),j=Math.min(f.y+f.height,c.canvas.height+e);f.x=g,f.y=h,f.width=i-g,f.height=j-h;var k=b.pop();k||(k=new PIXI.CanvasBuffer(a.context.canvas.width*a.resolution,a.context.canvas.height*a.resolution),k.context._setTransform=k.context.setTransform,k.context.setTransform=function(a,b,c,d,e,f){this._setTransform(a,b,c,d,e-(this.globalOffX||0),f-(this.globalOffY||0))}),k.resize(f.width*a.resolution,f.height*a.resolution),k.context.clearRect(0,0,f.width*a.resolution,f.height*a.resolution),k.context.globalOffX=f.x*a.resolution+d,k.context.globalOffY=f.y*a.resolution+e,a.context=k.context}if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,a.context.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),this.texture.valid){var l=this.texture.baseTexture.resolution/a.resolution;a.context.globalAlpha=this.worldAlpha,a.smoothProperty&&a.scaleMode!==this.texture.baseTexture.scaleMode&&(a.scaleMode=this.texture.baseTexture.scaleMode,a.context[a.smoothProperty]=a.scaleMode===PIXI.scaleModes.LINEAR);var m=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,n=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height;a.roundPixels?(a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),m=0|m,n=0|n):a.context.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution),this.maskPixel||(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint)),a.drawCount++,a.context.drawImage(this.tintedTexture,0,0,this.texture.crop.width,this.texture.crop.height,m/l,n/l,this.texture.frame.width/l,this.texture.frame.height/l)):(a.drawCount++,a.context.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,m/l,n/l,this.texture.frame.width/l,this.texture.frame.height/l)))}for(var o=0;o<this.children.length;o++)this.children[o]._renderCanvas(a);if(this._mask&&a.maskManager.popMask(a),this.maskPixel&&this.texture.valid){var p=a.context;p.globalCompositeOperation="destination-in",a.roundPixels?(p.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),m=0|m,n=0|n):p.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution),a.drawCount++,p.drawImage(this.texture.baseTexture.source,this.texture.crop.x,this.texture.crop.y,this.texture.crop.width,this.texture.crop.height,m/l,n/l,this.texture.crop.width/l,this.texture.crop.height/l),p.globalCompositeOperation="source-over",a.context=c,a.roundPixels?a.context.setTransform(1,0,0,1,f.x*a.resolution|0,f.y*a.resolution|0):a.context.setTransform(1,0,0,1,f.x*a.resolution,f.y*a.resolution),a.drawCount++,a.context.drawImage(k.canvas,0,0,k.canvas.width,k.canvas.height,0,0,k.canvas.width,k.canvas.height),b.push(k)}}};var oldWebGLFastSpriteBatchSetContext=PIXI.WebGLFastSpriteBatch.prototype.setContext;PIXI.WebGLFastSpriteBatch.prototype.setContext=function(a){oldWebGLFastSpriteBatchSetContext.call(this,a),this.quadSize=this.size,this.triangleSize=300,this.batchIndexNumber=6;var b=3*this.triangleSize;this.triangleIndices=new PIXI.Uint16Array(b);for(var c=0;b>c;++c)this.triangleIndices[c]=c;this._batchType=qc.BATCH_QUAD,this.quadIndexBuffer=this.indexBuffer,this.triangleIndexBuffer=a.createBuffer(),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.triangleIndexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,this.triangleIndices,a.STATIC_DRAW)};var oldWebGLFastSpriteBatchDestroy=PIXI.WebGLFastSpriteBatch.prototype.destroy;PIXI.WebGLFastSpriteBatch.prototype.destroy=function(){this.triangleIndices=null,this.gl.deleteBuffer(this.triangleIndexBuffer),oldWebGLFastSpriteBatchDestroy.call(this)},Object.defineProperties(PIXI.WebGLFastSpriteBatch.prototype,{batchType:{get:function(){return this._batchType},set:function(a){a!==this._batchType&&(this.stop(),a===qc.BATCH_TRIANGLES?(this.size=this.triangleSize,this.indexBuffer=this.triangleIndexBuffer,this._batchType=a,this.batchIndexNumber=3):(this.size=this.quadSize,this.indexBuffer=this.quadIndexBuffer,this._batchType=a,this.batchIndexNumber=6),this.start())}}}),PIXI.WebGLFastSpriteBatch.prototype.flush=function(){if(0!==this.currentBatchSize){var a=this.gl;if(this.currentBaseTexture._glTextures[a.id]||this.renderSession.renderer.updateTexture(this.currentBaseTexture,a),a.bindTexture(a.TEXTURE_2D,this.currentBaseTexture._glTextures[a.id]),this.currentBatchSize>.5*this.size)a.bufferSubData(a.ARRAY_BUFFER,0,this.vertices);else{var b=this.vertices.subarray(0,4*this.currentBatchSize*this.vertSize);a.bufferSubData(a.ARRAY_BUFFER,0,b)}a.drawElements(a.TRIANGLES,this.currentBatchSize*this.batchIndexNumber,a.UNSIGNED_SHORT,0),this.currentBatchSize=0,this.renderSession.drawCount++}},PIXI.WebGLFilterManager.prototype.initShaderBuffers=function(){var a=this.gl;this.vertexBuffer=a.createBuffer(),this.uvBuffer=a.createBuffer(),this.colorBuffer=a.createBuffer(),this.indexBuffer=a.createBuffer(),this.vertexArray=new PIXI.Float32Array([0,0,1,0,0,1,1,1]),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),a.bufferData(a.ARRAY_BUFFER,this.vertexArray,a.STATIC_DRAW),this.uvArray=new PIXI.Float32Array(8*Filter.MAX_SAMPLE_COUNT),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),a.bufferData(a.ARRAY_BUFFER,this.uvArray,a.STATIC_DRAW),this.colorArray=new PIXI.Float32Array([1,16777215,1,16777215,1,16777215,1,16777215]),a.bindBuffer(a.ARRAY_BUFFER,this.colorBuffer),a.bufferData(a.ARRAY_BUFFER,this.colorArray,a.STATIC_DRAW),a.bindBuffer(a.ELEMENT_ARRAY_BUFFER,this.indexBuffer),a.bufferData(a.ELEMENT_ARRAY_BUFFER,new Uint16Array([0,1,2,1,3,2]),a.STATIC_DRAW)},PIXI.WebGLFilterManager.prototype.pushFilter=function(a){var b=this.gl,c=this.renderSession.projection,d=this.renderSession.offset,e=a._filterArea=(a.target.filterArea||a.target.getBounds()).clone();a._previous_stencil_mgr=this.renderSession.stencilManager,this.renderSession.stencilManager=new PIXI.WebGLStencilManager,this.renderSession.stencilManager.setContext(b),b.disable(b.STENCIL_TEST),this.filterStack.push(a);for(var f=a.filterPasses.length,g=0;f--;){var h=a.filterPasses[f];h.padding>g&&(g=h.padding)}e.x-=g,e.y-=g,e.width+=2*g,e.height+=2*g;var i=Math.max(this.offsetX,e.x),j=Math.max(this.offsetY,e.y),k=Math.max(i,Math.min(e.x+e.width,this.width+this.offsetX)),l=Math.max(j,Math.min(e.y+e.height,this.height+this.offsetY));e.x=i,e.y=j,e.width=k-i,e.height=l-j,this.offsetX+=e.x,this.offsetY+=e.y;var m=this.texturePool.pop();m?m.resize(this.width,this.height):m=new PIXI.FilterTexture(this.gl,this.width,this.height),b.bindTexture(b.TEXTURE_2D,m.texture),b.bindFramebuffer(b.FRAMEBUFFER,m.frameBuffer),b.viewport(0,0,e.width,e.height),c.x=e.width/2,c.y=-e.height/2,d.x=-e.x,d.y=-e.y,b.colorMask(!0,!0,!0,!0),b.clearColor(0,0,0,0),b.clear(b.COLOR_BUFFER_BIT),a._glFilterTexture=m},PIXI.WebGLFilterManager.prototype.popFilter=function(){var a=this.gl,b=this.filterStack.pop(),c=b._filterArea,d=b._glFilterTexture,e=b._glFilterTexture,f=this.renderSession.projection,g=this.renderSession.offset;if(b.filterPasses.length>1){a.viewport(0,0,c.width,c.height),a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=0,this.vertexArray[1]=c.height,this.vertexArray[2]=c.width,this.vertexArray[3]=c.height,this.vertexArray[4]=0,this.vertexArray[5]=0,this.vertexArray[6]=c.width,this.vertexArray[7]=0,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=c.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height,a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray);var h=d,i=this.texturePool.pop();i||(i=new PIXI.FilterTexture(this.gl,this.width,this.height)),i.resize(this.width,this.height),a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.clear(a.COLOR_BUFFER_BIT),a.disable(a.BLEND);for(var j=0;j<b.filterPasses.length-1;j++){var k=b.filterPasses[j],l=k.extraAttribute;if(l){a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer);for(var m=0;m<l.length;++m){var n=k.uniforms[l[m].texture].value;if(n){var o=n._uvs;this.uvArray[8*(m+1)]=o.x3,this.uvArray[8*(m+1)+1]=o.y3,this.uvArray[8*(m+1)+2]=o.x2,this.uvArray[8*(m+1)+3]=o.y2,this.uvArray[8*(m+1)+4]=o.x0,this.uvArray[8*(m+1)+5]=o.y0,this.uvArray[8*(m+1)+6]=o.x1,this.uvArray[8*(m+1)+7]=o.y1}}a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray)}a.bindFramebuffer(a.FRAMEBUFFER,i.frameBuffer),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,h.texture),this.applyFilterPass(k,c,c.width,c.height,e);var p=h;h=i,p===e?(i=this.texturePool.pop(),i||(i=new PIXI.FilterTexture(this.gl,this.width,this.height))):i=p}a.enable(a.BLEND),d=h,this.texturePool.push(i)}var q=b.filterPasses[b.filterPasses.length-1];this.offsetX-=c.x,this.offsetY-=c.y;var r=this.width,s=this.height,t=0,u=0,v=this.buffer;if(0===this.filterStack.length)a.colorMask(!0,!0,!0,!0);else{var w=this.filterStack[this.filterStack.length-1];c=w._filterArea,r=c.width,s=c.height,t=c.x,u=c.y,v=w._glFilterTexture.frameBuffer}f.x=r/2,f.y=-s/2,g.x=t,g.y=u,c=b._filterArea;var x=c.x-t,y=c.y-u;a.bindBuffer(a.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=x,this.vertexArray[1]=y+c.height,this.vertexArray[2]=x+c.width,this.vertexArray[3]=y+c.height,this.vertexArray[4]=x,this.vertexArray[5]=y,this.vertexArray[6]=x+c.width,this.vertexArray[7]=y,a.bufferSubData(a.ARRAY_BUFFER,0,this.vertexArray),a.bindBuffer(a.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=0,this.uvArray[1]=0,this.uvArray[2]=c.width/this.width,this.uvArray[3]=0,this.uvArray[4]=0,this.uvArray[5]=c.height/this.height,this.uvArray[6]=c.width/this.width,this.uvArray[7]=c.height/this.height;var l=q.extraAttribute;if(l)for(var m=0;m<l.length;++m){var n=q.uniforms[l[m].texture].value;if(n){var o=n._uvs;this.uvArray[8*(m+1)]=o.x3,this.uvArray[8*(m+1)+1]=o.y3,this.uvArray[8*(m+1)+2]=o.x2,this.uvArray[8*(m+1)+3]=o.y2,this.uvArray[8*(m+1)+4]=o.x0,this.uvArray[8*(m+1)+5]=o.y0,this.uvArray[8*(m+1)+6]=o.x1,this.uvArray[8*(m+1)+7]=o.y1}}a.bufferSubData(a.ARRAY_BUFFER,0,this.uvArray),a.viewport(0,0,r*this.renderSession.resolution,s*this.renderSession.resolution),a.bindFramebuffer(a.FRAMEBUFFER,v),a.activeTexture(a.TEXTURE0),a.bindTexture(a.TEXTURE_2D,d.texture),this.renderSession.stencilManager&&this.renderSession.stencilManager.destroy(),this.renderSession.stencilManager=b._previous_stencil_mgr,b._previous_stencil_mgr=null,this.renderSession.stencilManager.count>0?a.enable(a.STENCIL_TEST):a.disable(a.STENCIL_TEST),this.applyFilterPass(q,c,r,s,e),d!==e&&this.texturePool.push(e),this.texturePool.push(d),b._glFilterTexture=null},PIXI.WebGLFilterManager.prototype.buildFilterTexture=function(a,b,c){var d=a.gl,e=d.isEnabled(d.STENCIL_TEST);e&&d.disable(d.STENCIL_TEST);var f=c.texture.baseTexture;f._glTextures[d.id]||a.renderer.updateTexture(f,d);var g=f._glTextures[d.id],h={texture:g},i=new qc.Rectangle(0,0,f.width,f.height),j=c.texture.crop,k=c.texture._uvs,l=this.texturePool.pop();

l||(l=new PIXI.FilterTexture(this.gl,i.width,i.height)),l.resize(i.width,i.height),d.bindFramebuffer(d.FRAMEBUFFER,l.frameBuffer),d.viewport(0,0,i.width,i.height),d.colorMask(!0,!0,!0,!0),d.clearColor(0,0,0,0),d.clear(d.COLOR_BUFFER_BIT),d.disable(d.BLEND),d.bindBuffer(d.ARRAY_BUFFER,this.vertexBuffer),this.vertexArray[0]=j.x,this.vertexArray[1]=i.height-j.y,this.vertexArray[2]=j.x+j.width,this.vertexArray[3]=i.height-j.y,this.vertexArray[4]=j.x,this.vertexArray[5]=i.height-j.y-j.height,this.vertexArray[6]=j.x+j.width,this.vertexArray[7]=i.height-j.y-j.height,d.bufferSubData(d.ARRAY_BUFFER,0,this.vertexArray);var m=b.filterPasses[0];d.bindBuffer(d.ARRAY_BUFFER,this.uvBuffer),this.uvArray[0]=k.x0,this.uvArray[1]=k.y0,this.uvArray[2]=k.x1,this.uvArray[3]=k.y1,this.uvArray[4]=k.x3,this.uvArray[5]=k.y3,this.uvArray[6]=k.x2,this.uvArray[7]=k.y2;var n=m.extraAttribute;if(n)for(var o=0;o<n.length;++o){var p=m.uniforms[n[o].texture].value;if(p){var k=p._uvs;this.uvArray[8*(o+1)]=k.x0,this.uvArray[8*(o+1)+1]=k.y0,this.uvArray[8*(o+1)+2]=k.x1,this.uvArray[8*(o+1)+3]=k.y1,this.uvArray[8*(o+1)+4]=k.x3,this.uvArray[8*(o+1)+5]=k.y3,this.uvArray[8*(o+1)+6]=k.x2,this.uvArray[8*(o+1)+7]=k.y2}}d.bufferSubData(d.ARRAY_BUFFER,0,this.uvArray),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,h.texture),this.applyFilterPass(m,new qc.Rectangle(0,0,i.width,i.height),i.width,i.height,h,i.width,i.height);for(var q=null,r=1;r<b.filterPasses.length;r++){var s=q;q=l,l=s,l||(l=this.texturePool.pop(),l||(l=new PIXI.FilterTexture(this.gl,i.width,i.height)),l.resize(i.width,i.height)),d.bindBuffer(d.ARRAY_BUFFER,this.uvBuffer),d.bufferSubData(d.ARRAY_BUFFER,0,this._filterSelfUVArray);var m=b.filterPasses[r],n=m.extraAttribute;if(n){d.bindBuffer(d.ARRAY_BUFFER,this.uvBuffer);for(var o=0;o<n.length;++o){var p=m.uniforms[n[o].texture].value;if(p){var k=p._uvs;this.uvArray[8*(o+1)]=k.x0,this.uvArray[8*(o+1)+1]=k.y0,this.uvArray[8*(o+1)+2]=k.x1,this.uvArray[8*(o+1)+3]=k.y1,this.uvArray[8*(o+1)+4]=k.x3,this.uvArray[8*(o+1)+5]=k.y3,this.uvArray[8*(o+1)+6]=k.x2,this.uvArray[8*(o+1)+7]=k.y2}}d.bufferSubData(d.ARRAY_BUFFER,0,this.uvArray)}d.bindFramebuffer(d.FRAMEBUFFER,l.frameBuffer),d.activeTexture(d.TEXTURE0),d.bindTexture(d.TEXTURE_2D,q.texture),this.applyFilterPass(m,new qc.Rectangle(0,0,i.width,i.height),i.width,i.height,h,i.width,i.height)}return e&&d.enable(d.STENCIL_TEST),d.enable(d.BLEND),d.viewport(0,0,this.width*this.renderSession.resolution,this.height*this.renderSession.resolution),d.bindFramebuffer(d.FRAMEBUFFER,this.buffer),d.colorMask(!0,!0,!0,!0),l},PIXI.WebGLFilterManager.prototype.applyFilterPass=function(a,b,c,d,e,f,g){var h=this.gl,i=a.shaders[h.id];if(i||(i=new PIXI.PixiShader(h),i.fragmentSrc=a.fragmentSrc,a.vertexSrc&&(i.vertexSrc=a.vertexSrc),i.uniforms=a.uniforms,a.extraAttribute&&(i.extraAttribute=a.extraAttribute),i.init(),a.shaders[h.id]=i),this.renderSession.shaderManager.setShader(i),f=isNaN(f)?this.width:f,g=isNaN(g)?this.height:g,h.uniform2f(i.projectionVector,c/2,-d/2),h.uniform2f(i.offsetVector,0,0),i.pixelSize&&h.uniform2f(i.pixelSize,1/f,1/g),a.uniforms.dimensions&&(a.uniforms.dimensions.value[0]=f,a.uniforms.dimensions.value[1]=g,a.uniforms.dimensions.value[2]=this.vertexArray[0],a.uniforms.dimensions.value[3]=this.vertexArray[5]),i.syncUniforms(),i.uSourceSampler&&e){var j=i.textureCount++;h.activeTexture(h["TEXTURE"+j]),h.bindTexture(h.TEXTURE_2D,e.texture),h.uniform1i(i.uSourceSampler,j)}h.bindBuffer(h.ARRAY_BUFFER,this.vertexBuffer),h.vertexAttribPointer(i.aVertexPosition,2,h.FLOAT,!1,0,0);var k=a.extraAttribute;if(h.bindBuffer(h.ARRAY_BUFFER,this.uvBuffer),h.vertexAttribPointer(i.aTextureCoord,2,h.FLOAT,!1,0,0),k)for(var l=0;l<k.length;++l)h.vertexAttribPointer(i[k[l].name],2,h.FLOAT,!1,0,32*(l+1));h.bindBuffer(h.ARRAY_BUFFER,this.colorBuffer),h.vertexAttribPointer(i.colorAttribute,2,h.FLOAT,!1,0,0),h.bindBuffer(h.ELEMENT_ARRAY_BUFFER,this.indexBuffer),h.drawElements(h.TRIANGLES,6,h.UNSIGNED_SHORT,0),this.renderSession.drawCount++},PIXI.WebGLMaskManager.prototype.popMask=function(a,b){var c=this.gl;a._webGL[c.id].data.length&&b.stencilManager.popStencil(a,a._webGL[c.id].data[0],b)};var oldTextUpdateTexture=PIXI.Text.prototype.updateTexture;PIXI.Text.prototype.updateTexture=function(){oldTextUpdateTexture.call(this),this.displayChanged(qc.DisplayChangeStatus.SIZE|qc.DisplayChangeStatus.TEXTURE)},PIXI.Text.prototype.getSelfWidth=function(){return this.texture&&this.texture.frame&&this.texture.frame.width*(this._canvasDownScale?this._canvasDownScale.x:1)},PIXI.Text.prototype.getSelfHeight=function(){return this.texture&&this.texture.frame&&this.texture.frame.height*(this._canvasDownScale?this._canvasDownScale.y:1)},PIXI.Text.prototype._uploadToRenderTexture=function(){var a=this._frameTexture,b=a.baseTexture,c=this.game.renderer;b.source=this.canvas,c.updateTexture(b),this.texture=a,b.resolution=this.resolution,b.scaleMode=PIXI.scaleModes.NEAREST,b.width=a.crop.width=a.frame.width=this.canvas.width,b.height=a.crop.height=a.frame.height=this.canvas.height},Object.defineProperty(Phaser.Text.prototype,"dirty",{get:function(){return this._dirty},set:function(a){this._dirty!==a&&(this._dirty=a,this.displayChanged(qc.DisplayChangeStatus.SIZE|qc.DisplayChangeStatus.TEXTURE))}}),Object.defineProperty(Phaser.Text.prototype,"width",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.x*this.texture.frame.width/this.resolution},set:function(a){this.scale.x=a/this.texture.frame.width,this._width=a}}),Object.defineProperty(Phaser.Text.prototype,"height",{get:function(){return this.dirty&&(this.updateText(),this.dirty=!1),this.scale.y*this.texture.frame.height/this.resolution},set:function(a){this.scale.y=a/this.texture.frame.height,this._height=a}});var textScaleDirtyInterval=200,oldRenderCanvas=PIXI.Sprite.prototype._renderCanvas,oldRenderWebGL=PIXI.Sprite.prototype._renderWebGL,createFunc=function(a){return function(b){var c,d=this._canvasDownScale,e=this._nqc.roundPixels!==!1;if(e&&(c=b.roundPixels,b.roundPixels=!0),d){var f=this.worldTransform,g=f.a,h=f.b,i=f.c,j=f.d,k=d.x,l=d.y;f.a*=k,f.b*=k,f.c*=l,f.d*=l,this.texture.baseTexture.scaleMode=!this.game.antialias||f.a===f.d&&0===f.b&&0===f.c?PIXI.scaleModes.NEAREST:PIXI.scaleModes.LINEAR,a.call(this,b),f.a=g,f.b=h,f.c=i,f.d=j}else a.call(this,b);e&&(b.roundPixels=c)}};PIXI.Text.prototype.getBounds=function(a){this.dirty&&(this.updateText(),this.dirty=!1);var b=this._canvasDownScale,c=this.worldTransform;c.tx=c.tx||0,c.ty=c.ty||0;var d=c.a,e=c.b,f=c.c,g=c.d,h=b.x,i=b.y;c.a*=h,c.b*=h,c.c*=i,c.d*=i;var j=PIXI.Sprite.prototype.getBounds.call(this,a);return c.a=d,c.b=e,c.c=f,c.d=g,j},PIXI.Text.prototype._renderCanvas=function(){return createFunc(oldRenderCanvas)}(),PIXI.Text.prototype._renderWebGL=function(){return createFunc(oldRenderWebGL)}(),Phaser.Text.prototype.updateLine=function(a,b,c,d,e,f,g,h,i,j){for(var k=0;k<a.length;k++){var l=a[k];this.colors[this._charCount]&&(d.fillStyle="defaultColor"===this.colors[this._charCount]?f:this.colors[this._charCount]);var m=d.measureText(l).width;if(this.style.stroke&&e&&(this._clearShadowStyle(d),d.strokeText(l,b,c),this._restoreShadowStyle(d)),this.style.fill)if(i===d.fillStyle&&j){if(d.save(),d.fillStyle="black",d.fillText(l,b,c),d.globalCompositeOperation="source-in",d.fillStyle=i,d.beginPath(),d.rect(b,c-h/2,m,h),d.clip(),d.fillRect(b,c-h/2,m,h),d.restore(),qc.__IS_ANDROID_UC){var n=qc._tempCanvas;n||(n=qc._tempCanvas=document.createElement("canvas"),n.width=128,n.height=128),d.drawImage(n,0,0,2,2,-5,-5,1,1)}}else d.fillText(l,b,c);b+=m,this._charCount++}},Phaser.Text.prototype._clearShadowStyle=function(a){this.style.fill&&this._nqc&&this._nqc.enableShadow&&(a.shadowOffsetX=0,a.shadowOffsetY=0,a.shadowColor=null)},Phaser.Text.prototype._restoreShadowStyle=function(a){this.style.fill&&this._nqc&&this._nqc.enableShadow&&(this._shadowOffset?(a.shadowOffsetX=this._shadowOffset[0],a.shadowOffsetY=this._shadowOffset[1]):(a.shadowOffsetX=this.style.shadowOffsetX,a.shadowOffsetY=this.style.shadowOffsetY),a.shadowColor=this.style.shadowColor,a.shadowBlur=this.style.shadowBlur)},Phaser.Text.prototype._getWorldWidth=function(a){if(a.length>0&&"\n"===a[a.length-1]){var b=a.substr(0,a.length-1);return this.context.measureText(b).width}return this.context.measureText(a).width},Phaser.Text.prototype._isLetter=function(a){return("a">a||a>"z")&&("A">a||a>"Z")?!1:!0},Phaser.Text.prototype.runWordWrap=function(a,b){for(var c=b,d=[],e=0,f=!1,g=0;g<a.length;)if("\n"===a[g]){var h=a.substr(e,g-e+1);1===h.length&&d.length>0&&!f?d[d.length-1]+="\n":d.push(h),g++,e=g,f=!0}else{f=!1;for(var i=-1;g<a.length;){var j=a.charAt(g);if(!this._isLetter(j)){i>=0&&g--;break}-1===i&&(i=g),g++}g===a.length&&g--;var k=this._getWorldWidth(a.substr(e,g-e+1));if(k>c)if(i>=0&&i===e){var h=a.substr(e,g-e+1);d.push(h),g++,e=g}else if(i>=0){var l=i-e,h=a.substr(e,l);d.push(h),g=e+l,e=g}else if(g-e===0){var h=a.substr(e,g-e+1);d.push(h),g++,e=g}else{var h=a.substr(e,g-e);d.push(h),e=g}else if(g++,g===a.length){var h=a.substr(e,g-e+1);d.push(h)}}return d},Phaser.Text.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.inUpdate=!0,this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this._isNotNeedCalcTransform=!1,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation;for(var c=this.children.length;c--;)this.children[c].visible?this.children[c].preUpdate():this.children[c].renderOrderID=-1;return!0},Phaser.Text.prototype.update=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}},Phaser.BitmapText.prototype._isLetter=Phaser.Text.prototype._isLetter,Phaser.BitmapText.prototype.runWordWrap=Phaser.Text.prototype.runWordWrap,Phaser.BitmapText.prototype._getWorldWidth=function(a){var b=0,c=PIXI.BitmapText.fonts[this.fontName];if(!c||!a)return b;for(var d=this.fontSize/c.size,e=null,f=0;f<a.length;f++){var g=a.charCodeAt(f),h=c.chars[g];h&&(e&&h.kerning[e]&&(b+=h.kerning[e]),b+=h.xAdvance,e=g)}return b*d},PIXI.BitmapText.prototype.updateText=function(){var a=this.text;if(this._nqc){var b=PIXI.BitmapText.fonts[this.fontName];if(b){var c=new PIXI.Point,d=null,e=[],f=0,g=[],h=this.fontSize/b.size,i=[];if(this._nqc.wrap){a=a.replace(/\r/gi,"").replace(/\n/gi,"\n");var i=this.runWordWrap(a,this._nqc.width)}else for(var i=a.split(/(?:\r\n|\r|\n)/),j=0;j<i.length-1;j++)i[j]+="\n";c.x=0,c.y=0;for(var j=0;j<i.length;j++){c.x=0,d=null;for(var k=i[j],l=0;l<k.length;l++){var m=k.charCodeAt(l),n=b.chars[m];n&&(d&&n.kerning[d]&&(c.x+=n.kerning[d]),e.push({texture:n.texture,line:j,charCode:m,position:new PIXI.Point(c.x+n.xOffset,c.y+n.yOffset)}),c.x+=n.xAdvance,d=m)}g.push(c.x),f=Math.max(f,c.x),c.y+=b.lineHeight}var o=[];for(j=0;j<=i.length;j++){var p=0;"right"===this.style.align?p=f-g[j]:"center"===this.style.align&&(p=(f-g[j])/2),o.push(p)}var q=this.children.length,r=e.length,s=this.tint||16777215;this.textWidth=f*h,this.textHeight=b.lineHeight*h;var t=this.textWidth*this.anchor.x,u=this.textHeight*this.anchor.y;for(j=0;r>j;j++){var v=q>j?this.children[j]:this._pool.pop();v?v.setTexture(e[j].texture):v=new PIXI.Sprite(e[j].texture),v.position.x=(e[j].position.x+o[e[j].line])*h-t,v.position.y=Math.floor(e[j].position.y*h-u),v.scale.x=v.scale.y=h,v.tint=s,v.parent||this.addChild(v)}for(;this.children.length>r;){var w=this.getChildAt(this.children.length-1);this._pool.push(w),this.removeChild(w)}this._nqc.textRealWidth=this.textWidth,this._nqc.textRealHeight=this.textHeight,this.realWidth=this.textWidth,this.realHeight=this.textHeight,this._nqc._adjustTextPos(this.textWidth,this.textHeight)}}},Phaser.BitmapText.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}if(this.fresh)return a&&(a._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(var c=this.children.length;c--;)this.children[c].visible?this.children[c].preUpdate():this.children[c].renderOrderID=-1;return!0},Phaser.BitmapText.prototype.postUpdate=function(){this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var a=this._qc;if(a&&!a["static"]){a.postUpdate&&a.postUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.postUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.postUpdate(),!this.visible))return}}},Phaser.Graphics.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,a&&(a._isTransformDirty=!0),this.fresh=!1,!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++;for(var c=this.children.length;c--;)this.children[c].visible?this.children[c].preUpdate():this.children[c].renderOrderID=-1;return!0},Phaser.Graphics.prototype.update=function(){var a=this._qc;if(a&&!a["static"]){a.update&&a.update();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.update&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.update(),!this.visible))return}}for(var c=this.children.length;c--;)this.children[c].visible&&this.children[c].update()},Phaser.Graphics.prototype.postUpdate=function(){this.key instanceof Phaser.BitmapData&&this.key.render();var a=this._qc;if(a&&!a["static"]){a.postUpdate&&a.postUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.postUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.postUpdate(),!this.visible))return}}for(var c=this.children.length;c--;)this.children[c].visible&&this.children[c].postUpdate()},Object.defineProperty(PIXI.Graphics.prototype,"dirty",{get:function(){return this._dirty},set:function(a){a!==this._dirty&&(this._dirty=a,this.displayChanged(qc.DisplayChangeStatus.RECALC_MASK))}}),PIXI.Graphics.prototype._updateBounds=function(){var a=this,b=(a.worldTransform,a.parent),c=b?b._displayChangeStatus:0;null==a._displayChangeStatus&&(a._displayChangeStatus=DisplayChangeStatus.SHOW);var d=a._displayChangeStatus;if(d|=c&DisplayChangeStatus.INHERIT_MASK,!(a.worldVisible||d&DisplayChangeStatus.HIDE))return!0;if(0===d)return!1;a._lastWorldBounds||(a._lastWorldBounds=[]),a._currWorldBounds&&a._lastWorldBounds.push(a._currWorldBounds),a._displayChangeStatus=d,a._currentBounds=null;var e=this.getBounds();return a._currWorldBounds={x:e.x,y:e.y,tx:e.x,ty:e.y,width:e.width,height:e.height,area:e.width*e.height},a._dirtyBounds=!0,!1},Phaser.Sprite.prototype.preUpdate=function(){var a=this._qc;if(a&&!a["static"]){a.preUpdate&&a.preUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.preUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)){if(!this.visible)return;d.preUpdate()}}}if(this.fresh)return this.world.setTo(this.parent.position.x+this.position.x,this.parent.position.y+this.position.y),this.worldTransform.tx=this.world.x,this.worldTransform.ty=this.world.y,this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,a&&(a._isTransformDirty=!0),this.fresh=!1,!1;if(this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.lifespan>0&&(this.lifespan-=this.game.time.physicsElapsedMS,this.lifespan<=0))return this.kill(),!1;this.previousPosition.set(this.world.x,this.world.y),this.previousRotation=this.rotation,this.world.setTo(this.game.camera.x+this.worldTransform.tx,this.game.camera.y+this.worldTransform.ty),this.renderOrderID=this.game.stage.currentRenderOrderID++,this.animations&&this.animations.update();for(var c=this.children.length;c--;)this.children[c].visible?this.children[c].preUpdate():this.children[c].renderOrderID=-1;return!0},Phaser.Sprite.prototype.update=function(){var a=this._qc;if(a&&!a["static"]){a.update&&a.update();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.update&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.update(),!this.visible))return}}for(var c=this.children.length;c--;)this.children[c].visible&&this.children[c].update()},Phaser.Sprite.prototype.postUpdate=function(){this.key instanceof Phaser.BitmapData&&this.key.render(),this.fixedToCamera&&(this.x=this.game.camera.view.x+this.cameraOffset.x,this.y=this.game.camera.view.y+this.cameraOffset.y);var a=this._qc;if(a&&!a["static"]){a.postUpdate&&a.postUpdate();for(var b=a.scripts,c=b.length;c--;){var d=b[c];if(d&&d._enable&&d.__hadUpdateOrRender&&d.postUpdate&&(a.game.device.editor!==!0||d.runInEditor===!0)&&(d.postUpdate(),!this.visible))return}}for(var c=this.children.length;c--;)this.children[c].visible&&this.children[c].postUpdate()},Phaser.Tileset.prototype.updateTileData=function(a,b){a-=this.tileMargin,b-=this.tileMargin;var c,d;c=b>this.tileHeight?(b-this.tileHeight)/(this.tileHeight+this.tileSpacing)+1:b/this.tileHeight,d=a>this.tileWidth?(a-this.tileWidth)/(this.tileWidth+this.tileSpacing)+1:a/this.tileWidth,c=Math.floor(c),d=Math.floor(d),(this.rows&&this.rows!==c||this.columns&&this.columns!==d)&&console.warn("Phaser.Tileset - actual and expected number of tile rows and columns differ"),this.rows=c,this.columns=d,this.total=c*d,this.drawCoords.length=0;for(var e=this.tileMargin,f=this.tileMargin,g=0;g<this.rows;g++){for(var h=0;h<this.columns;h++)this.drawCoords.push(e),this.drawCoords.push(f),e+=this.tileWidth+this.tileSpacing;e=this.tileMargin,f+=this.tileHeight+this.tileSpacing}},Phaser.Cache.prototype.getSound=function(a){return this._sounds[a]?this._sounds[a]:null},Phaser.Loader.prototype.loadAudioTag=function(a){var b=this;if(this.game.sound.touchLocked)a.data=new Audio,a.data.name=a.key,a.data.preload="auto",a.data.src=this.transformUrl(a.url,a),this.fileComplete(a);else{a.data=new Audio,a.data.name=a.key;var c=function(){a.data.removeEventListener("canplaythrough",c,!1),a.data.removeEventListener("stalled",d,!1),a.data.onerror=null,Phaser.GAMES[b.game.id].load.fileComplete(a)};a.data.onerror=function(){a.data.removeEventListener("canplaythrough",c,!1),a.data.removeEventListener("stalled",d,!1),a.data.onerror=null,b.fileError(a)};var d=function(){a.data.removeEventListener("canplaythrough",c,!1),a.data.removeEventListener("stalled",d,!1),a.data.onerror=null,b.fileError(a)};a.data.preload="auto",a.data.src=this.transformUrl(a.url,a),a.data.addEventListener("canplaythrough",c,!1),a.data.addEventListener("stalled",d,!1)}},Phaser.Sound.prototype.soundHasUnlocked=function(a){a===this.key&&(this._sound=this.game.cache.getSoundData(this.key),this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this))},Phaser.Sound.prototype.play=function(a,b,c,d,e){if(("undefined"==typeof a||a===!1||null===a)&&(a=""),"undefined"==typeof e&&(e=!0),this.isPlaying&&!this.allowMultiple&&!e&&!this.override)return this;if(this._sound&&this.isPlaying&&!this.allowMultiple&&(this.override||e))if(this.usingWebAudio)if("undefined"==typeof this._sound.stop)this._sound.noteOff(0);else try{this._sound.stop(0)}catch(f){}else this.usingAudioTag&&(this._sound.pause(),this._sound.currentTime=0);if(""===a&&Object.keys(this.markers).length>0)return this;if(""!==a){if(this.currentMarker=a,!this.markers[a])return this;this.position=this.markers[a].start,this.volume=this.markers[a].volume,this.loop=this.markers[a].loop,this.duration=this.markers[a].duration,this.durationMS=this.markers[a].durationMS,"undefined"!=typeof c&&(this.volume=c),"undefined"!=typeof d&&(this.loop=d),this._tempMarker=a,this._tempPosition=this.position,this._tempVolume=this.volume,this._tempLoop=this.loop}else b=b||0,"undefined"==typeof c&&(c=this._volume),"undefined"==typeof d&&(d=this.loop),this.position=b,this.volume=c,this.loop=d,this.duration=0,this.durationMS=0,this._tempMarker=a,this._tempPosition=b,this._tempVolume=c,this._tempLoop=d;return this.usingWebAudio?this.game.cache.isSoundDecoded(this.key)?(null===this._buffer&&(this._buffer=this.game.cache.getSoundData(this.key)),this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&""===a&&(this._sound.loop=!0),this.loop||""!==a||(this._sound.onended=this.onEndedHandler.bind(this)),this.totalDuration=this._sound.buffer.duration,0===this.duration&&(this.duration=this.totalDuration,this.durationMS=Math.ceil(1e3*this.totalDuration)),"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,this.position,this.duration):this.loop&&""===a?this._sound.start(0):this._sound.start(0,this.position,this.duration),this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):(this.pendingPlayback=!0,this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).isDecoding===!1&&this.game.sound.decode(this.key,this)):this.game.cache.getSound(this.key)&&this.game.cache.getSound(this.key).locked?(this.game.cache.reloadSound(this.key),this.pendingPlayback=!0):this._sound&&(this.game.device.cocoonJS||4===this._sound.readyState)?(this._sound.play(),this.totalDuration=this.game._qc.sound._getAudioTagDurationInConfig(this),0===this.duration&&(this.duration=this.totalDuration,this.durationMS=1e3*this.totalDuration),this._sound.currentTime=this.position,this._sound.muted=this._muted,this._sound.volume=this._muted?0:this._volume,this.isPlaying=!0,this.startTime=this.game.time.time,this.currentTime=0,this.stopTime=this.startTime+this.durationMS,this.onPlay.dispatch(this)):this.pendingPlayback=!0,this},Phaser.Sound.prototype.resume=function(){if(this.paused&&this._sound){if(this.usingWebAudio){var a=this.position+this.pausedPosition/1e3;this._sound=this.context.createBufferSource(),this._sound.buffer=this._buffer,this._sound.connect(this.externalNode?this.externalNode:this.gainNode),this.loop&&(this._sound.loop=!0),this.loop||""!==this.currentMarker||(this._sound.onended=this.onEndedHandler.bind(this));var b=this.duration-this.pausedPosition/1e3;"undefined"==typeof this._sound.start?this._sound.noteGrainOn(0,a,b):this.loop?this._sound.start(0,a):this._sound.start(0,a,b)}else this._sound.play();this.isPlaying=!0,this.paused=!1,this.startTime+=this.game.time.time-this.pausedTime,this.onResume.dispatch(this)}},Phaser.SoundManager.prototype.decode=function(a,b){b=b||null;var c=this.game.cache.getSoundData(a);if(c&&this.game.cache.isSoundDecoded(a)===!1){this.game.cache.updateSound(a,"isDecoding",!0);var d=this;try{var e=this.context.decodeAudioData(c,function(c){d.game.cache&&(c&&d.game.cache.decodedSound(a,c),d.onSoundDecode.dispatch(a,b))},function(){d.game._qc.log.trace("Sound decode failed: {0}",a),d.onSoundDecode.dispatch(a,b)});e&&e["catch"]&&e["catch"](function(){})}catch(f){this.game._qc.log.trace("{0}",f.stack),d.onSoundDecode.dispatch(a,b)}}},Phaser.SoundManager.prototype.boot=function(){if(this.game.device.iOS&&this.game.device.webAudio===!1&&(this.channels=1),window.PhaserGlobal){if(window.PhaserGlobal.disableAudio===!0)return this.usingWebAudio=!1,void(this.noAudio=!0);if(window.PhaserGlobal.disableWebAudio===!0)return this.usingWebAudio=!1,this.usingAudioTag=!0,void(this.noAudio=!1)}if(window.PhaserGlobal&&window.PhaserGlobal.audioContext)this.context=window.PhaserGlobal.audioContext;else if(window.AudioContext)try{this.context=new window.AudioContext}catch(a){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",a),qc.Util.popupError(a.message)}else if(window.webkitAudioContext)try{this.context=new window.webkitAudioContext}catch(a){this.context=null,this.usingWebAudio=!1,this.noAudio=!0,console.error("SoundManager boot error!",a),qc.Util.popupError(a.message)}window.Audio&&null===this.context&&(this.usingWebAudio=!1,this.usingAudioTag=!0,this.noAudio=!1),null!==this.context&&(this.masterGain="undefined"==typeof this.context.createGain?this.context.createGainNode():this.context.createGain(),this.masterGain.gain.value=1,this.masterGain.connect(this.context.destination))},Phaser.SoundManager.prototype.unlock=function(){if(this.touchLocked!==!1)if(this.game.device.webAudio===!1||window.PhaserGlobal&&window.PhaserGlobal.disableWebAudio===!0)this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null,this.game.input._qc.mouse.callbackContext=null,this.game.input._qc.mouse.mouseDownCallback=null;else{var a=this.context.createBuffer(1,1,22050);this._unlockSource=this.context.createBufferSource(),this._unlockSource.buffer=a,this._unlockSource.connect(this.context.destination),"undefined"==typeof this._unlockSource.start?this._unlockSource.noteOn(0):this._unlockSource.start(0)}},Phaser.SoundManager.prototype.update=function(){this.touchLocked&&this.game.device.webAudio&&null!==this._unlockSource&&(this._unlockSource.playbackState===this._unlockSource.PLAYING_STATE||this._unlockSource.playbackState===this._unlockSource.FINISHED_STATE)&&(this.touchLocked=!1,this._unlockSource=null,this.game.input._qc.touch.callbackContext=null,this.game.device.iOSVersion>8?this.game.input._qc.touch.touchEndCallback=null:this.game.input._qc.touch.touchStartCallback=null);for(var a=0;a<this._sounds.length;a++)this._sounds[a].update();if(this._watching){for(var b=this._watchList.first;b;)this.game.cache.isSoundDecoded(b)&&this._watchList.remove(b),b=this._watchList.next;0===this._watchList.total&&(this._watching=!1,this._watchCallback.call(this._watchContext))}},Phaser.Loader.prototype.transformUrl=function(a){return/^http(s|):\/\//i.test(a)?a:this.baseURL+a},Phaser.Loader.prototype.asyncComplete=function(a,b){"undefined"==typeof b&&(b=""),a.loaded=!0,a.error=!!b,a.requestObject&&200!==a.requestObject.status&&304!==a.requestObject.status&&(a.error=!0),b&&(a.errorMessage=b,console.warn("Phaser.Loader - "+a.type+"["+a.key+"]: "+b)),this.processLoadQueue()},PIXI.CanvasRenderer.prototype.render=function(a){if(this.context.setTransform(1,0,0,1,0,0),this.context.globalAlpha=1,this.renderSession.drawCount=0,this.renderSession.currentBlendMode=PIXI.blendModes.NORMAL,this.context.globalCompositeOperation=PIXI.blendModesCanvas[PIXI.blendModes.NORMAL],this.dirtyRectangle.enable){if(!this.dirtyRectangle.updateDirtyRegion(this.context,this.resolution,a))return this.context.fillStyle="rgba(0, 0, 0, 0)",this.context.fillRect(0,0,1,1),void this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution)}else navigator.isCocoonJS&&this.view.screencanvas&&(this.context.fillStyle="black",this.context.clear());this.clearBeforeRender&&(this.transparent?this.context.clearRect(0,0,this.width,this.height):(this.context.fillStyle=a.backgroundColorString,this.context.fillRect(0,0,this.width,this.height))),this.renderDisplayObject(a),this.dirtyRectangle.enable&&(this.dirtyRectangle.restore(this.context),this.dirtyRectangle.showDirtyRectangle(this.context,this.resolution))},PIXI.WebGLRenderer.prototype.render=function(a){if(!this.contextLost){this.__stage!==a&&(this.__stage=a);var b=this.gl;b.viewport(0,0,this.width,this.height),b.bindFramebuffer(b.FRAMEBUFFER,null),this.clearBeforeRender&&(this.transparent?b.clearColor(0,0,0,0):b.clearColor(a.backgroundColorSplit[0],a.backgroundColorSplit[1],a.backgroundColorSplit[2],1),b.clear(b.COLOR_BUFFER_BIT)),this.renderDisplayObject(a,this.projection)}};var GameObjectFactory=qc.GameObjectFactory=function(a){this.game=a};GameObjectFactory.prototype.constructor=GameObjectFactory,GameObjectFactory.prototype.clone=function(a,b){if(!a)return null;if(a instanceof Prefab){var c=this.game.serializer.restoreBundle(a.json,b);return c._prefab=a.uuid,c}var d={},e=this.game.serializer.buildBundle(a,d);e.dependences=this.game.serializer.combineDependence(d);var c=this.game.serializer.restoreBundle(e,b?b:a.parent);return c},GameObjectFactory.prototype.node=function(a,b){var c=new Node(new Phaser.Group(this.game.phaser,null),a,b);return c.name="node",c},GameObjectFactory.prototype.text=function(a,b){return new UIText(this.game,a,b)},GameObjectFactory.prototype.image=function(a,b){return new UIImage(this.game,a,b)},GameObjectFactory.prototype.button=function(a,b){return new Button(this.game,a,b)},GameObjectFactory.prototype.toggle=function(a,b){return new Toggle(this.game,a,b)},GameObjectFactory.prototype.sprite=function(a,b){return new Sprite(this.game,a,b)},GameObjectFactory.prototype.sound=function(a,b){return new Sound(this.game,a,b)},GameObjectFactory.prototype.scrollView=function(a,b){return new ScrollView(this.game,a,b)},GameObjectFactory.prototype.scrollBar=function(a,b,c){var d=new ScrollBar(this.game,a,c),e=c!==undefined;if(e)return d;if(d.width=160,d.height=20,d.size=.2,d.direction=qc.ScrollBar.LEFT_TO_RIGHT,b){var f=this.node(d);f.name="slidingArea",f.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),f.setStretch(0,0,0,0),f.pivotX=f.pivotY=.5;var g=this.image(f);g.name="sliders",g.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),g.setStretch(0,0,0,0),g.pivotX=g.pivotY=.5,d.sliders=g,d.interactive=!0}return d},GameObjectFactory.prototype.progressBar=function(a,b,c){var d=new ProgressBar(this.game,a,c),e=c!==undefined;if(e)return d;if(d.width=160,d.height=20,b){var f=this.node(d);f.name="progressArea",f.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),f.setStretch(0,0,0,0),f.pivotX=f.pivotY=.5;var g=this.image(f);g.name="sliders",g.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),g.setStretch(0,0,0,0),g.pivotX=g.pivotY=.5,d.sliders=g}return d},GameObjectFactory.prototype.slider=function(a,b,c){var d=new Slider(this.game,a,c),e=c!==undefined;if(e)return d;if(d.interactive=!0,d.width=160,d.height=20,b){var f=this.node(d);f.name="slidingArea",f.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),f.setStretch(0,0,0,0),f.pivotX=f.pivotY=.5;var g=this.image(f);g.name="sliders",g.setAnchor(new qc.Point(.5,.5),new qc.Point(.5,.5)),g.setStretch(0,0,0,0),g.pivotX=g.pivotY=.5,d.sliders=g}return d},GameObjectFactory.prototype.inputField=function(a,b){return new InputField(this.game,a,b)},GameObjectFactory.prototype.dropdown=function(a,b){return new qc.Dropdown(this.game,a,b)},GameObjectFactory.prototype.tilemap=function(a,b){
return new Tilemap(this.game,a,b)},GameObjectFactory.prototype.tileLayer=function(a,b){return new TileLayer(this.game,a,b)},GameObjectFactory.prototype.objectLayer=function(a,b){return new ObjectLayer(this.game,a,b)},GameObjectFactory.prototype.dom=function(a,b){return new Dom(this.game,a,b)},GameObjectFactory.prototype.graphics=function(a,b){return new Graphics(this.game,a,b)};var UIImage=qc.UIImage=function(a,b,c){var d=this,e=new Phaser.Sprite(a.phaser);qc.Node.call(d,e,b,c),d._oldUpdateTransformFunc=e.updateTransform,e._renderWebGL=imageRenderWebGL,e._renderCanvas=imageRenderCanvas,d._borderLeft=0,d._borderRight=0,d._borderTop=0,d._borderBottom=0,d._imageType=qc.UIImage.IMAGE_TYPE_SIMPLE,d.name="UIImage"};UIImage.prototype=Object.create(qc.Node.prototype),UIImage.prototype.constructor=UIImage,UIImage.IMAGE_TYPE_SIMPLE=0,UIImage.IMAGE_TYPE_SLICED=1,UIImage.IMAGE_TYPE_TILED=2,Object.defineProperties(UIImage.prototype,{texture:{get:function(){return this._atlas?new qc.Texture(this._atlas,this.frame):null},set:function(a){var b=this;if(!a)return b._atlas=null,void b.phaser.loadTexture(null,b.frame);if(a instanceof qc.Atlas)a=a.getTexture(this.frame);else if("string"==typeof a){if(!b._atlas)return;if(a=b._atlas.getTexture(a),!a)return}(b._atlas!==a.atlas||b.frame!==a.frame)&&(b._atlas=a.atlas,a.atlas.getFrame(a.frame)||(a.frame=0),b.phaser.key=a.atlas.key,b.frame=a.frame)}},frame:{get:function(){return this.phaser.frameName},set:function(a){if(this.texture){var b=this.texture.atlas.frameNames||[0];("string"!=typeof a||-1!==b.indexOf(a))&&(this.phaser.loadTexture(this.texture.atlas.key,a),this.setWidth(this.width),this.setHeight(this.height),this._resetNinePadding(),this._dispatchLayoutArgumentChanged("size"),this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE),this._onTextureChanged&&this._onTextureChanged.dispatch())}}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new qc.Rectangle(0,0,0,0)}},imageType:{get:function(){return this._imageType},set:function(a){this._imageType!==a&&(this._imageType=a,this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE))}},borderTop:{get:function(){return this._borderTop},set:function(a){this._borderTop=a}},borderBottom:{get:function(){return this._borderBottom},set:function(a){this._borderBottom=a}},borderLeft:{get:function(){return this._borderLeft},set:function(a){this._borderLeft=a}},borderRight:{get:function(){return this._borderRight},set:function(a){this._borderRight=a}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new Phaser.Signal),this._onTextureChanged}},skewX:{get:function(){return this._skewX},set:function(a){var b=this;b._skewX!==a&&(b._skewX=a,b.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),b._isTransformDirty=!0,b._skewX||b._skewY?this.phaser.updateTransform=imageUpdateTransform:b.phaser.updateTransform=b._oldUpdateTransformFunc)}},skewY:{get:function(){return this._skewY},set:function(a){var b=this;b._skewY!==a&&(b._skewY=a,b.phaser.displayChanged(qc.DisplayChangeStatus.ROTATION),b._isTransformDirty=!0,b._skewX||b._skewY?this.phaser.updateTransform=imageUpdateTransform:b.phaser.updateTransform=b._oldUpdateTransformFunc)}},"class":{get:function(){return"qc.UIImage"}}}),UIImage.prototype.resetNativeSize=function(){this.parent?(this.width=this.nativeSize.width,this.height=this.nativeSize.height):(this.setWidth(this.nativeSize.width),this.setHeight(this.nativeSize.width))},UIImage.prototype.setWidth=function(a){Node.prototype.setWidth.call(this,a),this.phaser.texture.trim||(this.phaser.texture.frame.width=a,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},UIImage.prototype.setHeight=function(a){Node.prototype.setHeight.call(this,a),this.phaser.texture.trim||(this.phaser.texture.frame.height=a,this.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},UIImage.prototype._resetNinePadding=function(){if(this.texture){var a=this.texture.padding;this._borderLeft=a[0],this._borderTop=a[1],this._borderRight=a[2],this._borderBottom=a[3]}},UIImage.prototype.getMeta=function(){var a=qc.Serializer,b=qc.Node.prototype.getMeta.call(this);return b.texture=a.TEXTURE,b.frame=a.AUTO,b.imageType=a.NUMBER,b.skewX=a.NUMBER,b.skewY=a.NUMBER,b};var imageRenderWebGL=function(a){var b=this._qc;if(b.imageType===qc.UIImage.IMAGE_TYPE_SIMPLE)return Phaser.Sprite.prototype._renderWebGL.call(this,a);if(this.visible&&!(this.alpha<=0)&&this.renderable){var c;if(this.softClip&&SoftClipManager.getManager(a).pushPolygon(this.softClip),this._graphicsFilter||this._mask||this._filters){var d=a.spriteBatch;for(this._graphicsFilter&&(d.flush(),a.filterManager.pushFilter(this._graphicsFilter)),this._filters&&!this.filterSelf&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),this._mask&&(d.stop(),a.maskManager.pushMask(this.mask,a),d.start()),this._filters&&this.filterSelf&&(d.flush(),a.filterManager.pushFilter(this._filterBlock)),imageFillVBO(d,this),this._filters&&this.filterSelf&&(d.stop(),a.filterManager.popFilter(),d.start()),c=0;c<this.children.length;c++)this.children[c]._renderWebGL(a);d.stop(),this._mask&&a.maskManager.popMask(this._mask,a),this._filters&&!this.filterSelf&&a.filterManager.popFilter(),this._graphicsFilter&&a.filterManager.popFilter(),d.start()}else for(imageFillVBO(a.spriteBatch,this),c=0;c<this.children.length;c++)this.children[c]._renderWebGL(a);this.softClip&&SoftClipManager.getManager(a).popPolygon()}},generateSlicedSprite=function(a,b){var c=b.texture,d=c._uvs;if(d){var e,f,g,h,i=b._qc,j=i.borderLeft,k=i.borderRight,l=i.borderTop,m=i.borderBottom,n=b.anchor.x,o=b.anchor.y;if(c.trim){var p=c.trim;f=p.x-n*p.width,e=f+c.crop.width,h=p.y-o*p.height,g=h+c.crop.height}else e=c.frame.width*(1-n),f=c.frame.width*-n,g=c.frame.height*(1-o),h=c.frame.height*-o;var q=c.baseTexture.width,r=c.baseTexture.height,s=[new Phaser.Point(d.x0,d.y0),new Phaser.Point(d.x0+j/q,d.y0+l/r),new Phaser.Point(d.x2-k/q,d.y2-m/r),new Phaser.Point(d.x2,d.y2)],t=Math.abs(e-f),u=Math.abs(g-h);j+k>t&&(j=t*j/(j+k),k=t-j),f>e&&(j=-j,k=-k),l+m>u&&(l=u*l/(l+m),m=u-l),h>g&&(l=-l,m=-m);var v=[new Phaser.Point(f,h),new Phaser.Point(f+j,h+l),new Phaser.Point(e-k,g-m),new Phaser.Point(e,g)],w=b.tint;w=(w>>16)+(65280&w)+((255&w)<<16)+(255*b.worldAlpha<<24);for(var x=c.baseTexture.resolution,y=b.worldTransform,z=y.a/x,A=y.b/x,B=y.c/x,C=y.d/x,D=y.tx,E=y.ty,F=0;3>F;++F)for(var G=F+1,H=0;3>H;++H){var I=H+1;webGLAddQuad(a,b,v[F].x,v[H].y,v[G].x,v[I].y,s[F].x,s[H].y,s[G].x,s[I].y,z,A,B,C,D,E,w)}}},webGLAddQuad=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q){var r=a.renderSession.softClipManager;if(r&&r.needClip)return void r.renderSprite(a.renderSession,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q);a.currentBatchSize>=a.size&&(a.flush(),a.currentBaseTexture=b.texture.baseTexture);var s=a.colors,t=a.positions,u=4*a.currentBatchSize*a.vertSize;a.renderSession.roundPixels?(t[u]=k*c+m*d+o|0,t[u+1]=n*d+l*c+p|0,t[u+5]=k*e+m*d+o|0,t[u+6]=n*d+l*e+p|0,t[u+10]=k*e+m*f+o|0,t[u+11]=n*f+l*e+p|0,t[u+15]=k*c+m*f+o|0,t[u+16]=n*f+l*c+p|0):(t[u]=k*c+m*d+o,t[u+1]=n*d+l*c+p,t[u+5]=k*e+m*d+o,t[u+6]=n*d+l*e+p,t[u+10]=k*e+m*f+o,t[u+11]=n*f+l*e+p,t[u+15]=k*c+m*f+o,t[u+16]=n*f+l*c+p),t[u+2]=g,t[u+3]=h,t[u+7]=i,t[u+8]=h,t[u+12]=i,t[u+13]=j,t[u+17]=g,t[u+18]=j,s[u+4]=s[u+9]=s[u+14]=s[u+19]=q,a.sprites[a.currentBatchSize++]=b},generateTiledSprite=function(a,b){var c=b.texture,d=c._uvs;if(d){var e,f,g,h,i=b._qc,j=i.borderLeft,k=i.borderRight,l=i.borderTop,m=i.borderBottom,n=b.anchor.x,o=b.anchor.y;if(c.trim){var p=c.trim;f=p.x-n*p.width,e=f+c.crop.width,h=p.y-o*p.height,g=h+c.crop.height}else e=c.frame.width*(1-n),f=c.frame.width*-n,g=c.frame.height*(1-o),h=c.frame.height*-o;var q=c.baseTexture.width,r=c.baseTexture.height,s=[new Phaser.Point(d.x0,d.y0),new Phaser.Point(d.x0+j/q,d.y0+l/r),new Phaser.Point(d.x2-k/q,d.y2-m/r),new Phaser.Point(d.x2,d.y2)],t=d.x0+j/q,u=d.y0+l/r,v=d.x2-k/q,w=d.y2-m/r,x=Math.abs(e-f),y=Math.abs(g-h);j+k>x&&(j=x*j/(j+k),k=x-j),f>e&&(j=-j,k=-k),l+m>y&&(l=y*l/(l+m),m=y-l),h>g&&(l=-l,m=-m);var z=e-k,A=g-m,B=f+j,C=h+l,D=[new Phaser.Point(f,h),new Phaser.Point(B,C),new Phaser.Point(z,A),new Phaser.Point(e,g)],E=b.tint;E=(E>>16)+(65280&E)+((255&E)<<16)+(255*b.worldAlpha<<24);var F=c.baseTexture.resolution,G=b.worldTransform,H=G.a/F,I=G.b/F,J=G.c/F,K=G.d/F,L=G.tx,M=G.ty,N=(d.x2-d.x0)*q-j-k,O=(d.y2-d.y0)*r-l-m;x-j-k>32*N&&(N=(x-j-k)/32),y-l-m>32*O&&(O=(y-l-m)/32);var P=v,Q=w;if(N>0&&O>0)for(var R=C;A>R;R+=O){var S=R+O;S>A&&(Q=u+(w-u)*(A-R)/(S-R),S=A),P=v;for(var T=B;z>T;T+=N){var U=T+N;U>z&&(P=t+(v-t)*(z-T)/(U-T),U=z),webGLAddQuad(a,b,T,R,U,S,t,u,P,Q,H,I,J,K,L,M,E)}}if(P=v,Q=w,O)for(var R=C;A>R;R+=O){var S=R+O;S>A&&(Q=u+(w-u)*(A-R)/(S-R),S=A),webGLAddQuad(a,b,f,R,B,S,d.x0,u,t,Q,H,I,J,K,L,M,E),webGLAddQuad(a,b,z,R,e,S,v,u,d.x2,Q,H,I,J,K,L,M,E)}if(P=v,Q=w,N)for(var T=B;z>T;T+=N){var U=T+N;U>z&&(P=t+(v-t)*(z-T)/(U-T),U=z),webGLAddQuad(a,b,T,h,U,C,t,d.y0,P,u,H,I,J,K,L,M,E),webGLAddQuad(a,b,T,A,U,g,t,w,P,d.y2,H,I,J,K,L,M,E)}webGLAddQuad(a,b,D[0].x,D[0].y,D[1].x,D[1].y,s[0].x,s[0].y,s[1].x,s[1].y,H,I,J,K,L,M,E),webGLAddQuad(a,b,D[2].x,D[0].y,D[3].x,D[1].y,s[2].x,s[0].y,s[3].x,s[1].y,H,I,J,K,L,M,E),webGLAddQuad(a,b,D[2].x,D[2].y,D[3].x,D[3].y,s[2].x,s[2].y,s[3].x,s[3].y,H,I,J,K,L,M,E),webGLAddQuad(a,b,D[0].x,D[2].y,D[1].x,D[3].y,s[0].x,s[2].y,s[1].x,s[3].y,H,I,J,K,L,M,E)}},imageRenderCanvas=function(a){if(!(this.visible===!1||0===this.alpha||this.renderable===!1||this.texture.crop.width<=0||this.texture.crop.height<=0)){var b=this.texture.valid,c=this._qc,d=c.imageType;if(this.maskPixel&&b&&d===qc.UIImage.IMAGE_TYPE_SIMPLE){var e=a.bufferPool||(a.bufferPool=[]),f=a.context,g=f.globalOffX||0,h=f.globalOffY||0,i=this.maskPixel.target.filterArea||this.maskPixel.target.getBounds(),j=Math.max(g,i.x),k=Math.max(h,i.y),l=Math.min(i.x+i.width,f.canvas.width+g),m=Math.min(i.y+i.height,f.canvas.height+h);i.x=j,i.y=k,i.width=l-j,i.height=m-k;var n=e.pop();n||(n=new PIXI.CanvasBuffer(a.context.canvas.width*a.resolution,a.context.canvas.height*a.resolution),n.context._setTransform=n.context.setTransform,n.context.setTransform=function(a,b,c,d,e,f){this._setTransform(a,b,c,d,e-(this.globalOffX||0),f-(this.globalOffY||0))}),n.resize(i.width*a.resolution,i.height*a.resolution),n.context.clearRect(0,0,i.width*a.resolution,i.height*a.resolution),n.context.globalOffX=i.x*a.resolution+g,n.context.globalOffY=i.y*a.resolution+h,a.context=n.context}var o=a.context;if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,o.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),b){var p=this.texture.baseTexture.resolution/a.resolution;o.globalAlpha=this.worldAlpha,!a.smoothProperty||a.scaleMode===this.texture.baseTexture.scaleMode&&o[a.smoothProperty]===(a.scaleMode===PIXI.scaleModes.LINEAR)||(a.scaleMode=this.texture.baseTexture.scaleMode,o[a.smoothProperty]=a.scaleMode===PIXI.scaleModes.LINEAR);var q=this.texture.trim?this.texture.trim.x-this.anchor.x*this.texture.trim.width:this.anchor.x*-this.texture.frame.width,r=this.texture.trim?this.texture.trim.y-this.anchor.y*this.texture.trim.height:this.anchor.y*-this.texture.frame.height,s=this.texture.trim?this.texture.crop.width:this.texture.frame.width,t=this.texture.trim?this.texture.crop.height:this.texture.frame.height;a.roundPixels?(o.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),q=0|q,r=0|r):o.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution);var u,v,w,x,y,z=function(b,c,d,e,f,g,h,i,j,k){j&&k&&(a.drawCount++,b.drawImage(c,d,e,f||1,g||1,h,i,j,k))};if(16777215!==this.tint?(this.cachedTint!==this.tint&&(this.cachedTint=this.tint,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint)),u=this.tintedTexture,v=0,w=0,x=this.texture.crop.width,y=this.texture.crop.height):(u=this.texture.baseTexture.source,v=this.texture.crop.x,w=this.texture.crop.y,x=this.texture.crop.width,y=this.texture.crop.height),q=Math.round(q/p),r=Math.round(r/p),s=Math.round(s/p),t=Math.round(t/p),d===qc.UIImage.IMAGE_TYPE_SIMPLE)this.maskPixel||z(o,u,v,w,x,y,q,r,s,t);else if(c.texture&&s&&t){var A=""+c.texture.atlas.uuid+d+c.frame+this.tint+s+t,B=qc.CanvasPool.get(A),C=B.canvas;if(B.dirty){var D=C.getContext("2d");a.smoothProperty&&D[a.smoothProperty]!==(a.scaleMode===PIXI.scaleModes.LINEAR)&&(D[a.smoothProperty]=a.scaleMode===PIXI.scaleModes.LINEAR),C.width=s,C.height=t,D.clearRect(0,0,s,t);var E=c.borderLeft,F=c.borderRight,G=c.borderTop,H=c.borderBottom,I=[new Phaser.Point(v,w),new Phaser.Point(v+E,w+G),new Phaser.Point(v+x-F,w+y-H),new Phaser.Point(v+x,w+y)];E/=p,G/=p,F/=p,H/=p,E+F>s&&(E=s*E/(E+F),F=s-E),G+H>t&&(G=t*G/(G+H),H=t-G);var J=[new Phaser.Point(0,0),new Phaser.Point(E,G),new Phaser.Point(s-F,t-H),new Phaser.Point(s,t)];if(d==qc.UIImage.IMAGE_TYPE_SLICED)for(var K=0;3>K;++K)for(var L=K+1,M=0;3>M;++M){var N=M+1,O=I[K].x,P=I[M].y,Q=I[L].x,R=I[N].y,S=J[K].x,T=J[M].y,U=J[L].x,V=J[N].y;0>=Q-O||0>=R-P||0>=U-S||0>=V-T||z(D,u,O,P,Q-O,R-P,S,T,U-S,V-T)}else{var W=I[1].x,X=I[1].y,Y=I[2].x,Z=I[2].y,$=s-F,_=t-H,aa=E,ba=G,ca=x/p-E-F,da=y/p-G-H;s-E-F>32*ca&&(ca=(s-E-F)/32),t-G-H>32*da&&(da=(t-G-H)/32);var ea=Y,fa=Z;if(ca>0&&da>0)for(var ga=ba;_>ga;ga+=da){var N=ga+da;N>_&&(fa=X+(Z-X)*(_-ga)/(N-ga),N=_),ea=Y;for(var ha=aa;$>ha;ha+=ca){var L=ha+ca;L>$&&(ea=W+(Y-W)*($-ha)/(L-ha),L=$),0>=ea-W||0>=fa-X||0>=L-ha||0>=N-ga||z(D,u,W,X,ea-W,fa-X,ha,ga,L-ha,N-ga)}}if(fa=Z,da)for(var ga=ba;_>ga;ga+=da){var N=ga+da;N>_&&(fa=X+(Z-X)*(_-ga)/(N-ga),N=_),z(D,u,v,X,W-v,fa-X,0,ga,E,N-ga),z(D,u,Y,X,v+x-Y,fa-X,$,ga,F,N-ga)}if(ea=Y,ca)for(var ha=aa;$>ha;ha+=ca){var L=ha+ca;L>$&&(ea=W+(Y-W)*($-ha)/(L-ha),L=$),z(D,u,W,w,ea-W,X-w,ha,0,L-ha,G),z(D,u,W,Z,ea-W,w+y-Z,ha,_,L-ha,H)}z(D,u,I[0].x,I[0].y,I[1].x-I[0].x,I[1].y-I[0].y,J[0].x,J[0].y,J[1].x-J[0].x,J[1].y-J[0].y),z(D,u,I[2].x,I[0].y,I[3].x-I[2].x,I[1].y-I[0].y,J[2].x,J[0].y,J[3].x-J[2].x,J[1].y-J[0].y),z(D,u,I[2].x,I[2].y,I[3].x-I[2].x,I[3].y-I[2].y,J[2].x,J[2].y,J[3].x-J[2].x,J[3].y-J[2].y),z(D,u,I[0].x,I[2].y,I[1].x-I[0].x,I[3].y-I[2].y,J[0].x,J[2].y,J[1].x-J[0].x,J[3].y-J[2].y)}}z(o,C,0,0,s,t,q,r,s,t)}}for(var ia=0;ia<this.children.length;ia++)this.children[ia]._renderCanvas(a);if(this._mask&&a.maskManager.popMask(a),this.maskPixel&&b&&d===qc.UIImage.IMAGE_TYPE_SIMPLE){if(o.globalCompositeOperation="destination-in",a.roundPixels?(o.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution|0,this.worldTransform.ty*a.resolution|0),q=0|q,r=0|r):o.setTransform(this.worldTransform.a,this.worldTransform.b,this.worldTransform.c,this.worldTransform.d,this.worldTransform.tx*a.resolution,this.worldTransform.ty*a.resolution),z(o,u,v,w,x,y,q,r,s,t),o.globalCompositeOperation="source-over",a.context=f,a.roundPixels?a.context.setTransform(1,0,0,1,i.x*a.resolution|0,i.y*a.resolution|0):a.context.setTransform(1,0,0,1,i.x*a.resolution,i.y*a.resolution),!n.canvas.height||!n.canvas.width)return;a.drawCount++,a.context.drawImage(n.canvas,0,0,n.canvas.width,n.canvas.height,0,0,n.canvas.width,n.canvas.height),e.push(n)}}},imageFillVBO=function(a,b){switch(b._qc.imageType){case UIImage.IMAGE_TYPE_SLICED:generateSlicedSprite(a,b);break;case UIImage.IMAGE_TYPE_TILED:generateTiledSprite(a,b)}},imageUpdateTransform=function(){var a=this,b=a.parent;if(b&&a.visible){if(a.worldAlpha=a.alpha*b.worldAlpha,!a._isNotNeedCalcTransform||b._isSubNeedCalcTransform){a.game&&a.game._calcTransformCount++,a.rotation!==a.rotationCache&&(a.rotationCache=a.rotation,a._sr=Math.sin(a.rotation),a._cr=Math.cos(a.rotation));var c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x;i=Math.cos(a._qc._skewY||0),j=Math.sin(a._qc._skewY||0),k=-Math.sin(a._qc._skewX||0),l=Math.cos(a._qc._skewX||0),m=a.position.x,n=a.position.y,o=a._cr*a.scale.x,p=a._sr*a.scale.x,q=-a._sr*a.scale.y,r=a._cr*a.scale.y,s=0,t=0,c=o*i+p*k,d=o*j+p*l,e=q*i+r*k,f=q*j+r*l,g=s*i+t*k+m,h=s*j+t*l+n;var y=a.worldTransform,z=b.worldTransform;u=z.a,v=z.b,w=z.c,x=z.d,y.a=c*u+d*w,y.b=c*v+d*x,y.c=e*u+f*w,y.d=e*v+f*x,y.tx=g*u+h*w+z.tx,y.ty=g*v+h*x+z.ty,a.transformCallback&&(y.inUpdate=!1,a.transformCallback.call(a.transformCallbackContext,y,z))}else{a._isSubNeedCalcTransform=!1;var y=a.worldTransform,z=b.worldTransform;a.transformCallback&&(y.inUpdate=!1,a.transformCallback.call(a.transformCallbackContext,y,z))}if(!a._cacheAsBitmap)for(var A=0,B=a.children.length;B>A;A++)a.children[A].updateTransform()}},UIRoot=qc.UIRoot=function(a,b){qc.Node.call(this,new Phaser.Group(a.phaser,null),null,b),this.name="UIRoot";var c=b!==undefined;if(!c){var d=this.addScript("qc.ScaleAdapter");d.referenceResolution=new qc.Point(640,960),d.manualType=qc.ScaleAdapter.EXPAND,d.fullTarget=!0}this.setAnchor(new qc.Point(0,0),new qc.Point(0,0)),this.pivotX=0,this.pivotY=0;var e=this.getWorldScale();this.setTransformToWorld(0,0,e.x,e.y,this.getWorldRotation())};UIRoot.prototype=Object.create(qc.Node.prototype),UIRoot.prototype.constructor=UIRoot,Object.defineProperties(UIRoot.prototype,{"class":{get:function(){return"qc.UIRoot"}}}),UIRoot.prototype.postUpdate=function(){this.x=0,this.y=0};var Sprite=qc.Sprite=function(a,b,c){var d=new Phaser.Sprite(a.phaser);qc.Node.call(this,d,b,c),this.name="Sprite",this.animationType=qc.Sprite.NONE_ANIMATION,this._phaserImageSetFrame=d.setFrame,d.setFrame=setFrame,d._renderWebGL=spriteRenderWebGL,d._renderCanvas=spriteRenderCanvas};Sprite.prototype=Object.create(qc.Node.prototype),Sprite.prototype.constructor=Sprite,Sprite.NONE_ANIMATION=0,Sprite.FRAME_ANIMATION=1,Sprite.DRAGON_BONES=2,Sprite.FRAME_SAMPLES=3;var sInterpolationCo=8;Sprite.prototype.playAnimation=function(a,b,c){var d=this,e=d.animationType;if(e!==Sprite.NONE_ANIMATION&&a){if(e===Sprite.DRAGON_BONES){var f=d._armature.animation;if(f.animationNameList.indexOf(a)<0)return void console.warn("Animation is not exist.",a);var g=undefined;if("number"==typeof b&&1!=b&&b>0){for(var h,i=f.animationNameList.length;i--;)if(f._animationDataList[i].name==a){h=f._animationDataList[i];break}h&&(g=h.duration/b)}var j;return j=c===!0?2097152:c===!1?1:undefined,d.paused=!1,void d._armature.animation.gotoAndPlay(a,undefined,g,j)}var h=this._animation[a];if(!h)return void d.game.log.error("Animation {0} not exists",a);var k=h.rate?h.rate:60;if(e===Sprite.FRAME_SAMPLES&&(k*=sInterpolationCo),!d.phaser.animations._anims[a]){d.phaser.animations.add(a,h.frames,k);var f=d.phaser.animations._anims[a];f.onStart.add(function(){d._onStart&&d._onStart.dispatch(d.lastAnimationName)}),f.onComplete.add(function(){d._onFinished&&d._onFinished.dispatch(d.lastAnimationName)}),f.onLoop.add(function(){d._onLoopFinished&&d._onLoopFinished.dispatch(d.lastAnimationName)})}"boolean"!=typeof c&&(c=!!h.loop),this._slowMotion=this.game.time.timeScale,this._speed=(b?b:1)*k,d.phaser.animations.play(a,this._speed/this._slowMotion,c)}},Sprite.prototype.stop=function(){var a=this,b=a.animationType;if(b!==Sprite.NONE_ANIMATION&&a.isPlaying){if(b===Sprite.DRAGON_BONES){var c=a._armature.animation;return void c.stop()}var d=a.phaser.animations.currentAnim;d&&d.stop(undefined,!0)}},Sprite.prototype.update=function(){if(this.animationType===qc.Sprite.FRAME_SAMPLES&&this.isPlaying&&this.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE),this.animationType===qc.Sprite.DRAGON_BONES&&this._armature){if(this.isPaused())return;var a=.001*this.game.time.deltaTime;this._armature.advanceTime(a)}else if(this.animationType===qc.Sprite.FRAME_ANIMATION||this.animationType===qc.Sprite.FRAME_SAMPLES){var b=this.game.time.timeScale;if(b===this._slowMotion)return;this._slowMotion=b;var c=this.phaser.animations.currentAnim;c&&(c.speed=this._speed/b)}},Sprite.prototype.bindDragonBonesEvent=function(){var a=this;a._armature.addEventListener("start",function(){a._onStart&&a._onStart.dispatch(a.lastAnimationName)}),a._armature.addEventListener("complete",function(){a._onFinished&&a._onFinished.dispatch(a.lastAnimationName)}),a._armature.addEventListener("loopComplete",function(){a._onLoopFinished&&a._onLoopFinished.dispatch(a.lastAnimationName)})},Sprite.prototype.getAnimationInfo=function(a){var b=this.animationType;if(b!==Sprite.NONE_ANIMATION){if(b===Sprite.DRAGON_BONES){var c=this._armature.animation;if(c.animationNameList.indexOf(a)<0)return;for(var d,e=c.animationNameList.length;e--;)if(c._animationDataList[e].name==a){d=c._animationDataList[e];break}return d}var d=this._animation[a];if(d){var f=d.frames||[],g=d.rate?parseFloat(d.rate):30;return{frames:f,frameRate:g,loop:d.loop?0:1,duration:f.length/g}}}},Object.defineProperties(Sprite.prototype,{texture:{get:function(){return this._atlas?new qc.Texture(this._atlas,this.frame):null},set:function(a){var b=this;if(b.animationType===Sprite.DRAGON_BONES&&b._boneBase&&(b.removeChild(b._boneBase),b._armature=null,b._boneBase=null),!a)return b._atlas=null,b.phaser.loadTexture(null,b.frame),void(b.animationType=Sprite.NONE_ANIMATION);a instanceof qc.Atlas&&(a=new qc.Texture(a,b.frame));var c=b._atlas=a.atlas;if(b.animationType=c.animation?c.animation.type:Sprite.NONE_ANIMATION,b.animationType===Sprite.DRAGON_BONES){var d=b._armature=qc.dragonBones.makeQcArmature(c.animation.data,c.json,c.img,c.key);if(!d)return void console.warn("makeQcArmature failed:(img:",c.img,"atlas:",c.json,"skeleton:",c.animation.data,")");b._armature=d;var e=d.getDisplay();b.addChild(e),b._boneBase=e,b.colorTint=b.colorTint}else b.animationType===Sprite.FRAME_ANIMATION?(b._animation=c.animation.data.animations,b.phaser.animations=new Phaser.AnimationManager(b.phaser)):b.animationType===Sprite.FRAME_SAMPLES&&(b._animation=c.animation.data.samples,b.phaser.animations=new Phaser.AnimationManager(b.phaser));c.getFrame(a.frame)||(a.frame=0),b.phaser.key=c.key,b.frame=a.frame,b.paused=!1,b.animationType===Sprite.DRAGON_BONES&&b.bindDragonBonesEvent(),b.defaultAnimation&&(!b.animationNameList||b.animationNameList.indexOf(b.defaultAnimation)<0?b.defaultAnimation=null:b.playAnimation(b.defaultAnimation)),b._dispatchLayoutArgumentChanged("size"),b._onTextureChanged&&b._onTextureChanged.dispatch()}},frame:{get:function(){return this.phaser.frameName},set:function(a){if(this.texture){var b=this.texture.atlas.frameNames||[0];("string"!=typeof a||-1!==b.indexOf(a))&&(this.phaser.loadTexture(this.texture.atlas.key,a,!1),this._dispatchLayoutArgumentChanged("size"),this._onTextureChanged&&this._onTextureChanged.dispatch())}}},defaultAnimation:{get:function(){return this._defaultAnimation},set:function(a){""===a&&(a=null),this._defaultAnimation=a,this.playAnimation(a)}},paused:{get:function(){return this.isPaused()},set:function(a){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:if(!this.phaser.animations.currentAnim)return;this.phaser.animations.paused=a;break;case qc.Sprite.DRAGON_BONES:this._paused=a}}},isPlaying:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var a=this.phaser.animations.currentAnim;return!!a&&a.isPlaying;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsPlaying();default:return!1}}},isComplete:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var a=this.phaser.animations.currentAnim;return!!a&&a.isFinished;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getIsComplete();default:return!1}}},lastAnimationName:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:var a=this.phaser.animations.currentAnim;return a?a.name:null;case qc.Sprite.DRAGON_BONES:return this._armature&&this._armature.animation.getLastAnimationName();default:return!1}}},onStart:{get:function(){return this._onStart||(this._onStart=new Phaser.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new Phaser.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new Phaser.Signal),this._onLoopFinished}},nativeSize:{get:function(){return this.phaser&&this.phaser.texture&&this.phaser.texture.crop||new qc.Rectangle(0,0,0,0)}},armature:{get:function(){return this._armature}},animationNameList:{get:function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:if(!this.texture)return null;var a=this.texture.atlas.animation.data.animations;return a?Object.keys(a):null;case qc.Sprite.DRAGON_BONES:return this._armature?this._armature.animation.animationNameList:null;case qc.Sprite.FRAME_SAMPLES:var b=this._animation;return b?Object.keys(b):null;default:return null}}},colorTint:{get:function(){return new Color(this.phaser.tint)},set:function(a){if(!(a instanceof Color))throw new Error("Expected:qc.Color");this.phaser.tint=a.toNumber(),this.animationType===qc.Sprite.DRAGON_BONES&&this._armature&&this._armature._slotList.forEach(function(b){b._displayList&&b._displayList.forEach(function(b){b.colorTint=a})})}},onTextureChanged:{get:function(){return this._onTextureChanged||(this._onTextureChanged=new Phaser.Signal),this._onTextureChanged}},"class":{get:function(){return"qc.Sprite"}}}),Sprite.prototype.resetNativeSize=function(){this.width=this.nativeSize.width,this.height=this.nativeSize.height},Sprite.prototype.isPaused=function(){switch(this.animationType){case qc.Sprite.FRAME_ANIMATION:case qc.Sprite.FRAME_SAMPLES:return this.phaser.animations.currentAnim?this.phaser.animations.paused:!1;case qc.Sprite.DRAGON_BONES:return this._paused;default:return!1}};var setFrame=function(a){var b=this._qc;b._phaserImageSetFrame.call(this,a),b.animationType!==qc.Sprite.DRAGON_BONES&&(b.setWidth(b.width),b.setHeight(b.height))},_spriteWebGLAddQuad=function(a,b,c,d,e,f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u){a.currentBatchSize>=a.size&&(a.flush(),a.currentBaseTexture=b.texture.baseTexture);var v=a.colors,w=a.positions,x=4*a.currentBatchSize*a.vertSize;a.renderSession.roundPixels?(w[x]=o*c+q*d+s|0,w[x+1]=r*d+p*c+t|0,w[x+5]=o*e+q*f+s|0,w[x+6]=r*f+p*e+t|0,w[x+10]=o*g+q*h+s|0,w[x+11]=r*h+p*g+t|0,w[x+15]=o*i+q*j+s|0,w[x+16]=r*j+p*i+t|0):(w[x]=o*c+q*d+s,w[x+1]=r*d+p*c+t,w[x+5]=o*e+q*f+s,w[x+6]=r*f+p*e+t,w[x+10]=o*g+q*h+s,w[x+11]=r*h+p*g+t,w[x+15]=o*i+q*j+s,w[x+16]=r*j+p*i+t),w[x+2]=k,w[x+3]=l,w[x+7]=m,w[x+8]=l,w[x+12]=m,w[x+13]=n,w[x+17]=k,w[x+18]=n,v[x+4]=v[x+9]=v[x+14]=v[x+19]=u,a.sprites[a.currentBatchSize++]=b},spriteRenderWebGL=function(a){var b=this._qc,c=b.animationType;if(c===qc.Sprite.FRAME_SAMPLES){if(!this.visible||this.alpha<=0||!this.renderable)return;if(!this.animations.currentAnim)return;var d,e,f,g,h=a.spriteBatch,i=this,j=this.animations.currentAnim._frameIndex,k=b.texture.atlas.animation.data,l=k.uvs,m=b.lastAnimationName,n=b._animation[m],o=n.frames,p=i.texture,q=p.baseTexture.resolution,r=i.worldTransform,s=r.a/q,t=r.b/q,u=r.c/q,v=r.d/q,w=r.tx,x=r.ty,y=i.tint,z=i.parent.worldAlpha*i.alpha,A=n.last;y=(y>>16)+(65280&y)+((255&y)<<16);var B,C,D,E,F=-1;k.convert||(k.convert={}),k.convert[m]?D=k.convert[m]:k.convert[m]=D=new Array(o.length),0===(7&j)?(F=j>>3,D[F]||(E=[F])):j===A-1?(F=(j>>3)+1,D[F]||(E=[F])):(B=j>>3,C=B+1,D[B]||D[C]?D[B]?D[C]||(E=[C]):E=[B]:E=[B,C]);var G,H,I,J,K,L,M,N,O;if(E)for(var P=i.texture.baseTexture.width,Q=i.texture.baseTexture.height,R=l.length>>2,S=0,T=E.length;T>S;S++){var U=E[S],V=o[U];if(V){g=new Array(R);for(var W=0,X=V.length/10;X>W;W++){d=10*W,e=4*V[d],g[e]=W;var Y=V[d+1],Z=V[d+2],$=V[d+3],_=V[d+4],aa=V[d+5],ba=V[d+6],ca=V[d+7],da=V[d+8],ea=(l[e+2]-l[e])*P,fa=(l[e+3]-l[e+1])*Q,ga=ea*-ca,ha=fa*-da,ia=ea*(1-ca),ja=fa*(1-da);V[d+1]=Y*ga+$*ha+aa,V[d+2]=Z*ga+_*ha+ba,V[d+3]=Y*ia+$*ha+aa,V[d+4]=Z*ia+_*ha+ba,V[d+5]=Y*ia+$*ja+aa,V[d+6]=Z*ia+_*ja+ba,V[d+7]=Y*ga+$*ja+aa,V[d+8]=Z*ga+_*ja+ba}k.convert[m][U]=!0,k.uvmap||(k.uvmap={}),k.uvmap[m]||(k.uvmap[m]={}),k.uvmap[m][U]=g}else console.log(U,E)}if(F>=0)for(var V=o[F],W=0,X=V.length/10;X>W;W++)d=10*W,e=4*V[d],G=V[d+1],H=V[d+2],I=V[d+3],J=V[d+4],K=V[d+5],L=V[d+6],M=V[d+7],N=V[d+8],O=V[d+9],_spriteWebGLAddQuad(h,i,G,H,I,J,K,L,M,N,l[e],l[e+1],l[e+2],l[e+3],s,t,u,v,w,x,y+(O*z<<24));else for(var ka=(j-(B<<3))/(C===A?A-(B<<3):8),V=o[B],la=o[C],g=k.uvmap[m][C],W=0,X=V.length/10;X>W;W++)d=10*W,e=4*V[d],f=10*g[e],isNaN(f)?(G=V[d+1],H=V[d+2],I=V[d+3],J=V[d+4],K=V[d+5],L=V[d+6],M=V[d+7],N=V[d+8],O=V[d+9]):(G=V[d+1],H=V[d+2],I=V[d+3],J=V[d+4],K=V[d+5],L=V[d+6],M=V[d+7],N=V[d+8],O=V[d+9],G+=(la[f+1]-G)*ka,H+=(la[f+2]-H)*ka,I+=(la[f+3]-I)*ka,J+=(la[f+4]-J)*ka,K+=(la[f+5]-K)*ka,L+=(la[f+6]-L)*ka,M+=(la[f+7]-M)*ka,N+=(la[f+8]-N)*ka,O+=(la[f+9]-O)*ka),_spriteWebGLAddQuad(h,i,G,H,I,J,K,L,M,N,l[e],l[e+1],l[e+2],l[e+3],s,t,u,v,w,x,y+(O*z<<24));return PIXI.DisplayObjectContainer.prototype._renderWebGL.call(this,a)}return c===qc.Sprite.DRAGON_BONES&&b._armature?PIXI.DisplayObjectContainer.prototype._renderWebGL.call(this,a):Phaser.Sprite.prototype._renderWebGL.call(this,a)},spriteRenderCanvas=function(a){var b=this._qc,c=b.animationType;if(c!==qc.Sprite.FRAME_SAMPLES)return c===qc.Sprite.DRAGON_BONES&&b._armature?PIXI.DisplayObjectContainer.prototype._renderCanvas.call(this,a):Phaser.Sprite.prototype._renderCanvas.call(this,a);if(!(this.visible===!1||0===this.alpha||this.renderable===!1||this.texture.crop.width<=0||this.texture.crop.height<=0)&&this.animations.currentAnim){var d=a.context;if(this.blendMode!==a.currentBlendMode&&(a.currentBlendMode=this.blendMode,d.globalCompositeOperation=PIXI.blendModesCanvas[a.currentBlendMode]),this._mask&&a.maskManager.pushMask(this._mask,a),this.texture.valid){var e=this.texture.baseTexture.resolution/a.resolution;!a.smoothProperty||a.scaleMode===this.texture.baseTexture.scaleMode&&d[a.smoothProperty]===(a.scaleMode===PIXI.scaleModes.LINEAR)||(a.scaleMode=this.texture.baseTexture.scaleMode,d[a.smoothProperty]=a.scaleMode===PIXI.scaleModes.LINEAR);var f,g=this.texture.baseTexture.width,h=this.texture.baseTexture.height;if(16777215!==this.tint){if(this.cachedTint!==this.tint){this.cachedTint=this.tint;var i=this.texture.crop,j=i.x,k=i.y,l=i.width,m=i.height;i.x=0,i.y=0,i.width=g,i.height=h,this.tintedTexture=PIXI.CanvasTinter.getTintedTexture(this,this.tint),i.x=j,i.y=k,i.width=l,i.height=m}f=this.tintedTexture}else f=this.texture.baseTexture.source;var n,o,p,q,r,s,t,u,v,w,x,y=this,z=this.animations.currentAnim._frameIndex,A=b.texture.atlas.animation.data,B=A.uvs,C=b.lastAnimationName,D=b._animation[C].frames,E=y.texture.baseTexture.resolution,F=y.worldTransform,G=F.a/E,H=F.b/E,I=F.c/E,J=F.d/E,K=F.tx,L=F.ty,M=b._animation[C].last;if(0===(7&z))n=z>>3,s=D[n];else if(z===M-1)n=(z>>3)+1,s=D[n];else if(o=z>>3,p=o+1,s=D[o],t=D[p],u=(z-(o<<3))/(p===M?M-(o<<3):8),A.uvmap||(A.uvmap={}),A.uvmap[C]?q=A.uvmap[C]:A.uvmap[C]=q=new Array(D.length),q[p])r=q[p];else{var N=B.length>>2;r=new Array(N),t=D[p];for(var O=0,P=t.length/10;P>O;O++)w=4*t[10*O],r[w]=O;q[p]=r}for(var Q=this.parent.worldAlpha*y.alpha,O=0,P=s.length/10;P>O;O++){v=10*O,w=4*s[v];var R=s[v+1],S=s[v+2],T=s[v+3],U=s[v+4],V=s[v+5],W=s[v+6],X=s[v+7],Y=s[v+8],Z=s[v+9];p&&(x=10*r[w],isNaN(x)||(R+=(t[x+1]-R)*u,S+=(t[x+2]-S)*u,T+=(t[x+3]-T)*u,U+=(t[x+4]-U)*u,V+=(t[x+5]-V)*u,W+=(t[x+6]-W)*u,X+=(t[x+7]-X)*u,Y+=(t[x+8]-Y)*u,Z+=(t[x+9]-Z)*u));var $=B[w]*g,_=B[w+1]*h,aa=B[w+2]*g,ba=B[w+3]*h,ca=R*G+S*I,da=R*H+S*J,ea=T*G+U*I,fa=T*H+U*J,ga=(V*G+W*I+K)*a.resolution,ha=(V*H+W*J+L)*a.resolution,ia=aa-$,ja=ba-_,ka=ia*-X,la=ja*-Y;a.roundPixels?(d.setTransform(ca,da,ea,fa,0|ga,0|ha),ka=0|ka,la=0|la):d.setTransform(ca,da,ea,fa,ga,ha),d.globalAlpha=Q*(Z/255),d.drawImage(f,$,_,ia,ja,ka/e,la/e,ia/e,ja/e)}}for(var ma=this.children,O=0;O<ma.length;O++)ma[O]._renderCanvas(a);this._mask&&a.maskManager.popMask(a)}};Sprite.prototype.getSampledAnimationBounds=function(){var a=this.animationType;if(a!==qc.Sprite.FRAME_SAMPLES)return new qc.Rectangle(0,0,0,0);var b=this.lastAnimationName;if(!b)return new qc.Rectangle(0,0,0,0);var c=this.texture.atlas.animation.data,d=c.bounds;

d||(d=c.bounds={});var e=d[b];if(e)return e;var f,g,h,i,j,k,l,m,n,o,p,q,r,s,t,u,v,w,x,y,z,A,B,C,D,E,F,G,H,I,J=c.uvs,K=this.phaser.texture.baseTexture.width,L=this.phaser.texture.baseTexture.height,M=this._animation[b],N=c.convert?c.convert[b]||{}:{},O=1/0,P=1/0,Q=-(1/0),R=-(1/0);for(f=0,g=M.frames.length;g>f;f++)for(h=M.frames[f],k=N[f],i=0,j=h.length/10;j>i;i++)l=10*i,m=4*h[l],k?(B=h[l+1],F=h[l+2],C=h[l+3],G=h[l+4],D=h[l+5],H=h[l+6],E=h[l+7],I=h[l+8]):(n=h[l+1],o=h[l+2],p=h[l+3],q=h[l+4],r=h[l+5],s=h[l+6],t=h[l+7],u=h[l+8],v=(J[m+2]-J[m])*K,w=(J[m+3]-J[m+1])*L,x=v*-t,y=w*-u,z=v*(1-t),A=w*(1-u),B=n*x+p*y+r,F=o*x+q*y+s,C=n*z+p*y+r,G=o*z+q*y+s,D=n*z+p*A+r,H=o*z+q*A+s,E=n*x+p*A+r,I=o*x+q*A+s),O=Math.min(O,B,C,D,E),Q=Math.max(Q,B,C,D,E),P=Math.min(P,F,G,H,I),R=Math.max(R,F,G,H,I);return e=d[b]=new qc.Rectangle(O,P,Q-O,R-P)},Sprite.prototype.setWidth=function(a){Node.prototype.setWidth.call(this,a),this.phaser.texture.trim||(this.phaser.texture.frame.width=a)},Sprite.prototype.setHeight=function(a){Node.prototype.setHeight.call(this,a),this.phaser.texture.trim||(this.phaser.texture.frame.height=a)},Sprite.prototype.getMeta=function(){var a=qc.Serializer,b=qc.Node.prototype.getMeta.call(this);return b.texture=a.TEXTURE,b.frame=a.AUTO,b.defaultAnimation=a.STRING,b};var UIText=qc.UIText=function(a,b,c){qc.Node.call(this,new Phaser.Group(a.phaser,null),b,c),this.textPhaser=new Phaser.Text(a.phaser),this.textPhaser._nqc=this,this.textPhaser.wordWrapWidth=this.width,this.phaser.addChildAt(this.textPhaser,0),this.textRealWidth=0,this.textRealHeight=0,this.fontSize=12,this._glowText=null,this.name="UIText",this._data="",this._colors=[],this.color=Color.black,this._gradient=!1,this.startColor=Color.red,this.endColor=Color.black,this._fontFamily=UIText.SYSTEMFONT,this.textPhaser.updateText=UIText._phaserUpdateText,this.textPhaser.determineFontProperties=UIText._phaserDetermineFontProperties,this.shadowBlur=10,this.shadowOffsetX=3,this.shadowOffsetY=3,this.shadowColor=Color.shadow,this._enableShadow=!1,this._enableGlow=!1,this.glowColor=Color.red,this.stroke=Color.black,this._strokeThickness=0,this._glowBlur=1,this._wrap=!1,this._wrapWidth=this.width,this._autoSize=!1,this._onPhaseTextSizeChange=new Phaser.Signal,this._onPhaseTextSizeChange.add(function(a,b){this.autoSize&&(this.width=a,this.height=b)},this);var d=c!==undefined;d!==!0&&(this.bold=!1,this.alignH=UIText.LEFT,this.alignV=UIText.MIDDLE,this.overflow=!0)};UIText.prototype=Object.create(qc.Node.prototype),UIText.prototype.constructor=UIText,UIText.LEFT=0,UIText.RIGHT=1,UIText.CENTER=2,UIText.TOP=0,UIText.BOTTOM=1,UIText.MIDDLE=2,UIText.SYSTEMFONT=0,UIText.WEBFONT=1,UIText.BITMAPFONT=2,UIText._SYMBOL_COLOR=0,UIText._SYMBOL_END_COLOR=1,Object.defineProperties(UIText.prototype,{colorTint:{get:function(){return new Color(this.textPhaser.tint)},set:function(a){if(a=a||new Color(16777215),!(a instanceof Color))throw new Error("Expected qc.Color");this.textPhaser.tint=a.toNumber()}},autoSize:{get:function(){return this._autoSize},set:function(a){a!==this._autoSize&&(this._autoSize=a,a&&this.textPhaser&&(this.width=this.textPhaser.width,this.height=this.textPhaser.height))}},fontFamily:{get:function(){return this._fontFamily},set:function(a){this._fontFamily!==a&&(this._fontFamily=a,this._changeText(""),this._isTransformDirty=!0)}},alignH:{get:function(){return this._alignH},set:function(a){a!==this._alignH&&(this._alignH=a,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},alignV:{get:function(){return this._alignV},set:function(a){a!==this._alignV&&(this._alignV=a,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},font:{get:function(){var a=this.textPhaser.font.replace(/\'/g,"");return this.fontFamily!==UIText.SYSTEMFONT?this.game.assets.find(a):a},set:function(a){if(a){var b=a;if(this.fontFamily!==UIText.SYSTEMFONT){if(!(a instanceof qc.Font))return void this.game.log.error("Expected qc.Font");if(this.fontFamily!==a._fontFamily)return void this.game.log.error("Invalid font asset");b=this.fontFamily===UIText.WEBFONT?a.uuid:a.url}else if("string"!=typeof a)return void this.game.log.error("Expected string");b!==this.textPhaser.font&&(this._changeText(b),this.enableGlow&&(this._glowText.font=b),this._isTransformDirty=!0)}}},bold:{get:function(){return"normal"!==this.textPhaser.fontWeight},set:function(a){var b=a?"bold":"normal";b!==this.textPhaser.fontWeight&&(this.textPhaser.fontWeight=b,this._enableGlow&&(this._glowText.fontWeight=b),this._isTransformDirty=!0)}},fontSize:{get:function(){return this.textPhaser.fontSize},set:function(a){if("number"!=typeof a)throw new Error("Expected number");a!==this.textPhaser.fontSize&&(this.textPhaser.fontSize=a,this._enableGlow&&(this._glowText.fontSize=a),this._isTransformDirty=!0)}},color:{get:function(){return new Color(this.textPhaser.fill)},set:function(a){if(!(a instanceof Color))throw new Error("Expected qc.Color");var b=a.toString("rgb");b!==this.textPhaser.fill&&(this.textPhaser.fill=b,this._setTextColor(this.textPhaser),this._enableGlow&&(this._glowText.fill=b),this._isTransformDirty=!0)}},text:{get:function(){return this._data},set:function(a){if("string"!=typeof a)throw new Error("Expected string");a!==this._data&&(this._colors=[],this._data=a,this._parseTextColor(a),this._setTextColor(this.textPhaser),this._enableGlow&&(this._glowText.text=this.textPhaser.text),this._isTransformDirty=!0)}},lineSpacing:{get:function(){return this.textPhaser.lineSpacing},set:function(a){a!==this.textPhaser.lineSpacing&&(this.textPhaser.lineSpacing=a,this._enableGlow&&(this._glowText.lineSpacing=a),this._isTransformDirty=!0)}},wrap:{get:function(){return this._wrap},set:function(a){a!==this._wrap&&(this._wrap=a,this.textPhaser.wordWrap=a,this._enableGlow&&(this._glowText.wordWrap=a),this._isTransformDirty=!0)}},overflow:{get:function(){var a=this.getScript("qc.NodeMask");return a&&a.enable?!1:!0},set:function(a){var b=this.getScript("qc.NodeMask");b||(b=this.addScript("qc.NodeMask")),b.enable=!a}},pivotX:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotX").get.call(this)},set:function(a){Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotX").set.call(this,a),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},pivotY:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotY").get.call(this)},set:function(a){Object.getOwnPropertyDescriptor(qc.Node.prototype,"pivotY").set.call(this,a),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0}},width:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").get.call(this)},set:function(a){a!==this.width&&(Object.getOwnPropertyDescriptor(qc.Node.prototype,"width").set.call(this,a),this._wrapWidth=a,this._enableGlow&&(this._glowText.wordWrapWidth=a),this.textPhaser&&(this.textPhaser.wordWrapWidth=a,this._adjustTextPos()),this._isTransformDirty=!0)}},height:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").get.call(this)},set:function(a){a!==this.height&&(Object.getOwnPropertyDescriptor(qc.Node.prototype,"height").set.call(this,a),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos()),this._isTransformDirty=!0)}},"class":{get:function(){return"qc.UIText"}},startColor:{get:function(){return new Color(this._startColor)},set:function(a){if(!(a instanceof Color))throw new Error("Expected qc.Color");var b=a.toString();b!==this._startColor&&(this._startColor=b,this.textPhaser.dirty=!0)}},endColor:{get:function(){return new Color(this._endColor)},set:function(a){if(!(a instanceof Color))throw new Error("Expected qc.Color");var b=a.toString();b!==this._endColor&&(this._endColor=b,this.textPhaser.dirty=!0)}},gradient:{get:function(){return this._gradient},set:function(a){a!==this._gradient&&(this._gradient=a,this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},stroke:{get:function(){return new Color(this.textPhaser.stroke)},set:function(a){if(!(a instanceof Color))throw new Error("Expected qc.Color");var b=a.toString();b!==this.textPhaser.stroke&&(this.textPhaser.stroke=b,this._isTransformDirty=!0)}},strokeThickness:{get:function(){return this._strokeThickness},set:function(a){a!==this._strokeThickness&&(this._strokeThickness=a,this._enableGlow&&(this._glowText.strokeThickness=this.textPhaser.strokeThickness,this._glowText.dirty=!0),this.textPhaser.dirty=!0,this._isTransformDirty=!0)}},enableShadow:{get:function(){return this._enableShadow},set:function(a){this._enableShadow=a,this.textPhaser.dirty=!0,this._isTransformDirty=!0}},shadowColor:{get:function(){return new Color(this.textPhaser.shadowColor)},set:function(a){if(!(a instanceof Color))throw new Error("Expected qc.Color");var b=a.toString();b!==this.textPhaser.shadowColor&&(this.textPhaser.shadowColor=b,this._isTransformDirty=!0)}},shadowBlur:{get:function(){return this.textPhaser.shadowBlur},set:function(a){a!==this.textPhaser.shadowBlur&&(this.textPhaser.shadowBlur=a,this._isTransformDirty=!0)}},shadowOffsetX:{get:function(){return this.textPhaser.shadowOffsetX},set:function(a){this.textPhaser.shadowOffsetX=a,this._isTransformDirty=!0}},shadowOffsetY:{get:function(){return this.textPhaser.shadowOffsetY},set:function(a){this.textPhaser.shadowOffsetY=a,this._isTransformDirty=!0}},glowColor:{get:function(){return new Color(this._glowColor)},set:function(a){if(!(a instanceof Color))throw new Error("Expected qc.Color");var b=a.toString();b!==this._glowColor&&(this._glowColor=b,this._glowText&&(this._glowText.fill=b,this._glowText.stroke=b,this._glowText.dirty=!0))}},glowBlur:{get:function(){return this._glowBlur},set:function(a){a!==this._glowBlur&&(this._glowBlur=a,this.enableGlow&&(this._glowText.filterX.blur=a,this._glowText.filterY.blur=a))}},enableGlow:{get:function(){return this._enableGlow},set:function(a){if(a!==this._enableGlow){if(this._enableGlow=a,a){this._glowText=new Phaser.Text(this.game.phaser),this._glowText._nqc=this,this._copyProperty(this._glowText,this.textPhaser),this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.fill=this._glowColor,this._glowText.stroke=this._glowColor,this._glowText.shadowColor=this._glowColor,this._glowText.scale=this.textPhaser.scale,this._glowText.pivot=this.textPhaser.pivot,this._glowText.rotation=this.textPhaser.rotation,this._glowText.updateText=UIText._phaserUpdateText,this._glowText.determineFontProperties=UIText._phaserDetermineFontProperties,this._glowText.font=this.textPhaser.font,this.phaser.addChildAt(this._glowText,0);var b=new qc.Filter.BlurX(this.game),c=new qc.Filter.BlurY(this.game);b.blur=this.glowBlur,c.blur=this.glowBlur,this._glowText.filters=[b,c],this._glowText.filterX=b,this._glowText.filterY=c}else this.phaser.removeChild(this._glowText),this._glowText.destroy(),this._glowText=null,this.textPhaser.dirty=!0;this._isTransformDirty=!0}}},nativeSize:{get:function(){var a=this.rect;return a.width=this.textRealWidth,a.height=this.textRealHeight,a}}}),UIText.prototype._changeText=function(a){var b,c=PIXI.BitmapText.fonts[a];c?(b=new Phaser.BitmapText(this.game.phaser,0,0,a),this._glowText&&(this._glowText.visible=!1)):(b=new Phaser.Text(this.game.phaser),b.updateText=UIText._phaserUpdateText,b.determineFontProperties=UIText._phaserDetermineFontProperties,this._glowText&&(this._glowText.visible=!0)),b.font=a,b._nqc=this,this._copyProperty(b,this.textPhaser),b.x=this.textPhaser.x,b.y=this.textPhaser.y,this._glowText&&(this._glowText.font=b.font);var d=this.phaser.getChildIndex(this.textPhaser);this.phaser.removeAt?this.phaser.removeAt(d):this.phaser.removeChildAt(d),this.phaser.addAt?this.phaser.addAt(b,d):this.phaser.addChildAt(b,d),this.textPhaser.destroy(),this.textPhaser=b,this._isTransformDirty=!0,this._setTextColor(this.textPhaser)},UIText.prototype.setWidth=function(a){qc.Node.prototype.setWidth.call(this,a),this._wrapWidth=a,this.textPhaser&&(this.textPhaser.wordWrapWidth=a,this._adjustTextPos())},UIText.prototype.setHeight=function(a){qc.Node.prototype.setHeight.call(this,a),this.textPhaser&&(this.textPhaser.dirty=!0,this._adjustTextPos())},UIText.prototype.postUpdate=function(){var a=this,b=this.textPhaser;if(b.dirty)b.updateText();else{var c=a.getWorldScale(),d=a._preWorldScale,e=a.game.time.fixedTime;if(d)if(d.x!==c.x||d.y!==c.y)d.x=c.x,d.y=c.y,a._worldScaleChangeTime=e,0===a.scaleDirtyInterval&&b.updateText();else{var f=b._worldScale,g=a.scaleDirtyInterval||textScaleDirtyInterval;e-a._worldScaleChangeTime>g&&(!f||c.x!==f.x||c.y!==f.y)&&b.updateText()}else a._preWorldScale=new qc.Point(c.x,c.y),a._worldScaleChangeTime=e}},UIText.prototype._copyProperty=function(a,b){a.align=b.align,a.fontWeight=b.fontWeight,a.fontSize=b.fontSize,a.lineSpacing=b.lineSpacing,a.wordWrap=this._wrap,a.name=b.name,a.scale=b.scale,a.pivot=b.pivot,a.rotation=b.rotation,a.alpha=b.alpha,a.visible=b.visible,a.renderable=b.renderable,a.mask=b.mask,a.text=b.text,a.wordWrapWidth=this._wrapWidth,a.stroke=b.stroke,a.strokeThickness=b.strokeThickness,a.shadowColor=b.shadowColor,a.shadowOffsetX=b.shadowOffsetX,a.shadowOffsetY=b.shadowOffsetY,a.fill=b.fill,a.fontFamily=this.fontFamily},UIText.prototype._parseSymbol=function(a,b,c){var d={};if(d.result=!1,"["!==a[b])return d;for(var e=b;++e;){if("["===a[e]||e>=a.length||e-b>25)return d;if("]"===a[e])break}var f=e-b;return f>2&&"#"===a[b+1]?(d.color=a.slice(b+1,e),d.result=!0,d.type=UIText._SYMBOL_COLOR):f>6&&"r"===a[b+1]&&"g"===a[b+2]&&"b"===a[b+3]?(d.color=a.slice(b+1,e),d.result=!0,d.type=UIText._SYMBOL_COLOR):"-"===a[b+1]&&"]"===a[b+2]&&(c.length>0&&(d.result=!0),d.type=UIText._SYMBOL_END_COLOR),d.result&&(d.pos=e),d},UIText.prototype._pushColor=function(a,b){var c={};c.color=a,c.pos=b,this._colors.push(c),this._isTransformDirty=!0},UIText.prototype._setTextColor=function(a){if(a.clearColors&&a.clearColors(),a.addColor){for(var b=0;b<this._colors.length;b++){var c="defaultColor"===this._colors[b].color?"defaultColor":this._colors[b].color;a.addColor(c,this._colors[b].pos)}this._isTransformDirty=!0}},UIText.prototype._parseTextColor=function(a){a=a.replace(/(?:\r\n|\r|\n)/g,"\n");for(var b="",c=[],d=0;d<a.length;d++){var e=this._parseSymbol(a,d,c);if(e.result){if(d=e.pos,e.type===UIText._SYMBOL_COLOR)c.push(e.color),this._pushColor(e.color,b.length);else if(e.type===UIText._SYMBOL_END_COLOR){c.pop();var f=c.length>0?c[c.length-1]:"defaultColor";this._pushColor(f,b.length)}}else b+=a[d]}this.textPhaser.text=b,this._isTransformDirty=!0},UIText.prototype.getMeta=function(){var a=Node.prototype.getMeta.call(this);return a.fontFamily=Serializer.NUMBER,a.alignH=Serializer.NUMBER,a.alignV=Serializer.NUMBER,a.font=Serializer.FONT,a.bold=Serializer.BOOLEAN,a.fontSize=Serializer.NUMBER,a.color=Serializer.COLOR,a.text=Serializer.STRING,a.lineSpacing=Serializer.NUMBER,a.wrap=Serializer.BOOLEAN,a.enableGlow=Serializer.BOOLEAN,a.startColor=Serializer.COLOR,a.endColor=Serializer.COLOR,a.gradient=Serializer.BOOLEAN,a.stroke=Serializer.COLOR,a.strokeThickness=Serializer.NUMBER,a.glowColor=Serializer.COLOR,a.autoSize=Serializer.BOOLEAN,a.shadowColor=Serializer.COLOR,a.shadowBlur=Serializer.NUMBER,a.shadowOffsetX=Serializer.NUMBER,a.shadowOffsetY=Serializer.NUMBER,a.enableShadow=Serializer.BOOLEAN,a},UIText.prototype._adjustTextPos=function(){var a=this.textPhaser.realWidth,b=this.textPhaser.realHeight;this.textPhaser.x=-this.pivotX*this.width,this._alignH===UIText.RIGHT?this.textPhaser.x=this.textPhaser.x+this.width-a:this._alignH===UIText.CENTER&&(this.textPhaser.x=this.textPhaser.x+(this.width-a)/2),this.textPhaser.y=-this.pivotY*this.height,this._alignV===UIText.BOTTOM?this.textPhaser.y=this.textPhaser.y+this.height-b:this._alignV===UIText.MIDDLE&&(this.textPhaser.y=this.textPhaser.y+(this.height-b)/2),this._shiftCanvas&&(this.textPhaser.x-=this._shiftCanvas[0],this.textPhaser.y-=this._shiftCanvas[1]),this._enableGlow&&(this._glowText.x=this.textPhaser.x,this._glowText.y=this.textPhaser.y,this._glowText.dirty=!0),this._isTransformDirty=!0},UIText.prototype._refreshWebFont=function(a){/^(?:inherit|serif|sans-serif|cursive|fantasy|monospace)$/.exec(a)||/['",]/.exec(a)||(a="'"+a+"'"),a===this.textPhaser.font&&(this.textPhaser.dirty=!0,this._glowText&&(this._glowText.dirty=!0),this._isTransformDirty=!0)},UIText._phaserUpdateText=function(){var a=!this._canvasMode;a&&(this.texture=PIXI.Text.drawSprite);var b=this._nqc,c=this.canvas,d=this.context,e=b.getWorldScale(),f=b.game.device.desktop,g=f?1920:Math.max(960,b.game.world.width),h=f?1920:Math.max(960,b.game.world.height),i=b.game.device.phaser.UCBrowser;this._worldScale=new qc.Point(e.x,e.y);var j=Math.max(.2,Math.min(10,Math.abs(e.x))),k=Math.max(.2,Math.min(10,Math.abs(e.y))),l=this.resolution=b.game.resolution;this.texture.baseTexture.resolution=l,this.texture.baseTexture.scaleMode=PIXI.scaleModes.NEAREST,d.font=this.style.font;var m=this.text,n=b.width;if(this.style.wordWrap){m=m.replace(/(?:\r\n|\r|\n)/g,"\n");var o=this.runWordWrap(m,n)}else for(var o=m.split(/(?:\r\n|\r|\n)/),p=0;p<o.length-1;p++)o[p]+="\n";for(var q=b,r=[],s=0,t=this.determineFontProperties(d.font).fontSize,p=0;p<o.length;p++){var u=this._getWorldWidth(o[p]);r[p]=u,s=Math.max(s,u)}s=Math.ceil(s);var v=this.style.stroke?q._strokeThickness:0,w=b.enableShadow?this.style.shadowOffsetX:0,x=b.enableShadow?this.style.shadowOffsetY:0,y=this.realWidth=s;this.realWidth=y,y*l*j>g&&(j=g/(y*l));var z=t,A=z*o.length,B=this._lineSpacing;if(0>B&&Math.abs(B)>z&&(B=-z),0!==B){var C=B*(o.length-1);A+=C}var D=this.realHeight=A;D*l*k>h&&(k=h/(D*l)),q.textRealWidth=s,q.textRealHeight=A;var E=Math.min(j,k);w*=E*l,x*=E*l,this._shadowOffset=[w,x];var F=v*E*l/2;y=y*l*E+F+Math.max(Math.abs(w),F),D=D*l*E+F+Math.max(Math.abs(x),F),c.width=Math.max(Math.ceil(y),1),c.height=Math.max(Math.ceil(D),1),this._canvasDownScale=new qc.Point(1/E,1/E),d.scale(l*E,l*E);var G,H;G=H=F,0>w&&(G=Math.max(G,-w)),0>x&&(H=Math.max(H,-x)),G/=E*l,H/=E*l,b._shiftCanvas=[G,H],d.translate(G,H);var I=[];for(p=0;p<o.length;p++){var J=0;q._alignH===UIText.RIGHT?J=this.realWidth-r[p]:q._alignH===UIText.CENTER&&(J=(this.realWidth-r[p])/2),I.push(J)}var K=0;q._alignV===UIText.BOTTOM?K=this.realHeight-A:q._alignV===UIText.MIDDLE&&(K=(this.realHeight-A)/2),navigator.isCocoonJS&&d.clearRect(0,0,this.realWidth,this.realHeight),d.font=this.style.font,d.strokeStyle=this.style.stroke,d.textBaseline="middle",q.enableShadow&&(d.shadowOffsetX=w,d.shadowOffsetY=x,d.shadowColor=this.style.shadowColor,d.shadowBlur=this.style.shadowBlur),d.lineCap="round",d.lineJoin="round",d.lineWidth=v,this._charCount=0;var L;if(q._gradient){L=d.createLinearGradient(0,K,0,K+A*this.scale.y);var M=1/o.length;L.addColorStop(0,q._startColor);for(var p=1;p<o.length;p++)L.addColorStop(M*p,q._endColor),L.addColorStop(M*p,q._startColor);L.addColorStop(1,q._endColor),d.fillStyle=L}else d.fillStyle=this.style.fill;var N,O,P=d.fillStyle,Q=d.strokeStyle;for(p=0;p<o.length;p++)if(N=I[p],O=K+p*z+z/2,p>0&&(O+=B*p),this.colors.length>0)this.updateLine(o[p],N,O,d,v,P,Q,z,L,i);else if(this.style.stroke&&v&&(this._clearShadowStyle(d),d.strokeText(o[p],N,O),this._restoreShadowStyle(d)),this.style.fill)if(L&&i){if(d.save(),d.fillStyle="black",d.fillText(o[p],N,O),d.globalCompositeOperation="source-in",d.fillStyle=L,d.beginPath(),d.rect(N,O-z/2,r[p],z),d.clip(),d.fillRect(N,O-z/2,r[p],z),d.restore(),qc.__IS_ANDROID_UC){var R=qc._tempCanvas;R||(R=qc._tempCanvas=document.createElement("canvas"),R.width=128,R.height=128),d.drawImage(R,0,0,2,2,-5,-5,1,1)}}else d.fillText(o[p],N,O);this.updateTexture(),a&&this._uploadToRenderTexture(),this.cachedTint=null,b._adjustTextPos(),this.getWorldTransform(),this.dirty=!1},UIText._phaserDetermineFontProperties=function(a){var b=PIXI.Text.fontPropertiesCache[a];if(!b){b={},PIXI.Text.fontPropertiesCanvas||(PIXI.Text.fontPropertiesCanvas=PIXI.sharedCanvas,PIXI.Text.fontPropertiesContext=PIXI.Text.fontPropertiesCanvas.getContext("2d"));var c=PIXI.Text.fontPropertiesCanvas,d=PIXI.Text.fontPropertiesContext;d.font=a;var e=Math.ceil(d.measureText("|MÉq").width);0===e&&(e=1);var f=Math.ceil(d.measureText("M").width),g=2*f;0===g&&(g=1),f=1.4*f|0,c.width=e,c.height=g,d.fillStyle="#f00",d.fillRect(0,0,e,g),d.font=a,d.textBaseline="alphabetic",d.fillStyle="#000",d.fillText("|MÉq",0,f);var h,i,j=d.getImageData(0,0,e,g).data,k=j.length,l=4*e,m=0,n=!1;for(h=0;f>h;h++){for(i=0;l>i;i+=4)if(255!==j[m+i]){n=!0;break}if(n)break;m+=l}for(b.ascent=f-h,m=k-l,n=!1,h=g;h>f;h--){for(i=0;l>i;i+=4)if(255!==j[m+i]){n=!0;break}if(n)break;m-=l}b.descent=h-f,b.fontSize=b.ascent+b.descent,PIXI.Text.fontPropertiesCache[a]=b}return b};var Button=qc.Button=function(a,b,c){qc.UIImage.call(this,a,b,c),this.name="Button",this.onStateChange=new qc.Signal;var d=c!==undefined;if(d!==!0){this.text=a.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.interactive=!0,this.state=qc.UIState.NORMAL;var e=this.addScript("qc.TransitionBehaviour");e.target=this,this.width=120,this.height=40,this.text.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),this.text.left=0,this.text.right=0,this.text.top=0,this.text.bottom=0,this.text.alignH=UIText.CENTER}var f=this;this.onDown.add(function(){f.state!==qc.UIState.DISABLED&&(f.state=qc.UIState.PRESSED)}),this.onUp.add(function(){f.state===qc.UIState.PRESSED&&(f.state=qc.UIState.NORMAL)}),this._onNativeElementClick=this._processNativeClick.bind(this)};Button.prototype=Object.create(qc.UIImage.prototype),Button.prototype.constructor=Button,Object.defineProperties(Button.prototype,{state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this.onStateChange.dispatch())}},colorTint:{get:function(){return Object.getOwnPropertyDescriptor(qc.Node.prototype,"colorTint").get.call(this)},set:function(a){Object.getOwnPropertyDescriptor(qc.Node.prototype,"colorTint").set.call(this,a),this.text&&(this.text.colorTint=a)}},supportNativeEvent:{get:function(){return this._supportNativeEvent},set:function(a){a!==this._supportNativeEvent&&(this._supportNativeEvent=a,this._checkNativeElement())}},onNativeClick:{get:function(){return this._onNativeClick||(this._onNativeClick=new Phaser.Signal),this._onNativeClick}},"class":{get:function(){return"qc.Button"}}}),Button.prototype.getMeta=function(){var a=qc.Serializer,b=qc.UIImage.prototype.getMeta.call(this);return b.text=a.NODE,b.state=a.NUMBER,b.supportNativeEvent=a.BOOLEAN,b},Button.prototype.update=function(a){this.isWorldVisible()&&this.supportNativeEvent?(this._checkNativeElement(),a&&this._updateNativeElement()):this._removeNativeElement()},Button.prototype.onVisibleChange=function(){this.update(!0)},Button.prototype.onDestroy=function(){this._removeNativeElement(),qc.UIImage.prototype.onDestroy.call(this)},Button.prototype._checkNativeElement=function(){this.supportNativeEvent&&this.worldVisible&&!this._nativeElement?this._createNativeElement():!this._nativeElement||this.supportNativeEvent&&this.worldVisible||this._removeNativeElement()},Button.prototype._createNativeElement=function(){var a=this;if(!a._nativeElement){var b=a._nativeElement=document.createElement("div");b.addEventListener("click",a._onNativeElementClick,!1),b.addEventListener("touchstart",a._onNativeElementClick,!1);var c=b.style;c.position="absolute",c.padding=0,c.margin=0,c.border=0,c.outline=0,c.background="none",a.game.world.frontDomRoot.appendChild(b),a._updateNativeElement(),a.phaser.worldTransformChangedCallback=a._updateNativeElement.bind(a),a.phaser.worldTransformChangedContext=a}},Button.prototype._removeNativeElement=function(){var a=this._nativeElement;a&&(this._nativeElement=null,a.removeEventListener("click",this._onNativeElementClick,!1),a.removeEventListener("touchstart",this._onNativeElementClick,!1),qc.Util.removeHTML(a))},Button.prototype._updateNativeElement=function(){var a=this,b=a._nativeElement;b&&(b._lastUpdate=a.game.time.now,qc.Util.updateTransform(a,b))},Button.prototype._processNativeClick=function(a){this.worldVisible||this._checkNativeElement(),this._onNativeClick&&this._onNativeClick.getNumListeners()>0&&this._onNativeClick.dispatch(this,a)};var Toggle=qc.Toggle=function(a,b,c){qc.Node.call(this,new Phaser.Group(a.phaser,null),b,c),this.name="Toggle",this.interactive=!0,this.onStateChange=new qc.Signal,this.onValueChange=new qc.Signal,this.canValueChange=new qc.Signal;var d=c!==undefined;if(d!==!0){this.background=a.add.image(this),this.background.name="Background",this.background.interactive=!1,this.background.width=80,this.background.height=80,this.checkMark=a.add.image(this.background),this.checkMark.name="CheckMark",this.checkMark.interactive=!1,this.text=a.add.text(this),this.text.text="Button",this.text.name="Text",this.text.interactive=!1,this.on=!1,this.state=qc.UIState.NORMAL,this.checkMark.pivotX=.5,this.checkMark.pivotY=.5,this.checkMark.setAnchor(new qc.Point(.5,.5),new qc.Point(.5,.5)),this.checkMark.anchoredX=0,this.checkMark.anchoredY=0,this.checkMark.width=50,this.checkMark.height=50,this.text.x=this.background.width+5,this.text.height=this.background.height;var e=this.addScript("qc.TransitionBehaviour");e.target=this.background,e.transition=qc.Transition.TEXTURE_SWAP}var f=this;this.onDown.add(function(){f.state!==qc.UIState.DISABLED&&(f.state=qc.UIState.PRESSED)}),this.onUp.add(function(){f.state===qc.UIState.PRESSED&&(f.state=qc.UIState.NORMAL)}),this.onClick.add(function(){f.on=!f.on,f.checkMark.visible=f.on})};Toggle.prototype=Object.create(qc.Node.prototype),Toggle.prototype.constructor=Toggle,Object.defineProperties(Toggle.prototype,{on:{get:function(){return!!this._on},set:function(a){var b=this.on,c={};this.canValueChange.dispatch(this,a,b,c),c.ignore||(this._on=a,this.checkMark.visible=a,b!==a&&this.onValueChange.dispatch(this))}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this.onStateChange.dispatch())}},"class":{get:function(){return"qc.Toggle"}}}),Toggle.prototype.getMeta=function(){var a=qc.Serializer,b=qc.Node.prototype.getMeta.call(this);return b.background=a.NODE,b.checkMark=a.NODE,b.text=a.NODE,b.on=_CUSTOM_FIELD("on",a.BOOLEAN),b.state=_CUSTOM_FIELD("state",a.NUMBER),b};var Sound=qc.Sound=function(a,b,c){this.soundPhaser=new Phaser.Sound(a.phaser),this.soundPhaser._qc=this,this._loop=!1,this.game=a,qc.Node.call(this,new Phaser.Group(this.game.phaser,null),b,c),this.name="Sound",this._related(),a.phaser.sound._sounds.push(this.soundPhaser),this._playOnAwake=!1,this.destroyWhenStop=!0};Sound.prototype=Object.create(qc.Node.prototype),Sound.prototype.constructor=Sound,Object.defineProperties(Sound.prototype,{loop:{get:function(){return this.soundPhaser.loop},set:function(a){this._loop=a,this.soundPhaser.loop=a,this.soundPhaser._sound&&(this.soundPhaser._sound.loop=a)}},audio:{get:function(){return this.game.assets.find(this.soundPhaser.key)},set:function(a){var b=this.soundPhaser;if(!a)return void(b.key=a);var c=a.key;if(b&&b.key){var d=this.loop,e=this.mute,f=this.volume;b.destroy(),b=this.soundPhaser=new Phaser.Sound(this.game.phaser,c),b._qc=this,this.game.phaser.sound._sounds.push(b),this.loop=d,this.mute=e,this.volume=f}else b.key=c,b.usingAudioTag&&(b.game.cache.getSound(c)&&b.game.cache.isSoundReady(c)?(b._sound=b.game.cache.getSoundData(c),b.totalDuration=0,b._sound.duration&&(b.totalDuration=b._sound.duration)):b.game.cache.onSoundUnlock.add(b.soundHasUnlocked,b))}},volume:{get:function(){return this.soundPhaser.volume},set:function(a){this.soundPhaser.volume=a}},playOnAwake:{get:function(){return this._playOnAwake},set:function(a){this._playOnAwake=a}},mute:{get:function(){return this.soundPhaser.mute},set:function(a){this.soundPhaser.mute=a}},destroyWhenStop:{get:function(){return this._destroyWhenStop||!1},set:function(a){this._destroyWhenStop=a}},"class":{get:function(){return"qc.Sound"}},isPlaying:{get:function(){return this.soundPhaser.isPlaying},set:function(a){a?this.play():this.stop()}},isPaused:{get:function(){return this.soundPhaser.paused}}}),Sound.prototype._dispatchAwake=function(){var a=this;Node.prototype._dispatchAwake.call(a),!a.game.device.editor&&a.playOnAwake&&a.play()},Sound.prototype._related=function(){var a=this;a.onDecoded=a.soundPhaser.onDecoded,a.onStop=a.soundPhaser.onStop,this.onStop.add(function(){!a.game.device.editor&&a.destroyWhenStop&&a.destroy()},a),a.onLoop=a.soundPhaser.onLoop},Sound.prototype.play=function(){if(this.isPaused)return this.soundPhaser.resume(),this;this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null);var a=this.marker?this.marker.name:null;return this.soundPhaser.play(a),this},Sound.prototype.fadeIn=function(a){this.soundPhaser.fadeIn(a)},Sound.prototype.fadeOut=function(a){this.soundPhaser.fadeOut(a)},Sound.prototype.pause=function(){this.soundPhaser.pause()},Sound.prototype.resume=function(){this.soundPhaser.resume()},Sound.prototype.stop=function(){this.soundPhaser.isPlaying&&this.soundPhaser._sound&&this.soundPhaser.usingWebAudio&&(this.soundPhaser._sound.onended=null),this.soundPhaser.stop()},Sound.prototype.addMarker=function(a,b,c){this.removeMarker(),this.marker={},this.marker.name="s",this.marker.start=a,this.marker.duration=b,this.marker.volume=c,this.soundPhaser.addMarker(this.marker.name,a,b,c)},Sound.prototype.removeMarker=function(){this.marker&&(this.soundPhaser.currentMarker="",this.soundPhaser.markers={},this.marker=null)},Sound.prototype.onDestroy=function(){this.game.phaser.sound.remove(this.soundPhaser),qc.Node.prototype.onDestroy.call(this)},Sound.prototype.getMeta=function(){var a=qc.Serializer,b=qc.Node.prototype.getMeta.call(this);return b.audio=a.AUDIO,b.loop=a.BOOLEAN,b.volume=a.NUMBER,b.playOnAwake=a.BOOLEAN,b.mute=a.BOOLEAN,b.destroyWhenStop=a.BOOLEAN,b};var ScrollView=qc.ScrollView=function(a,b,c){qc.UIImage.call(this,a,b,c),this.name="ScrollView",this.canHorizontal=!0,this.canVertical=!0,this.movementType=ScrollView.MOVEMENT_ELASTIC,this.elasticity=1,this.inertia=!0,this.decelerationRate=.03,this.scrollSensitivity=1,this.propagationScroll=!1,this.onValueChange=new Phaser.Signal,this._contentRect=null,this._viewRect=null,this._preContentPosition=null,this._preContentRect=null,this._preViewRect=null,this._velocity=new qc.Point(0,0),this._isDragging=!1,this.onWheel.add(this._doWheel,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};ScrollView.prototype=Object.create(qc.UIImage.prototype),ScrollView.prototype.constructor=ScrollView,Object.defineProperties(ScrollView.prototype,{"class":{get:function(){return"qc.ScrollView"}},content:{get:function(){return this._content&&this._content._destroy&&(this._content=null),this._content},set:function(a){this._content=a,this._updateBounds()}},horizontalScrollBar:{get:function(){return this._horizontalScrollBar&&this._horizontalScrollBar._destroy&&(this._horizontalScrollBar=null),this._horizontalScrollBar},set:function(a){this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.remove(this._setHorizontalNormalizedPosition,this),this._horizontalScrollBar=a,this._horizontalScrollBar&&this._horizontalScrollBar.onValueChange.add(this._setHorizontalNormalizedPosition,this)}},verticalScrollBar:{get:function(){return this._verticalScrollBar&&this._verticalScrollBar._destroy&&(this._verticalScrollBar=null),this._verticalScrollBar},set:function(a){this._verticalScrollBar&&this._verticalScrollBar.onValueChange.remove(this._setVerticalNormalizedPosition,this),this._verticalScrollBar=a,this._verticalScrollBar&&this._verticalScrollBar.onValueChange.add(this._setVerticalNormalizedPosition,this)}},horizontalNormalizedPosition:{get:function(){return this._updateBounds(),this._contentRect.width<=this._viewRect.width?this._viewRect.x>this._contentRect.x?1:0:(this._viewRect.x-this._contentRect.x)/(this._contentRect.width-this._viewRect.width)},set:function(a){this.setNormalizedPosition(a,0)}},verticalNormalizedPosition:{
get:function(){return this._updateBounds(),this._contentRect.height<=this._viewRect.height?this._viewRect.y>this._contentRect.y?1:0:(this._viewRect.y-this._contentRect.y)/(this._contentRect.height-this._viewRect.height)},set:function(a){this.setNormalizedPosition(a,1)}}}),ScrollView.prototype.getMeta=function(){var a=qc.Serializer,b=qc.UIImage.prototype.getMeta.call(this);return b.content=a.NODE,b.canHorizontal=a.BOOLEAN,b.canVertical=a.BOOLEAN,b.movementType=a.NUMBER,b.elasticity=a.NUMBER,b.inertia=a.BOOLEAN,b.decelerationRate=a.NUMBER,b.scrollSensitivity=a.NUMBER,b.horizontalScrollBar=a.NODE,b.verticalScrollBar=a.NODE,b.propagationScroll=a.BOOLEAN,b},ScrollView.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.content=null,this.horizontalScrollBar=null,this.verticalScrollBar=null,this.phaser.mask=null},ScrollView.prototype.update=function(){this._updateBounds()},ScrollView.prototype.postUpdate=function(){this._updateVelocity()},ScrollView.prototype._setHorizontalNormalizedPosition=function(a){this.setNormalizedPosition(a,0)},ScrollView.prototype._setVerticalNormalizedPosition=function(a){this.setNormalizedPosition(a,1)},ScrollView.prototype._setContentPosition=function(a,b){this.content.x=a,this.content.y=b},ScrollView.prototype._calculateOffset=function(a,b){var c=new qc.Point(0,0);if(this.movementType===ScrollView.MOVEMENT_UNRESTRICTED)return c;var d=this.rect,e=this._contentRect,f=new qc.Point(e.x,e.y),g=new qc.Point(e.x+e.width,e.y+e.height);return this.canHorizontal&&(f.x+=a,g.x+=a,f.x>d.x?c.x=d.x-f.x:g.x<d.x+d.width&&(c.x=d.x+d.width-g.x)),this.canVertical&&(f.y+=b,g.y+=b,f.y>d.y?c.y=d.y-f.y:g.y<d.y+d.height&&(c.y=d.y+d.height-g.y)),c},ScrollView.prototype._calcVelocityEffect=function(a,b,c,d){if(this.movementType===ScrollView.MOVEMENT_ELASTIC&&0!==b[d]){var e=this["_lastOffset_"+d]||0;Math.abs(e)<Math.abs(b[d])?(this["_lastOffset_"+d]=b[d],this._currSmoothetTime=c):(this["_lastOffset_"+d]=b[d],this._currSmoothetTime+=c);var f=(this.elasticity<=0?c:this.elasticity,this.game.math.smoothDamp(a[d],a[d]+b[d],this._velocity[d],this.elasticity,Number.MAX_VALUE,c/100));Math.abs(a[d]+b[d]-f[0])<1e-4?(a[d]=a[d]+b[d],this._velocity[d]=0):(a[d]=f[0],this._velocity[d]=f[1])}else if(this.movementType===ScrollView.MOVEMENT_CLAMPED&&0!==b[d])a[d]=a[d]+b[d];else if(this.inertia){var g=this._velocity[d]*Math.pow(Math.abs(this.decelerationRate),c/1e3);Math.abs(g)<1&&(g=0),this._velocity[d]=g,a[d]=a[d]+g*c/1e3}else this._velocity[d]=0},ScrollView.prototype._rubberDelta=function(a,b){return(1-1/(.55*Math.abs(a)/b+1))*b*this.game.math.sign(a)},ScrollView.prototype._updateVelocity=function(){if(this.content){this._updateBounds();var a=this.game.time.deltaTime,b=this._calculateOffset(0,0),c=new qc.Point(this.content.x,this.content.y);if(this._isDragging||0===b.x&&0===b.y&&0===this._velocity.x&&0===this._velocity.y||(this._calcVelocityEffect(c,b,a,"x"),this._calcVelocityEffect(c,b,a,"y"),(0!==this._velocity.x||0!==this._velocity.y)&&this.movementType===ScrollView.MOVEMENT_CLAMPED&&(b=this._calculateOffset(c.x-this.content.x,c.y-this.content.y),c.x+=b.x,c.y+=b.y),this._setContentPosition(c.x,c.y)),this._isDragging&&this.inertia){var d=this.content.x-this._preContentPosition.x,e=this.content.y-this._preContentPosition.y,f=this.game.math.clamp(a/1e3,0,1);this._velocity.x=d/f,this._velocity.y=e/f}this._preViewRect&&qc.Rectangle.equals(this._viewRect,this._preViewRect)&&this._preContentRect&&qc.Rectangle.equals(this._contentRect,this._preContentRect)&&this._preContentPosition&&qc.Point.equals(this._preContentPosition,c)||(this._updateScrollBars(b.x,b.y),this.onValueChange.dispatch(new qc.Point(this.horizontalNormalizedPosition,this.verticalNormalizedPosition)),this._updatePrevData())}},ScrollView.prototype.setNormalizedPosition=function(a,b){if(this._updateBounds(),this.content&&this._contentRect){var c=b?"height":"width",d=b?"y":"x",e=this._contentRect[c]-this._viewRect[c],f=this._viewRect[d]-a*e,g=this.content[d]+f-this._contentRect[d],h=this.content[d];Math.abs(h-g)>1&&(this.content[d]=g,this._velocity[d]=0,this._updateBounds())}},ScrollView.prototype._updatePrevData=function(){this._preContentPosition=this.content?new qc.Point(this.content.x,this.content.y):new qc.Point(0,0),this._preContentRect=this._contentRect,this._preViewRect=this._viewRect},ScrollView.prototype._updateScrollBars=function(a,b){if(this.horizontalScrollBar){if(this._contentRect.width>0){var c=(this._viewRect.width-Math.abs(a))/this._contentRect.width;this.horizontalScrollBar.size=Phaser.Math.clamp(c,0,1)}else this.horizontalScrollBar.size=1;this.horizontalScrollBar.value=this.horizontalNormalizedPosition}if(this.verticalScrollBar){if(this._contentRect.height>0){var c=(this._viewRect.height-Math.abs(b))/this._contentRect.height;this.verticalScrollBar.size=Phaser.Math.clamp(c,0,1)}else this.verticalScrollBar.size=1;this.verticalScrollBar.value=this.verticalNormalizedPosition}},ScrollView.prototype._updateBounds=function(){if(this._viewRect=this.rect,this._updateContentBounds(),this.content){var a=this.rect,b=a.width-this._contentRect.width,c=a.height-this._contentRect.height;b>0&&(this._contentRect.width=a.width,this._contentRect.x-=b*this.content.pivotX),c>0&&(this._contentRect.height=a.height,this._contentRect.y-=c*this.content.pivotY)}},ScrollView.prototype._updateContentBounds=function(){return this.content?void(this._contentRect=qc.Bounds.getBox(this.content,qc.Bounds.USE_BOUNDS,!1,1,this)):void(this._contentRect=new qc.Rectangle(0,0,0,0))},ScrollView.prototype._doWheel=function(a,b){if(this.content){this._updateBounds();var c=new qc.Point(b.source.deltaX,b.source.deltaY);this.canVertical||(c.y=0),this.canHorizontal||(c.x=0);var d=c.x*this.scrollSensitivity,e=c.y*this.scrollSensitivity;this.doScroll(d,e,!1)}},ScrollView.prototype._doDragStart=function(a,b){b.source.eventId===qc.Mouse.BUTTON_LEFT&&(this._updateBounds(),this._contentStartPosition=new qc.Point(this.content.x,this.content.y),this._pointerStartCursor=this.toLocal(new qc.Point(b.source.startX,b.source.startY)),this._isDragging=!0)},ScrollView.prototype._doDragEnd=function(a,b){b.source.eventId===qc.Mouse.BUTTON_LEFT&&(this._isDragging=!1)},ScrollView.prototype._doDrag=function(a,b){if(b.source.eventId===qc.Mouse.BUTTON_LEFT){this._updateBounds();var c=this.toLocal(new qc.Point(b.source.x,b.source.y));if(this._pointerStartCursor){var d=this.canHorizontal?c.x-this._pointerStartCursor.x:0,e=this.canVertical?c.y-this._pointerStartCursor.y:0;this.doScroll(this._contentStartPosition.x+d-this.content.x,this._contentStartPosition.y+e-this.content.y,!0)}}},ScrollView.prototype.doScroll=function(a,b,c){var d=new qc.Point(this.content.x,this.content.y);d.x+=a,d.y+=b;var e=this._calculateOffset(a,b);if(d.x+=e.x,d.y+=e.y,this.movementType===ScrollView.MOVEMENT_CLAMPED&&this.propagationScroll){for(var f=this.parent;!(f instanceof ScrollView)&&f!==this.game.world;)f=f.parent;f instanceof ScrollView&&f.doScroll(-e.x,-e.y,c)}else this.movementType===ScrollView.MOVEMENT_ELASTIC&&(c?(0!==e.x&&(d.x=d.x-this._rubberDelta(e.x,this._viewRect.width)),0!==e.y&&(d.y=d.y-this._rubberDelta(e.y,this._viewRect.height))):(d.x-=e.x,d.y-=e.y,Math.abs(e.x)>this._viewRect.width&&(d.x+=e.x-this.game.math.sign(e.x)*this._viewRect.width),Math.abs(e.y)>this._viewRect.height&&(d.y+=e.y-this.game.math.sign(e.y)*this._viewRect.height)));this._setContentPosition(d.x,d.y),c||this._updateBounds()},ScrollView.MOVEMENT_UNRESTRICTED=0,ScrollView.MOVEMENT_ELASTIC=1,ScrollView.MOVEMENT_CLAMPED=2;var ScrollBar=qc.ScrollBar=function(a,b,c){qc.UIImage.call(this,a,b,c),this.name="ScrollBar",this.autoHide=!1,this._setValue(0,!1),this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this)};ScrollBar.prototype=Object.create(qc.UIImage.prototype),ScrollBar.prototype.constructor=ScrollBar,Object.defineProperties(ScrollBar.prototype,{"class":{get:function(){return"qc.ScrollBar"}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(a){this._sliders=a,this._updateSliders()}},direction:{get:function(){return this._direction||ScrollBar.LEFT_TO_RIGHT},set:function(a){this._setDirection(a,!1)}},value:{get:function(){return this._value},set:function(a){this._setValue(a,!0)}},size:{get:function(){return this._size},set:function(a){var b=Phaser.Math.clamp(a,0,1);this.visible=!(this.autoHide&&this.game.math.fuzzyEqual(b,1)),this.visible&&!this.fixSlidersSize&&(this._size=b,this._size=Math.max(5/Math.max(this.height,this.width),this._size),this._updateSliders())}},numberOfStep:{get:function(){return this._numberOfStep},set:function(a){this._numberOfStep=a}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new Phaser.Signal),this._onValueChange}},stepSize:{get:function(){return this.numberOfStep>1?1/(this.numberOfStep-1):.1}},fixSlidersSize:{get:function(){return this._fixSlidersSize},set:function(a){this._fixSlidersSize=a}},_axisPos:{get:function(){return this.direction===ScrollBar.LEFT_TO_RIGHT||this.direction===ScrollBar.RIGHT_TO_LEFT?"x":"y"}},_axisSize:{get:function(){return this.direction===ScrollBar.LEFT_TO_RIGHT||this.direction===ScrollBar.RIGHT_TO_LEFT?"width":"height"}},_reverseValue:{get:function(){return this.direction===ScrollBar.RIGHT_TO_LEFT||this.direction===ScrollBar.BOTTOM_TO_TOP}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}}}),ScrollBar.prototype.getMeta=function(){var a=qc.Serializer,b=qc.UIImage.prototype.getMeta.call(this);return b.sliders=a.NODE,b.value=a.NUMBER,b.size=a.NUMBER,b.numberOfStep=a.NUMBER,b.direction=a.NUMBER,b.fixSlidersSize=a.BOOLEAN,b.autoHide=a.BOOLEAN,b},ScrollBar.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.sliders=null},ScrollBar.prototype._setDirection=function(a,b){if(this._direction!==a){{var c=this._axisPos;this._reverseValue}if(this._direction=a,b&&c!=this._axisPos){var d=this.width;this.width=this.height,this.height=d}this._updateSliders()}},ScrollBar.prototype._setValue=function(a,b){var c=this._value;this._value=Phaser.Math.clamp(a,0,1),c!==this.value&&(this._updateSliders(),b&&this.onValueChange.dispatch(this.value))},ScrollBar.prototype.postUpdate=function(){this._isMoveNotDragging&&this._doPursued()},ScrollBar.prototype._updateSliders=function(){if(this._slidingRect){var a=new qc.Point(0,0),b=new qc.Point(1,1),c=this.value*(1-this.size),d=this._axisPos;this._reverseValue?(a[d]=1-c-this.size,b[d]=1-c):(a[d]=c,b[d]=c+this.size),this.sliders.setAnchor(a,b,!1)}},ScrollBar.prototype._getSlidersRectInBar=function(){var a=this.sliders.minAnchor,b=this.sliders.maxAnchor,c=this._slidingRect,d=c.width*a.x,e=c.height*a.y,f=c.width*(b.x-a.x),g=c.height*(b.y-a.y),h=c.width/this.rect.width,i=c.height/this.rect.height;return new qc.Rectangle(this.rect.x+d*h,this.rect.y+e*i,f*h,g*i)},ScrollBar.prototype._getSlidersPointInBar=function(a){var b=this.sliders.minAnchor,c=(this.sliders.maxAnchor,this._slidingRect),d=this.sliders.rect.width/c.width,e=this.sliders.rect.height/c.height,f=c.width*b.x+a.x*d,g=c.height*b.y+a.y*e,h=c.width/this.rect.width,i=c.height/this.rect.height;return new qc.Point(this.rect.x+f*h,this.rect.y+g*i)},ScrollBar.prototype._doPursued=function(){var a=this._getSlidersRectInBar(),b=this._axisPos,c=this._axisSize;return this._pursuedPoint>=a[b]&&this._pursuedPoint<=a[b]+a[c]?(this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-a[b]-a[c]/2,this._pursuedPoint=0,void(this._pursuedType=0)):void(this._pursuedPoint<a[b]^this._reverseValue?2!==this._pursuedType&&(this.value-=this.stepSize,this._pursuedType=1):1!==this._pursuedType&&(this.value+=this.stepSize,this._pursuedType=2))},ScrollBar.prototype._doDown=function(a,b){if(this.sliders&&b.source.eventId==qc.Mouse.BUTTON_LEFT){var c=new qc.Point(b.source.x,b.source.y);if(!this.sliders.rectContains(c)){var d=this.toLocal(c);this._isMoveNotDragging=!0,this._pursuedPoint=d[this._axisPos],this._pursuedType=0}}},ScrollBar.prototype._doUp=function(){this._isMoveNotDragging=!1},ScrollBar.prototype._doDragStart=function(a,b){if(this.sliders&&b.source.eventId==qc.Mouse.BUTTON_LEFT){this._isMoveNotDragging=!1;var c=new qc.Point(b.source.x,b.source.y),d=this.toLocal(c),e=this._getSlidersRectInBar(),f=this._axisPos,g=this._axisSize;this._offset=d[f]-e[f]-e[g]/2}},ScrollBar.prototype._doDragEnd=function(){this._isMoveNotDragging=!1},ScrollBar.prototype._doDrag=function(a,b){if(this.sliders&&b.source.eventId==qc.Mouse.BUTTON_LEFT){var c=new qc.Point(b.source.x,b.source.y),d=this.toLocal(c),e=this._getSlidersRectInBar(),f=this._axisPos,g=this._axisSize,h=d[f]-this._offset-this.rect[f]-e[g]/2,i=this.rect[g]*(1-this.size);switch(this.direction){case ScrollBar.LEFT_TO_RIGHT:case ScrollBar.TOP_TO_BOTTOM:this._setValue(h/i,!0);break;case ScrollBar.RIGHT_TO_LEFT:case ScrollBar.BOTTOM_TO_TOP:this._setValue(1-h/i,!0)}}},ScrollBar.prototype._doWheel=function(a,b){if(this.sliders){var c=b.source["delta"+this._axisPos.toUpperCase()],d=this.value;d+=(this._reverseValue?-1:1)*Math.sign(c)*this.stepSize,this._setValue(d,!0)}},ScrollBar.LEFT_TO_RIGHT=0,ScrollBar.RIGHT_TO_LEFT=1,ScrollBar.TOP_TO_BOTTOM=2,ScrollBar.BOTTOM_TO_TOP=3;var ProgressBar=qc.ProgressBar=function(a,b,c){qc.UIImage.call(this,a,b,c),this.name="ProgressBar",this.style=ProgressBar.STYLE_HORIZONTAL,this.value=0,this.minValue=0,this.maxValue=1,this.indeterminable=!1,this.loopTime=3e3,this.numberOfStep=0,this.fixedSize=-1,this._canSlideOut=!0,this.clipSliders=!1,this.showMode=ProgressBar.SHOW_PROCESSED,this.reverse=!1};ProgressBar.prototype=Object.create(qc.UIImage.prototype),ProgressBar.prototype.constructor=ProgressBar,Object.defineProperties(ProgressBar.prototype,{"class":{get:function(){return"qc.ProgressBar"}},style:{get:function(){return this._style},set:function(a){this._setStyle(a)}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(a){this._sliders=a,this._updateSliders()}},indeterminable:{get:function(){return this._indeterminable},set:function(a){this._indeterminable=a}},minValue:{get:function(){return isNaN(this._minValue)||null===this._minValue?0:this._minValue},set:function(a){this.setMinMax(a)}},maxValue:{get:function(){return isNaN(this._maxValue)||null===this._maxValue?1:this._maxValue},set:function(a){this.setMinMax(null,a)}},length:{get:function(){return this.maxValue-this.minValue}},stepValue:{get:function(){var a=this.stepSize;return a>0?this.minValue+Math.round((this.value-this.minValue)/a)*a:this.value},set:function(a){var b=this.stepSize;b>0?this._setValue(this.minValue+Math.round((a-this.minValue)/b)*b,!0):this._setValue(a)}},value:{get:function(){return this._value||0},set:function(a){a!==this._value&&this._setValue(a,!0)}},loopTime:{get:function(){return this._loopTime},set:function(a){this._loopTime=a}},numberOfStep:{get:function(){return this._numberOfStep},set:function(a){this._numberOfStep=a}},stepSize:{get:function(){return this.numberOfStep>1?this.length/(this.numberOfStep-1):this.style===ProgressBar.STYLE_CIRCLE?this.length/360:this.style===ProgressBar.STYLE_HORIZONTAL?this.length/(this._slidingRect?this._slidingRect.width:this.width):this.length/(this._slidingRect?this._slidingRect.height:this.height)}},fixedSize:{get:function(){return this._fixedSize},set:function(a){this._fixedSize!==a&&(this._fixedSize=a,this._updateSliders())}},onValueChange:{get:function(){return this._onValueChange||(this._onValueChange=new Phaser.Signal),this._onValueChange}},clipSliders:{get:function(){if(!this.sliders)return!1;var a=this.sliders.getScript(qc.NodeMask);return a&&a.enable},set:function(a){this._setClipSliders(a)}},showMode:{get:function(){return this._showMode},set:function(a){this._setShowMode(a)}},reverse:{get:function(){return this._reverse},set:function(a){this._reverse=a,this._updateSliders()}},startRadian:{get:function(){return this._startRadian||0},set:function(a){this.setCircleScope(a)}},endRadian:{get:function(){return this._endRadian||2*Math.PI},set:function(a){this.setCircleScope(null,a)}},startAngle:{get:function(){return 180*this.startRadian/Math.PI},set:function(a){this.setCircleAngle(a)}},endAngle:{get:function(){return 180*this.endRadian/Math.PI},set:function(a){this.setCircleAngle(null,a)}},showRadian:{get:function(){return this.endRadian-this.startRadian}},_slidingRect:{get:function(){return this.sliders&&this.sliders.parent?this.sliders.parent.rect:null}},_axisPos:{get:function(){return this.style===ProgressBar.STYLE_CIRCLE?"rotation":this.style===ProgressBar.STYLE_HORIZONTAL?"x":"y"}},_axisSize:{get:function(){return this.style===ProgressBar.STYLE_CIRCLE?"rotation":this.style===ProgressBar.STYLE_HORIZONTAL?"width":"height"}}}),ProgressBar.prototype.getMeta=function(){var a=(qc.Serializer,qc.UIImage.prototype.getMeta.call(this));return a.style=qc.Serializer.NUMBER,a.sliders=qc.Serializer.NODE,a._minValue=qc.Serializer.NUMBER,a._maxValue=qc.Serializer.NUMBER,a.value=qc.Serializer.NUMBER,a._startRadian=qc.Serializer.NUMBER,a._endRadian=qc.Serializer.NUMBER,a.indeterminable=qc.Serializer.BOOLEAN,a.loopTime=qc.Serializer.NUMBER,a.numberOfStep=qc.Serializer.NUMBER,a.fixedSize=qc.Serializer.NUMBER,a.showMode=qc.Serializer.NUMBER,a.reverse=qc.Serializer.NUMBER,a},ProgressBar.prototype.onDestroy=function(){qc.UIImage.prototype.onDestroy.call(this),this.sliders=null},ProgressBar.prototype._resetSliders=function(){if(this.sliders){this.sliders.rotation=0,this.sliders.setAnchor(new qc.Point(0,0),new qc.Point(1,1),!1);var a=this.sliders.getScript(qc.NodeMask);a&&a.setMask(new qc.Point(0,0),new qc.Point(1,1),0,2*Math.PI)}},ProgressBar.prototype._setStyle=function(a){this._style!==a&&(this._style=a,this._resetSliders(),this._updateSliders())},ProgressBar.prototype._setClipSliders=function(a){if(this.clipSliders!==a){if(this.sliders){this._resetSliders();var b=this.sliders.getScript(qc.NodeMask);!b&&a&&(b=this.sliders.addScript("qc.NodeMask")),b&&(b.enable=a)}this._updateSliders()}},ProgressBar.prototype._setShowMode=function(a){this._showMode!==a&&(this._showMode=a,this.sliders&&this._resetSliders(),this._updateSliders())},ProgressBar.prototype.update=function(){this._indeterminable&&this._processIndeterminable()},ProgressBar.prototype.setMinMax=function(a,b){if(a="undefined"==typeof a||null===a?this.minValue:a,b="undefined"==typeof b||null===b?this.maxValue:b,a>=b)throw new Error("Expected:min < max");this._minValue=a,this._maxValue=b,this._setValue(this.value,!0)},ProgressBar.prototype.setCircleScope=function(a,b){if(a="undefined"==typeof a||null===a?this.startRadian:a,b="undefined"==typeof b||null===b?this.endRadian:b,a>=b||b>a+2*Math.PI)throw new Error("Expected:start < end and end <= 2*PI + start");this._startRadian=a,this._endRadian=b,this._updateSliders()},ProgressBar.prototype.setCircleAngle=function(a,b){if(a="undefined"==typeof a||null===a?this.startAngle:a,b="undefined"==typeof b||null===b?this.endAngle:b,a>=b||b>a+360)throw new Error("Expected:start < end and end <= 360 + start");this._startRadian=a*Math.PI/180,this._endRadian=b*Math.PI/180,this._updateSliders()},ProgressBar.prototype._setValue=function(a,b){var c=this.stepValue;this._value=Phaser.Math.clamp(a,this.minValue,this.maxValue),c!==this.stepValue&&this._updateSliders(),b&&this.onValueChange.dispatch(this.value)},ProgressBar.prototype._processIndeterminable=function(){this._loopValue=this._loopValue||this.value,this._loopValue+=this.length*this.game.time.deltaTime/this.loopTime,this._loopValue>this.maxValue+this.stepSize&&(this._loopValue=this.minValue),this.value=this._loopValue},ProgressBar.prototype._updateSliders=function(){if(this._slidingRect){var a=this.sliders.getScript(qc.NodeMask),b=(this.stepValue-this.minValue)/this.length;if(this.reverse&&(b=1-b),this.clipSliders&&a)switch(this.style){case ProgressBar.STYLE_HORIZONTAL:case ProgressBar.STYLE_VERTICAL:var c=new qc.Point(0,0),d=new qc.Point(1,1),e=this._axisPos;this.fixedSize>=0?this._canSlideOut?(b*=1+this.fixedSize,d[e]=Math.min(1,b),c[e]=Math.max(0,b-this.fixedSize-1e-5)):(b*=1-this.fixedSize,c[e]=Math.max(0,b),d[e]=Math.min(1,b+this.fixedSize+1e-5)):this.showMode===ProgressBar.SHOW_PROCESSED?d[e]=Math.min(1,b):c[e]=Math.min(1,b),a.setMask(c,d);break;case ProgressBar.STYLE_CIRCLE:if(this.fixedSize>=0){var f=this.startRadian+(b-this.fixedSize)*this.showRadian,g=this.startRadian+b*this.showRadian;if(this.showMode===ProgressBar.SHOW_REMAINED&&this.showRadian===2*Math.PI){var h=g;g=f+2*Math.PI,f=h}a.setMask(null,null,f,g)}else{var f=-Math.PI/2+this.startRadian,g=-Math.PI/2+this.endRadian;this.showMode===ProgressBar.SHOW_PROCESSED?g=f+b*this.showRadian:f+=b*this.showRadian,a.setMask(null,null,f,g)}}else switch(this.style){case ProgressBar.STYLE_HORIZONTAL:case ProgressBar.STYLE_VERTICAL:var c=new qc.Point(0,0),d=new qc.Point(1,1),e=this._axisPos;this.fixedSize>=0?this._canSlideOut?(b*=1+this.fixedSize,d[e]=Math.min(1,b),c[e]=Math.max(0,b-this.fixedSize-1e-5)):(b*=1-this.fixedSize,c[e]=Math.max(0,b),d[e]=Math.min(1,b+this.fixedSize+1e-5)):this.showMode===ProgressBar.SHOW_PROCESSED?d[e]=Math.max(1e-5,Math.min(1,b)):c[e]=Math.min(.99999,b),this.sliders.setAnchor(c,d,!1);break;case ProgressBar.STYLE_CIRCLE:this.sliders.rotation=b*this.showRadian+this.startRadian}}},ProgressBar.STYLE_HORIZONTAL=0,ProgressBar.STYLE_VERTICAL=1,ProgressBar.STYLE_CIRCLE=2,ProgressBar.SHOW_PROCESSED=0,ProgressBar.SHOW_REMAINED=1;var Slider=qc.Slider=function(a,b,c){qc.ProgressBar.call(this,a,b,c),this.name="Slider",this.canPursue=!0,this._canSlideOut=!1,this.onWheel.add(this._doWheel,this),this.onDown.add(this._doDown,this),this.onUp.add(this._doUp,this),this.onDragStart.add(this._doDragStart,this),this.onDrag.add(this._doDrag,this),this.onDragEnd.add(this._doDragEnd,this);var d=c!==undefined;if(d!==!0){this.state=qc.UIState.NORMAL;var e=this.addScript("qc.TransitionBehaviour");e.target=this.sliders,e.transition=qc.Transition.TEXTURE_SWAP}};Slider.prototype=Object.create(qc.ProgressBar.prototype),Slider.prototype.constructor=Slider,Object.defineProperties(Slider.prototype,{state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this._onStateChange&&this._onStateChange.dispatch())}},sliders:{get:function(){return this._sliders&&this._sliders._destroy&&(this._sliders=null),this._sliders},set:function(a){this._sliders=a;var b=this.getScript("qc.TransitionBehaviour");b&&(b.target=a?a:this),this._updateSliders()}},onStateChange:{get:function(){return this._onStateChange||(this._onStateChange=new qc.Signal),this._onStateChange}},"class":{get:function(){return"qc.Slider"}},canPursue:{get:function(){return this._canPursue},set:function(a){this._canPursue=a}},interactive:{get:function(){return this._interactive},set:function(a){this._interactive=a,this._onInteractive&&this._onInteractive.dispatch(),this.state=this.interactive?qc.UIState.NORMAL:qc.UIState.DISABLED}}}),Slider.prototype.getMeta=function(){var a=(qc.Serializer,qc.ProgressBar.prototype.getMeta.call(this));return a.canPursue=qc.Serializer.BOOLEAN,a},Slider.prototype.update=function(){qc.ProgressBar.prototype.update.call(this),this._isMoveNotDragging&&this._canPursue&&this._doPursued()},Slider.prototype._setStyle=function(a){qc.ProgressBar.prototype._setStyle.call(this,a),this.fixedSize=a===Slider.STYLE_CIRCLE?0:-1},Slider.prototype._calcPointValue=function(a,b){var c=0,d=this.rect;switch(this.style){case Slider.STYLE_HORIZONTAL:case Slider.STYLE_VERTICAL:c=this.minValue+(a[this._axisPos]-d[this._axisPos])*this.length/d[this._axisSize];break;case Slider.STYLE_CIRCLE:var e=2*Math.PI,f=Math.atan2(a.x-d.centerX,d.centerY-a.y);if(0>f&&(f+=e),b)if("undefined"==typeof this._tempDragAngle||null===this._tempDragAngle)this._tempDragAngle=f,this._recordDragAngle=f;else{var g=f-this._tempDragAngle;this._tempDragAngle=f,Math.abs(g)>Math.PI&&(g=Phaser.Math.sign(g)*(e-Math.abs(g))),this._recordDragAngle+=g,f=this._recordDragAngle}c=this.minValue+(f-this.startRadian)*this.length/this.showRadian}return this.reverse&&(c=this.maxValue-c+this.minValue),c},Slider.prototype._doWheel=function(a,b){if(this.sliders){var c=Math.abs(b.source.deltaX)>=Math.abs(b.source.deltaY)?b.source.deltaX:b.source.deltaY,d=this.value;d+=(this.reverse?-1:1)*Math.sign(c)*this.stepSize,this.value=d}},Slider.prototype._doDown=function(a,b){if(this.sliders&&b.source.eventId==qc.Mouse.BUTTON_LEFT){this.state=qc.UIState.PRESSED,this._tempDragAngle=null,this._recordDragAngle=null;var c=new qc.Point(b.source.x,b.source.y);if(!this.sliders.rectContains(c)||this.fixedSize<0){var d=this.toLocal(c);this._isMoveNotDragging=!0,this._pursuedPoint=this._calcPointValue(d),this._pursuedType=0}}},Slider.prototype._doUp=function(){this._isMoveNotDragging=!1,this.state===qc.UIState.PRESSED&&(this.state=qc.UIState.NORMAL)},Slider.prototype._doDragStart=function(a,b){if(this.sliders&&b.source.eventId==qc.Mouse.BUTTON_LEFT){this.state=qc.UIState.PRESSED,this._isMoveNotDragging=!1;var c=new qc.Point(b.source.x,b.source.y),d=this.toLocal(c);this._offset=this._calcPointValue(d,!0)-this.value}},Slider.prototype._doDragEnd=function(){this._isMoveNotDragging=!1,this._tempDragAngle=null,this._recordDragAngle=null,this.state===qc.UIState.PRESSED&&(this.state=qc.UIState.NORMAL)},Slider.prototype._doDrag=function(a,b){if(this.sliders&&b.source.eventId==qc.Mouse.BUTTON_LEFT){var c=new qc.Point(b.source.x,b.source.y),d=this.toLocal(c),e=this._calcPointValue(d,!0)-this._offset;this._setValue(e,!0)}},Slider.prototype._doPursued=function(){for(var a=this.stepSize,b=Math.max(1,Math.ceil(this.length/10/a));b--;){if(this._pursuedPoint>=this.value&&this._pursuedPoint<=this.value+a)return this._isMoveNotDragging=!1,this._offset=this._pursuedPoint-this.value,this._pursuedPoint=0,void(this._pursuedType=0);this._pursuedPoint<this.value^this.reverse?2!==this._pursuedType&&(this.value-=a,this._pursuedType=1):1!==this._pursuedType&&(this.value+=a,this._pursuedType=2)}},Slider.STYLE_HORIZONTAL=qc.ProgressBar.STYLE_HORIZONTAL,Slider.STYLE_VERTICAL=qc.ProgressBar.STYLE_VERTICAL,Slider.STYLE_CIRCLE=qc.ProgressBar.STYLE_CIRCLE,Slider.SHOW_PROCESSED=qc.ProgressBar.SHOW_PROCESSED,Slider.SHOW_REMAINED=qc.ProgressBar.SHOW_REMAINED;var InputField=qc.InputField=function(a,b,c){var d=this;qc.UIImage.call(d,a,b,c),d.name="InputField",d.onStateChange=new qc.Signal,d.onValueChange=new qc.Signal,d.interactive=!0;var e=d.div=document.createElement("div"),f=e.style;f.setProperty("-webkit-tap-highlight-color","rgba(0, 0, 0, 0)",null),f.position="absolute",f.padding=0,f.margin=0,f.border=0,f.outline=0,f.background="none",d.game.world.frontDomRoot.appendChild(e);var g=c!==undefined;if(g!==!0){var h=d.textComponent=a.add.text(d);h.text="",h.name="Text",h.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),h.left=5,h.right=5,h.top=5,h.bottom=5,h.interactive=!1,h.color=Color.black,h.alignV=UIText.MIDDLE,h.alignH=UIText.LEFT;var i=d.placeholder=a.add.text(d);i.text="Enter text...",i.name="Placeholder",i.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),i.left=5,i.right=5,i.top=5,i.bottom=5,i.interactive=!1,i.color=Color.grey,i.alignV=UIText.MIDDLE,i.alignH=UIText.LEFT,this.state=qc.UIState.NORMAL;var j=this.addScript("qc.TransitionBehaviour");j.target=this}var k=function(a){a.preventDefault(),d.state!==qc.UIState.DISABLED&&d.startEditing()};e.addEventListener("mouseup",k,!1),e.addEventListener("touchend",k,!1),this.onDown.add(function(){d.state!==qc.UIState.DISABLED&&(d.state=qc.UIState.PRESSED)}),this.onUp.add(function(){d.state===qc.UIState.PRESSED&&(d.state=qc.UIState.NORMAL)}),d.phaser.worldTransformChangedCallback=d._updateNativeDiv.bind(d),d.phaser.worldTransformChangedContext=d,this.text="",this.width=120,this.height=30,this._checkVisibility()};InputField.SINGLE_LINE=0,InputField.MULTI_LINE=1,InputField.STANDARD=0,InputField.INT=1,InputField.NUMBER=2,InputField.TEL=3,InputField.EMAIL=4,InputField.PASSWORD=5,InputField.prototype=Object.create(qc.UIImage.prototype),InputField.prototype.constructor=InputField,InputField.prototype._characterLimit=-1,InputField.prototype._lineType=InputField.SINGLE_LINE,InputField.prototype._contentType=InputField.STANDARD,InputField.prototype._input=null,InputField.prototype._password="",InputField.prototype.textComponent=null,InputField.prototype.placeholder=null,Object.defineProperties(InputField.prototype,{"class":{get:function(){return"qc.InputField"}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this.onStateChange.dispatch())}},lineType:{get:function(){return this._lineType},set:function(a){this._lineType=a}},contentType:{get:function(){return this._contentType},set:function(a){this._contentType!==a&&(this._contentType=a,this.text=this.text)}},textComponent:{get:function(){return this._textComponent&&this._textComponent._destroy&&(this._textComponent=null),this._textComponent},set:function(a){this._textComponent=a}},placeholder:{get:function(){return this._placeholder&&this._placeholder._destroy&&(this._placeholder=null),this._placeholder},set:function(a){this._placeholder=a}},placeholderText:{get:function(){var a=this.placeholder;return a?a.text:""},set:function(a){var b=this.placeholder;b&&(b.text=a)}},text:{get:function(){var a=this.textComponent;return a?this._contentType===InputField.PASSWORD?this._password:this.textComponent.text:""},set:function(a){if(this.textComponent&&(a=this.toValidateText(a),a!==this.text)){if(this._contentType===InputField.PASSWORD){this._password=a;for(var b="",c=0;c<a.length;c++)b+="·";this.textComponent.text=b}else this.textComponent.text=a;this.onValueChange.dispatch(a)}}},characterLimit:{get:function(){return this._characterLimit},set:function(a){this.characterLimit!==a&&(this._characterLimit=a,this.text=this.text)}},overflow:{get:function(){return this.textComponent?this.textComponent.overflow:!1},set:function(a){this.textComponent&&(this.textComponent.overflow=a)}},isFocused:{get:function(){return!!this.getInput()},set:function(a){a?this.startEditing():this.stopEditing()}}}),InputField.prototype.getMeta=function(){var a=qc.Serializer,b=qc.UIImage.prototype.getMeta.call(this);return b.lineType=a.NUMBER,b.contentType=a.NUMBER,b.placeholder=a.NODE,b.textComponent=a.NODE,b.text=a.STRING,b.overflow=a.BOOLEAN,b.state=a.NUMBER,b._password=a.STRING,b.characterLimit=a.NUMBER,b},InputField.prototype.update=function(){var a=this.getInput(),b=this.textComponent,c=this.placeholder,d=b.textPhaser.renderable;a?(b&&(b.textPhaser.renderable=!1),c&&(c.textPhaser.renderable=!1),this._updateInput(a)):(b&&(b.textPhaser.renderable=!0),c&&(c.textPhaser.renderable=""===this.text)),b.textPhaser.renderable!==d&&(b.textPhaser.displayChanged(b.textPhaser.renderable?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE),this.phaser.displayChanged(b.textPhaser.renderable?qc.DisplayChangeStatus.SHOW:qc.DisplayChangeStatus.HIDE))},InputField.prototype.toValidateText=function(a){switch(a=a||"",this.contentType){case InputField.INT:a=a.replace(/[^\d\-]/g,"");break;case InputField.NUMBER:a=a.replace(/[^\d\.\-]/g,"");break;case InputField.EMAIL:a=a.replace(/[^\w0-9\@\.]/g,"");break;case InputField.TEL:a=a.replace(/[^\d\(\)\+\-\s]/g,"")}return this.characterLimit>0&&a.length>this.characterLimit&&(a=a.substr(0,this.characterLimit)),a},InputField.prototype.startEditing=function(){var a=this,b=a.textComponent;if(b){var c=this._input;if(!c){if(this.lineType===InputField.MULTI_LINE)c=a._input=document.createElement("textarea"),c.onkeydown=function(b){Keyboard.ESC===b.keyCode&&a.cancelEditing()};else{switch(c=a._input=document.createElement("input"),c.onkeydown=function(b){Keyboard.ENTER===b.keyCode?a.stopEditing():Keyboard.ESC===b.keyCode&&a.cancelEditing()},a.contentType){case InputField.PASSWORD:c.type="password";break;case InputField.EMAIL:
c.type="email";break;case InputField.TEL:c.type="tel";break;case InputField.INT:case InputField.NUMBER:c.type="number";break;default:c.type="text"}switch(b.alignH){case UIText.LEFT:c.style.textAlign="left";break;case UIText.RIGHT:c.style.textAlign="right";break;default:c.style.textAlign="center"}switch(b.alignV){case UIText.TOP:c.style.verticalAlign="top";break;case UIText.BOTTOM:c.style.verticalAlign="bottom";break;default:c.style.verticalAlign="middle"}}this.characterLimit>0&&c.setAttribute("maxlength",this.characterLimit),c._qc=a,c.value=a.text;var d=c.style;d.position="absolute",d.padding=0,d.margin=0,d.border=0,d.outline=0,d.background="none",c.onblur=function(){a.stopEditing()},c._handleClick=function(b){b.target!==a.div&&b.target!==c&&a.stopEditing()};var e=a.game.world.frontDomRoot;e.addEventListener("mousedown",c._handleClick,!1),e.addEventListener("touchstart",c._handleClick,!1),a.game.input._inputting++;var f=document.createElement("div");f.style.width=this.game.canvas.style.width,f.style.height=this.game.canvas.style.height,f.style.position="absolute",f.style.overflow="hidden",f.appendChild(c),e.appendChild(f),a._updateInput(c),c.focus(),a._updateNativeInput(),b.phaser.worldTransformChangedCallback=this._updateNativeInput.bind(a),b.phaser.worldTransformChangedContext=b}}},InputField.prototype._updateInput=function(a){var b=this.game.time.now;if(!(a._lastUpdate&&b-a._lastUpdate<100)){a._lastUpdate=b;var c=this.textComponent;c.textPhaser instanceof Phaser.Text&&(a.style.font=c.textPhaser.style.font),a.style.fontSize=c.fontSize+"px",a.style.color=c.color.toString(),a._lastValue!==a.value&&(a._lastValue=a.value,this.text=a.value)}},InputField.prototype.getInput=function(){return this._input&&!this.textComponent&&this.cancelEditing(),this._input},InputField.prototype.cancelEditing=function(){var a=this._input;if(a){this._input=null,this.game.input._inputting--;var b=this.game.world.frontDomRoot;b.removeEventListener("mousedown",a._handleClick,!1),b.removeEventListener("touchstart",a._handleClick,!1),qc.Util.removeHTML(a.parentNode)}},InputField.prototype.stopEditing=function(){var a=this.getInput();a&&(this.text=a.value,this.cancelEditing())},InputField.prototype.onDestroy=function(){this.cancelEditing(),qc.Util.removeHTML(this.div),qc.UIImage.prototype.onDestroy.call(this)},InputField.prototype._dispatchAwake=function(){Node.prototype._dispatchAwake.call(this),this._checkVisibility()},InputField.prototype.onVisibleChange=function(){this._checkVisibility()},InputField.prototype._checkVisibility=function(){var a=this.isWorldVisible();this.div.style.display=a?"block":"none",a||this.stopEditing()},InputField.prototype._updateNativeDiv=function(){var a=this,b=a.div;b._lastUpdate=a.game.time.now,qc.Util.updateTransform(a,b)},InputField.prototype._updateNativeInput=function(){var a=this,b=a.getInput();b&&qc.Util.updateTransform(a.textComponent,b)};var Tilemap=qc.Tilemap=function(a,b,c){qc.Node.call(this,new Phaser.Group(a.phaser,null),b,c),this.name="Tilemap",this._copyCanvas=Phaser.Canvas.create(1,1),this._copyContext=this._copyCanvas.getContext("2d")};Tilemap.prototype=Object.create(qc.Node.prototype),Tilemap.prototype.constructor=Tilemap,Tilemap.prototype._data=null,Tilemap.prototype._scrollX=0,Tilemap.prototype._scrollY=0,Tilemap.prototype._layers=0,Tilemap.prototype._tilesets=0,Tilemap.prototype.getMeta=function(){var a=qc.Node.prototype.getMeta.call(this);return a.data=Serializer.TEXTASSET,a.scrollX=Serializer.NUMBER,a.scrollY=Serializer.NUMBER,a.layers=Serializer.NODES,a.tilesets=Serializer.TEXTURES,a},Tilemap.prototype.generateLayers=function(a){var b=this,c=b.data;if(c){for(var d=b.game,e=b._dataInfo,f=e.json,g=f.tilesets,h=[],i=0;i<g.length;i++)h.push({key:g[i].name,url:e.prefix+g[i].name+".bin"});d.assets.loadBatch(h,function(){for(var c=[],e=0;e<h.length;e++)c.push(new qc.Texture(h[e].asset));b.tilesets=c,b.removeChildren();for(var g=[],e=0;e<f.layers.length;e++){var i=f.layers[e];if("tilelayer"===i.type){var j=new TileLayer(d,b);j.name=i.name,j.tilemap=b,j.layerIndex=e,g.push(j)}else if("objectgroup"===i.type){var k=new ObjectLayer(d,b);k.name=i.name,k.tilemap=b,k.layerIndex=e,g.push(k)}}b.layers=g,a&&a()})}},Tilemap.prototype.getLayerByIndex=function(a){var b=this._layers;return b&&a>=0&&a<b.length?b[a]:null},Tilemap.prototype.getLayerByName=function(a){var b=this._layers;if(b)for(var c=0;c<b.length;c++)if(b[c].name===a)return b[c];return null},Tilemap.prototype._getLayerJson=function(a,b){if(this._dataInfo){var c=this._dataInfo.json.layers;if(a>=0&&a<c.length){var d=c[a];if(d.type===b)return d}return null}},Tilemap.prototype.resetNativeSize=function(){var a=this.nativeSize;a&&(this.width=a.width,this.height=a.height)},Tilemap.prototype.getTilePosition=function(a,b){return new qc.Point(Math.floor(a/this.tileWidth),Math.floor(b/this.tileHeight))},Object.defineProperties(Tilemap.prototype,{nativeSize:{get:function(){var a=this._dataInfo;return a?new qc.Rectangle(0,0,a.map.widthInPixels,a.map.heightInPixels):null}},layers:{get:function(){return this._layers},set:function(a){this._layers=a}},tilesets:{get:function(){return this._tilesets},set:function(a){this._tilesets=a}},scrollX:{get:function(){return this._scrollX},set:function(a){this._scrollX=a}},scrollY:{get:function(){return this._scrollY},set:function(a){this._scrollY=a}},tileWidth:{get:function(){return this._dataInfo.json.tilewidth}},tileHeight:{get:function(){return this._dataInfo.json.tileheight}},mapWidth:{get:function(){return this._dataInfo.json.width}},mapHeight:{get:function(){return this._dataInfo.json.height}},data:{get:function(){return this._data},set:function(a){var b=this,c=b.game,d=null;if(a){if(!(a instanceof TextAsset))return;try{var e=JSON.parse(a.text);if(!e.layers||!e.tilesets)throw new Error("Invalid tilemap data format");c.phaser.load.tilemap(a.url,null,e,Phaser.Tilemap.TILED_JSON);for(var f=c.phaser.add.tilemap(a.url),g=0,h=0,i=0;i<f.tilesets.length;i++)g=Math.max(g,f.tilesets[i].tileWidth),h=Math.max(h,f.tilesets[i].tileHeight);f.maxTileWidth=g,f.maxTileHeight=h;var j=a.url.lastIndexOf("/");d={json:e,map:f,prefix:j>=0?a.url.substring(0,j+1):""}}catch(k){return c.log.error("Asset{0}/{1} Parse fail",a.key,a.url,k),void qc.Util.popupError(k.message)}}b._data=a,b._dataInfo=d}},"class":{get:function(){return"qc.Tilemap"}}});var TileLayer=qc.TileLayer=function(a,b,c){var d=this,e=new Phaser.Sprite(a.phaser);qc.Node.call(d,e,b,c),d.name="TileLayer",d._cache={},d._dirtyTiles=null,e.canvas=Phaser.Canvas.create(1,1),e.context=e.canvas.getContext("2d"),e.baseTexture=new PIXI.BaseTexture(e.canvas),e.texture=new PIXI.Texture(e.baseTexture),d.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),d.setStretch(0,0,0,0);var f=e._renderCanvas,g=e._renderWebGL;e._renderCanvas=function(){d._renderTiles(),f.apply(e,arguments)},e._renderWebGL=function(){d._renderTiles(),g.apply(e,arguments)}};TileLayer.prototype=Object.create(qc.Node.prototype),TileLayer.prototype.constructor=TileLayer,TileLayer.prototype._tilemap=null,TileLayer.prototype._layerIndex=-1,TileLayer.prototype._scrollXRatio=1,TileLayer.prototype._scrollYRatio=1,TileLayer.prototype.getMeta=function(){var a=qc.Node.prototype.getMeta.call(this);return a.tilemap=Serializer.NODE,a.layerIndex=Serializer.INT,a.scrollXRatio=Serializer.NUMBER,a.scrollYRatio=Serializer.NUMBER,a},TileLayer.prototype.getTile=function(a,b){var c=this._cache,d=this.tilemap;if(!d)return undefined;var e=c.phaserLayer;if(!e||c.tilemap!==d||c.layerIndex!==this.layerIndex){e=null;var f=d._getLayerJson(this.layerIndex,"tilelayer");if(f){var g=d._dataInfo.map,h=g.getLayerIndex(f.name);h>=0&&(e=g.layers[h])}}return e&&e.data&&e.data[b]?e.data[b][a]:undefined},TileLayer.prototype.getTileIndex=function(a,b){var c=this.getTile(a,b);return c?c.index:1/0},TileLayer.prototype.setTileIndex=function(a,b,c){var d=this.getTile(a,b);d&&d.index!==c&&(d.index=c,this._dirtyTiles||(this._dirtyTiles={}),this._dirtyTiles[a+"|"+b]={x:a,y:b})},TileLayer.prototype.redrawAll=function(){this._redrawAllFlag=!0},TileLayer.prototype._renderTiles=function(){var a=this,b=a.tilemap;if(b){var c=a._cache,d=a.phaser,e=b._dataInfo.map,f=a._checkTileLayerChange(e),g=c.phaserLayer;if(g){a._redrawAllFlag&&(f=!0,a._redrawAllFlag=!1);var h=d.context,i=g.data,j=Math.round(a.width),k=Math.round(a.height),l=b.scrollX,m=b.scrollY,n=a.scrollXRatio,o=a.scrollYRatio;f=a._checkSizeChange(j,k)||f;var p=!1;if(f||c.scrollX!==l||c.scrollY!==m||c.scrollXRatio!==n||c.scrollYRatio!==o){var q=Math.round(l*n),r=Math.round(m*o),s=c.viewRect,t=new Phaser.Rectangle(-q,-r,j,k);if(!f){var u=Phaser.Rectangle.intersection(s,t);if(u.width>10&&u.height>10){var v=u.x-s.x,w=u.y-s.y,x=u.width,y=u.height;b._copyCanvas.width!==j&&(b._copyCanvas.width=j),b._copyCanvas.height!==k&&(b._copyCanvas.height=k),b._copyContext.clearRect(v,w,x,y),b._copyContext.drawImage(d.canvas,v,w,x,y,v,w,x,y)}else f=!0}h.clearRect(0,0,j,k),h.translate(q,r),f?(a._dirtyTiles=null,a._drawRect(h,e,i,-q,-r,j,k)):(h.drawImage(b._copyCanvas,v,w,x,y,u.x,u.y,x,y),t.contains(s.left,s.top)?(a._drawRect(h,e,i,t.x,t.y,u.x-t.x,t.height),a._drawRect(h,e,i,u.x,t.y,t.right-u.x,u.y-t.y)):t.contains(s.right,s.top)?(a._drawRect(h,e,i,t.x,t.y,u.right-t.x,u.y-t.y),a._drawRect(h,e,i,u.right,t.y,t.right-u.right,t.height)):t.contains(s.left,s.bottom)?(a._drawRect(h,e,i,t.x,t.y,u.x-t.x,t.height),a._drawRect(h,e,i,u.x,u.bottom,t.right-u.x,t.bottom-u.bottom)):t.contains(s.right,s.bottom)&&(a._drawRect(h,e,i,t.x,u.bottom,u.right-t.x,t.bottom-u.bottom),a._drawRect(h,e,i,u.right,t.y,t.right-u.right,t.height))),h.translate(-q,-r),p=!0,c.scrollX=l,c.scrollY=m,c.scrollXRatio=n,c.scrollYRatio=o,c.viewRect=t}var z=a._renderDirtyTiles(h,e,i);(p||z)&&(d.texture.baseTexture.dirty(),d.displayChanged(qc.DisplayChangeStatus.TEXTURE))}}},TileLayer.prototype._renderDirtyTiles=function(a,b,c){var d=this,e=!1;if(d._dirtyTiles){var f=b.maxTileWidth,g=b.maxTileHeight,h=b.tileWidth,i=b.tileHeight,j=d._cache.viewRect,k=f>h?-f:0,l=g>i?g:0,m=Math.floor((j.x+k)/h),n=Math.floor(j.y/i),o=Math.ceil((j.x+j.width)/h),p=Math.ceil((j.y+j.height+l)/i);a.translate(-j.x,-j.y);for(var q in d._dirtyTiles){var r=d._dirtyTiles[q],s=r.x,t=r.y;s>=m&&o>=s&&t>=n&&p>=t&&(d._drawRect(a,b,c,s*h,t*i+i-g,f,g,!0),e=!0)}a.translate(j.x,j.y),d._dirtyTiles=null}return e},TileLayer.prototype._checkTileLayerChange=function(a){var b=this._cache,c=this.tilemap,d=this.layerIndex;if(b.tilemap!==c||b.layerIndex!==d){b.phaserLayer=null;var e=c._getLayerJson(d,"tilelayer");if(e){var f=a.getLayerIndex(e.name);f>=0&&(b.phaserLayer=a.layers[f])}return b.tilemap=c,b.layerIndex=d,!0}return!1},TileLayer.prototype._checkSizeChange=function(a,b){var c=this._cache,d=this.phaser,e=d.texture;return c.width!==a||c.height!==b?(d.canvas.width=a,d.canvas.height=b,e.frame.width=a,e.frame.height=b,e.width=a,e.height=b,e.crop.width=a,e.crop.height=b,e.baseTexture.width=a,e.baseTexture.height=b,e.baseTexture.dirty(),c.width=a,c.height=b,!0):!1},TileLayer.prototype._drawRect=function(a,b,c,d,e,f,g,h){if(f&&g){h&&a.clearRect(d,e,f,g),a.save(),a.beginPath(),a.rect(d,e,f,g),a.clip();var i=b.maxTileWidth,j=b.maxTileHeight,k=b.tileWidth,l=b.tileHeight,m=Math.floor((i>k?d-i:d)/k),n=Math.floor(e/l),o=Math.ceil((d+f)/k),p=Math.ceil((j>l?e+g+j:e+g)/l);for(0>m&&(m=0),0>n&&(n=0),o>b.width&&(o=b.width),p>b.height&&(p=b.height),e=n;p>e;e++){var q=c[e];for(d=m;o>d;d++)this._drawTile(a,b,q[d],d,e)}a.restore()}},TileLayer.prototype._drawTile=function(a,b,c){var d=c.index;if(!(0>=d)){var e=b.tiles[d],f=b.tilesets[e[2]],g=f.asset;if(g===undefined){var h=this.tilemap._dataInfo.prefix+f.name+".bin",i=this.tilemap.tilesets;if(i)for(var j=0;j<i.length;j++)if(i[j].atlas.url===h){g=i[j];break}f.asset=g?g:null}g&&a.drawImage(g.atlas.img,e[0],e[1],f.tileWidth,f.tileHeight,c.worldX,c.worldY+b.tileHeight-f.tileHeight,f.tileWidth,f.tileHeight)}},Object.defineProperties(TileLayer.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(a){(!a||a instanceof Tilemap)&&(this._tilemap=a)}},layerIndex:{get:function(){return this._layerIndex},set:function(a){this._layerIndex=a}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(a){this._scrollXRatio=a}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(a){this._scrollYRatio=a}},"class":{get:function(){return"qc.TileLayer"}}});var ObjectLayer=qc.ObjectLayer=function(a,b,c){qc.Node.call(this,new Phaser.Group(a.phaser,null),b,c),this.name="ObjectLayer",this.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),this.setStretch(0,0,0,0)};ObjectLayer.prototype=Object.create(qc.Node.prototype),ObjectLayer.prototype.constructor=ObjectLayer,ObjectLayer.prototype._tilemap=null,ObjectLayer.prototype._layerIndex=-1,ObjectLayer.prototype._scrollXRatio=1,ObjectLayer.prototype._scrollYRatio=1,ObjectLayer.prototype.getMeta=function(){var a=qc.Node.prototype.getMeta.call(this);return a.tilemap=Serializer.NODE,a.layerIndex=Serializer.INT,a.scrollXRatio=Serializer.NUMBER,a.scrollYRatio=Serializer.NUMBER,a},ObjectLayer.prototype.update=function(){this._tilemap&&this._tilemap._destroy&&(this._tilemap=null);var a=this._tilemap;a&&(this.x=a.scrollX*this.scrollXRatio,this.y=a.scrollY*this.scrollXRatio)},Object.defineProperties(ObjectLayer.prototype,{tilemap:{get:function(){return this._tilemap&&this._tilemap._destroy&&(this._tilemap=null),this._tilemap},set:function(a){(!a||a instanceof Tilemap)&&(this._tilemap=a)}},layerIndex:{get:function(){return this._layerIndex},set:function(a){this._layerIndex=a}},scrollXRatio:{get:function(){return this._scrollXRatio},set:function(a){this._scrollXRatio=a}},scrollYRatio:{get:function(){return this._scrollYRatio},set:function(a){this._scrollYRatio=a}},"class":{get:function(){return"qc.ObjectLayer"}}});var Dom=qc.Dom=function(a,b,c){var d=this;d.game=a,qc.Node.call(this,new Phaser.Group(this.game.phaser,null),b,c),d.name="dom";var e=d.div=document.createElement("div");e.style.position="absolute",e.setAttribute("id",d.uuid),e._qc=d,d.overflow="hidden",d.serializable=!0,d.phaser.worldTransformChangedCallback=d._updateDomTransform,d.phaser.worldTransformChangedContext=d,d.pos=Dom.POS_FRONT,d._updateDomTransform(),d.game.device.android&&(d.game.timer.add(1,function(){d._destroy||(d.rotation+=.001)}),d.game.timer.add(40,function(){d._destroy||(d.rotation-=.002)}),d.game.timer.add(300,function(){d._destroy||(d.rotation+=5e-4)}),d.game.timer.add(1e3,function(){d._destroy||(d.rotation+=5e-4)}))};Dom.prototype=Object.create(qc.Node.prototype),Dom.prototype.constructor=Dom,Dom.POS_NONE=-1,Dom.POS_BACK=0,Dom.POS_FRONT=1,Object.defineProperties(Dom.prototype,{"class":{get:function(){return"qc.Dom"}},pos:{get:function(){return this._pos},set:function(a){this.pos!==a&&(this._pos=a,this.div.parentNode&&this.div.parentNode.removeChild(this.div),a===Dom.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex>=0&&(this.zIndex=-1)):a===Dom.POS_FRONT&&(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex<=0&&(this.zIndex=1)))}},zIndex:{get:function(){return this.div.style.zIndex||0},set:function(a){a!==this.div.style.zIndex&&(this._pos===Dom.POS_BACK&&a>=0?a=-1:this._pos===Dom.POS_FRONT&&0>=a&&(a=1),this.div.style.zIndex=a)}},innerHTML:{get:function(){return this.div.innerHTML},set:function(a){this.div.innerHTML=a}},className:{get:function(){return this.div.className},set:function(a){this.div.className=a}},overflow:{get:function(){return this._overflow},set:function(a){a!==this._overflow&&(this._overflow=a,this.div.style.overflow=a)}},alpha:{get:function(){var a=this.div,b=a.style.opacity;return b?1*b:1},set:function(a){var b=this,c=b.div;a!==c.alpha&&(c.style.filter="alpha(opacity:"+100*a+")",c.style.opacity=a)}}}),Dom.prototype._dispatchAwake=function(){Node.prototype._dispatchAwake.call(this),this._updateDomTransform()},Dom.prototype.onVisibleChange=function(){this._updateDomTransform()},Dom.prototype.onRemoveFromWorld=function(){this.div&&this.div.parentNode&&this.div.parentNode.removeChild(this.div)},Dom.prototype.onAddToWorld=function(){if(this.div&&!this.div.parentNode){var a=this.pos;a===Dom.POS_BACK?(this.game.world.backDomRoot.appendChild(this.div),this.zIndex>=0&&(this.zIndex=-1)):a===Dom.POS_FRONT&&(this.game.world.frontDomRoot.appendChild(this.div),this.zIndex<=0&&(this.zIndex=1))}},Dom.prototype.onDestroy=function(){this.div._qc=null,this.div.parentNode&&this.div.parentNode.removeChild(this.div),qc.Node.prototype.onDestroy.call(this)},Dom.prototype.getMeta=function(){var a=this,b=qc.Serializer,c=qc.Node.prototype.getMeta.call(this);return c.pos=b.NUMBER,c.className=b.STRING,c.overflow=b.STRING,c.innerHTML={get:function(a){return a.serializable?[!0,a.innerHTML]:undefined},set:function(b,c){c?(a.serializable=!0,a.innerHTML=c[1]):(a.serializable=!1,a.innerHTML="")}},c.zIndex=b.INT,c},Dom.prototype._updateDomTransform=function(){qc.Util.updateTransform(this,this.div),this.div.style.display=this.isWorldVisible()?"block":"none"};var Graphics=qc.Graphics=function(a,b,c){var d=this;d.game=a,qc.Node.call(this,new Phaser.Graphics(this.game.phaser),b,c),d.name="graphics"};Graphics.prototype=Object.create(qc.Node.prototype),Graphics.prototype.constructor=Graphics,Object.defineProperties(Graphics.prototype,{"class":{get:function(){return"qc.Graphics"}},fillAlpha:{get:function(){return this.phaser.fillAlpha},set:function(a){this.phaser.fillAlpha=a}},lineWidth:{get:function(){return this.phaser.lineWidth},set:function(a){this.phaser.lineWidth=a}},lineColor:{get:function(){return this.phaser.lineColor},set:function(a){this.phaser.lineColor=a}},blendMode:{get:function(){return this.phaser.blendMode},set:function(a){this.phaser.blendMode=a}},boundsPadding:{get:function(){return this.phaser.boundsPadding},set:function(a){this.phaser.boundsPadding=a}}}),Graphics.prototype.getMeta=function(){var a=(qc.Serializer,qc.Node.prototype.getMeta.call(this));return a},Graphics.prototype.drawTriangle=function(a,b){return this.phaser.drawTriangle(a,b)},Graphics.prototype.drawTriangles=function(a,b,c){return this.phaser.drawTriangles(a,b,c)},Graphics.prototype.lineStyle=function(a,b,c){return this.phaser.lineStyle(a,b,c)},Graphics.prototype.moveTo=function(a,b){return this.phaser.moveTo(a,b)},Graphics.prototype.lineTo=function(a,b){return this.phaser.lineTo(a,b)},Graphics.prototype.quadraticCurveTo=function(a,b,c,d){return this.quadraticCurveTo(a,b,c,d)},Graphics.prototype.bezierCurveTo=function(a,b,c,d,e,f){return this.phaser.bezierCurveTo(a,b,c,d,e,f)},Graphics.prototype.arcTo=function(a,b,c,d,e){return this.phaser.arcTo(a,b,c,d,e)},Graphics.prototype.arc=function(a,b,c,d,e,f){return this.phaser.arc(a,b,c,d,e,f)},Graphics.prototype.beginFill=function(a,b){return this.phaser.beginFill(a,b)},Graphics.prototype.endFill=function(){return this.phaser.endFill()},Graphics.prototype.drawRect=function(a,b,c,d){return this.phaser.drawRect(a,b,c,d)},Graphics.prototype.drawRoundedRect=function(a,b,c,d,e){return this.phaser.drawRoundedRect(a,b,c,d,e)},Graphics.prototype.drawCircle=function(a,b,c){return this.phaser.drawCircle(a,b,c)},Graphics.prototype.drawEllipse=function(a,b,c,d){return this.phaser.drawEllipse(a,b,c,d)},Graphics.prototype.drawPolygon=function(a){return this.phaser.drawPolygon(a)},Graphics.prototype.clear=function(){return this.phaser.clear()},Graphics.prototype.generateTexture=function(a,b){return this.phaser.generateTexture(a,b)},Graphics.prototype.containsPoint=function(a){return this.phaser.containsPoint(a)},Graphics.prototype.drawShape=function(a){return this.phaser.drawShape(a)};var Dropdown=qc.Dropdown=function(a,b,c){var d=this;qc.UIImage.call(d,a,b,c),d.onStateChange=new qc.Signal,d.onValueChange=new qc.Signal,d.captionImage=null,d.captionText=null,d.item=null,d.options=[],d.template=null;var e=c!==undefined;if(d.name="Dropdown",d.interactive=!0,d._items=[],d._value=-1,e!==!0){d.captionText=a.add.text(d),d.captionText.name="Label",d.captionImage=a.add.image(d),d.captionImage.name="Image",d.template=a.add.scrollView(d),d.template.interactive=!0,d.template.name="Template";var f=d.template.addScript("qc.NodeMask");f.checkInField=!1,d.template.content=a.add.node(d.template),d.template.visible=!1,d.template.content.name="Content";var g=d.item=a.add.node(d.template.content);g.name="Item",g.interactive=!0;var h=g.addScript("qc.DropdownItem");h.checkBackground=a.add.image(g),h.checkBackground.name="Background",h.checkMark=a.add.image(g),h.checkMark.name="CheckMark",h.text=a.add.text(g),h.text.name="Text",h.image=a.add.image(g),h.image.name="Image",h.image.visible=!1}d.addListener(d.onDown,function(){d.state!==qc.UIState.DISABLED&&(d.state=qc.UIState.PRESSED)}),d.addListener(d.onUp,function(){d.state===qc.UIState.PRESSED&&(d.state=qc.UIState.NORMAL)}),d.addListener(d.onClick,function(){d.isFocused=!d.isFocused}),d.phaser.worldTransformChangedCallback=d._updatePosition,d.phaser.worldTransformChangedContext=d,d._updatePosition()};Dropdown.prototype=Object.create(qc.UIImage.prototype),Dropdown.prototype.constructor=Dropdown,Object.defineProperties(Dropdown.prototype,{"class":{get:function(){return"qc.Dropdown"}},state:{get:function(){return this._state||qc.UIState.NORMAL},set:function(a){this.state!==a&&(this._state=a,this.onStateChange.dispatch())}},value:{get:function(){return this.options.length>0?this._value:-1},set:function(a){if(!(this._value===a||a>=this.options.length)&&"number"==typeof this._value){var b=this._items[this._value],c=this._items[a];this._value=a,b&&b.getScript("qc.DropdownItem").redraw(),c&&c.getScript("qc.DropdownItem").redraw(),this._redraw(),this.onValueChange.dispatch(a)}}},isFocused:{get:function(){return this._list&&this._list.visible},set:function(a){a!==this.isFocused&&(a?this.show():this.hide())}}}),Dropdown.prototype._dispatchAwake=function(){var a=this;Node.prototype._dispatchAwake.call(a),a._value&&0!==a.options.length||(a._value=-1),a._redraw()},Dropdown.prototype.addOptions=function(a){var b=this,c=b.options.concat(a);0===b.options.length?(b.options=c,this.value=0):b.options=c,b.isFocused&&b.show()},Dropdown.prototype.clearOptions=function(){var a=this;a.options=[],a._value>=0&&(a._value=-1,a.onValueChange.dispatch(a._value)),a.isFocused&&a.hide(),a._redraw()},Dropdown.prototype.show=function(){var a=this,b=a._list;a.hide(),a._maskNode=a.game.add.node(a.game.world),a._maskNode.interactive=!0,a._maskNode.name="mask",a._maskNode.addListener(a._maskNode.onClick,function(){a.hide()}),a._items=[],a.item.visible=!1,b=a._list=a.game.add.clone(a.template,a.game.world);for(var c="",d=a.item.parent;d!==a.template;)c=""===c?d.name:d.name+"/"+c,d=d.parent;for(var e=""===c?b:b.find(c),f=0;f<a.options.length;f++){var g=a.game.add.clone(a.item,e);g.visible=!0;var h=g.getScript("qc.DropdownItem");h.dropdown=a,h.index=f,a._items.push(g)}b.visible=!0,a._updatePosition()},Dropdown.prototype.hide=function(){var a=this,b=a._list;b&&(b.destroy(),delete a._list),a._maskNode&&(a._maskNode.destroy(),delete a._maskNode),a._items=[]},Dropdown.prototype.getMeta=function(){var a=this,b=qc.Serializer,c=qc.UIImage.prototype.getMeta.call(a);return c.captionImage=b.NODE,c.captionText=b.NODE,c.template=b.NODE,c.item=b.NODE,c.maskNode=b.NODE,c.state=b.NUMBER,c._value=b.NUMBER,c.options={get:function(b,c){for(var d=[],e=0;e<a.options.length;e++){var f=a.options[e];d.push(f?"string"!=typeof f?a.game.serializer._saveTextureItem(f,c):f:undefined)}return d},set:function(b,c){c.forEach(function(b){return b&&"string"!=typeof b?void a.options.push(a.game.serializer._restoreTextureItem(b)):void a.options.push(b)})}},c},Dropdown.prototype._redraw=function(){var a=this;if(0===a.options.length||a.value<0||a.value>=a.options.length)return a.captionImage&&(a.captionImage.visible=!1),void(a.captionText&&(a.captionText.visible=!1));var b=a.options[a.value];"string"==typeof b?(a.captionImage&&(a.captionImage.visible=!1),a.captionText&&(a.captionText.visible=!0,a.captionText.text=b)):b&&(a.captionText&&(a.captionText.visible=!1),a.captionImage&&(a.captionImage.visible=!0,a.captionImage.texture=b))},Dropdown.prototype._updatePosition=function(){var a=this,b=a._list;if(b){a.template.visible=!0;var c=qc.Bounds.getBox(a,Bounds.USE_BOUNDS,!0,0),d=qc.Bounds.getBox(a.template,Bounds.USE_BOUNDS,!0,0),e=d.y;if(d.height<a.game.world.height/2&&d.y+d.height>a.game.world.height){var f=d.y-(c.y+c.height);e=c.y-f-d.height}var g=a.template.getWorldPosition();b.setAnchor(new qc.Point(0,0),new qc.Point(0,0)),b.x=g.x,b.y=e-b.pivotY*b.height;var h=a.template.getWorldScale();b.scaleX=h.x,b.scaleY=h.y,b.rotation=a.template.getWorldRotation(),b.width=a.template.width,b.height=a.template.height,a._maskNode.x=a._maskNode.y=0,a._maskNode.width=a.game.world.width,a._maskNode.height=a.game.world.height,a.template.visible=!1}};var Bounds=defineBehaviour("qc.Bounds",qc.Behaviour,function(){this._sizeProvider=Bounds.USE_BOUNDS,this._autoCalcBounds=!0,this._marginTop=this._marginBottom=this._marginLeft=this._marginRight=0,this._paddingTop=this._paddingBottom=this._paddingLeft=this._paddingRight=0,this._deep=1},{_sizeProvider:qc.Serializer.NUMBER,_marginTop:qc.Serializer.NUMBER,_marginBottom:qc.Serializer.NUMBER,_marginLeft:qc.Serializer.NUMBER,_marginRight:qc.Serializer.NUMBER,_paddingTop:qc.Serializer.NUMBER,_paddingBottom:qc.Serializer.NUMBER,_paddingLeft:qc.Serializer.NUMBER,_paddingRight:qc.Serializer.NUMBER,_autoCalcBounds:qc.Serializer.BOOLEAN});Bounds.__hiddenInMenu=!0,Object.defineProperties(Bounds.prototype,{sizeProvider:{get:function(){return this._sizeProvider},set:function(a){this._sizeProvider!==a&&(this._sizeProvider=a,this.getBounds(!0))}},marginTop:{get:function(){return this._marginTop},set:function(a){this.setMargin(a)}},marginBottom:{get:function(){return this._marginBottom},set:function(a){this.setMargin(null,null,a)}},marginLeft:{get:function(){return this._marginLeft},set:function(a){this.setMargin(null,null,null,a)}},marginRight:{get:function(){return this._marginRight},set:function(a){this.setMargin(null,a)}},paddingTop:{get:function(){return this._paddingTop},set:function(a){this.setPadding(a)}},paddingBottom:{get:function(){return this._paddingBottom},set:function(a){this.setPadding(null,null,a)}},paddingLeft:{get:function(){return this._paddingLeft},set:function(a){this.setPadding(null,null,null,a)}},paddingRight:{get:function(){return this._paddingRight},set:function(a){this.setPadding(null,a)}},autoCalcBounds:{get:function(){return this._autoCalcBounds},set:function(a){this._autoCalcBounds=a}}}),Bounds.prototype.setPadding=function(a,b,c,d){"undefined"!=typeof a&&null!==a&&(this._paddingTop=a),"undefined"!=typeof b&&null!==b&&(this._paddingRight=b),"undefined"!=typeof c&&null!==c&&(this._paddingBottom=c),"undefined"!=typeof d&&null!==d&&(this._paddingLeft=d),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},Bounds.prototype.setMargin=function(a,b,c,d){"undefined"!=typeof a&&null!==a&&(this._marginTop=a),"undefined"!=typeof b&&null!==b&&(this._marginRight=b),"undefined"!=typeof c&&null!==c&&(this._marginBottom=c),"undefined"!=typeof d&&null!==d&&(this._marginLeft=d),this._lastWrapTime=null,this.relayout&&this.relayout(),this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout")},Bounds.prototype.calcBounds=function(){this.getBounds(!0)},Bounds.prototype.getBounds=function(a){var b=this._recordBounds||new qc.Rectangle(0,0,0,0);if(!this.enable||!this.gameObject||!this.gameObject.isWorldVisible())return b;if(this._recordBounds&&!a&&(!this.autoCalcBounds||this._lastWrapTime===this.gameObject.game.time.fixedTime))return this._recordBounds;this._lastWrapTime=this.gameObject.game.time.fixedTime;var c=new qc.Point(0,0),d=new qc.Point(0,0);return Bounds._calcBounds(c,d,this.sizeProvider,this.gameObject,this._deep),b.x=c.x,b.y=c.y,b.width=d.x-c.x,b.height=d.y-c.y,this._recordBounds=b,b},Bounds.prototype.getWorldCorners=function(a){var b=this.getBounds(a),c=new qc.Point(b.x,b.y),d=new qc.Point(b.x+b.width,b.y),e=new qc.Point(b.x+b.width,b.y+b.height),f=new qc.Point(b.x,b.y+b.height),g=this.gameObject.worldTransform;return[g.apply(c),g.apply(d),g.apply(e),g.apply(f)]},Bounds._calcBounds=function(a,b,c,d,e){var f=d.getScript("qc.Bounds");c=f&&f.enable?f.sizeProvider:c,c===Bounds.USE_BOUNDS?this._calcRealBounds(a,b,d,e):this._calcRectBounds(a,b,d,e)},Bounds._calcRectBounds=function(a,b,c,d){var e=c.getScript("qc.Bounds"),f=c.rect,g=f.x,h=f.y,i=f.x+f.width,j=f.y+f.height;if(0!==d)for(var k=c.children,l=k.length;l--;){var m=k[l];if(m.isWorldVisible()){var n=m.getScript("qc.Bounds"),o=new qc.Point(0,0),p=new qc.Point(0,0);if(n){var q=n.getBounds();o.x=q.x,o.y=q.y,p.x=q.x+q.width,p.y=q.y+q.height}else Bounds._calcRectBounds(o,p,m,d-1);e&&e.enable&&(o.x-=e.paddingLeft,o.y-=e.paddingTop,p.x+=e.paddingRight,p.y+=e.paddingBottom),g=Math.min(g,o.x),h=Math.min(h,o.y),i=Math.max(i,p.x),j=Math.max(j,p.y)}}e&&e.enable&&(g-=e.marginLeft,h-=e.marginTop,i+=e.marginRight,j+=e.marginBottom),a.x=Math.min(a.x,g),a.y=Math.min(a.y,h),b.x=Math.max(b.x,i),b.y=Math.max(b.y,j)},Bounds._calcRealBounds=function(a,b,c,d){var e=c.getScript("qc.Bounds"),f=c.rect,g=f.x,h=f.y,i=f.x+f.width,j=f.y+f.height;if(0!==d)for(var k=c.worldTransform,l=c.children,m=l.length;m--;){var n=l[m];if(n.isWorldVisible()){var o=n.getScript("qc.Bounds"),p=new qc.Point(0,0),q=new qc.Point(0,0);if(o){var r=o.getBounds();p.x=r.x,p.y=r.y,q.x=r.x+r.width,q.y=r.y+r.height}else Bounds._calcRealBounds(p,q,n,d-1);var s=new qc.Point(p.x,p.y),t=new qc.Point(q.x,p.y),u=new qc.Point(q.x,q.y),v=new qc.Point(p.x,q.y),w=n.worldTransform;s=k.applyInverse(w.apply(s)),t=k.applyInverse(w.apply(t)),u=k.applyInverse(w.apply(u)),v=k.applyInverse(w.apply(v));var x=Math.min(s.x,t.x,u.x,v.x),y=Math.min(s.y,t.y,u.y,v.y),z=Math.max(s.x,t.x,u.x,v.x),A=Math.max(s.y,t.y,u.y,v.y);e&&e.enable&&(x-=e.paddingLeft,y-=e.paddingTop,z+=e.paddingRight,A+=e.paddingBottom),g=Math.min(g,x),h=Math.min(h,y),i=Math.max(i,z),j=Math.max(j,A)}}e&&e.enable&&(g-=e.marginLeft,h-=e.marginTop,i+=e.marginRight,j+=e.marginBottom),a.x=Math.min(a.x,g),a.y=Math.min(a.y,h),b.x=Math.max(b.x,i),b.y=Math.max(b.y,j)},Bounds.getBounds=function(a,b,c,d){d="undefined"==typeof d||null===d?0:d;var e=a.getScript("qc.Bounds");if(e&&e.enable)return e.getBounds(c);var f=new qc.Point(0,0),g=new qc.Point(0,0);Bounds._calcBounds(f,g,b,a,d);var h=new qc.Rectangle(0,0,0,0);return h.x=f.x,h.y=f.y,h.width=g.x-f.x,h.height=g.y-f.y,h},Bounds.getCorners=function(a,b,c,d,e){var f=Bounds.getBounds(a,b,c,d),g=a.worldTransform,h=e&&e.worldTransform;if(b===Bounds.USE_RECTTRANSFORM){for(var i=Bounds.findCommonRoot(a,e||a.game.world),j=0,k=0,l=a;l&&l!==a.game.world&&l!==i;)j+=l.x,k+=l.y,l=l.parent;for(l=e;l&&l!==a.game.world&&l!==i;)j-=l.x,k-=l.y;var m=new qc.Point(f.x+j,f.y+k),n=new qc.Point(f.x+f.width+j,f.y+k),o=new qc.Point(f.x+f.width+j,f.y+f.height+k),p=new qc.Point(f.x+j,f.y+f.height+k);return[m,n,o,p]}var m=new qc.Point(f.x,f.y),n=new qc.Point(f.x+f.width,f.y),o=new qc.Point(f.x+f.width,f.y+f.height),p=new qc.Point(f.x,f.y+f.height);return h?[h.applyInverse(g.apply(m)),h.applyInverse(g.apply(n)),h.applyInverse(g.apply(o)),h.applyInverse(g.apply(p))]:[g.apply(m),g.apply(n),g.apply(o),g.apply(p)]},Bounds.getBox=function(a,b,c,d,e){for(var f=Bounds.getCorners(a,b,c,d,e),g=new qc.Point(-Number.MAX_VALUE,-Number.MAX_VALUE),h=new qc.Point(Number.MAX_VALUE,Number.MAX_VALUE),i=0;4>i;i++){var j=f[i];g.x=Math.max(g.x,j.x),g.y=Math.max(g.y,j.y),h.x=Math.min(h.x,j.x),h.y=Math.min(h.y,j.y)}return new qc.Rectangle(h.x,h.y,g.x-h.x,g.y-h.y)},Bounds.getContentRect=function(a){var b=a.rect,c=a.getScript("qc.Bounds");return c&&c.enable&&(b.x+=c.paddingLeft,b.y+=c.paddingTop,b.width-=c.paddingLeft+c.paddingRight,b.height-=c.paddingTop+c.paddingBottom),b},Bounds.getMargin=function(a){var b=a.getScript("qc.Bounds");return b&&b.enable?{top:b._marginTop,bottom:b._marginBottom,left:b._marginLeft,right:b._marginRight}:{top:0,bottom:0,left:0,right:0}},Bounds.findCommonRoot=function(a,b){
if(!a||!b)return null;for(var c=a,d=b;c;){for(d=b;d;){if(c===d)return c;d=d.parent}c=c.parent}return null},Bounds.USE_BOUNDS=0,Bounds.USE_RECTTRANSFORM=1;var LayoutElement=defineBehaviour("qc.LayoutElement",qc.Bounds,function(){this.ignoreLayout=!1,this.minWidth=-1,this.minHeight=-1,this.preferredWidth=-1,this.preferredHeight=-1,this.flexibleWidth=-1,this.flexibleHeight=-1,this._deep=0},{ignoreLayout:qc.Serializer.BOOLEAN,minWidth:qc.Serializer.NUMBER,minHeight:qc.Serializer.NUMBER,preferredWidth:qc.Serializer.NUMBER,preferredHeight:qc.Serializer.NUMBER,flexibleWidth:qc.Serializer.NUMBER,flexibleHeight:qc.Serializer.NUMBER});LayoutElement.__menu="UI/Layout/LayoutElement",Object.defineProperties(LayoutElement.prototype,{ignoreLayout:{get:function(){return this._ignoreLayout},set:function(a){a!==this._ignoreLayout&&(this._ignoreLayout=a)}},minWidth:{get:function(){return this._minWidth},set:function(a){a!==this._minWidth&&(this._minWidth=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},minHeight:{get:function(){return this._minHeight},set:function(a){a!==this._minHeight&&(this._minHeight=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredWidth:{get:function(){return this._preferredWidth},set:function(a){a!==this._preferredWidth&&(this._preferredWidth=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},preferredHeight:{get:function(){return this._preferredHeight},set:function(a){a!==this._preferredHeight&&(this._preferredHeight=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleWidth:{get:function(){return this._flexibleWidth},set:function(a){a!==this._flexibleWidth&&(this._flexibleWidth=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},flexibleHeight:{get:function(){return this._flexibleHeight},set:function(a){a!==this._flexibleHeight&&(this._flexibleHeight=a,this.gameObject&&this.gameObject._dispatchLayoutArgumentChanged("layout"))}},hasMinWidth:{get:function(){return this.minWidth>=0},set:function(a){this.hasMinWidth!==a&&(this.minWidth=a?0:-1)}},hasMinHeight:{get:function(){return this.minHeight>=0},set:function(a){this.hasMinHeight!==a&&(this.minHeight=a?0:-1)}},hasPreferredWidth:{get:function(){return this.preferredWidth>=0},set:function(a){this.hasPreferredWidth!==a&&(this.preferredWidth=a?this.gameObject?this.gameObject.width:0:-1)}},hasPreferredHeight:{get:function(){return this.preferredHeight>=0},set:function(a){this.hasPreferredHeight!==a&&(this.preferredHeight=a?this.gameObject?this.gameObject.height:0:-1)}},hasFlexibleWidth:{get:function(){return this.flexibleWidth>=0},set:function(a){this.hasFlexibleWidth!==a&&(this.flexibleWidth=a?1:-1)}},hasFlexibleHeight:{get:function(){return this.flexibleHeight>=0},set:function(a){this.hasFlexibleHeight!==a&&(this.flexibleHeight=a?1:-1)}}}),LayoutElement.getLayoutElement=function(a){var b=new LayoutElement,c=a.getScript("qc.LayoutElement");return c&&!c.ignoreLayout&&(b.ignoreLayout=c.ignoreLayout,b.minWidth=c.minWidth,b.minHeight=c.minHeight,b.preferredWidth=c.preferredWidth,b.preferredHeight=c.preferredHeight,b.flexibleWidth=c.flexibleWidth,b.flexibleHeight=c.flexibleHeight),b},LayoutElement.USE_RECTTRANSFORM=qc.Bounds.USE_RECTTRANSFORM,LayoutElement.USE_BOUNDS=qc.Bounds.USE_BOUNDS;var TableLayout=defineBehaviour("qc.TableLayout",qc.Bounds,function(){this._cellStyle=[[this._buildCellInfo()]],this._constraint=TableLayout.CONSTRAINT_FLEXIBLE,this.runInEditor=!0,this.cellAlignment=TableLayout.ALIGN_TOP_LEFT,this.gameObject.onChildrenChanged.add(this._doChildrenChanged,this),this.gameObject.onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this)},{constraint:qc.Serializer.NUMBER,stride:qc.Serializer.NUMBER,startCorner:qc.Serializer.NUMBER,startAxis:qc.Serializer.NUMBER,contentSizeProvider:qc.Serializer.NUMBER,style:qc.Serializer.NUMBER,_cellStyle:qc.Serializer.MAPPING,autoUpdate:qc.Serializer.BOOLEAN,contentAlignment:qc.Serializer.NUMBER,cellAlignment:qc.Serializer.NUMBER,spacingX:qc.Serializer.NUMBER,spacingY:qc.Serializer.NUMBER,ignoreX:qc.Serializer.BOOLEAN,ignoreY:qc.Serializer.BOOLEAN});TableLayout.__menu="UI/Layout/TableLayout",TableLayout._precision=1e-7,Object.defineProperties(TableLayout.prototype,{constraint:{get:function(){return isNaN(this._constraint)?TableLayout.CONSTRAINT_FLEXIBLE:this._constraint},set:function(a){this._constraint!==a&&(this._constraint=a,this.rebuildTable())}},stride:{get:function(){return isNaN(this._stride)?0:this._stride},set:function(a){a!==this._stride&&(this._stride=a,this.rebuildTable())}},startCorner:{get:function(){return this._startCorner||TableLayout.CORNER_TOP_LEFT},set:function(a){a!==this._startCorner&&(this._startCorner=a,this.rebuildTable())}},startAxis:{get:function(){return this._startAxis||TableLayout.AXIS_HORIZONTAL},set:function(a){a!==this._startAxis&&(this._startAxis=a,this.rebuildTable())}},contentSizeProvider:{get:function(){return this._contentSizeProvider||TableLayout.USE_BOUNDS},set:function(a){a!==this._contentSizeProvider&&(this._contentSizeProvider=a,this.rebuildTable())}},style:{get:function(){return this._style||TableLayout.STYLE_WRAP_ELEMENT},set:function(a){a!==this._style&&(this._style=a,this.rebuildTable())}},autoUpdate:{get:function(){return this._autoUpdate},set:function(a){this._autoUpdate=a}},spacingX:{get:function(){return this._spacingX||0},set:function(a){this._spacingX!==a&&(this._spacingX=a,this.rebuildTable())}},spacingY:{get:function(){return this._spacingY||0},set:function(a){this._spacingY!==a&&(this._spacingY=a,this.rebuildTable())}},cellWidth:{get:function(){return this.getCellStyle(null,null).cellWidth},set:function(a){this.setCellStyle(null,null,null,null,null,null,null,a)}},cellHeight:{get:function(){return this.getCellStyle(null,null).cellHeight},set:function(a){this.setCellStyle(null,null,null,null,null,null,null,null,a)}},contentAlignment:{get:function(){return this._contentAlignment||TableLayout.ALIGN_TOP_LEFT},set:function(a){this._contentAlignment!==a&&(this._contentAlignment=a,this.rebuildTable())}},cellAlignment:{get:function(){return this.getCellStyle(null,null).align},set:function(a){this.cellAlignment!==a&&(this.setCellStyle(null,null,a),this.rebuildTable())}},columnsCount:{get:function(){var a=this._calcColumnRow();return a.x}},rowsCount:{get:function(){var a=this._calcColumnRow();return a.y}},ignoreX:{get:function(){return!!this._ignoreX},set:function(a){this._ignoreX!==a&&(this._ignoreX=a)}},ignoreY:{get:function(){return!!this._ignoreY},set:function(a){this._ignoreY!==a&&(this._ignoreY=a)}}}),TableLayout.prototype.postUpdate=function(){this.enable&&(this.autoUpdate||this._needRebuildTable)&&(this.rebuildTable(),this._needRebuildTable=!1)},TableLayout.prototype._getChildrenCount=function(){for(var a=0,b=this.gameObject.children,c=0;c<b.length;++c)b[c]&&b[c].isWorldVisible()&&a++;return a},TableLayout.prototype._getChildren=function(){for(var a=[],b=this.gameObject.children,c=0;c<b.length;++c)b[c]&&b[c].isWorldVisible()&&a.push(b[c]);return a},TableLayout.prototype._mixinStyle=function(a,b){return{align:(0===(240&b.align)?240&a.align:240&b.align)|(0===(15&b.align)?15&a.align:15&b.align),timestamp:Math.max(b.timestamp,a.timestamp),paddingLeft:isNaN(b.paddingLeft)?a.paddingLeft:b.paddingLeft,paddingRight:isNaN(b.paddingRight)?a.paddingRight:b.paddingRight,paddingTop:isNaN(b.paddingTop)?a.paddingTop:b.paddingTop,paddingBottom:isNaN(b.paddingBottom)?a.paddingBottom:b.paddingBottom,cellWidth:isNaN(b.cellWidth)?a.cellWidth:b.cellWidth,cellHeight:isNaN(b.cellHeight)?a.cellHeight:b.cellHeight}},TableLayout._calcRectTransform=function(a,b){b=isNaN(b)?0:b;var c=a.rect;if(0!==b)return c;for(var d=a.children,e=d.length;e--;){var f=TableLayout._calcRectTransform(d[e],b-1);c.x=Math.min(c.x,f.x),c.y=Math.min(c.y,f.y),c.w=Math.max(c.x+c.width,f.x+f.width)-c.x,c.h=Math.max(c.y+c.height,f.y+f.height)-c.y}return c},TableLayout.prototype.getCellRect=function(a,b){return qc.Bounds.getBox(a,this.contentSizeProvider,b,0,this.gameObject)},TableLayout.prototype.getCellStyle=function(a,b){a=null==a?0:a+1,b=null==b?0:b+1;var c=this._cellStyle[0][0],d=this._cellStyle[b]&&this._cellStyle[b][0],e=this._cellStyle[0][a];!e||d&&d.timestamp>e.timestamp?(e&&(c=this._mixinStyle(c,e)),d&&(c=this._mixinStyle(c,d))):(d&&(c=this._mixinStyle(c,d)),e&&(c=this._mixinStyle(c,e)));var f=this._cellStyle[b]&&this._cellStyle[b][a];return f&&(c=this._mixinStyle(c,f)),c.paddingTop=isNaN(c.paddingTop)?0:c.paddingTop,c.paddingLeft=isNaN(c.paddingLeft)?0:c.paddingLeft,c.paddingRight=isNaN(c.paddingRight)?0:c.paddingRight,c.paddingBottom=isNaN(c.paddingBottom)?0:c.paddingBottom,c.cellWidth=isNaN(c.cellWidth)?0:c.cellWidth,c.cellHeight=isNaN(c.cellHeight)?0:c.cellHeight,c},TableLayout.prototype.setCellStyle=function(a,b,c,d,e,f,g,h,i){a=null==a?0:a+1,b=null==b?0:b+1,this._cellStyle[b]||(this._cellStyle[b]=[]),this._cellStyle[b][a]||(this._cellStyle[b][a]=this._buildCellInfo());var j=this._cellStyle[b][a];null!=c&&(j.align=c),null!=d&&(j.paddingTop=d),null!=e&&(j.paddingRight=e),null!=f&&(j.paddingBottom=f),null!=g&&(j.paddingLeft=g),null!=h&&(j.cellWidth=h),null!=i&(j.cellHeight=i),this._cellStyle[b][a].timestamp=this.gameObject.game.time.fixedTime,this.rebuildTable()},TableLayout.prototype.clearCellStyle=function(a,b){return a=null==a?0:a+1,b=null==b?0:b+1,0===a&&0===b?void(this._cellStyle[0][0]=this._buildCellInfo()):void(this._cellStyle[b]&&this._cellStyle[b][a]&&(this._cellStyle[b][a]=null))},TableLayout.prototype._buildCellInfo=function(){return{align:0,timestamp:0,paddingLeft:0/0,paddingRight:0/0,paddingTop:0/0,paddingBottom:0/0,cellWidth:0/0,cellHeight:0/0}},TableLayout.prototype._calcColumnRow=function(){var a=this._getChildrenCount(),b=this.stride,c=this.constraint;if(c===TableLayout.CONSTRAINT_FLEXIBLE){var d=this.getCellStyle(null,null),e=qc.Bounds.getContentRect(this.gameObject);this.startAxis===TableLayout.AXIS_HORIZONTAL?(b=Math.min(Math.max(1,Math.floor((e.width+this.spacingX)/(d.cellWidth+this.spacingX))),a),c=TableLayout.CONSTRAINT_FIX_COLUMN_COUNT):(b=Math.min(Math.max(1,Math.floor((e.height+this.spacingY)/(d.cellHeight+this.spacingY))),a),c=TableLayout.CONSTRAINT_FIX_ROW_COUNT)}var f=c===TableLayout.CONSTRAINT_FIX_ROW_COUNT?Math.ceil(a/b):b,g=c===TableLayout.CONSTRAINT_FIX_ROW_COUNT?b:Math.ceil(a/b);return new qc.Point(f,g)},TableLayout.prototype._calcPos=function(a,b){var c=this._calcColumnRow();return b=b||new qc.Point(0,0),this.startAxis===TableLayout.AXIS_HORIZONTAL?(b.x=a%c.x,b.y=Math.floor(a/c.x)):(b.x=Math.floor(a/c.y),b.y=a%c.y),0!==(240&this.startCorner)&&(b.x=c.x-1-b.x),0!==(15&this.startCorner)&&(b.y=c.y-1-b.y),b},TableLayout.prototype._setCellPosition=function(a,b){if(!this.ignoreX||this.columnsCount>1){var c=a.node.x;c+=0!==(a.style.align&TableLayout.ALIGN_RIGHT)?b.x-a.bounds.x+(b.width-a.bounds.width):0!==(a.style.align&TableLayout.ALIGN_CENTER)?b.x-a.bounds.x+(b.width-a.bounds.width)/2:b.x-a.bounds.x,Math.abs(c-a.node.x)>TableLayout._precision&&(a.node.x=c)}if(!this.ignoreY||this.rowsCount>1){var d=a.node.y;d+=0!==(a.style.align&TableLayout.ALIGN_BOTTOM)?b.y-a.bounds.y+(b.height-a.bounds.height):0!==(a.style.align&TableLayout.ALIGN_MIDDLE)?b.y-a.bounds.y+(b.height-a.bounds.height)/2:b.y-a.bounds.y,Math.abs(d-a.node.y)>TableLayout._precision&&(a.node.y=d)}},TableLayout.prototype._setCellSize=function(a,b,c){if(!(Math.abs(a.bounds.width-b)<TableLayout._precision&&Math.abs(a.bounds.height-c)<TableLayout._precision)){var d=Bounds.getMargin(a.node),e=b-d.left-d.right,f=c-d.top-d.bottom,g=a.bounds.width-d.left-d.right,h=a.bounds.height-d.top-d.bottom;a.node.setAnchor(new qc.Point(0,0),new qc.Point(0,0),!1),a.node.x=0,a.node.y=0,0>=g?a.node.width=e:a.node.width*=e/g,0>=h?a.node.height=f:a.node.height*=f/h,a.node.setStretch(0,0,0,0),a.bounds=this.getCellRect(a.node,!0)}},TableLayout.prototype.relayout=function(){this.rebuildTable()},TableLayout.prototype.rebuildTable=function(){this.getCellStyle(null,null);this.style===TableLayout.STYLE_WRAP_ELEMENT?this._rebuildWrapTable():this._rebuildResizeTable()},TableLayout.prototype._getDefaultLayout=function(){return{min:0,preferred:0,flexible:0,extra:0}},TableLayout.prototype.getCellLayout=function(a){return qc.LayoutElement.getLayoutElement(a)},TableLayout.prototype._rebuildResizeTable=function(){for(var a=this._getChildren(),b=[],c=[],d=[],e=[],f=[],g=a.length,h=new qc.Point(0,0),i=-1;++i<g;){this._calcPos(i,h);var j=this.getCellLayout(a[i]),k=this.getCellStyle(h.x,h.y),l=this.getCellRect(a[i]);(b[h.y]||(b[h.y]=[]))[h.x]={node:a[i],layout:j,bounds:l,style:k};var m=e[h.x]||(e[h.x]=this._getDefaultLayout("x")),n=f[h.y]||(f[h.y]=this._getDefaultLayout("y"));j.preferredWidth<0&&a[i].nativeSize&&(j.preferredWidth=a[i].nativeSize.width),j.preferredHeight<0&&a[i].nativeSize&&(j.preferredHeight=a[i].nativeSize.height),!isNaN(k.cellWidth)&&k.cellWidth>0&&(j.minWidth=k.cellWidth,j.preferredWidth=k.cellWidth),!isNaN(k.cellHeight)&&k.cellHeight>0&&(j.minHeight=k.cellHeight,j.preferredHeight=k.cellHeight),j.minWidth>=0&&(m.min=Math.max(m.min,j.minWidth)),j.minHeight>=0&&(n.min=Math.max(n.min,j.minHeight)),m.preferred=Math.max(m.preferred,j.preferredWidth,m.min),n.preferred=Math.max(n.preferred,j.preferredHeight,m.min),j.flexibleWidth>=0&&(m.flexible=Math.max(m.flexible,j.flexibleWidth)),j.flexibleHeight>=0&&(n.flexible=Math.max(n.flexible,j.flexibleHeight)),m.extra=Math.max(m.extra,k.paddingLeft+k.paddingRight),n.extra=Math.max(n.extra,k.paddingTop+k.paddingBottom)}var o={min:0,preferred:0,flexible:0,extra:0,fixed:0},p={min:0,preferred:0,flexible:0,extra:0,fixed:0};e.forEach(function(a){o.min+=a.min,o.preferred+=a.preferred,o.flexible+=a.flexible,o.extra+=a.extra}),f.forEach(function(a){p.min+=a.min,p.preferred+=a.preferred,p.flexible+=a.flexible,p.extra+=a.extra});var q=qc.Bounds.getContentRect(this.gameObject),r=Math.max(0,e.length-1)*this.spacingX,s=Math.max(0,f.length-1)*this.spacingY,t=new qc.Point(0,0);if(q.width<=o.min+o.extra+r)for(var u=0;u<e.length;++u)c[u]=e[u]?e[u].min+e[u].extra:0;else if(q.width<=o.preferred+o.extra+r)for(var v=q.width-o.extra-o.min-r,u=0;u<e.length;++u)c[u]=e[u]?v*e[u].preferred/(o.preferred||1)+e[u].min+e[u].extra:0;else{for(var v=q.width-o.extra-o.preferred-r,u=0;u<e.length;++u)c[u]=e[u]?v*e[u].flexible/(o.flexible||1)+e[u].preferred+e[u].extra:0;0===o.flexible&&(0!==(this.contentAlignment&TableLayout.ALIGN_RIGHT)?t.x=v:0!==(this.contentAlignment&TableLayout.ALIGN_CENTER)&&(t.x=v/2))}if(q.height<=p.min+p.extra+s)for(var u=0;u<f.length;++u)d[u]=f[u]?f[u].min+f[u].extra:0;else if(q.height<=p.preferred+p.extra+s)for(var v=q.height-p.extra-p.min-s,u=0;u<f.length;++u)d[u]=f[u]?v*f[u].preferred/(p.preferred||1)+f[u].min+f[u].extra:0;else{for(var v=q.height-p.extra-p.preferred-s,u=0;u<f.length;++u)d[u]=f[u]?v*f[u].flexible/(p.flexible||1)+f[u].preferred+f[u].extra:0;0===p.flexible&&(0!==(this.contentAlignment&TableLayout.ALIGN_BOTTOM)?t.y=v:0!==(this.contentAlignment&TableLayout.ALIGN_MIDDLE)&&(t.y=v/2))}for(var w=qc.Bounds.getContentRect(this.gameObject),x=new qc.Rectangle(0,0,0,0),y=0,z=0,A=0;A<d.length;A++){y=0;for(var B=0;B<c.length;B++){var C=b[A][B];if(C){x.x=w.x+y+C.style.paddingLeft+t.x,x.y=w.y+z+C.style.paddingTop+t.y,x.width=c[B]-C.style.paddingLeft-C.style.paddingRight,x.height=d[A]-C.style.paddingTop-C.style.paddingBottom;var D=x.width,E=x.height;C.layout.flexibleWidth<=0&&x.width>C.layout.preferredWidth&&C.layout.preferredWidth>0&&(D=C.layout.preferredWidth),C.layout.flexibleHeight<=0&&x.height>C.layout.preferredHeight&&C.layout.preferredHeight>0&&(E=C.layout.preferredHeight),this._setCellSize(C,D,E),this._setCellPosition(C,x),y+=c[B]+this.spacingX}else y+=c[B]+this.spacingX}z+=d[A]+this.spacingY}},TableLayout.prototype._rebuildWrapTable=function(){for(var a=this._getChildren(),b=[],c=[],d=[],e=a.length,f=new qc.Point(0,0);e--;){this._calcPos(e,f);var g=this.getCellStyle(f.x,f.y),h=this.getCellRect(a[e]);(b[f.y]||(b[f.y]=[]))[f.x]={node:a[e],bounds:h,style:g},c[f.x]=g.cellWidth>0?g.cellWidth:Math.max(h.width+g.paddingLeft+g.paddingRight,c[f.x]||0,g.cellWidth),d[f.y]=g.cellHeight>0?g.cellHeight:Math.max(h.height+g.paddingTop+g.paddingBottom,d[f.y]||0,g.cellHeight)}for(var i=0,j=0,k=0;k<c.length;k++)i+=c[k];for(var l=0;l<d.length;l++)j+=d[l];var m=qc.Bounds.getContentRect(this.gameObject),n=new qc.Point(0,0);0!==(this.contentAlignment&TableLayout.ALIGN_BOTTOM)?n.y=m.height-j:0!==(this.contentAlignment&TableLayout.ALIGN_MIDDLE)&&(n.y=(m.height-j)/2),0!==(this.contentAlignment&TableLayout.ALIGN_RIGHT)?n.x=m.width-i:0!==(this.contentAlignment&TableLayout.ALIGN_CENTER)&&(n.x=(m.width-i)/2);for(var o=new qc.Rectangle(0,0,0,0),p=0,q=0,l=0;l<d.length;l++){p=0;for(var k=0;k<c.length;k++){var r=b[l][k];if(r)o.x=m.x+p+r.style.paddingLeft+n.x,o.y=m.y+q+r.style.paddingTop+n.y,o.width=c[k]-r.style.paddingLeft-r.style.paddingRight,o.height=d[l]-r.style.paddingTop-r.style.paddingBottom,this._setCellPosition(r,o),p+=c[k]+this.spacingX;else{var g=this.getCellStyle(k,l),s=c[k]===undefined?g.cellWidth:c[k];p+=s+this.spacingX}}q+=d[l]+this.spacingY}},TableLayout.prototype._doChildrenChanged=function(a){var b=a.children.length;if("add"===a.type)for(;b--;)a.children[b]&&a.children[b].onLayoutArgumentChanged.add(this._doLayoutArgumentChanged,this);else if("remove"===a.type)for(;b--;)a.children[b]&&a.children[b].onLayoutArgumentChanged.remove(this._doLayoutArgumentChanged,this);this._needRebuildTable=!0},TableLayout.prototype._doLayoutArgumentChanged=function(){this._needRebuildTable=!0},TableLayout.CONSTRAINT_FLEXIBLE=0,TableLayout.CONSTRAINT_FIX_COLUMN_COUNT=1,TableLayout.CONSTRAINT_FIX_ROW_COUNT=2,TableLayout.STYLE_WRAP_ELEMENT=0,TableLayout.STYLE_RESIZE_ELEMENT=1,TableLayout.USE_RECTTRANSFORM=qc.LayoutElement.USE_RECTTRANSFORM,TableLayout.USE_BOUNDS=qc.LayoutElement.USE_BOUNDS,TableLayout.AXIS_HORIZONTAL=0,TableLayout.AXIS_VERTICAL=1,TableLayout.CORNER_TOP_LEFT=0,TableLayout.CORNER_TOP_RIGHT=16,TableLayout.CORNER_BOTTOM_RIGHT=17,TableLayout.CORNER_BOTTOM_LEFT=1,TableLayout.ALIGN_LEFT=1,TableLayout.ALIGN_CENTER=2,TableLayout.ALIGN_RIGHT=4,TableLayout.ALIGN_TOP=16,TableLayout.ALIGN_MIDDLE=32,TableLayout.ALIGN_BOTTOM=64,TableLayout.ALIGN_TOP_LEFT=TableLayout.ALIGN_TOP|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_TOP_CENTER=TableLayout.ALIGN_TOP|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_TOP_RIGHT=TableLayout.ALIGN_TOP|TableLayout.ALIGN_RIGHT,TableLayout.ALIGN_MIDDLE_LEFT=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_MIDDLE_CENTER=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_MIDDLE_RIGHT=TableLayout.ALIGN_MIDDLE|TableLayout.ALIGN_RIGHT,TableLayout.ALIGN_BOTTOM_LEFT=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_LEFT,TableLayout.ALIGN_BOTTOM_CENTER=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_CENTER,TableLayout.ALIGN_BOTTOM_RIGHT=TableLayout.ALIGN_BOTTOM|TableLayout.ALIGN_RIGHT;var Animator=defineBehaviour("qc.Animator",qc.Behaviour,function(){var a=this;a.animatorMap={},a.animatorList=[],a.animators=null,a.runInEditor=!0},{animators:qc.Serializer.ANIMATORS});Animator.__menu="Action/Animator",Object.defineProperties(Animator.prototype,{animators:{get:function(){return this._animators},set:function(a){for(var b=0;b<this.animatorList.length;b++){var c=this.animatorList[b];c&&c.destroy()}if(this.animatorMap={},this.animatorList=[],this._animators=a,a)for(var b=0;b<a.length;b++){var d=a[b];if(d){d instanceof qc.ActionManagerAsset?this.animatorList[b]=qc.ActionManager.restoreBundle(d,this.game,!this.game.serializer.isRestoring):d instanceof qc.ActionAsset&&(this.animatorList[b]=qc.Action.restoreBundle(d,this.game,!this.game.serializer.isRestoring)),this.animatorList[b].targetLocked||(this.animatorList[b].targetObject=this.gameObject);var e=this.animatorList[b].name;this.animatorMap[e]&&this.gameObject.game.log.error("Exist duplicate action's name: {0}",e),this.animatorMap[e]=this.animatorList[b]}}}}}),Animator.prototype.awake=function(){if(!(this.animatorList.length<1))for(var a=0;a<this.animatorList.length;a++)this.animatorList[a]&&this.animatorList[a].awake()},Animator.prototype.update=function(){for(var a=0;a<this.animatorList.length;a++){var b=this.animatorList[a];b&&b.isRunning&&b.update()}},Animator.prototype.getAction=function(a){return this.animatorMap[a]||this.animatorList[a]},Animator.prototype.play=function(a,b,c){a=a||0;var d=this.getAction(a);d&&(b=b||this.gameObject,c="boolean"==typeof c?c:!0,d.playAction(b,c))},Animator.prototype.stop=function(a){a=a||0;var b=this.getAction(a);b&&b.stop()},Animator.prototype.destroy=function(){this.animators=null,qc.Behaviour.prototype.destroy.call(this)};var AspectRatioFitter=defineBehaviour("qc.AspectRatioFitter",qc.Behaviour,function(){var a=this;a.mode=AspectRatioFitter.NONE,a.ratio=1,a.runInEditor=!0},{mode:qc.Serializer.NUMBER,ratio:qc.Serializer.NUMBER});AspectRatioFitter.__menu="UI/AspectRatioFitter",Object.defineProperties(AspectRatioFitter.prototype,{mode:{get:function(){return this._mode||AspectRatioFitter.NONE},set:function(a){this.mode!==a&&(this._mode=a,this._reset())}},ratio:{get:function(){return this._ratio||1},set:function(a){0>=a&&(a=.001),this.ratio!==a&&(this._ratio=a,this._reset())}}}),AspectRatioFitter.NONE=0,AspectRatioFitter.WIDTH_CONTROLS_HEIGHT=1,AspectRatioFitter.HEIGHT_CONTROLS_WIDTH=2,AspectRatioFitter.FIT_IN_PARENT=3,AspectRatioFitter.ENVELOPE_PARENT=4,AspectRatioFitter.prototype.awake=function(){var a=this;a._reset();var b=a.gameObject;a.addListener(b.onRelayout,function(){a._reset()})},AspectRatioFitter.prototype._reset=function(){var a=this;if(a.mode!==AspectRatioFitter.NONE){var b=a.gameObject;if(a.mode===AspectRatioFitter.WIDTH_CONTROLS_HEIGHT)return void(b.height=b.width/a.ratio);if(a.mode===AspectRatioFitter.HEIGHT_CONTROLS_WIDTH)return void(b.width=b.height*a.ratio);var c=b.parent.rect;if(b.setAnchor(new qc.Point(0,0),new qc.Point(1,1)),a.mode===AspectRatioFitter.FIT_IN_PARENT){var d=c.width,e=d/a.ratio;return e>c.height&&(e=c.height,d=e*a.ratio),void b.setStretch((c.width-d)/2,(c.width-d)/2,(c.height-e)/2,(c.height-e)/2)}if(a.mode===AspectRatioFitter.ENVELOPE_PARENT){var d=c.width,e=d/a.ratio;return e<c.height&&(e=c.height,d=e*a.ratio),void b.setStretch((c.width-d)/2,(c.width-d)/2,(c.height-e)/2,(c.height-e)/2)}}};var CacheAsBitmap=defineBehaviour("qc.CacheAsBitmap",qc.Behaviour,function(){this._boundsType=CacheAsBitmap.BOUNDS_SELF,this._cacheType=CacheAsBitmap.CACHE_FOR_SCREEN,this._dirty=!0,this.boundsInScreen=!1,this.runInEditor=!0,this.offX=0,this.offY=0},{boundsType:qc.Serializer.NUMBER,cacheType:qc.Serializer.NUMBER,boundsInScreen:qc.Serializer.BOOLEAN});CacheAsBitmap.__menu="UI/CacheAsBitmap",Object.defineProperties(CacheAsBitmap.prototype,{boundsType:{get:function(){return this._boundsType},set:function(a){this._boundsType!==a&&(this._boundsType=a,this.dirty=!0)}},cacheType:{get:function(){return this._cacheType},set:function(a){this._cacheType!==a&&(this._cacheType=a,this.dirty=!0)}},dirty:{get:function(){return this._dirty},set:function(a){this._dirty!==a&&(this._dirty=a)}}}),CacheAsBitmap.prototype.awake=function(){var a=this,b=a.gameObject;a.addListener(a.game.assets.webFontLoaded,a._setDirty,a),b.onRelayout.add(a._setDirty,a)},CacheAsBitmap.prototype._setDirty=function(){this.dirty=!0},CacheAsBitmap.prototype.onEnable=function(){var a=this,b=a.gameObject;b._destroy||(a._cache||(a._cache=new qc.RenderTexture(100,100,this.game.phaser.render,null,this.game.resolution),a._cacheSprite=new PIXI.Sprite(a._cache)),a.dirty=!0,a.gameObject.phaser.setDisplayProxy(a._cacheSprite,!0),a._nodeRenderCanvas||(a._nodeRenderCanvas=a.gameObject.phaser._renderCanvas,a.gameObject.phaser._renderCanvas=a.renderCanvas.bind(a)),a._nodeRenderWebGL||(a._nodeRenderWebGL=a.gameObject.phaser._renderWebGL,a.gameObject.phaser._renderWebGL=a.renderWebGL.bind(a)))},CacheAsBitmap.prototype.onDisable=function(){var a=this;a.gameObject.phaser.setDisplayProxy(null,!1),a._nodeRenderCanvas&&(a.gameObject.phaser._renderCanvas=a._nodeRenderCanvas,a._nodeRenderCanvas=null),a._nodeRenderWebGL&&(a.gameObject.phaser._renderWebGL=a._nodeRenderWebGL,a._nodeRenderWebGL=null)},CacheAsBitmap.prototype.onDestroy=function(){var a=this;a._nodeRenderCanvas&&(a.gameObject.phaser._renderCanvas=a._nodeRenderCanvas,a._nodeRenderCanvas=null),a._nodeRenderWebGL&&(a.gameObject.phaser._renderWebGL=a._nodeRenderWebGL,a._nodeRenderWebGL=null),a._cache&&(a._cache.destroy(!0),a._cache=null),a._cacheSprite&&(a._cacheSprite=null),a.gameObject.onRelayout.remove(a._setDirty,a)},CacheAsBitmap.prototype._updateCache=function(){var a=this,b=a._cache,c=a._cacheSprite;a._updatingCache=!0;var d=null;d=a._cacheBounds=this._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN?a.getLocalBounds():a.getBounds(),a.boundsInScreen?(d.x<0&&(d.width+=d.x,d.x=0),d.y<0&&(d.height+=d.y,d.y=0),d.width=Math.round(Math.max(1,Math.min(a.game.width*a.game.resolution-d.x,d.width))),d.height=Math.round(Math.max(1,Math.min(a.game.height*a.game.resolution-d.y,d.height)))):(d.width=Math.round(d.width),d.height=Math.round(d.height)),b.resize(d.width+(1&d.width),d.height+(1&d.height),!0);var e=a.gameObject.worldTransform;if(this._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN){var f=c.worldTransform;f.a=e.a,f.b=e.b,f.c=e.c,f.d=e.d,f.tx=e.tx,f.ty=e.ty,PIXI.DisplayObject._tempMatrix.tx=-d.x,PIXI.DisplayObject._tempMatrix.ty=-d.y,b.render(a.gameObject.phaser,PIXI.DisplayObject._tempMatrix,!0),c.anchor.x=-(d.x/d.width),c.anchor.y=-(d.y/d.height)}else a.offX=d.x-e.tx,a.offY=d.y-e.ty,c.anchor.x=0,c.anchor.y=0,CacheAsBitmap._tempMatrix.a=e.a,CacheAsBitmap._tempMatrix.b=e.b,CacheAsBitmap._tempMatrix.c=e.c,CacheAsBitmap._tempMatrix.d=e.d,CacheAsBitmap._tempMatrix.tx=Math.round(e.tx-d.x),CacheAsBitmap._tempMatrix.ty=Math.round(e.ty-d.y),b.render(a.gameObject.phaser,CacheAsBitmap._tempMatrix,!0),e=c.worldTransform,e.identity(),e.tx=d.x,e.ty=d.y;a._updatingCache=!1,a.dirty=!1,a.gameObject._isTransformDirty=!0,c.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE),a.gameObject.phaser.displayChanged(qc.DisplayChangeStatus.TEXTURE|qc.DisplayChangeStatus.SIZE),b.baseTexture.scaleMode=PIXI.scaleModes.NEAREST},CacheAsBitmap.prototype.postUpdate=function(){var a=this,b=a._cacheSprite;if(a.dirty)a.game.log.trace("[CacheAsBitmap]Update Cache."),a._updateCache();else if(a._cacheType!==CacheAsBitmap.CACHE_FOR_SCREEN){var c=b.worldTransform,d=a.gameObject.worldTransform;c.a=d.a,c.b=d.b,c.c=d.c,c.d=d.d,c.tx=d.tx,c.ty=d.ty}else{var e=a.gameObject.worldTransform,d=b.worldTransform;d.identity(),d.tx=e.tx+a.offX,d.ty=e.ty+a.offY}},CacheAsBitmap.prototype.getBounds=function(){var a=this;return a.boundsType===CacheAsBitmap.BOUNDS_SELF?qc.Bounds.getBox(a.gameObject,qc.Bounds.USE_BOUNDS,!0,0):a.boundsType===CacheAsBitmap.BOUNDS_ALL?qc.Bounds.getBox(a.gameObject,qc.Bounds.USE_BOUNDS,!0,-1):new qc.Rectangle(0,0,1,1)},CacheAsBitmap.prototype.getLocalBounds=function(){var a=this;return a.boundsType===CacheAsBitmap.BOUNDS_SELF?qc.Bounds.getBox(a.gameObject,qc.Bounds.USE_BOUNDS,!0,0,a.gameObject):a.boundsType===CacheAsBitmap.BOUNDS_ALL?qc.Bounds.getBox(a.gameObject,qc.Bounds.USE_BOUNDS,!0,-1,a.gameObject):new qc.Rectangle(0,0,1,1)},CacheAsBitmap.prototype.renderCanvas=function(a){var b=this,c=b.gameObject;if(c.phaser.visible!==!1&&c.renderable!==!1){if(b._updatingCache&&b._nodeRenderCanvas)return void b._nodeRenderCanvas.call(b.gameObject.phaser,a);b._cacheSprite.worldAlpha=b._cacheSprite.alpha=b.gameObject.phaser.worldAlpha,b._cacheSprite._renderCanvas(a)}},CacheAsBitmap.prototype.renderWebGL=function(a){var b=this,c=b.gameObject;if(c.phaser.visible!==!1&&c.renderable!==!1){if(b._updatingCache&&b._nodeRenderWebGL)return void b._nodeRenderWebGL.call(b.gameObject.phaser,a);b._cacheSprite.worldAlpha=b._cacheSprite.alpha=b.gameObject.phaser.worldAlpha,b._cacheSprite._renderWebGL(a)}},CacheAsBitmap._tempMatrix=new PIXI.Matrix,Object.defineProperties(qc.Node.prototype,{cacheAsBitmap:{get:function(){var a=this.getScript("qc.CacheAsBitmap");return a&&a.enable},set:function(a){var b=this.getScript("qc.CacheAsBitmap");(a||b)&&(b||(b=this.addScript("qc.CacheAsBitmap")),b.enable=a)}}}),CacheAsBitmap.BOUNDS_SELF=0,CacheAsBitmap.BOUNDS_ALL=1,CacheAsBitmap.CACHE_FOR_SCREEN=0,CacheAsBitmap.CACHE_FOR_SELF=1;var DebugViewer=defineBehaviour("qc.DebugViewer",qc.Behaviour,function(){var a=this;a.count=1,a.now=a.game.time.now,a.runInEditor=!0,a.duration=1,a.detail=!1},{debugOn:qc.Serializer.BOOLEAN,duration:qc.Serializer.NUMBER,detail:qc.Serializer.BOOLEAN});DebugViewer.__menu="Debug/DebugViewer",Object.defineProperties(DebugViewer.prototype,{debugOn:{get:function(){return this.game.debug.on},set:function(a){this.game.debug.on=a}}}),DebugViewer.prototype.postUpdate=function(){var a=this.game.debug,b=this.game.time.now;if(b-this.now>=1e3*this.duration){var c=1e3*this.count/(b-this.now),d=(a.preUpdate/this.count).toFixed(1),e=(a.update/this.count).toFixed(1),f=(a.postUpdate/this.count).toFixed(1),g=(a.logic/this.count).toFixed(1),h=(a.render/this.count).toFixed(1),i=(a.total/this.count).toFixed(1),j=this.game.phaser.renderer.renderSession.drawCount;null==j&&(j="(N/A)");var k=this.game.phaser._calcTransformCount,l="FPS: "+c.toFixed(1)+"\nDraw Calls: "+j+"\nTotal: "+i+" ms\nLogic: "+g+" ms\nRender: "+h+" ms\nPreUpdate: "+d+" ms\nUpdate: "+e+" ms\nPostUpdate: "+f+" ms\nTransformCalc: "+k;if(this.detail){var m="Canvas";this.game.phaser.renderType===Phaser.WEBGL?m="WebGL":this.game.phaser.renderType==Phaser.HEADLESS&&(m="Headless"),l+="\n------------\nresolution="+this.game.phaser.resolution+"\ndevicePixelRatio="+window.devicePixelRatio+"\nsize="+this.game.width+"*"+this.game.height+"\nrenderType="+m+"\nantialias="+this.game.antialias}this.gameObject instanceof qc.UIText?this.gameObject.text=l:this.gameObject instanceof qc.Dom&&(l=l.replace(/\n/g,"<br/>"),this.gameObject.innerHTML=l),this.count=1,this.now=b,a.total=0,a.logic=0,a.preUpdate=0,a.update=0,a.postUpdate=0,a.render=0}else this.count++};var DropdownItem=defineBehaviour("qc.DropdownItem",qc.Behaviour,function(){var a=this;a.dropdown=null},{checkBackground:qc.Serializer.NODE,checkMark:qc.Serializer.NODE,text:qc.Serializer.NODE,image:qc.Serializer.NODE});DropdownItem.__menu="UI/DropdownItem",Object.defineProperties(DropdownItem.prototype,{index:{get:function(){return this._index},set:function(a){this._index!==a&&(this._index=a,this.redraw())}}}),DropdownItem.prototype.onDown=function(){this.checkBackground&&(this.checkBackground.visible=!0)},DropdownItem.prototype.onUp=function(){this.checkBackground&&(this.checkBackground.visible=!1)},DropdownItem.prototype.onClick=function(){var a=this;a.index!==a.dropdown.value&&(a.dropdown.value=a.index,a.dropdown.hide())},DropdownItem.prototype.redraw=function(){var a=this,b=a.gameObject,c=a.dropdown.options[a.index];"string"==typeof c?(a.image&&(a.image.visible=!1),a.text.visible=!0,a.text.text=c):(a.text&&(a.text.visible=!1),a.image.visible=!0,a.image.texture=c),a.checkMark&&(a.checkMark.visible=a.index===a.dropdown.value),b.anchoredY=a.index*b.height,a.checkBackground&&(a.checkBackground.visible=!1)};var FilterGroup=defineBehaviour("qc.FilterGroup",qc.Behaviour,function(){this._filters=[]},{filters:Serializer.FILTERS,inherited:Serializer.BOOLEAN});FilterGroup.__menu="UI/FilterGroup",Object.defineProperties(FilterGroup.prototype,{filters:{get:function(){return this._filters},set:function(a){this._filters=a,this.refresh()}},inherited:{get:function(){return!(this.gameObject&&this.gameObject.filterSelf)},set:function(a){this.gameObject&&(this.gameObject.filterSelf=!a)}}}),FilterGroup.prototype.onDisable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},FilterGroup.prototype.onEnable=function(){this.gameObject&&!this.gameObject._destroy&&this.refresh()},FilterGroup.prototype.onDestroy=function(){this.gameObject&&!this.gameObject._destroy&&this.gameObject.phaser&&(this.gameObject.phaser.filters=null)},FilterGroup.prototype.refresh=function(){this.gameObject&&!this.gameObject._destroy&&(this.enable?this.enable&&(this.gameObject.phaser.filters=this.filters&&this.filters.length>0?this.filters:null):this.gameObject.phaser.filters=null);

},FilterGroup.prototype.findFilter=function(a){"string"==typeof a&&(a=qc.Util.findClass(a));var b=[];for(var c in this.filters)this.filters[c]instanceof a&&b.push(this.filters[c]);return b},FilterGroup.prototype.removeFilterAt=function(a){if(!(0>a||a>=this.filters.length)){var b=this.filters.splice(a,1);return this.refresh(),b}},FilterGroup.prototype.removeFilter=function(a){"string"==typeof a&&(a=qc.Util.findClass(a));var b=[],c=this.filters.length;if("function"==typeof a)for(;c-->0;)this.filters[c]instanceof a&&b.push(this.filters.splice(c,1));else for(;c-->0;)this.filters[c]===a&&b.push(this.filters.splice(c,1));return this.refresh(),b},FilterGroup.prototype.addFilter=function(a,b){if("string"==typeof a&&(a=qc.Util.findClass(a),"function"!=typeof a))return null;if("function"==typeof a)a=new a(this.game);else for(var b=this.filters.length;b-->0;)if(this.filters[b]===a)return;return isNaN(b)||0>b||b>this.filters.length?this.filters.push(a):this.filters.splice(b,0,a),this.refresh(),a};var HorizontalLayout=defineBehaviour("qc.HorizontalLayout",qc.TableLayout,function(){this.style=qc.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=qc.TableLayout.CONSTRAINT_FIX_ROW_COUNT,this.contentSizeProvider=qc.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=qc.TableLayout.CORNER_TOP_LEFT,this.startAxis=qc.TableLayout.AXIS_HORIZONTAL},{childForceExpandWidth:qc.Serializer.NUMBER,childForceExpandHeight:qc.Serializer.NUMBER});HorizontalLayout.__menu="UI/Layout/HorizontalLayout",Object.defineProperties(HorizontalLayout.prototype,{spacing:{get:function(){return this.spacingX},set:function(a){this.spacingX=a}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(a){this._childForceExpandWidth!==a&&(this._childForceExpandWidth=a,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(a){this._childForceExpandHeight!==a&&(this._childForceExpandHeight=a,this.rebuildTable())}}}),HorizontalLayout.prototype._getDefaultLayout=function(a){return"x"===a?{min:0,preferred:0,flexible:this.childForceExpandWidth?1:0,extra:0}:{min:0,preferred:this.childForceExpandHeight?this.gameObject.rect.height:-1,flexible:1,extra:0}},HorizontalLayout.prototype.getCellLayout=function(a){var b=qc.LayoutElement.getLayoutElement(a);return this.childForceExpandWidth&&(b.flexibleWidth=1),this.childForceExpandHeight&&(b.flexibleHeight=1),b};var NodeMask=defineBehaviour("qc.NodeMask",qc.Behaviour,function(){this._mask=this.gameObject.game.phaser.add.graphics(0,0),this._mask.parent&&this._mask.parent.remove(this._mask),this.gameObject.onTextureChanged&&this.addListener(this.gameObject.onTextureChanged,this._doTextureChange,this),this.gameObject.onTransformChanged&&this.addListener(this.gameObject.onTransformChanged,this._doTransformChanged,this),this.onEnable(),this.runInEditor=!0},{checkInField:qc.Serializer.BOOLEAN,minAnchor:qc.Serializer.GEOM,maxAnchor:qc.Serializer.GEOM,minRotation:qc.Serializer.NUMBER,maxRotation:qc.Serializer.NUMBER,clipType:qc.Serializer.NUMBER,mode:qc.Serializer.NUMBER});NodeMask.__menu="UI/NodeMask",Object.defineProperties(NodeMask.prototype,{checkInField:{get:function(){return!!this._checkInField},set:function(a){this._checkInField!==a&&(this._checkInField=a,a||this._resetRenderAble(this.gameObject))}},minAnchor:{get:function(){return this._minAnchor||new qc.Point(0,0)},set:function(a){this.setMask(a)}},maxAnchor:{get:function(){return this._maxAnchor||new qc.Point(1,1)},set:function(a){this.setMask(null,a)}},minRotation:{get:function(){return"undefined"!=typeof this._minRotation||null===this._minRotation?this._minRotation:0},set:function(a){this.setMask(null,null,a)}},maxRotation:{get:function(){return"undefined"!=typeof this._maxRotation||null===this._maxRotation?this._maxRotation:2*Math.PI},set:function(a){this.setMask(null,null,null,a)}},clipType:{get:function(){return NodeMask.CLIP_STENCIL},set:function(){}},mode:{get:function(){return this._mode||NodeMask.MODE_DEFAULT},set:function(a){this._mode!==a&&(this._mode=a,this._refresh())}},customGraphics:{get:function(){return this._customGraphics||(this._customGraphics=this.game.phaser.add.graphics(0,0),this._customGraphics.parent&&this._customGraphics.parent.remove(this._customGraphics)),this._customGraphics}},_maskFilter:{get:function(){return this.__maskFilter||(this.__maskFilter=new qc.Filter.AlphaMask(this.game),this.__maskFilter.otherTexture=new qc.Filter.FilterTexture(this.game),this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame),this.__maskFilter}},_graphicsFilter:{get:function(){return this.__graphicsFilter||(this.__graphicsFilter=new qc.Filter.AlphaMask(this.game),this.__graphicsFilter.otherTexture=new qc.Filter.GraphicsTexture(this.game)),this.__graphicsFilter}}}),NodeMask.prototype.onEnable=function(){this._refresh()},NodeMask.prototype.onDisable=function(){this._refresh()},NodeMask.prototype.onDestroy=function(){this.gameObject.phaser.mask=null,this.gameObject.phaser.softClip=null,this.gameObject.phaser.maskPixel=null,this.gameObject.phaser._graphicsFilter=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject)},NodeMask.prototype._doTextureChange=function(){this.__maskFilter&&(this.__maskFilter.otherTexture.texture=this.gameObject.texture,this.__maskFilter.otherTexture.frame=this.gameObject.frame)},NodeMask.prototype._doTransformChanged=function(){this.postUpdate()},NodeMask.prototype._isNeedUseClipReplaceStencil=function(){return!this.game.device.phaser.supportStencil&&this.game.phaser.renderType===Phaser.WEBGL&&this.clipType===NodeMask.CLIP_STENCIL},NodeMask.prototype._refresh=function(){this._isNeedUseClipReplaceStencil()?(this.gameObject.phaser.softClip=null,this.gameObject.phaser.mask=null,this.gameObject.phaser.maskPixel=null,this._graphicsFilter.otherTexture.updateTexture(),this.gameObject.phaser._graphicsFilter=this.enable?{target:this.gameObject.phaser,filterPasses:this._graphicsFilter.passes}:null):this.game.phaser.renderType!==Phaser.WEBGL||this.clipType===NodeMask.CLIP_STENCIL?(this.gameObject.phaser.mask=this.enable&&this.mode!==NodeMask.MODE_PIXEL?this.mode===NodeMask.MODE_GRAPHICS?this.customGraphics:this._mask:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===NodeMask.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.softClip=null,this.gameObject._destroy||this._resetRenderAble(this.gameObject),this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null):(this.gameObject.phaser.softClip=this.enable&&this.mode!==NodeMask.MODE_PIXEL?this._softClip:null,this.gameObject.phaser.maskPixel=this.enable&&this.mode===NodeMask.MODE_PIXEL?{target:this.gameObject.phaser,filterPasses:this._maskFilter.passes}:null,this.gameObject.phaser.mask=null,this.gameObject.phaser._clipTexture=null,this.gameObject.phaser._graphicsFilter=null)},NodeMask.prototype.postUpdate=function(){if(this.enable&&this.mode===NodeMask.MODE_DEFAULT&&(this._updateMask(),this._checkInField))for(var a=this.gameObject.children,b=this.gameObject.getWorldBox(),c=0;c<a.length;c++)this._checkRenderable(b,a[c])},NodeMask.prototype.setMask=function(a,b,c,d){var e=a||this.minAnchor,f=b||this.maxAnchor;if(c="undefined"==typeof c||null===c?this.minRotation:c,d="undefined"==typeof d||null===d?this.maxRotation:d,e.x<0&&(e.x=0),e.y<0&&(e.y=0),e.x>1&&(e.x=1),e.y>1&&(e.y=1),f.x<0&&(f.x=0),f.y<0&&(f.y=0),f.x>1&&(f.x=1),f.y>1&&(f.y=1),e.x>f.x||e.y>f.y)throw new Error("Expected:min < max");if(c>d)throw new Error("Expected:minRotation < maxRotation");(e.x!==this.minAnchor.x||e.y!==this.minAnchor.y||f.x!==this.maxAnchor.x||f.y!==this.maxAnchor.y||c!==this.minRotation||d!==this.maxRotation)&&(this._minAnchor=e,this._maxAnchor=f,this._minRotation=c,this._maxRotation=d,this._maskForceChange=!0,this.gameObject.phaser.displayChanged(qc.DisplayChangeStatus.SIZE))},NodeMask.prototype._updateMask=function(){var a=this._mask,b=this.gameObject.worldTransform,c=this.gameObject.rect,d=[c.x,c.y,c.width,c.height,b.a,b.b,b.c,b.d,b.tx,b.ty];if(this._maskForceChange||!this._lastMaskRect||this._lastMaskRect[0]!==d[0]||this._lastMaskRect[1]!==d[1]||this._lastMaskRect[2]!==d[2]||this._lastMaskRect[3]!==d[3]||this._lastMaskRect[4]!==d[4]||this._lastMaskRect[5]!==d[5]||this._lastMaskRect[6]!==d[6]||this._lastMaskRect[7]!==d[7]||this._lastMaskRect[8]!==d[8]||this._lastMaskRect[9]!==d[9]){this._maskForceChange=!1,this._lastMaskRect=d;var e=this.minAnchor,f=this.maxAnchor,g=this.minRotation,h=this.maxRotation,i=c.x+e.x*c.width,j=c.y+e.y*c.height,k=c.x+f.x*c.width,l=c.y+f.y*c.height,m=this.gameObject.getWorldScale(),n=m.x*m.y<0,o=(i+k)/2,p=(j+l)/2,q=null;if(h-g>=2*Math.PI)q=[new qc.Point(i,j),new qc.Point(k,j),new qc.Point(k,l),new qc.Point(i,l)];else{for(var r=2*Math.PI,s=Math.atan2(l-j,k-i);-s>g||g>r-s;){var t=0>g?r:-r;g+=t,h+=t}var u,v,w;g>=-s&&s>g?(u=k,v=p+(k-o)*Math.tan(g),w=0):g<Math.PI-s?(v=l,u=o+(l-p)/Math.tan(g),w=1):g<Math.PI+s?(u=i,v=p+(o-i)*Math.tan(Math.PI-g),w=2):(v=j,u=o+(p-j)/Math.tan(r-g),w=3);for(var x,y,z=0;h>r-s;)h-=r,z+=4;h>=-s&&s>h?(x=k,y=p+(k-o)*Math.tan(h),z+=0):h<Math.PI-s?(y=l,x=o+(l-p)/Math.tan(h),z+=1):h<Math.PI+s?(x=i,y=p+(o-i)*Math.tan(Math.PI-h),z+=2):(y=j,x=o+(p-j)/Math.tan(r-h),z+=3);var A=[new qc.Point(k,l),new qc.Point(i,l),new qc.Point(i,j),new qc.Point(k,j)];for(q=[new qc.Point(o,p),new qc.Point(u,v)];z>w;)q.push(A[w%4]),w++;q.push(new qc.Point(x,y))}if(!this._isNeedUseClipReplaceStencil()){for(var B=0;B<q.length;B++)q[B]=b.apply(q[B]);n&&q.reverse()}if(this._softClip=q,this._isNeedUseClipReplaceStencil()){var C=this.gameObject.phaser.getBounds(),D=this._graphicsFilter.otherTexture;D.resize(C.width,C.height),D.offset.x=-C.x,D.offset.y=-C.y;var E=D.graphics;E.clear(),E.beginFill(16777215),E.drawPolygon(q),E.worldTransform=this.gameObject.worldTransform}else a.clear(),a.beginFill(16777215),a.drawPolygon(q);this._refresh()}},NodeMask.prototype._checkRenderable=function(a,b){var c=b.getWorldBox();b.renderable=qc.Rectangle.intersects(a,c)?!0:!1;for(var d=b.children,e=0;e<d.length;e++)this._checkRenderable(a,d[e])},NodeMask.prototype._resetRenderAble=function(a){if(a){a.renderable=!0;for(var b=a.children,c=0;c<b.length;c++)this._resetRenderAble(b[c])}},NodeMask.MODE_DEFAULT=0,NodeMask.MODE_PIXEL=1,NodeMask.MODE_GRAPHICS=2,NodeMask.CLIP_STENCIL=1;var NonexistScript=defineBehaviour("qc.NonexistScript",qc.Behaviour,function(){this.script="",this.data={}},{});NonexistScript.__hiddenInMenu=!0;var ScaleAdapter=defineBehaviour("qc.ScaleAdapter",qc.Behaviour,function(){var a=this;a.target=null,a.referenceResolution=new qc.Point(0,0),a.manualType=ScaleAdapter.NONE,a.gameObjectRecord=a.gameObject?[a.gameObject.scaleX,a.gameObject.scaleY,a.gameObject.width,a.gameObject.height]:[],a._fullTarget=!1,a.runInEditor=!0},{target:qc.Serializer.NODE,referenceResolution:qc.Serializer.GEOM,manualType:qc.Serializer.NUMBER,fullTarget:qc.Serializer.BOOLEAN,gameObjectRecord:qc.Serializer.NUMBERS});ScaleAdapter.__hiddenInMenu=!0,Object.defineProperties(ScaleAdapter.prototype,{fullTarget:{get:function(){return this._fullTarget},set:function(a){this._fullTarget!==a&&(this._fullTarget=a,!a&&this.gameObject&&(this.gameObject.width=this.gameObjectRecord[2],this.gameObject.height=this.gameObjectRecord[3]),this._forceUpdate=!0)}}}),ScaleAdapter.NONE=0,ScaleAdapter.MANUAL_HEIGHT=1,ScaleAdapter.MANUAL_WIDTH=2,ScaleAdapter.EXPAND=3,ScaleAdapter.SHRINK=4,ScaleAdapter.FILL=5,ScaleAdapter.prototype.awake=function(){if(this.game.fixedGameSize){var a=this.gameObject;a.width=this.game.world.width,a.height=this.game.world.height,a.scaleX=1,a.scaleY=1}},ScaleAdapter.prototype.onEnable=function(){var a=this,b=a.gameObject,c=a.gameObjectRecord;c[0]=b.scaleX,c[1]=b.scaleY,c[2]=b.width,c[3]=b.height},ScaleAdapter.prototype.onDisable=function(){var a=this,b=a.gameObject,c=a.gameObjectRecord;c.length<4||null===c[0]||isNaN(c[0])||(b.scaleX=c[0],b.scaleY=c[1],b.width=c[2],b.height=c[3])},ScaleAdapter.prototype.preUpdate=function(){var a=this;if(!a.game.fixedGameSize){var b=a.gameObject;if(b&&b.scaleX){var c=a.getTargetSize(),d=a.getReferenceResolution();if(0!==c.x&&0!==c.y&&0!==d.x&&0!==d.y){var e=1,f=1;switch(this.manualType){case qc.ScaleAdapter.MANUAL_HEIGHT:f=e=c.y/d.y;break;case qc.ScaleAdapter.MANUAL_WIDTH:f=e=c.x/d.x;break;case qc.ScaleAdapter.EXPAND:f=e=Math.min(c.x/d.x,c.y/d.y);break;case qc.ScaleAdapter.SHRINK:f=e=Math.max(c.x/d.x,c.y/d.y);break;case qc.ScaleAdapter.FILL:e=c.x/d.x,f=c.y/d.y}isNaN(e)||isNaN(f)||(this.fullTarget&&(this.gameObject.width=c.x/e,this.gameObject.height=c.y/f),(this._forceUpdate||this.gameObject.scaleX!==e||this.gameObject.scaleY!==f)&&(this._forceUpdate=!1,this.gameObject.scaleX=e,this.gameObject.scaleY=f))}}}},ScaleAdapter.prototype.onDestroy=function(){this.target=null},ScaleAdapter.prototype.getTargetSize=function(){var a=this.target||this.gameObject.game.world;return a&&a.width&&a.height?new qc.Point(a.width,a.height):new qc.Point(0,0)},ScaleAdapter.prototype.getReferenceResolution=function(){return this.referenceResolution};var ToggleGroup=qc.defineBehaviour("qc.ToggleGroup",qc.Behaviour,function(){this._toggles=[],this.runInEditor=!0,this.onValueChange=new qc.Signal},{toggles:qc.Serializer.NODES,allowSwitchOff:qc.Serializer.BOOLEAN});ToggleGroup.__menu="UI/ToggleGroup",Object.defineProperties(ToggleGroup.prototype,{toggle:{get:function(){for(var a=0;a<this._toggles.length;a++){var b=this._toggles[a];if(b&&b.on)return b}return null},set:function(a){var b=this._toggles.indexOf(a);if(-1===b)return void this.game.log.error("target is not in this group");for(var c=0;c<this._toggles.length;c++){var d=this._toggles[c];d&&(d.on=d===a)}this.onValueChange.dispatch(this,a,!0)}},toggles:{get:function(){return this._toggles},set:function(a){var b=this;b._toggles.forEach(function(a){a&&(a.onValueChange.remove(b._onValueChange,b),a.canValueChange.remove(b._canValueChange,b))}),b._toggles=a||[],b._toggles.forEach(function(a){a&&(a.onValueChange.add(b._onValueChange,b),a.canValueChange.add(b._canValueChange,b))})}},allowSwitchOff:{get:function(){var a=this._allowSwitchOff;return a===undefined?!0:a},set:function(a){a=!!a;var b=this.allowSwitchOff;b!==a&&(this._allowSwitchOff=a,a||this._assureSelection())}}}),ToggleGroup.prototype._assureSelection=function(){if(null==this.toggle){var a=this.toggles;if(a&&a.length){var b=a[0];b&&(b.on=!0)}}},ToggleGroup.prototype.add=function(a){-1===this._toggles.indexOf(a)&&(this._toggles.push(a),a.on=!1,a.onValueChange.add(this._onValueChange,this),a.canValueChange.add(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},ToggleGroup.prototype.remove=function(a){var b=this._toggles.indexOf(a);-1!==b&&(this._toggles.splice(b,1),a.onValueChange.remove(this._onValueChange,this),a.canValueChange.remove(this._canValueChange,this),this.allowSwitchOff||this._assureSelection())},ToggleGroup.prototype._canValueChange=function(a,b,c,d){if(!this.allowSwitchOff&&c&&!b){for(var e=!1,f=0,g=this.toggles.length;g>f;f++){var h=this.toggles[f];if(h!==a){if(h&&h.on)return}else e=!0}e&&(d.ignore=!0)}},ToggleGroup.prototype._onValueChange=function(a){a.on?this.toggle=a:this.toggle||this.onValueChange.dispatch(this,a,!1)};var TransitionBehaviour=qc.defineBehaviour("qc.TransitionBehaviour",qc.Behaviour,function(){if(this.gameObject.state===undefined)throw new Error("The target node does not have the interactive function, and can not be added to this component.");this.target=this.gameObject,this._transition=qc.Transition.TEXTURE_SWAP},{target:qc.Serializer.NODE,_transition:qc.Serializer.NUMBER,_normalTexture:{get:function(a,b){return this._saveTexture(a._normalTexture,b)},set:function(a,b){this._normalTexture=this._restoreTexture(b,a)}},_pressedTexture:{get:function(a,b){return this._saveTexture(a._pressedTexture,b)},set:function(a,b){this._pressedTexture=this._restoreTexture(b,a)}},_disabledTexture:{get:function(a,b){return this._saveTexture(a._disabledTexture,b)},set:function(a,b){this._disabledTexture=this._restoreTexture(b,a)}},_normalColor:qc.Serializer.COLOR,_pressedColor:qc.Serializer.COLOR,_disabledColor:qc.Serializer.COLOR});TransitionBehaviour.__menu="UI/TransitionBehaviour",Object.defineProperties(TransitionBehaviour.prototype,{target:{get:function(){return this._target},set:function(a){this._target=a,this._reset()}},transition:{get:function(){return this._transition},set:function(a){this._transition!==a&&(this._transition=a,this.target&&this._reset())}},normalTexture:{get:function(){return this._normalTexture},set:function(a){a!==this._normalTexture&&(this._normalTexture=a,this.target&&this.gameObject.state===qc.UIState.NORMAL&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.normalTexture))}},pressedTexture:{get:function(){return this._pressedTexture},set:function(a){a!==this._pressedTexture&&(this._pressedTexture=a,this.target&&this.gameObject.state===qc.UIState.PRESSED&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.pressedTexture))}},disabledTexture:{get:function(){return this._disabledTexture},set:function(a){a!==this._disabledTexture&&(this._disabledTexture=a,this.target&&this.gameObject.state===qc.UIState.DISABLED&&this.transition===qc.Transition.TEXTURE_SWAP&&(this.target.texture=this.disabledTexture))}},normalColor:{get:function(){return this._normalColor},set:function(a){if(this._normalColor!==a&&this.target){if(a=a||Color.white,!(a instanceof Color))return void this.game.log.error("Expected qc.Color, got:{0}",a);this._normalColor=a,this.gameObject.state===qc.UIState.NORMAL&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.normalColor)}}},pressedColor:{get:function(){return this._pressedColor},set:function(a){if(this._pressedColor!==a&&this.target){if(a=a||Color.grey,!(a instanceof Color))return void this.game.log.error("Expected qc.Color, got:{0}",a);this._pressedColor=a,this.gameObject.state===qc.UIState.PRESSED&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.pressedColor)}}},disabledColor:{get:function(){return this._disabledColor},set:function(a){if(this._disabledColor!==a&&this.target){if(a=a||Color.grey,!(a instanceof Color))return void this.game.log.error("Expected:qc.Color, got:{0}",a);this._disabledColor=a,this.gameObject.state===qc.UIState.DISABLED&&this.transition===qc.Transition.COLOR_TINT&&(this.target.colorTint=this.disabledColor)}}},pressedAnimation:{get:function(){return this._pressedAnimation},set:function(a){this._pressedAnimation!==a&&(this._pressedAnimation=a)}}}),TransitionBehaviour.prototype._normalColor=Color.white,TransitionBehaviour.prototype._pressedColor=Color.grey,TransitionBehaviour.prototype._disabledColor=Color.grey,TransitionBehaviour.prototype.awake=function(){this.addListener(this.gameObject.onStateChange,this._reset,this),this._reset()},TransitionBehaviour.prototype._saveTexture=function(a,b){return this.gameObject.game.serializer._saveTextureItem(a,b)},TransitionBehaviour.prototype._restoreTexture=function(a,b){if(a&&a.length&&a[0]===qc.Serializer.STRING){var c=b.gameObject.texture;return c&&c.atlas.frameNames.indexOf(a[1])>=0?b.gameObject.texture.atlas.getTexture(a[1]):null}return this.gameObject.game.serializer._restoreTextureItem(a)},TransitionBehaviour.prototype._reset=function(){if(this.target&&this.enable)switch(this.transition){case qc.Transition.NONE:break;case qc.Transition.TEXTURE_SWAP:switch(this.gameObject.state){case qc.UIState.NORMAL:this.normalTexture&&(this.target.texture=this.normalTexture);break;case qc.UIState.PRESSED:this.pressedTexture&&(this.target.texture=this.pressedTexture);break;case qc.UIState.DISABLED:this.disabledTexture&&(this.target.texture=this.disabledTexture)}break;case qc.Transition.COLOR_TINT:switch(this.gameObject.state){case qc.UIState.NORMAL:this.target.colorTint=this.normalColor;break;case qc.UIState.PRESSED:this.target.colorTint=this.pressedColor;break;case qc.UIState.DISABLED:this.target.colorTint=this.disabledColor}break;case qc.Transition.ANIMATION:}};var Tween=defineBehaviour("qc.Tween",qc.Behaviour,function(){this._curve=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),this._started=!1,this._startTime=0,this._amountPerDelta=1e3,this._factor=0,this.duration=1,this.runInEditor=!0,this.flag="",this.playOnAwake=!1,this.canRunInEditor=!1},{_curve:qc.Serializer.GEOM,sampleMethod:qc.Serializer.NUMBER,style:qc.Serializer.NUMBER,delay:qc.Serializer.NUMBER,duration:qc.Serializer.NUMBER,tweenGroup:qc.Serializer.NUMBER,flag:qc.Serializer.STRING,playOnAwake:qc.Serializer.BOOLEAN});Tween.__hiddenInMenu=!0,Object.defineProperties(Tween.prototype,{curve:{get:function(){return this._curve}},sampleMethod:{get:function(){return this._sampleMethod||Tween.SAMPLE_LINEAR},set:function(a){this._sampleMethod!==a&&(this._sampleMethod=a)}},style:{get:function(){return this._style||0},set:function(a){this._style!==a&&(this._style=a)}},delay:{get:function(){return isNaN(this._delay)||this._delay<0?0:this._delay},set:function(a){this._delay!==a&&(this._delay=a)}},duration:{get:function(){return isNaN(this._duration)||this._duration<0?0:this._duration},set:function(a){this._duration!==a&&(this._duration=a,this._amountPerDelta=Math.abs(a>0?1/(1e3*a):1e3)*(this._amountPerDelta>=0?1:-1))}},tweenGroup:{get:function(){return this._tweenGroup||0},set:function(a){this._tweenGroup!==a&&(this._tweenGroup=a)}},onStart:{get:function(){return this._onStart||(this._onStart=new Phaser.Signal),this._onStart}},onFinished:{get:function(){return this._onFinished||(this._onFinished=new Phaser.Signal),this._onFinished}},onLoopFinished:{get:function(){return this._onLoopFinished||(this._onLoopFinished=new Phaser.Signal),this._onLoopFinished}},amountPerDelta:{get:function(){return this._amountPerDelta}},tweenFactor:{get:function(){return this._factor},set:function(a){this._factor=Phaser.Math.clamp(a,0,1)}},direction:{get:function(){return this.amountPerDelta<0?Tween.DIR_REVERSE:Tween.DIR_FORWARD}}}),Tween.prototype.awake=function(){var a=this;a._started||(a.enable=!1,a.playOnAwake&&(a.resetToBeginning(),a.playForward()))},Tween.prototype._lineSample=function(a){return a},Tween.prototype.start=function(){this.update()},Tween.prototype.update=function(){if(this.enable&&(!this.gameObject||!this.game.device.editor||this.canRunInEditor)){var a=this.game.time.deltaTime,b=this.game.time.scaledTime;this._started||(this._started=!0,this._dispatchStart=!1,this._startTime=b+1e3*this.delay),b<this._startTime||(b===this._startTime?a=0:b-this._startTime<a&&(a=b-this._startTime),this._dispatchStart||(this._dispatchStart=!0,this._onStart&&this._onStart.dispatch(this)),this._factor+=this.amountPerDelta*a,this.style===Tween.STYLE_LOOP?this._factor>1&&(this._factor-=Math.floor(this._factor),this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this.style===Tween.STYLE_PINGPONG&&(this._factor>1?(this._factor=1-(this._factor-Math.floor(this._factor)),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this)):this._factor<0&&(this._factor=-this._factor,this._factor-=Math.floor(this._factor),this._amountPerDelta=-this._amountPerDelta,this._onLoopFinished&&this._onLoopFinished.dispatch(this))),this.style===Tween.STYLE_ONCE&&(0===this.duration||this._factor>1||this._factor<0)?(this._factor=Phaser.Math.clamp(this._factor,0,1),this.sample(this._factor,!0),this._onFinished&&this._onFinished.dispatch(this),(0===this.duration||1===this._factor&&this._amountPerDelta>0||0===this._factor&&this._amountPerDelta<0)&&(this.enable=!1)):this.sample(this._factor,!1))}},Tween.prototype.onDisable=function(){this._started=!1,this.canRunInEditor=!1},Tween.prototype.sample=function(a,b){var c=Phaser.Math.clamp(a,0,1);switch(this.sampleMethod){case Tween.SAMPLE_LINEAR:c=this._lineSample(c)}this.onUpdate(this.curve.evaluate(c),b)},Tween.prototype._funcGroup=function(a){var b=this;return 0===b.tweenGroup?void a(b):void Tween._funcGroup(b.gameObject,b.tweenGroup,a)},Tween.prototype.reset=function(a){this._started||(a?this.setEndToCurrValue():this.setStartToCurrValue())},Tween.prototype.resetGroup=function(a){var b=function(b){b.reset(a)};this._funcGroup(b)},Tween.prototype.playForward=function(a){a&&this.resetToBeginning(),this.play(!1)},Tween.prototype.playGroupForward=function(a){var b=function(b){b.playForward(a)};this._funcGroup(b)},Tween.prototype.playReverse=function(a){a&&this.resetToBeginning(!0),this.play(!0)},Tween.prototype.playGroupReverse=function(a){var b=function(b){b.playReverse(a)};this._funcGroup(b)},Tween.prototype.stop=function(){this.enable=!1,this.canRunInEditor=!1},Tween.prototype.stopGroup=function(){var a=function(a){a.stop()};this._funcGroup(a)},Tween.prototype.play=function(a){this._amountPerDelta=Math.abs(this.amountPerDelta)*(a?-1:1),this.enable=!0,this.canRunInEditor=!0,this.update()},Tween.prototype.playGroup=function(a){var b=function(b){b.play(a)};this._funcGroup(b)},Tween.prototype.resetToBeginning=function(a){this._started=!1,this._amountPerDelta=Math.abs(this.amountPerDelta)*(a?-1:1),this._factor=this.amountPerDelta<0?1:0,this.sample(this._factor,!1),a?this.setEndToCurrValue():this.setStartToCurrValue()},Tween.prototype.resetGroupToBeginning=function(a){var b=function(b){b.resetToBeginning(a)};this._funcGroup(b)},Tween.prototype.toggle=function(){this._amountPerDelta=this._factor>0?-this.amountPerDelta:Math.abs(this.amountPerDelta),this.enable=!0},Tween.prototype.onUpdate=function(){},Tween.prototype.setStartToCurrValue=function(){},Tween.prototype.setEndToCurrValue=function(){},Tween.prototype.setCurrToStartValue=function(){},Tween.prototype.setCurrToEndValue=function(){},Tween.begin=function(a,b,c){var d=b.getScript(a,!1);if(d&&0!=d.tweenGroup){d=null;for(var e=b.getScripts(a,!1),f=0;f<e.length;++f)if(e[f]&&0===e[f].tweenGroup){d=e[f];break}}if((d||(d=b.addScript(a)))&&d instanceof Tween)return d._started=!1,d.duration=c,d._factor=0,d._amountPerDelta=Math.abs(d.amountPerDelta),d.style=Tween.STYLE_ONCE,d._curve=new qc.BezierCurve(new qc.Keyframe(0,0,1,1),new qc.Keyframe(1,1,1,1)),d.enable=!0,d},Tween._funcGroup=function(a,b,c){for(var d=a.getScripts?a.getScripts("qc.Tween"):[],e=d.length;e-->0;)d[e].tweenGroup===b&&c(d[e]);var f=a.children;if(f)for(var g=f.length;g-->0;){var h=f[g];Tween._funcGroup(h,b,c)}},Tween.resetGroup=function(a,b,c){var d=function(a){a.reset(c)};Tween._funcGroup(a,b,d)},Tween.playGroupForward=function(a,b){var c=function(a){a.playForward()};Tween._funcGroup(a,b,c)},Tween.playGroupReverse=function(a,b){var c=function(a){a.playReverse()};Tween._funcGroup(a,b,c)},Tween.stopGroup=function(a,b){var c=function(a){a.stop()};Tween._funcGroup(a,b,c)},Tween.playGroup=function(a,b,c){var d=function(a){a.play(c)};Tween._funcGroup(a,b,d)},Tween.resetGroupToBeginning=function(a,b,c){var d=function(a){a.resetToBeginning(c)};Tween._funcGroup(a,b,d)},Tween.STYLE_ONCE=0,Tween.STYLE_LOOP=1,Tween.STYLE_PINGPONG=2,Tween.DIR_FORWARD=0,Tween.DIR_REVERSE=1,Tween.SAMPLE_LINEAR=0;var TweenAlpha=defineBehaviour("qc.TweenAlpha",qc.Tween,function(){var a=this;a.from=0,a.to=1,a.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER});TweenAlpha.__menu="Tween/TweenAlpha",TweenAlpha.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to;b.gameObject.alpha=Phaser.Math.clamp(c+a*(d-c),0,1)},TweenAlpha.prototype.setStartToCurrValue=function(){this.gameObject.alpha=this.from},TweenAlpha.prototype.setEndToCurrValue=function(){this.gameObject.alpha=this.to},TweenAlpha.prototype.setCurrToStartValue=function(){this.from=this.gameObject.alpha},TweenAlpha.prototype.setCurrToEndValue=function(){this.to=this.gameObject.alpha},TweenAlpha.begin=function(a,b,c){var d=qc.Tween.begin("qc.TweenAlpha",a,b);return d.from=a.alpha,d.to=c,0>=b&&(d.sample(1,!0),d.enable=!1),d};var TweenColor=defineBehaviour("qc.TweenColor",qc.Tween,function(){var a=this;a.from=Color.black,a.to=Color.white,a.enable=!1},{from:qc.Serializer.COLOR,to:qc.Serializer.COLOR});TweenColor.__menu="Tween/TweenColor",TweenColor.prototype.onUpdate=function(a){var b=this,c=b.from.rgb,d=b.to.rgb,e=[Phaser.Math.clamp(Math.round(c[0]+a*(d[0]-c[0])),0,255),Phaser.Math.clamp(Math.round(c[1]+a*(d[1]-c[1])),0,255),Phaser.Math.clamp(Math.round(c[2]+a*(d[2]-c[2])),0,255),Phaser.Math.clamp(b.from.alpha+a*(b.to.alpha-b.from.alpha),0,1)],f=new Color(e);b.gameObject.colorTint=f},TweenColor.prototype.setStartToCurrValue=function(){this.gameObject.colorTint=new Color(this.from.toString())},TweenColor.prototype.setEndToCurrValue=function(){this.gameObject.colorTint=new Color(this.to.toString())},TweenColor.prototype.setCurrToStartValue=function(){this.from=new Color(this.gameObject.colorTint.toString())},TweenColor.prototype.setCurrToEndValue=function(){this.to=new Color(this.gameObject.colorTint.toString())},TweenColor.begin=function(a,b,c){var d=qc.Tween.begin("qc.TweenColor",a,b);return d.from=new Color(a.colorTint.toString()),d.to=c,0>=b&&(d.sample(1,!0),d.enable=!1),d};var TweenPosition=defineBehaviour("qc.TweenPosition",qc.Tween,function(){var a=this;a.from=new qc.Point(0,0),a.to=new qc.Point(0,0),a.moveAxis=TweenPosition.BOTH,a.enable=!1},{from:qc.Serializer.POINT,to:qc.Serializer.POINT,moveAxis:qc.Serializer.NUMBER});TweenPosition.__menu="Tween/TweenPosition",TweenPosition.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to;0!==(b.moveAxis&TweenPosition.ONLY_X)&&(b.gameObject.x=c.x+a*(d.x-c.x)),0!==(b.moveAxis&TweenPosition.ONLY_Y)&&(b.gameObject.y=c.y+a*(d.y-c.y))},TweenPosition.prototype.setStartToCurrValue=function(){0!==(this.moveAxis&TweenPosition.ONLY_X)&&(this.gameObject.x=this.from.x),0!==(this.moveAxis&TweenPosition.ONLY_Y)&&(this.gameObject.y=this.from.y)},TweenPosition.prototype.setEndToCurrValue=function(){0!==(this.moveAxis&TweenPosition.ONLY_X)&&(this.gameObject.x=this.to.x),0!==(this.moveAxis&TweenPosition.ONLY_Y)&&(this.gameObject.y=this.to.y)},TweenPosition.prototype.setCurrToStartValue=function(){this.from=new qc.Point(this.gameObject.x,this.gameObject.y)},TweenPosition.prototype.setCurrToEndValue=function(){this.to=new qc.Point(this.gameObject.x,this.gameObject.y)},TweenPosition.begin=function(a,b,c){var d=qc.Tween.begin("qc.TweenPosition",a,b);return d.from=new qc.Point(a.x,a.y),d.to=c.clone(),0>=b&&(d.sample(1,!0),d.enable=!1),d},TweenPosition.BOTH=255,TweenPosition.ONLY_X=1,TweenPosition.ONLY_Y=2;var TweenProperty=defineBehaviour("qc.TweenProperty",qc.Tween,function(){var a=this;a.from=0,a.to=1,a.property="",a.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER,property:qc.Serializer.STRING});TweenProperty.__menu="Tween/TweenProperty",Object.defineProperties(TweenProperty.prototype,{property:{get:function(){return this._property},set:function(a){if(a!==this._property){for(var b=a.split("."),c=this.gameObject,d=0;d<b.length-1;d++)if(c=c[b[d]],!c)return void this.game.log.important("The property({0}) non-exist.",a);this._ob=c,this._attrib=b[b.length-1],this._property=a}}}}),TweenProperty.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to;b._ob[b._attrib]=c+a*(d-c)},TweenProperty.prototype.setStartToCurrValue=function(){this._ob[this._attrib]=this.from},TweenProperty.prototype.setEndToCurrValue=function(){this._ob[this._attrib]=this.to},TweenProperty.prototype.setCurrToStartValue=function(){this.from=this._ob[this._attrib]},TweenProperty.prototype.setCurrToEndValue=function(){this.to=this._ob[this._attrib]},TweenProperty.begin=function(a,b,c){var d=qc.Tween.begin("qc.TweenProperty",a,b);return d.from=this._ob[this._attrib],d.to=c,0>=b&&(d.sample(1,!0),d.enable=!1),d};var TweenRotation=defineBehaviour("qc.TweenRotation",qc.Tween,function(){var a=this;a.from=0,a.to=1,a.enable=!1},{from:qc.Serializer.NUMBER,to:qc.Serializer.NUMBER});TweenRotation.__menu="Tween/TweenRotation",TweenRotation.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to;b.gameObject.rotation=c+a*(d-c)},TweenRotation.prototype.setStartToCurrValue=function(){
this.gameObject.rotation=this.from},TweenRotation.prototype.setEndToCurrValue=function(){this.gameObject.rotation=this.to},TweenRotation.prototype.setCurrToStartValue=function(){this.from=this.gameObject.rotation},TweenRotation.prototype.setCurrToEndValue=function(){this.to=this.gameObject.rotation},TweenRotation.begin=function(a,b,c){var d=qc.Tween.begin("qc.TweenRotation",a,b);return d.from=a.rotation,d.to=c,0>=b&&(d.sample(1,!0),d.enable=!1),d};var TweenScale=defineBehaviour("qc.TweenScale",qc.Tween,function(){var a=this;a.from=new qc.Point(0,0),a.to=new qc.Point(1,1),a.enable=!1},{from:qc.Serializer.POINT,to:qc.Serializer.POINT});TweenScale.__menu="Tween/TweenScale",TweenScale.prototype.onUpdate=function(a){var b=this,c=b.from,d=b.to,e=new qc.Point(c.x+a*(d.x-c.x),c.y+a*(d.y-c.y));b.gameObject.scaleX=e.x,b.gameObject.scaleY=e.y},TweenScale.prototype.setStartToCurrValue=function(){this.gameObject.scaleX=this.from.x,this.gameObject.scaleY=this.from.y},TweenScale.prototype.setEndToCurrValue=function(){this.gameObject.scaleX=this.to.x,this.gameObject.scaleY=this.to.y},TweenScale.prototype.setCurrToStartValue=function(){this.from=new qc.Point(this.gameObject.scaleX,this.gameObject.scaleY)},TweenScale.prototype.setCurrToEndValue=function(){this.to=new qc.Point(this.gameObject.scaleX,this.gameObject.scaleY)},TweenScale.begin=function(a,b,c){var d=qc.Tween.begin("qc.TweenScale",a,b);return d.from=new qc.Point(a.scaleX,a.scaleY),d.to=c.clone(),0>=b&&(d.sample(1,!0),d.enable=!1),d};var TweenTransform=defineBehaviour("qc.TweenTransform",qc.Tween,function(){var a=this;a.enable=!1,a.localFrom=new qc.Point,a.localTo=new qc.Point},{from:qc.Serializer.NODE,to:qc.Serializer.NODE});TweenTransform.__menu="Tween/TweenTransform",Object.defineProperties(TweenTransform.prototype,{from:{get:function(){return this._from},set:function(a){if(this._from=a,a){var b=this._from.getWorldPosition();this.localFrom=this.gameObject.parent.toLocal(b)}}},to:{get:function(){return this._to},set:function(a){if(this._to=a,a){var b=this._to.getWorldPosition();this.localTo=this.gameObject.parent.toLocal(b)}}}}),TweenTransform.prototype.onUpdate=function(a){if(this._from&&this._to){var b=this;b.gameObject.x=b.localFrom.x+a*(b.localTo.x-b.localFrom.x),b.gameObject.y=b.localFrom.y+a*(b.localTo.y-b.localFrom.y)}};var VerticalLayout=defineBehaviour("qc.VerticalLayout",qc.TableLayout,function(){this.style=qc.TableLayout.STYLE_RESIZE_ELEMENT,this.constraint=qc.TableLayout.CONSTRAINT_FIX_COLUMN_COUNT,this.contentSizeProvider=qc.TableLayout.USE_RECTTRANSFORM,this.stride=1,this.startCorner=qc.TableLayout.CORNER_TOP_LEFT,this.startAxis=qc.TableLayout.AXIS_VERTICAL},{childForceExpandWidth:qc.Serializer.NUMBER,childForceExpandHeight:qc.Serializer.NUMBER});VerticalLayout.__menu="UI/Layout/VerticalLayout",Object.defineProperties(VerticalLayout.prototype,{spacing:{get:function(){return this.spacingY},set:function(a){this.spacingY=a}},childForceExpandWidth:{get:function(){return!!this._childForceExpandWidth},set:function(a){this._childForceExpandWidth!==a&&(this._childForceExpandWidth=a,this.rebuildTable())}},childForceExpandHeight:{get:function(){return!!this._childForceExpandHeight},set:function(a){this._childForceExpandHeight!==a&&(this._childForceExpandHeight=a,this.rebuildTable())}}}),VerticalLayout.prototype._getDefaultLayout=function(a){return"y"===a?{min:0,preferred:0,flexible:this.childForceExpandHeight?1:0,extra:0}:{min:0,preferred:this.childForceExpandWidth?this.gameObject.rect.width:-1,flexible:0,extra:0}},VerticalLayout.prototype.getCellLayout=function(a){var b=qc.LayoutElement.getLayoutElement(a);return this.childForceExpandWidth&&(b.flexibleWidth=1),this.childForceExpandHeight&&(b.flexibleHeight=1),b};var Prop=qc.Prop=function(a,b,c){var d=this;d.action=a,d.path=b,d.propertyId=c,d.propMap={},d.propDefaultValue={},d.keyIndexMap={}};Prop.prototype.constructor=Prop,Prop.prototype.destroy=function(){this.action=null,this.propMap={}},Prop.prototype.getPropMap=function(){return this.propMap},Prop.prototype.saveValue=function(a,b,c){var d;switch(a){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:case Serializer.MAPPING:d=b;break;case Serializer.COLOR:d=b instanceof Color?b.toNumber(!0):null;break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:d=[b["class"],b.toJson()];break;case Serializer.TEXTURE:if(b)if(b[0]instanceof qc.Atlas){var e=b[0],f=b[1];c.dependences.push({key:e.key,uuid:e.uuid}),d=[e.uuid,f]}else d=null;else d=null;break;case Serializer.AUDIO:b instanceof qc.SoundAsset?(c.dependences.push({key:b.key,uuid:b.uuid}),d=b.uuid):d=null;break;default:throw new Error("unsupported asset type:"+a)}return d},Prop.prototype.restoreValue=function(a,b){var c;switch(a){case Serializer.INT:case Serializer.NUMBER:case Serializer.STRING:case Serializer.BOOLEAN:case Serializer.MAPPING:c=b;break;case Serializer.COLOR:c=new Color(b);break;case Serializer.GEOM:case Serializer.POINT:case Serializer.RECTANGLE:case Serializer.CIRCLE:case Serializer.ELLIPSE:if(b){var d=qc.Util.findClass(b[0]),e=new d;e.fromJson(b[1]),c=e}else c=null;break;case Serializer.TEXTURE:if(b){var f=b[0],g=b[1],h=this.action.game.assets.findByUUID(f);h?c=h instanceof qc.Atlas?[h,g]:[null,g]:(console.error("贴图资源尚未载入，无法反序列化。",b),c=[null,g])}else c=[];break;case Serializer.AUDIO:if(b){var h=this.action.game.assets.findByUUID(b);h?c=h instanceof qc.SoundAsset?h:null:(console.error("音频资源尚未载入，无法反序列化。",b),c=null)}else c=null;break;default:throw new Error("unsupported asset type:"+a)}return c},Prop.prototype.setData=function(){},Prop.prototype.fromJson=function(){return 0},Prop.prototype.toJson=function(){return[]},Prop.prototype.addKey=function(){return 0},Prop.prototype.deleteKey=function(){return 0},Prop.prototype.getDuration=function(){return{}},Prop.prototype.getValue=function(){},Prop.prototype.getValueByIndex=function(){},Prop.prototype.setValue=function(){},Prop.prototype.isKey=function(){return!1},Prop.prototype.update=function(){},Prop.prototype.reset=function(){this.keyIndexMap={}};var KeyProp=qc.KeyProp=function(a,b,c){var d=this;qc.Prop.call(d,a,b,c)};KeyProp.prototype=Object.create(qc.Prop.prototype),KeyProp.prototype.constructor=KeyProp,KeyProp.prototype.fromJson=function(a,b){this.propertyInfo=a,this.forceUpdate=a.forceUpdate;for(var c=0,d=a.properties,e=0;e<d.length;e++){var f,g=d[e].attrib;if("string"==typeof g){var h=g.split(".");h.length>1&&(f=h)}if(this.propDefaultValue[g]=d[e]["default"],b){var i=b[e];if(i){for(var j=i[0],k=i[1],l=[],m=0;m<k.length;m++)l.push([k[m][0],this.restoreValue(j,k[m][1])]);if(this.propMap[g]=[j,l,f],l.length>0){var n=l[l.length-1][0];n>c&&(c=n)}}else this.propMap[g]||(this.propMap[g]=[d[e].type,[],f])}else this.propMap[g]=[d[e].type,[],f]}return c},KeyProp.prototype.toJson=function(a){for(var b=[],c=this.propertyInfo.properties,d=0;d<c.length;d++){var e=c[d].attrib,f=this.propMap[e],g=f[0],h=f[1];if(g&&h){for(var i=[],j=0;j<h.length;j++)i.push([h[j][0],this.saveValue(g,h[j][1],a)]);b.push([g,i])}}return b},KeyProp.prototype.addKey=function(a,b,c){var d=this.propMap[a];if(!d)return void this.action.game.log.important("KeyProp not find attrib({0}) in addKey.",a);var e=function(a,b){return a[0]<b[0]};c!==undefined&&null!==c||this.propDefaultValue[a]==undefined||(c=this.propDefaultValue[a]);var f=qc.Util.insertSortedList(d[1],[b,c],e);return f},KeyProp.prototype.deleteKey=function(a,b){var c=this.propMap[a];return c?c[1]?c[1].splice(b,1):null:void this.action.game.log.important("KeyProp not find attrib({0}) in deleteKey.",a)},KeyProp.prototype.getKeyTimeList=function(a){var b=[],c=this.propMap[a];if(!c)return this.action.game.log.important("KeyProp not find attrib({0}) in getKeyTimeList.",a),[];for(var d=0;d<c[1].length;d++)b.push(c[1][d][0]);return b},KeyProp.prototype.getDuration=function(){var a=0;for(var b in this.propMap){var c=this.propMap[b];0!==c[1].length&&c[1][c[1].length-1][0]>a&&(a=c[1][c[1].length-1][0])}return a},KeyProp.prototype.isKey=function(a,b){var c=this.propMap[a];if(0===c[1].length)return!1;for(var d=0;d<c[1].length;d++)if(this.action.game.math.fuzzyEqual(c[1][d][0],b))return d},KeyProp.prototype.setValue=function(a,b,c){var d=this.isKey(a,b);if("number"!=typeof d)return this.addKey(a,b,c),b>this.action.duration&&(this.action.duration=b),!0;var e=this.propMap[a];e[1][d][1]=c},KeyProp.prototype.getValue=function(a,b){var c=this.propMap[a];if(0===c[1].length)return null;for(var d=0;d<c[1].length;d++)if(!(c[1][d][0]<=b))return d=d>0?d-1:0,c[1][d][1];return c[1][c[1].length-1][1]},KeyProp.prototype.getValueByIndex=function(a,b){var c=this.propMap[a];return 0===c[1].length?null:c[1][b]?c[1][b][1]:null},KeyProp.prototype.updateAttrib=function(a,b,c,d){if(d){var e=d.length;if(2===e&&a[d[0]])a[d[0]][d[1]]=c;else if(e>2){for(var f=a,g=0;e-1>g&&(f=f[d[g]],f);g++);f&&(f[d[e-1]]=c)}}else a[b]=c},KeyProp.prototype.update=function(a,b,c,d,e){c&&(this.keyIndexMap={});for(var f in this.propMap){var g=this.keyIndexMap[f]||0,h=this.propMap[f];if(0!==h[1].length)if(g>h[1].length&&(this.keyIndexMap[f]=h[1].length,g=h[1].length),g<h[1].length&&h[1][g][0]<=b)for(var i=g;i<h[1].length&&h[1][i][0]<=b;i++)this.updateAttrib(a,f,h[1][i][1],h[2]),this.keyIndexMap[f]=i+1;else{for(var j=!1,i=g-1;i>=0;i--)if(h[1][i]){if(!(h[1][i][0]>b)){j=!0,(i!==g-1||d&&(e||this.forceUpdate))&&(this.updateAttrib(a,f,h[1][i][1],h[2]),this.keyIndexMap[f]=i+1);break}}else this.action.game.log.error("{0}:{1}~{2} update error: keyIndex({3}), propList({4})",this.path,this.propertyId,f,g,h[1]);j||(this.keyIndexMap[f]=0)}}};var LinearProp=qc.LinearProp=function(a,b,c){var d=this;qc.KeyProp.call(d,a,b,c)};LinearProp.prototype=Object.create(qc.KeyProp.prototype),LinearProp.prototype.constructor=LinearProp,LinearProp.prototype.calcValue=function(a,b,c){return a+c*(b-a)},LinearProp.prototype.getValue=function(a,b){var c=this.propMap[a];if(0===c[1].length)return null;if(b<=c[1][0][0])return c[1][0][1];for(var d=0;d<c[1].length;d++)if(!(c[1][d][0]<b)){d=d>0?d-1:0;var e=(b-c[1][d][0])/(c[1][d+1][0]-c[1][d][0]);return this.calcValue(c[1][d][1],c[1][d+1][1],e)}return c[1][c[1].length-1][1]},LinearProp.prototype.updateAttrib=function(a,b,c,d){if(d){var e=d.length;if(2===e&&a[d[0]])a[d[0]][d[1]]=c;else if(e>2){for(var f=a,g=0;e-1>g&&(f=f[d[g]],f);g++);f&&(f[d[e-1]]=c)}}else a[b]=c},LinearProp.prototype.update=function(a,b,c){c&&(this.keyIndexMap={});for(var d in this.propMap){var e=this.keyIndexMap[d]||0,f=this.propMap[d];if(0!==f[1].length)if(e>=f[1].length&&(this.keyIndexMap[d]=f[1].length-1,e=f[1].length-1),f[1][e][0]<=b){for(var g=e;g<f[1].length;g++)if(g===f[1].length-1)g!==e&&(this.updateAttrib(a,d,f[1][g][1],f[2]),this.keyIndexMap[d]=g);else if(f[1][g][0]<=b&&f[1][g+1][0]>b){var h=(b-f[1][g][0])/(f[1][g+1][0]-f[1][g][0]);if(f[1][g][1]&&f[1][g+1][1]){var i=this.calcValue(f[1][g][1],f[1][g+1][1],h);this.updateAttrib(a,d,i,f[2])}this.keyIndexMap[d]=g;break}}else{if(f[1][0][0]>b){this.keyIndexMap[d]=0;continue}for(var g=0;e>g;g++)if(f[1][g][0]<=b&&f[1][g+1][0]>b){var h=(b-f[1][g][0])/(f[1][g+1][0]-f[1][g][0]);if(f[1][g][1]&&f[1][g+1][1]){var i=this.calcValue(f[1][g][1],f[1][g+1][1],h);this.updateAttrib(a,d,i,f[2])}this.keyIndexMap[d]=g;break}}}};var CurveProp=qc.CurveProp=function(a,b,c){var d=this;qc.Prop.call(d,a,b,c)};CurveProp.prototype=Object.create(qc.Prop.prototype),CurveProp.prototype.constructor=CurveProp,CurveProp.prototype.fromJson=function(a,b){this.propertyInfo=a;for(var c=0,d=a.properties,e=0;e<d.length;e++){var f,g=d[e].attrib;if("string"==typeof g){var h=g.split(".");h.length>1&&(f=h)}if(this.propDefaultValue[g]=d[e]["default"],b){var i=b[e];if(i){var j=new qc.BezierCurve;if(this.propMap[g]={curveType:i[0],curve:j,to:0,attribArray:f},j.fromJson(i[1]),i[0]>=qc.CURVE_TYPE_TWEEN_RELATIVE&&(this.propMap[g].from=i[2][0],this.propMap[g].to=i[2][1]||0),j._keys.length>0){var k=j._keys[j._keys.length-1].time;k>c&&(c=k)}}}else this.propMap[g]={curveType:qc.CURVE_TYPE_ABSOLUTE,curve:new qc.BezierCurve,to:0,attribArray:f}}return c},CurveProp.prototype.toJson=function(){for(var a=[],b=this.propertyInfo.properties,c=0;c<b.length;c++){var d=b[c].attrib,e=this.propMap[d],f=[e.curveType,e.curve.toJson()];e.curveType>=qc.CURVE_TYPE_TWEEN_RELATIVE&&f.push([e.from,e.to]),a.push(f)}return a},CurveProp.prototype.setData=function(a,b){var c=this.propMap[a];return c?("number"==typeof b.curveType&&(c.curveType=b.curveType),"number"==typeof b.from&&(c.from=b.from),void("number"==typeof b.to&&(c.to=b.to))):void this.action.game.log.important("CurveProp not find attrib({0}) in setData.",a)},CurveProp.prototype.getMaxValue=function(a){var b=this.propMap[a];if(!b)return void this.action.game.log.important("CurveProp not find attrib({0}) in getMaxValue.",a);for(var c=!1,d=0;d<b.curve._keys.length;d++)c===!1?c=b.curve._keys[d].value:c<b.curve._keys[d].value&&(c=b.curve._keys[d].value);return b.curveType===qc.CURVE_TYPE_ABSOLUTE?c:b.curveType===qc.CURVE_TYPE_RELATIVE?b.from+c:b.curveType===qc.CURVE_TYPE_TWEEN_ABSOLUTE?b.from+c*(b.to-b.from):b.curveType===qc.CURVE_TYPE_TWEEN_RELATIVE?b.from+c*b.to:void 0},CurveProp.prototype.getFromValue=function(a,b,c){var d=this.propMap[b];if(!d)return void this.action.game.log.important("CurveProp not find attrib({0}) in getFromValue.",b);if("number"==typeof d.from)return d.from;if(a){var e;if(d.attribArray){var f=d.attribArray.length;if(2===f)e=a[d.attribArray[0]]?a[d.attribArray[0]][d.attribArray[1]]:null;else if(f>2){for(var g=a,h=0;f-1>h&&(g=g[d.attribArray[h]],g);h++);g&&(e=g[d.attribArray[f-1]])}}else e=a[b];var i=this.getValue(b,c,!0)||0,j=d.to,k=i;return d.curveType===qc.CURVE_TYPE_RELATIVE?k=e-i:d.curveType===qc.CURVE_TYPE_TWEEN_RELATIVE&&(k=e-(j?j*i:0)),d.from=k,k}},CurveProp.prototype.addKey=function(a,b,c){var d=this.propMap[a];if(!d)return void this.action.game.log.important("CurveProp not find attrib({0}) in addKey.",a);c!==undefined&&null!==c||this.propDefaultValue[a]==undefined||(c=this.propDefaultValue[a]),c=c||0;var e=d.curve.addKey(b,c);return d.curve.makeKeyframeLinear(e-1),d.curve.makeKeyframeLinear(e),d.curve.makeKeyframeLinear(e+1),e},CurveProp.prototype.deleteKey=function(a,b){var c=this.propMap[a];return c?void c.curve.removeKey(b):void this.action.game.log.important("CurveProp not find attrib({0}) in deleteKey.",a)},CurveProp.prototype.getKeyTimeList=function(a){var b=[],c=this.propMap[a];if(!c)return this.action.game.log.important("CurveProp not find attrib({0}) in getKeyTimeList.",a),[];for(var d=0;d<c.curve._keys.length;d++)b.push(c.curve._keys[d].time);return b},CurveProp.prototype.getDuration=function(){var a=0;for(var b in this.propMap){var c=this.propMap[b],d=c.curve;if(!(d._keys.length<1)){var e=d._keys[d._keys.length-1].time;e>a&&(a=e)}}return a},CurveProp.prototype.getValue=function(a,b,c){var d=this.propMap[a],e=d.from,f=d.to,g=d.curveType,h=d.curve,i=h.evaluate(b);return c?i:g===qc.CURVE_TYPE_ABSOLUTE?i:g===qc.CURVE_TYPE_RELATIVE?e+i:g===qc.CURVE_TYPE_TWEEN_ABSOLUTE?e+i*(f-e):e+i*f},CurveProp.prototype.getValueByIndex=function(a,b){var c=this.propMap[a],d=c.curve;return d._keys[b]?d._keys[b].value:null},CurveProp.prototype.setValue=function(a,b,c){var d=this.isKey(a,b);if("number"!=typeof d)return this.addKey(a,b,c),b>this.action.duration&&(this.action.duration=b),!0;var e=this.propMap[a],f=e.curve;f._keys[d].value=c,e.curve.makeKeyframeLinear(d-1),e.curve.makeKeyframeLinear(d),e.curve.makeKeyframeLinear(d+1)},CurveProp.prototype.isKey=function(a,b){var c=this.propMap[a],d=c.curve;if(0===d._keys.length)return!1;for(var e=0;e<d._keys.length;e++)if(this.action.game.math.fuzzyEqual(d._keys[e].time,b))return e},CurveProp.prototype.update=function(a,b,c,d){c&&(this.keyIndexMap={});for(var e in this.propMap)if(d||!this.keyIndexMap[e]){var f,g=this.propMap[e],h=g.curve,i=g.curveType;if(c&&(i===qc.CURVE_TYPE_RELATIVE||i===qc.CURVE_TYPE_TWEEN_RELATIVE)){if(g.attribArray){var j=g.attribArray.length;if(2===j)f=a[g.attribArray[0]]?a[g.attribArray[0]][g.attribArray[1]]:null;else if(j>2){for(var k=a,l=0;j-1>l&&(k=k[g.attribArray[l]],k);l++);k&&(f=k[g.attribArray[j-1]])}}else f=a[e];g.from=f}if(!(h._keys.length<=0||h._keys[0].time>b)){var m=this.getFromValue(a,e,b),n=g.to,o=h.evaluate(b);if(!d&&h._keys[h._keys.length-1].time<=b&&(this.keyIndexMap[e]=1),f=i===qc.CURVE_TYPE_ABSOLUTE?o:i===qc.CURVE_TYPE_RELATIVE?m+o:i===qc.CURVE_TYPE_TWEEN_ABSOLUTE?m+o*(n-m):m+o*n,g.attribArray){var j=g.attribArray.length;if(2===j&&a[g.attribArray[0]])a[g.attribArray[0]][g.attribArray[1]]=f;else if(j>2){for(var k=a,l=0;j-1>l&&(k=k[g.attribArray[l]],k);l++);k&&(k[g.attribArray[j-1]]=f)}}else a[e]=f}}};var ActionState=qc.ActionState=function(a){var b=this;b.game=a,b.name="",b.targetObject=null,b.targetLocked=!1,b.eventList=[],b.samples=60,b.duration=0,b.speed=1,b.startTime=0,b.elapsedFrame=0,b.loop=!1,b.playEventInEditor=!0,b.isRunning=!1,b.onFinished=new qc.Signal,b.onLoopFinished=new qc.Signal,b.unpackDone=!1};ActionState.prototype.constructor=ActionState,ActionState.prototype.awake=function(){this.unpackDone=!0,"string"==typeof this.targetObject&&(this.targetObject=this.game.nodePool.find(this.targetObject))},ActionState.prototype.destroy=function(){var a=this;a.targetObject=null,a.isRunning=!1,a.eventList=[],a.onFinished.removeAll(),a.onLoopFinished.removeAll()},ActionState.prototype.getDuration=function(){return this.duration},ActionState.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0},ActionState.prototype.playAction=function(a,b){return this.isRunning=!0,!this.targetLocked&&a&&(this.targetObject=a),b&&this.reset(),this.update(null,!0)},ActionState.prototype.stop=function(){this.isRunning=!1},ActionState.prototype.addEvent=function(a,b,c){var d=function(a,b){return a[0]<b[0]},e=qc.Util.insertSortedList(this.eventList,[a,b,c],d,!0);return e},ActionState.prototype.deleteEvent=function(a){return this.eventList?this.eventList.splice(a,1):null},ActionState.prototype.setEvent=function(a,b,c){var d=this.eventList[a];d&&(d[b]=c)},ActionState.prototype.getEventInfo=function(a){var b=this.eventList[a];if(b)return{func:b[1],para:b[2]}},ActionState.prototype.triggerEvent=function(a){var b=this.eventList[0][0],c=this.eventList[this.eventList.length-1][0];if(!(this.elapsedFrame<b||a>c))for(var d=0;d<this.eventList.length;d++)if(!(this.eventList[d][0]<=a)){if(!(this.eventList[d][0]<=this.elapsedFrame))break;if(this.eventList[d][1])for(var e=0;e<this.targetObject.scripts.length;e++){var f=this.targetObject.scripts[e];if(f[this.eventList[d][1]]){var g=this.eventList[d][2];Array.isArray(g)||(g="string"==typeof g?[g]:[]),f[this.eventList[d][1]].apply(f,g)}}}},ActionState.prototype.update=function(){},ActionState.buildEmptyBundle=function(){return{}},ActionState.buildBundle=function(a){var b={dependences:[]};return a.targetObject&&(b.targetObject=a.targetObject.uuid),b.targetLocked=a.targetLocked,b.loop=a.loop,b.samples=a.samples,b.speed=a.speed,b.playEventInEditor=a.playEventInEditor,a.name&&(b.name=a.name),b.eventList=JSON.stringify(a.eventList),b},ActionState.restoreBundle=function(a,b,c){var d=b.json,e=a.game;if(a.uuid=b.uuid,a.key=b.key,a.name=d.name?d.name:b.key.match(/\/([^\/]+?).bin/)[1],d.__json&&(a.__json=d.__json),d.eventList)try{a.eventList=JSON.parse(d.eventList)}catch(f){e.log.error(f)}return a.targetLocked=d.targetLocked,a.loop=d.loop,a.samples=d.samples||60,a.speed=d.speed||1,a.playEventInEditor="boolean"==typeof d.playEventInEditor?d.playEventInEditor:!0,a.targetObject=c?e.nodePool.find(d.targetObject):e.nodePool.find(d.targetObject)||d.targetObject,c&&a.awake(),a};var Action=qc.Action=function(a){var b=this;b.propertyList={},b.actionList=[],qc.ActionState.call(b,a),b["class"]="qc.Action"};Action.prototype=Object.create(qc.ActionState.prototype),Action.prototype.constructor=Action,Object.defineProperties(Action.prototype,{targetObject:{get:function(){return this._targetObject},set:function(a){this.unpackDone&&a===this._targetObject&&this._targetObject||(this._targetObject=a,this.unpackDone&&(this.actionList=[],a&&this.refreshActionList()))}}}),Action.prototype.awake=function(){return this.unpackDone=!0,"string"==typeof this.targetObject?this.targetObject=this.game.nodePool.find(this.targetObject):"object"==typeof this.targetObject&&0===this.actionList.length&&this.refreshActionList(),!this.targetObject&&this.targetLocked?void this.game.log.trace("Action({0}) can not find targetObject.",this.name):void 0},Action.prototype.destroy=function(){var a=this;a.targetObject=null,a.isRunning=!1;for(var b in a.propertyList)a.propertyList[b].destroy();a.propertyList={},a.actionList=[],a.eventList=[],a.onFinished.removeAll(),a.onLoopFinished.removeAll()},Action.prototype.refreshActionList=function(){if(!this.targetObject)return void this.game.log.trace("Action({0}) can not find targetObject.",this.name);this.actionList=[];for(var a in this.propertyList){var b=a.match(/(.*):(.*)/),c=b[1],d=(b[2],this.targetObject.find(c));d?this.actionList.push({target:d,propOb:this.propertyList[a]}):this.game.log.error("In action({0}), target({1}) not find child({2})",this.key,this.targetObject?this.targetObject.name:null,c)}},Action.prototype.addProperty=function(a,b,c,d){var e=a+":"+b,f=this.propertyList[e];if(f)return void this.game.log.important("Action has duplicate key : {0} in addProperty",e);var g=qc.ActionProperties[b];if(!g)return void this.game.log.important("Can't find propertyId : {0} in addProperty",b);var h=qc.Util.findClass(g["class"]);f=new h(this,a,b);var i=f.fromJson(g,c);this.duration<i&&(this.duration=i),this.propertyList[e]=f,d&&this.refreshActionList()},Action.prototype.removeProperty=function(a,b){var c=a+":"+b,d=this.propertyList[c];return d?(d.destroy(),delete this.propertyList[c],this.refreshActionList(),void(this.duration=this.getDuration(!0,!0))):void this.game.log.important("Action not find key : {0} in removeProperty",c)},Action.prototype.getPropertyInfo=function(a,b){var c=a+":"+b,d=this.propertyList[c];return d?d.getPropMap():void this.game.log.important("Action not find key : {0} in getPropertyInfo",c)},Action.prototype.setData=function(a,b,c,d){var e=a+":"+b,f=this.propertyList[e];return f?void f.setData(c,d):void this.game.log.important("Action has't property : {0} in setData",e)},Action.prototype.addKey=function(a,b,c,d,e){var f=a+":"+b,g=this.propertyList[f];if(!g)return void this.game.log.important("Action has't property : {0} in addKey",f);g.addKey(c,d,e);d>this.duration&&(this.duration=d)},Action.prototype.deleteKey=function(a,b,c,d){var e=a+":"+b,f=this.propertyList[e];if(!f)return void this.game.log.important("Action has't property : {0} in deleteKey",e);var g=f.getKeyTimeList(c),h=g[d];f.deleteKey(c,d),this.duration==h&&(this.duration=this.getDuration(!0,!0))},Action.prototype.getDuration=function(a,b){if(a){var c=0;for(var d in this.propertyList){var e=this.propertyList[d],f=e.getDuration();f>c&&(c=f)}this.duration=c}return this.loop&&!b?qc.MAX_DURATION:this.duration},Action.prototype.getValue=function(a,b,c,d,e){var f=a+":"+b,g=this.propertyList[f];return g?g.getValue(c,d,e):void this.game.log.important("Action has't property : {0} in getValue",f)},Action.prototype.getValueByIndex=function(a,b,c,d){var e=a+":"+b,f=this.propertyList[e];return f?f.getValueByIndex(c,d):void this.game.log.important("Action has't property : {0} in getValueByIndex",e)},Action.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0;for(var a=0;a<this.actionList.length;a++){var b=this.actionList[a];b.propOb.reset()}},Action.prototype.update=function(a,b,c,d){if((this.isRunning||c)&&this.targetObject){var e=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop)return this.isRunning=!1,this.onFinished.dispatch(this),qc.FinishTrigger;this.onLoopFinished.dispatch(this),this.isRunning=!0;for(var f=this.elapsedFrame-this.duration;f>=this.duration;)f-=this.duration;a=f/(this.samples*this.speed)*1e3,this.reset(),this.startTime=e-a}a="number"==typeof a?a:this.game.time.deltaTime,this.startTime||(this.startTime=e),e===this.startTime&&(a=0);var g=b?-1:this.elapsedFrame;this.elapsedFrame+=a/1e3*this.samples*this.speed;for(var h=0;h<this.actionList.length;h++){var i=this.actionList[h];i.propOb.update(i.target,this.elapsedFrame,b,c,d)}(!c||this.playEventInEditor)&&this.eventList.length>0&&this.triggerEvent(g)}},Action.buildEmptyBundle=function(){return{propertyList:{}}},Action.buildBundle=function(a){var b=qc.ActionState.buildBundle(a),c={};for(var d in a.propertyList){var e=d.match(/(.*):(.*)/),f=e[1],g=e[2];c[f]=c[f]||{},c[f][g]=a.propertyList[d].toJson(b)}return b.propertyList=c,b},Action.restoreBundle=function(a,b,c){var d=a.json,e=new qc.Action(b);for(var f in d.propertyList)for(var g in d.propertyList[f])e.addProperty(f,g,d.propertyList[f][g]);return e=qc.ActionState.restoreBundle(e,a,c)},qc.MAX_DURATION=4294967295,qc.CURVE_TYPE_RELATIVE=1,qc.CURVE_TYPE_ABSOLUTE=2,qc.CURVE_TYPE_TWEEN_RELATIVE=3,qc.CURVE_TYPE_TWEEN_ABSOLUTE=4,qc.PROP_POSITION=1,qc.PROP_ROTATION=2,qc.PROP_ALPHA=3,qc.PROP_SCALE=4,qc.PROP_COLOR_TINT=5,qc.PROP_VISIBLE=6,qc.PROP_SIZE=7,qc.PROP_SKEW=8,qc.PROP_TEXTURE=9,qc.PROP_ANIMATION=10,qc.PROP_COLOR=11,qc.PROP_TEXT=12,qc.PROP_PIVOT=13,qc.PROP_ANCHORED_POSITION=14,qc.PROP_TOGGLE_ON=15,qc.PROP_SCROLLBAR_VALUE=16,qc.PROP_SCROLLVIEW_POSITION=17,qc.PROP_PROGRESSBAR_VALUE=18,qc.PROP_SLIDER_VALUE=19,qc.PROP_SOUND=20,qc.PROP_DOM_INNERHTML=21,qc.PROP_TILEMAP_POSITION=22,qc.ActionProperties={},qc.ActionProperties[qc.PROP_POSITION]={name:"Position","class":"qc.CurveProp",curve:!0,properties:[{attrib:"x",type:Serializer.NUMBER},{attrib:"y",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_ANCHORED_POSITION]={name:"AnchoredPosition","class":"qc.CurveProp",curve:!0,properties:[{attrib:"anchoredX",type:Serializer.NUMBER},{attrib:"anchoredY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_ROTATION]={name:"Rotation","class":"qc.CurveProp",curve:!0,properties:[{attrib:"rotation",type:"angle"}]},qc.ActionProperties[qc.PROP_ALPHA]={name:"Alpha","class":"qc.CurveProp",curve:!0,properties:[{attrib:"alpha",type:Serializer.NUMBER,min:0,max:1,precision:2}]},qc.ActionProperties[qc.PROP_SCALE]={name:"Scale","class":"qc.CurveProp",curve:!0,properties:[{attrib:"scaleX",type:Serializer.NUMBER},{attrib:"scaleY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_COLOR_TINT]={name:"ColorTint","class":"qc.ColorLinearProp",properties:[{attrib:"colorTint",type:Serializer.COLOR,"default":qc.Color.white}]},qc.ActionProperties[qc.PROP_VISIBLE]={name:"Visible","class":"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"visible",type:Serializer.BOOLEAN,"default":!0}]},qc.ActionProperties[qc.PROP_SIZE]={name:"Size","class":"qc.CurveProp",curve:!0,properties:[{attrib:"width",type:Serializer.NUMBER},{attrib:"height",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_PIVOT]={name:"Pivot","class":"qc.CurveProp",curve:!0,properties:[{attrib:"pivotX",type:Serializer.NUMBER},{attrib:"pivotY",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SKEW]={name:"Skew","class":"qc.CurveProp",curve:!0,properties:[{attrib:"skewX",type:"angle"},{attrib:"skewY",type:"angle"}]},qc.ActionProperties[qc.PROP_TEXTURE]={name:"Texture","class":"qc.TextureKeyProp",forceUpdate:!0,properties:[{attrib:"texture",type:Serializer.TEXTURE}]},qc.ActionProperties[qc.PROP_ANIMATION]={name:"Animation","class":"qc.AnimationKeyProp",properties:[{attrib:"defaultAnimation",type:Serializer.STRING}]},qc.ActionProperties[qc.PROP_COLOR]={name:"Color","class":"qc.ColorLinearProp",properties:[{attrib:"color",type:Serializer.COLOR,"default":qc.Color.white}]},qc.ActionProperties[qc.PROP_TEXT]={name:"Text","class":"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"text",type:Serializer.STRING,"default":""}]},qc.ActionProperties[qc.PROP_TOGGLE_ON]={name:"ToggleOn","class":"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"on",type:Serializer.BOOLEAN,"default":!0}]},qc.ActionProperties[qc.PROP_SCROLLBAR_VALUE]={name:"ScrollBarValue","class":"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SCROLLVIEW_POSITION]={name:"ScrollViewPosition","class":"qc.CurveProp",curve:!0,properties:[{attrib:"horizontalNormalizedPosition",type:Serializer.NUMBER},{attrib:"verticalNormalizedPosition",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_PROGRESSBAR_VALUE]={name:"ProgressBarValue","class":"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SLIDER_VALUE]={name:"SliderValue","class":"qc.CurveProp",curve:!0,properties:[{attrib:"value",type:Serializer.NUMBER}]},qc.ActionProperties[qc.PROP_SOUND]={name:"Sound","class":"qc.KeyProp",properties:[{attrib:"audio",type:Serializer.AUDIO},{attrib:"isPlaying",type:Serializer.BOOLEAN,"default":!0}]},qc.ActionProperties[qc.PROP_DOM_INNERHTML]={name:"DomInnerHTML","class":"qc.KeyProp",forceUpdate:!0,properties:[{attrib:"innerHTML",type:Serializer.STRING,"default":""}]},qc.ActionProperties[qc.PROP_TILEMAP_POSITION]={name:"TilemapPosition","class":"qc.CurveProp",curve:!0,properties:[{attrib:"scrollX",type:Serializer.NUMBER},{attrib:"scrollY",type:Serializer.NUMBER}]},qc.FinishTrigger=1,qc.EventTrigger=2,qc.propertyList={"qc.Node":[qc.PROP_POSITION,qc.PROP_ANCHORED_POSITION,qc.PROP_ROTATION,qc.PROP_ALPHA,qc.PROP_SCALE,qc.PROP_COLOR_TINT,qc.PROP_VISIBLE,qc.PROP_SIZE,qc.PROP_PIVOT],"qc.UIImage":[qc.PROP_SKEW,qc.PROP_TEXTURE],"qc.Sprite":[qc.PROP_TEXTURE,qc.PROP_ANIMATION],"qc.UIText":[qc.PROP_COLOR,qc.PROP_TEXT],"qc.Button":[qc.PROP_TEXTURE],"qc.Toggle":[qc.PROP_TOGGLE_ON],"qc.ScrollBar":[qc.PROP_TEXTURE,qc.PROP_SCROLLBAR_VALUE],"qc.ScrollView":[qc.PROP_TEXTURE,qc.PROP_SCROLLVIEW_POSITION],"qc.ProgressBar":[qc.PROP_TEXTURE,qc.PROP_PROGRESSBAR_VALUE],"qc.Slider":[qc.PROP_TEXTURE,qc.PROP_SLIDER_VALUE],"qc.InputField":[qc.PROP_TEXTURE,qc.PROP_TEXT],"qc.Sound":[qc.PROP_SOUND],"qc.Dom":[qc.PROP_DOM_INNERHTML],"qc.Graphics":[],"qc.UIRoot":[],"qc.Tilemap":[qc.PROP_TILEMAP_POSITION]},qc.extend=qc.extend||{},qc.extend.addProperty=function(a,b,c){qc.ActionProperties[b]=c===qc.Serializer.NUMBER?{name:b,"class":"qc.CurveProp",curve:!0,isCustomProperty:!0,properties:[{attrib:b,type:qc.Serializer.NUMBER}]}:c===qc.Serializer.TEXTURE?{name:b,"class":"qc.TextureKeyProp",forceUpdate:!0,isCustomProperty:!0,properties:[{attrib:b,type:qc.Serializer.TEXTURE}]}:c===qc.Serializer.COLOR?{name:b,"class":"qc.ColorLinearProp",isCustomProperty:!0,properties:[{attrib:b,type:Serializer.COLOR,"default":qc.Color.white}]}:{name:b,"class":"qc.KeyProp",forceUpdate:!0,isCustomProperty:!0,properties:[{attrib:b,type:c}]},qc.propertyList[a]=qc.propertyList[a]||[],qc.propertyList[a].push(b)};var ActionManager=qc.ActionManager=function(a){var b=this;b.actionList=[],qc.ActionState.call(b,a),b["class"]="qc.ActionManager",b._endLinePos=-1,b.runningActions={}};ActionManager.prototype=Object.create(qc.ActionState.prototype),ActionManager.prototype.constructor=ActionManager,ActionManager.prototype.awake=function(){if(this.unpackDone=!0,"string"==typeof this.targetObject&&(this.targetObject=this.game.nodePool.find(this.targetObject)),!this.targetObject&&this.targetLocked)return void this.game.log.trace("Action({0}) can not find targetObject.",this.name);for(var a=0;a<this.actionList.length;a++)this.actionList[a]&&this.actionList[a][1]&&this.actionList[a][1].awake()},ActionManager.prototype.destroy=function(){var a=this;a.isRunning=!1,a._targetObject=null;for(var b=0;b<this.actionList.length;b++)this.actionList[b]&&this.actionList[b][1]&&this.actionList[b][1].destroy();a.actionList=[]},Object.defineProperties(ActionManager.prototype,{targetObject:{get:function(){return this._targetObject},set:function(a){if(!this.unpackDone||a!==this._targetObject||!this._targetObject){this._targetObject=a;for(var b=0;b<this.actionList.length;b++)if(this.actionList[b]){var c=this.actionList[b][1];c&&!c.targetLocked&&(c.targetObject=a)}}}},isRunning:{get:function(){return this._isRunning},set:function(a){this._isRunning=a;

for(var b=0;b<this.actionList.length;b++)if(this.actionList[b]){var c=this.actionList[b][1];c&&(c.isRunning=a)}}},endLinePos:{get:function(){return this._endLinePos},set:function(a){this._endLinePos=a,a>-1?this.duration=a:this.getDuration(!0)}}}),ActionManager.prototype.reset=function(){this.elapsedFrame=0,this.startTime=0,this.runningActions={};for(var a=0;a<this.actionList.length;a++)if(this.actionList[a]){var b=this.actionList[a][1];b&&b.reset()}},ActionManager.prototype.update=function(a,b,c,d){if((this.isRunning||c)&&this.targetObject){var e=this.game.time.scaledTime;if(this.elapsedFrame>=this.duration){if(!this.loop)return this.isRunning=!1,this.onFinished.dispatch(this),qc.FinishTrigger;this.onLoopFinished.dispatch(this),this.isRunning=!0;for(var f=this.elapsedFrame-this.duration;f>=this.duration;)f-=this.duration;a=f/(this.samples*this.speed)*1e3,this.reset();var g=function(a,b,c){a.startTime=b;var d=c*a.samples*a.speed/1e3;if(a.duration<d&&(a.elapsedFrame=d),a instanceof qc.ActionManager)for(var e=0;e<a.actionList.length;e++){var f=a.actionList[e];if(f){var h=f[1];g(h,b,c)}}};g(this,e-a,a)}a="number"==typeof a?a:this.game.time.deltaTime,this.startTime||(this.startTime=e),e===this.startTime&&(a=0);var h=b?-1:this.elapsedFrame;this.elapsedFrame+=a/1e3*this.samples*this.speed,this.eventList.length>0&&(!c||this.playEventInEditor)&&this.triggerEvent(h),a*=this.speed;for(var i=0;i<this.actionList.length;i++){var j=this.actionList[i];if(j){var e=j[0],k=j[1];if(!(this.elapsedFrame<e)){var l=!1;this.runningActions[i]||(l=!0),k.update(a,l,c,d),this.runningActions[i]=!0}}}}},ActionManager.prototype.addAction=function(a){var b=this,c=b.actionList.push(a),d=a[0],e=a[1];if(e.parent=b,b.endLinePos>-1)return c;var f=e.getDuration();if(f===qc.MAX_DURATION)b.duration=f;else{var g=b.samples,h=e.samples;f=f*g/h,b.duration<d+f&&(b.duration=d+f)}return c},ActionManager.prototype.deleteAction=function(a){var b=this;if(b.actionList[a]){var c=b.actionList[a][1],d=0;if(c){var e=c.getDuration();if(e===qc.MAX_DURATION)d=qc.MAX_DURATION;else{var f=b.samples,g=c.samples;e=e*f/g,d=b.actionList[a][0]+e}c.destroy(),c.parent=undefined}delete b.actionList[a],this.duration===d&&this.getDuration(!0)}},ActionManager.prototype.updateActionTime=function(a,b){var c=this,d=c.actionList[a];d&&(d[0]=b,c.getDuration(!0))},ActionManager.prototype.getDuration=function(a,b){if(a&&this.endLinePos<=-1){for(var c=0,d=0;d<this.actionList.length;d++){var e=this.actionList[d];if(e){var f=e[1].getDuration(),g=e[0];if(f===qc.MAX_DURATION)c=qc.MAX_DURATION;else{var h=this.samples,i=e[1].samples;f=f*h/i/e[1].speed,g+f>c&&(c=g+f)}}}this.duration=c}return this.loop&&!b?qc.MAX_DURATION:this.endLinePos>-1?this.endLinePos:this.duration},ActionManager.buildEmptyBundle=function(){return{actionList:[]}},ActionManager.buildBundle=function(a){var b=qc.ActionState.buildBundle(a);b.endLinePos=a.endLinePos;for(var c=[],d=0;d<a.actionList.length;d++){var e=a.actionList[d];if(e){var f=e[1],g=e[0],h=f.uuid,i=f.loop,j=f.targetObject?f.targetObject.uuid:undefined;b.dependences.push({key:f.key,uuid:h}),c.push([g,h,i,j,f.targetLocked,f.speed])}}return b.actionList=c,b},ActionManager.restoreBundle=function(a,b,c,d){var e=a.json,f=new qc.ActionManager(b);if(d||(d={}),d[a.uuid])return b.log.error("Failed to add this action({0}) because of recursive reference.",a.key),!1;d[a.uuid]=!0,f.endLinePos=e.endLinePos?e.endLinePos:-1;for(var g=0;g<e.actionList.length;g++){var h=e.actionList[g]||[],i=h[0],j=h[1],k=h[2],l=h[3],m=h[4],n=h[5]||1,o=b.assets.findByUUID(j);if(o){var p;if(o instanceof qc.ActionAsset)p=qc.Action.restoreBundle(o,b,!b.serializer.isRestoring);else if(o instanceof qc.ActionManagerAsset&&(p=qc.ActionManager.restoreBundle(o,b,!b.serializer.isRestoring,d),!p))return delete d[a.uuid],!1;p.loop=k,p.speed=n,p.targetObject=b.serializer.isRestoring?b.nodePool.find(l)||l:b.nodePool.find(l),p.targetLocked=m,f.addAction([i,p])}}return delete d[a.uuid],f=qc.ActionState.restoreBundle(f,a,c)};var AnimationKeyProp=qc.AnimationKeyProp=function(a,b,c){var d=this;qc.KeyProp.call(d,a,b,c)};AnimationKeyProp.prototype=Object.create(qc.KeyProp.prototype),AnimationKeyProp.prototype.constructor=AnimationKeyProp,AnimationKeyProp.prototype.updateAttrib=function(a,b,c){for(var d=this.action,e=d.speed;d.parent;)e*=d.parent.speed,d=d.parent;a.playAnimation(c,e)};var ColorLinearProp=qc.ColorLinearProp=function(a,b,c){var d=this;qc.LinearProp.call(d,a,b,c)};ColorLinearProp.prototype=Object.create(qc.LinearProp.prototype),ColorLinearProp.prototype.constructor=ColorLinearProp,ColorLinearProp.prototype.calcValue=function(a,b,c){if(!a||!b)return qc.Color.white;var d=a.rgb,e=b.rgb,f=[Phaser.Math.clamp(Math.round(d[0]+c*(e[0]-d[0])),0,255),Phaser.Math.clamp(Math.round(d[1]+c*(e[1]-d[1])),0,255),Phaser.Math.clamp(Math.round(d[2]+c*(e[2]-d[2])),0,255),Phaser.Math.clamp(a.alpha+c*(b.alpha-a.alpha),0,1)],g=new Color(f);return g};var TextureKeyProp=qc.TextureKeyProp=function(a,b,c){var d=this;qc.KeyProp.call(d,a,b,c)};TextureKeyProp.prototype=Object.create(qc.KeyProp.prototype),TextureKeyProp.prototype.constructor=TextureKeyProp,TextureKeyProp.prototype.updateAttrib=function(a,b,c,d){if(!c){var e=this.action.game.assets.find("__builtin_resource__"),f=e?e.frameNames[0]:0;c=[e,f]}var e=c[0],f=c[1],g=e?new qc.Texture(e,f):null;if(d){var h=d.length;if(2===h&&a[d[0]])a[d[0]][d[1]]=g;else if(h>2){for(var i=a,j=0;h-1>j&&(i=i[d[j]],i);j++);i&&(i[d[h-1]]=g)}}else a[b]=g};var Time=qc.Time=function(a){this.phaser=a.phaser.time,this.phaser._qc=this,this.onFrameRateChanged=new qc.Signal};Time.prototype.constructor=Time,Object.defineProperties(Time.prototype,{game:{get:function(){return this.phaser.game._qc}},now:{get:function(){return Date.now()}},fixedTime:{get:function(){return 1e3*this.phaser.totalElapsedSeconds()}},scaledTime:{get:function(){return this.phaser._totalEscapeTime||0}},timeScale:{get:function(){return this.phaser.slowMotion},set:function(a){0>=a&&(a=1e-6),this.phaser.slowMotion=a}},frameRate:{get:function(){return this.phaser.desiredFps},set:function(a){this.phaser.desiredFps=a,this.onFrameRateChanged.dispatch(a)}},deltaTime:{get:function(){return this.phaser.frameDeltaTime}}}),Time.prototype.applyFrameRate=function(a){var b=this.game.device.desktop?a.desktop:a.mobile;this.frameRate=b};var LinkList=qc.LinkList=function(a){for(this.length=a,this.head=null,this.tail=null;a--;)this.push({})};LinkList.prototype={},LinkList.prototype.constructor=LinkList,LinkList.prototype.push=function(a){a.pre=null,a.next=null,this.head?(this.tail.next=a,a.pre=this.tail,this.tail=this.tail.next):(this.head=a,this.tail=this.head),this.length++},LinkList.prototype.insertBefore=function(a,b){if(!a)return void this.push(b);var c=a.pre;a.pre=b,b.next=a,b.pre=c,c&&(c.next=b),b.pre||(this.head=b)},LinkList.prototype.remove=function(a){var b=a.pre,c=a.next;b&&(b.next=c),c&&(c.pre=b),a===this.head&&(this.head=c),a===this.tail&&(this.tail=b),a.pre=null,a.next=null,this.length--};var Timer=qc.Timer=function(a){var b=this;b.game=a,b.paused=!1,b.events=new qc.LinkList(0),b.loopEvents=new qc.LinkList(0),this._nextTimerBegin=0,this._nextLoopTimerBegin=0};Timer.prototype.constructor=Timer,Timer.prototype.create=function(a,b,c,d,e){a=Math.round(a);var f=new Phaser.TimerEvent(this,a,a,0,b,c,d,e);return this._pushEvent(b?this.loopEvents:this.events,f),f},Timer.prototype.add=function(a,b,c){var a=a>0?a:1;return a+=this._nextTimerBegin,this.create(a,!1,b,c,Array.prototype.splice.call(arguments,3))},Timer.prototype.loop=function(a,b,c){var a=a>0?a:1;return a+=this._nextLoopTimerBegin,this.create(a,!0,b,c,Array.prototype.splice.call(arguments,3))},Timer.prototype.remove=function(a){a.__delete=!0},Timer.prototype.update=function(a){if(!this.paused){this._now=this._now?this._now:a;var b=(a-this._now)/this.game.time.timeScale;this._now=a;for(var c=this.events.head,d=b,e=0;c&&(c.delta-=d,!(c.delta>0));){if(e++,e>2e3)throw new Error("timer loop forever!");this._nextTimerBegin=d=-c.delta,this.events.remove(c),c.__delete||c.callback.apply(c.callbackContext,c.args),c=this.events.head}this._nextTimerBegin=0;var f=[];for(c=this.loopEvents.head,d=b;c&&(c.delta-=d,!(c.delta>0));)this._nextLoopTimerBegin=d=-c.delta,this.loopEvents.remove(c),c.__delete||(f.push(c),c.callback.apply(c.callbackContext,c.args)),c=this.loopEvents.head;this._nextLoopTimerBegin=0;for(var g=0;g<f.length;g++)this._pushEvent(this.loopEvents,f[g])}},Timer.prototype._pushEvent=function(a,b){var c=a.head;if(!c)return b.delta=b.delay,void a.push(b);for(var d=b.delay;c;){if(!(d>=c.delta))return c.delta-=d,b.delta=d,a.insertBefore(c,b),b;d-=c.delta,c=c.next}return b.delta=d,a.push(b),b},qc.TimerEvent=Phaser.TimerEvent;var Filter=qc.Filter=function(a){Phaser.Filter.call(this,a),this._textureCount=1,this.extraAttribute=[],this.customInspectors={}};Filter.prototype=Object.create(Phaser.Filter.prototype),Filter.prototype.constructor=Filter,Object.defineProperties(Filter.prototype,{textureCount:{get:function(){return this._textureCount}}}),Filter.prototype.registerCustomInspector=function(a,b){this.customInspectors[a]=b},Filter.filters={},Filter.F1="1f",Filter.F1V="1fv",Filter.I1="1i",Filter.F2="2f",Filter.F2V="2fv",Filter.I2="2i",Filter.I2V="2iv",Filter.F3="3f",Filter.F3V="3fv",Filter.I3="3i",Filter.I3V="3iv",Filter.F4="4f",Filter.F4V="4fv",Filter.I4="4i",Filter.I4V="4iv",Filter.MAT2="mat2",Filter.MAT3="mat3",Filter.MAT4="mat4",Filter.SAMPLER2D="sampler2D",Filter.MAX_SAMPLE_COUNT=8,Filter.mixinUniform=function(a,b){if(b)for(var c in b){var d=b[c],e=d===Filter.SAMPLER2D;if(!(e&&a.textureCount>=Filter.MAX_SAMPLE_COUNT)){var f=function(){var b=c;return e?(a._textureCount++,function(){return a[b]&&a[b].filterTexture}):function(){return a[b]}};if(a.uniforms[c]=new UniformHelp(d,f()),e){var g="a"+c.substring(0,1).toUpperCase()+c.substring(1)+"Coord";a.extraAttribute.push({name:g,texture:c})}}}},Filter.uniformToJson=function(a,b,c){switch(a){case Filter.F1:case Filter.I1:case Filter.I2V:case Filter.F2V:case Filter.I3V:case Filter.F3V:case Filter.I4V:case Filter.F4V:case Filter.MAT2:case Filter.MAT3:case Filter.MAT4:return[a,b];case Filter.I2:case Filter.F2:return[a,[b.x,b.y]];case Filter.I3:case Filter.F3:return[a,[b.x,b.y,b.z]];case Filter.I4:case Filter.F4:return[a,[b.x,b.y,b.z,b.w]];case Filter.SAMPLER2D:if(!(b instanceof FilterTexture))return[a,[]];var d=b.texture;return d?(c.dependences.push({key:d.key,uuid:d.uuid}),[a,[d.key,d.url,d.uuid,b.frame]]):[a,[]]}return[a,[]]},Filter.uniformFromJson=function(a,b,c,d,e){if(e)switch(d){case Filter.F1:case Filter.I1:case Filter.I2V:case Filter.F2V:case Filter.I3V:case Filter.F3V:case Filter.I4V:case Filter.F4V:case Filter.MAT2:case Filter.MAT3:case Filter.MAT4:return void(b[c]=e);case Filter.I2:case Filter.F2:return void(b[c]?(b[c].x=e[0],b[c].y=e[1]):b[c]={x:e[0],y:e[1]});case Filter.I3:case Filter.F3:return void(b[c]?(b[c].x=e[0],b[c].y=e[1],b[c].z=e[2]):b[c]={x:e[0],y:e[1],z:e[2]});case Filter.I4:case Filter.F4:return void(b[c]?(b[c].x=e[0],b[c].y=e[1],b[c].z=e[2],b[c].w=e[3]):b[c]={x:e[0],y:e[1],z:e[2],w:e[3]});case Filter.SAMPLER2D:if(!e)return;var f=new FilterTexture(a);if(e.length>0){var g=a.assets.find(e[0],e[1]);if(g||(g=a.assets.findByUUID(e[2])),!g)return void a.log.error("Texture({0}) not loaded, deserialize fail.",e[1]);if(!(g instanceof qc.Atlas))return;f.texture=g,f.frame=e[3]}return void(b[c]=f)}},Serializer.prototype._saveFilter=function(a,b,c,d,e){e&&(b[d]=this._saveFilterItem(e,c))},Serializer.prototype._restoreFilter=function(a,b,c,d){a[c]=this._restoreFilterItem(d)},Serializer.prototype._saveFilterItem=function(a,b){var c=a.getExtraUniforms(),d={};for(var e in c){var f=c[e];d[e]=Filter.uniformToJson(f,a[e],b)}return[Serializer.FILTER,a["class"],d]},Serializer.prototype._restoreFilterItem=function(a){var b=qc.Util.findClass(a[1]);if(!b)return void console.warn("着色器脚本：{0}未找到，无法反序列化。",a[1]);var c=a[2],d=new b(this.game),e=d.getExtraUniforms();for(var f in e){var g=e[f];c[f]&&g===c[f][0]&&Filter.uniformFromJson(this.game,d,f,g,c[f][1])}return d};var defineFilter=qc.defineFilter=function(a,b,c,d){for(var e=a.split("."),f=window,g=0;g<e.length-1;g++)f[e[g]]||(f[e[g]]={}),f=f[e[g]];var h=e[e.length-1];return b=b||qc.Filter,"function"==typeof d&&(d=d.call(this)),d=d||{},f[h]=function(d){b.call(this,d),this["class"]=a,this["super"]=b.prototype;var e=this.getExtraUniforms();Filter.mixinUniform(this,e),"function"==typeof c&&c.call(this,d)},f[h].prototype=Object.create(b.prototype),f[h].prototype.constructor=f[h],f[h].prototype.getExtraUniforms=function(){var a=b.prototype.getExtraUniforms?b.prototype.getExtraUniforms.call(this):{};return mixin(a,d)},f[h].prototype.clazz=a,Filter.filters[a]=f[h],f[h]},FilterTexture=qc.Filter.FilterTexture=function(a){this._image=new qc.UIImage(a,null,!1),this._image.parent.removeChild(this._image)};FilterTexture.prototype={},FilterTexture.prototype.constructor=FilterTexture,Object.defineProperties(FilterTexture.prototype,{texture:{get:function(){return this._image.texture},set:function(a){this._image.texture=a}},frame:{get:function(){return this._image.frame},set:function(a){this._image.frame=a}},filterTexture:{get:function(){return this._image.phaser.texture}}});var UniformHelp=qc.Filter.UniformHelp=function(a,b){this._type=a,this._value=b,this._valueIsFunc="function"==typeof this._value};UniformHelp.prototype={},UniformHelp.prototype.constructor=UniformHelp,Object.defineProperties(UniformHelp.prototype,{type:{get:function(){return this._type}},value:{get:function(){return this._valueIsFunc?this._value():this._value}}});var BlendTexture=defineFilter("qc.Filter.AlphaMask",qc.Filter,function(){this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = add.a * original;","}"]},{otherTexture:qc.Filter.SAMPLER2D}),BlendTexture=defineFilter("qc.Filter.BlendTexture",qc.Filter,function(){this.mixing=.5,this.otherTexture=null,this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec2 aOtherTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vOtherTextureCoord = aOtherTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec2 vOtherTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","uniform sampler2D otherTexture;","uniform float mixing;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(otherTexture, vOtherTextureCoord);","   gl_FragColor = mixing * add + (1.0 - mixing) * original;","}"]},{otherTexture:qc.Filter.SAMPLER2D,mixing:qc.Filter.F1}),BlurX=defineFilter("qc.Filter.BlurX",qc.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x - 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x - 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x - blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x + blur*pixelSize.x, vTextureCoord.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 2.0*blur*pixelSize.x, vTextureCoord.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 3.0*blur*pixelSize.x, vTextureCoord.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x + 4.0*blur*pixelSize.x, vTextureCoord.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:qc.Filter.F1});Object.defineProperty(BlurX.prototype,"blur",{get:function(){return this._blur},set:function(a){this.dirty=!0,this._blur=a,this.padding=Math.max(0,a)}});var BlurY=defineFilter("qc.Filter.BlurY",qc.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform float blur;","uniform sampler2D uSampler;","uniform vec2 pixelSize;","void main(void) {","vec4 sum = vec4(0.0);","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 4.0*blur*pixelSize.y)) * 0.05;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y - blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y)) * 0.16;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + blur*pixelSize.y)) * 0.15;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 2.0*blur*pixelSize.y)) * 0.12;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 3.0*blur*pixelSize.y)) * 0.09;","sum += texture2D(uSampler, vec2(vTextureCoord.x, vTextureCoord.y + 4.0*blur*pixelSize.y)) * 0.05;","gl_FragColor = sum;","}"],this.blur=1},{blur:qc.Filter.F1});Object.defineProperty(BlurY.prototype,"blur",{get:function(){return this._blur},set:function(a){this.dirty=!0,this._blur=a,this.padding=Math.max(0,a)}});var Glow=defineFilter("qc.Filter.Glow",qc.Filter,function(a){this.distance=40,this.outerStrength=1.5,this.innerStrength=1,this.glowColor=[1,0,0],this.pixelWidth=1/a.phaser.renderer.width,this.pixelHeight=1/a.phaser.renderer.height,this._updateFragmentSrc(),this.registerCustomInspector("glowColor",qc.Color)},{distance:qc.Filter.F1,outerStrength:qc.Filter.F1,innerStrength:qc.Filter.F1,glowColor:qc.Filter.F3V});Object.defineProperty(Glow.prototype,"distance",{get:function(){return this._distance},set:function(a){this._distance=a,this._updateFragmentSrc(),this.shaders=[]}}),Glow.prototype._updateFragmentSrc=function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","uniform sampler2D texture;","uniform float distance;","uniform float outerStrength;","uniform float innerStrength;","uniform vec3 glowColor;","uniform float pixelWidth;","uniform float pixelHeight;","vec2 px = vec2("+this.pixelWidth+", "+this.pixelHeight+");","void main(void) {","    const float PI = 3.14159265358979323846264;","    vec4 ownColor = texture2D(texture, vTextureCoord);","    vec4 curColor;","    float totalAlpha = 0.;","    float maxTotalAlpha = 0.;","    float offset = 0.;","    for (float curDistance = 0.; curDistance <= "+this.distance.toFixed(7)+"; curDistance++) {","       offset = curDistance - distance / 2.;","       curColor = texture2D(texture, vec2(vTextureCoord.x + offset * px.x, vTextureCoord.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x, vTextureCoord.y + offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.25) * offset * px.x, vTextureCoord.y + sin(PI * 0.25) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","       curColor = texture2D(texture, vec2(vTextureCoord.x + cos(PI * 0.75) * offset * px.x, vTextureCoord.y + sin(PI * 0.75) * offset * px.y));","       totalAlpha += (distance - curDistance) * curColor.a;","       maxTotalAlpha += (distance - curDistance);","    }","    maxTotalAlpha = max(maxTotalAlpha, 0.0001);","    ownColor.a = max(ownColor.a, 0.0001);","    ownColor.rgb = ownColor.rgb / ownColor.a;","    float outerGlowAlpha = (totalAlpha / maxTotalAlpha)  * outerStrength * (1. - ownColor.a);","    float innerGlowAlpha = ((maxTotalAlpha - totalAlpha) / maxTotalAlpha) * innerStrength * ownColor.a;","    float resultAlpha = (ownColor.a + outerGlowAlpha);","    gl_FragColor = vec4(mix(mix(ownColor.rgb, glowColor, innerGlowAlpha / ownColor.a), glowColor.rgb, outerGlowAlpha / resultAlpha) * resultAlpha, resultAlpha);","}"]};var GraphicsTexture=qc.Filter.GraphicsTexture=function(a,b,c,d,e){var f=this;f.game=a,f._texture=new qc.RenderTexture(b||100,c||100,d||f.game.phaser.render,null,e||f.game.resolution),f.offset=new qc.Point(0,0),f._graphics=f.game.phaser.add.graphics(0,0),f._graphics.parent&&f._graphics.parent.remove(f._graphics)};GraphicsTexture.prototype={},GraphicsTexture.prototype.constructor=GraphicsTexture,Object.defineProperties(GraphicsTexture.prototype,{graphics:{get:function(){return this._graphics}},filterTexture:{get:function(){return this._texture}}}),GraphicsTexture.prototype.updateTexture=function(){var a=this,b=a._texture,c=a._graphics;c.dirty&&b.directRenderWebGL(c,a.offset,!0)},GraphicsTexture.prototype.resize=function(a,b){a=1>=a?1:a,b=1>=b?1:b,this._texture.resize(a,b,!0)};var Gray=defineFilter("qc.Filter.Gray",qc.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   float gray = original.r * 0.3 + original.g * 0.59 + original.b * 0.11;","   gl_FragColor =  original;","   gl_FragColor.r = gray;","   gl_FragColor.g = gray;","   gl_FragColor.b = gray;","}"]},{}),Highlight=defineFilter("qc.Filter.Highlight",qc.Filter,function(){this.vertexSrc=["attribute vec2 aVertexPosition;","attribute vec2 aTextureCoord;","attribute vec4 aColor;","uniform vec2 projectionVector;","uniform vec2 offsetVector;","uniform float light;","uniform vec3 lightColor;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","const vec2 center = vec2(-1.0, 1.0);","void main(void) {","   gl_Position = vec4( ((aVertexPosition + offsetVector) / projectionVector) + center , 0.0, 1.0);","   vTextureCoord = aTextureCoord;","   vColor = vec4(aColor.rgb * aColor.a, aColor.a);","   vLight = light * vec4(lightColor, 0.0);","}"],this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec4 vLight;","uniform sampler2D uSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   gl_FragColor = original + original.a * vLight;","}"],this.light=.5,this.lightColor=[1,1,1],this.registerCustomInspector("lightColor",qc.Color)},{light:qc.Filter.F1,lightColor:qc.Filter.F3V}),KeepSource=defineFilter("qc.Filter.KeepSource",qc.Filter,function(){this.fragmentSrc=["precision mediump float;","varying vec2 vTextureCoord;","varying vec4 vColor;","varying vec2 vMaskCoord;","varying vec4 vMaskLimit;","uniform sampler2D uSampler;","uniform sampler2D uSourceSampler;","void main(void) {","   vec4 original =  texture2D(uSampler, vTextureCoord);","   vec4 add =  texture2D(uSourceSampler, vTextureCoord);","   gl_FragColor =  add.a * add + (1.0 - add.a) * original;","}"]},{})}}).call(this,this,Object);